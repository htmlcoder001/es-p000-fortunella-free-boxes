YMaps.onLoad(function(yt,bt){function a(t,e){if("string"!=typeof t)return null;var i=t.match(n);if(!i)return null;e=function(t){var e={};if("string"==typeof t){var i="+"==r.trim(t)?["+"]:t.toLowerCase().split(/\s*\+\s*/);e.altKey=-1!=r.inArray("alt",i),e.ctrlKey=-1!=r.inArray("ctrl",i),e.shiftKey=-1!=r.inArray("shift",i),e.key=i[i.length-1]}else{if(void 0===t)return null;(e=t).altKey=!!e.alt,e.ctrlKey=!!e.ctrl,e.shiftKey=!!e.shift}if(e.shortcut=(e.altKey?"alt+":"")+(e.ctrlKey?"ctrl+":"")+(e.shiftKey?"shift+":"")+e.key,e.disableInInput=!!e.disableInInput,!e.key)return null;if("string"!=typeof e.key){t=parseInt(e.key);isNaN(t)||(e.key=String.fromCharCode(t).toLowerCase())}else if(e.key=e.key.toLowerCase(),1<e.key.length){var n=!1;if(r.each(l,function(){n=n||this.toString()==e.key}),!n)return null}return e}(e);if(!e||!e.key)return null;t=r.trim(t.replace(n,""));return{handled:i.join(" "),unhandled:t,parsedData:e}}var r,h,s,n,l,c,t;!function(){var w,m=this,P=yt.jQuery=function(t,e){return new P.fn.init(t,e)},o=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,i=/^.[^:#\[\.,]*$/;function l(t,e){e.src?P.ajax({url:e.src,async:!1,dataType:"script"}):P.globalEval(e.text||e.textContent||e.innerHTML||""),e.parentNode&&e.parentNode.removeChild(e)}function g(){return+new Date}P.fn=P.prototype={init:function(t,e){if((t=t||document).nodeType)return this[0]=t,this.length=1,this.context=t,this;if("string"==typeof t){var i=o.exec(t);if(!i||!i[1]&&e)return P(e).find(t);if(!i[1]){var n=document.getElementById(i[3]);if(n&&n.id!=i[3])return P().find(t);n=P(n||[]);return n.context=document,n.selector=t,n}t=P.clean([i[1]],e)}else if(P.isFunction(t))return P(document).ready(t);return t.selector&&t.context&&(this.selector=t.selector,this.context=t.context),this.setArray(P.isArray(t)?t:P.makeArray(t))},selector:"",jquery:"@VERSION",size:function(){return this.length},get:function(t){return t===w?Array.prototype.slice.call(this):this[t]},pushStack:function(t,e,i){t=P(t);return t.prevObject=this,t.context=this.context,"find"===e?t.selector=this.selector+(this.selector?" ":"")+i:e&&(t.selector=this.selector+"."+e+"("+i+")"),t},setArray:function(t){return this.length=0,Array.prototype.push.apply(this,t),this},each:function(t,e){return P.each(this,t,e)},index:function(t){return P.inArray(t&&t.jquery?t[0]:t,this)},attr:function(e,t,i){var n=e;if("string"==typeof e){if(t===w)return this[0]&&P[i||"attr"](this[0],e);(n={})[e]=t}return this.each(function(t){for(e in n)P.attr(i?this.style:this,e,P.prop(this,n[e],i,t,e))})},css:function(t,e){return("width"==t||"height"==t)&&parseFloat(e)<0&&(e=w),this.attr(t,e,"curCSS")},text:function(t){if("object"!=typeof t&&null!=t)return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(t));var e="";return P.each(t||this,function(){P.each(this.childNodes,function(){8!=this.nodeType&&(e+=1!=this.nodeType?this.nodeValue:P.fn.text([this]))})}),e},wrapAll:function(t){return this[0]&&(t=P(t,this[0].ownerDocument).clone(),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild;)t=t.firstChild;return t}).append(this)),this},wrapInner:function(t){return this.each(function(){P(this).contents().wrapAll(t)})},wrap:function(t){return this.each(function(){P(this).wrapAll(t)})},append:function(){return this.domManip(arguments,!0,function(t){1==this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1==this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)})},end:function(){return this.prevObject||P([])},push:[].push,sort:[].sort,splice:[].splice,find:function(e){if(1!==this.length)return this.pushStack(P.unique(P.map(this,function(t){return P.find(e,t)})),"find",e);var t=this.pushStack([],"find",e);return t.length=0,P.find(e,this[0],t),t},clone:function(t){var n,o,e=this.map(function(){if(P.support.noCloneEvent||P.isXMLDoc(this))return this.cloneNode(!0);var t,e=this.outerHTML;return e||((t=this.ownerDocument.createElement("div")).appendChild(this.cloneNode(!0)),e=t.innerHTML),P.clean([e.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]});return!0===t&&(n=this.find("*").andSelf(),o=0,e.find("*").andSelf().each(function(){if(this.nodeName===n[o].nodeName){var t,e=P.data(n[o],"events");for(t in e)for(var i in e[t])P.event.add(this,t,e[t][i],e[t][i].data);o++}})),e},filter:function(i){return this.pushStack(P.isFunction(i)&&P.grep(this,function(t,e){return i.call(t,e)})||P.multiFilter(i,P.grep(this,function(t){return 1===t.nodeType})),"filter",i)},closest:function(e){var i=P.expr.match.POS.test(e)?P(e):null,n=0;return this.map(function(){for(var t=this;t&&t.ownerDocument;){if(i?-1<i.index(t):P(t).is(e))return P.data(t,"closest",n),t;t=t.parentNode,n++}})},not:function(t){if("string"==typeof t){if(i.test(t))return this.pushStack(P.multiFilter(t,this,!0),"not",t);t=P.multiFilter(t,this)}var e=t.length&&t[t.length-1]!==w&&!t.nodeType;return this.filter(function(){return e?P.inArray(this,t)<0:this!=t})},add:function(t){return this.pushStack(P.unique(P.merge(this.get(),"string"==typeof t?P(t):P.makeArray(t))))},is:function(t){return!!t&&0<P.multiFilter(t,this).length},hasClass:function(t){return!!t&&this.is("."+t)},val:function(e){if(e!==w)return"number"==typeof e&&(e+=""),this.each(function(){var t;1==this.nodeType&&(P.isArray(e)&&/radio|checkbox/.test(this.type)?this.checked=0<=P.inArray(this.value,e)||0<=P.inArray(this.name,e):P.nodeName(this,"select")?(t=P.makeArray(e),P("option",this).each(function(){this.selected=0<=P.inArray(this.value,t)||0<=P.inArray(this.text,t)}),t.length||(this.selectedIndex=-1)):this.value=e)});var t=this[0];if(t){if(P.nodeName(t,"option"))return(t.attributes.value||{}).specified?t.value:t.text;if(P.nodeName(t,"select")){var i=t.selectedIndex,n=[],o=t.options,s="select-one"==t.type;if(i<0)return null;for(var a=s?i:0,r=s?i+1:o.length;a<r;a++){var h=o[a];if(h.selected){if(e=P(h).val(),s)return e;n.push(e)}}return n}return(t.value||"").replace(/\r/g,"")}return w},html:function(t){return t===w?this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null:this.empty().append(t)},replaceWith:function(t){return this.after(t).remove()},eq:function(t){return this.slice(t,+t+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(i){return this.pushStack(P.map(this,function(t,e){return i.call(t,e,t)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(t,e,i){if(this[0]){var n=(this[0].ownerDocument||this[0]).createDocumentFragment(),t=P.clean(t,this[0].ownerDocument||this[0],n),o=n.firstChild;if(o)for(var s=0,a=this.length;s<a;s++)i.call((r=this[s],h=o,e&&P.nodeName(r,"table")&&P.nodeName(h,"tr")?r.getElementsByTagName("tbody")[0]||r.appendChild(r.ownerDocument.createElement("tbody")):r),1<this.length||0<s?n.cloneNode(!0):n);t&&P.each(t,l)}var r,h;return this}},P.fn.init.prototype=P.fn,P.extend=P.fn.extend=function(){var t,e=arguments[0]||{},i=1,n=arguments.length,o=!1;for("boolean"==typeof e&&(o=e,e=arguments[1]||{},i=2),"object"==typeof e||P.isFunction(e)||(e={}),n==i&&(e=this,--i);i<n;i++)if(null!=(t=arguments[i]))for(var s in t){var a=e[s],r=t[s];e!==r&&(o&&r&&"object"==typeof r&&!r.nodeType?e[s]=P.extend(o,a||(null!=r.length?[]:{}),r):r!==w&&(e[s]=r))}return e};var s=/z-?index|font-?weight|opacity|zoom|line-?height/i,a=document.defaultView||{},e=Object.prototype.toString;P.extend({noConflict:function(t){return m.$=_$,t&&(m.jQuery=_jQuery),P},isFunction:function(t){return"[object Function]"===e.call(t)},isArray:function(t){return"[object Array]"===e.call(t)},isXMLDoc:function(t){return 9===t.nodeType&&"HTML"!==t.documentElement.nodeName||!!t.ownerDocument&&P.isXMLDoc(t.ownerDocument)},globalEval:function(t){var e,i;t&&/\S/.test(t)&&(e=document.getElementsByTagName("head")[0]||document.documentElement,(i=document.createElement("script")).type="text/javascript",P.support.scriptEval?i.appendChild(document.createTextNode(t)):i.text=t,e.insertBefore(i,e.firstChild),e.removeChild(i))},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()==e.toUpperCase()},each:function(t,e,i){var n,o=0,s=t.length;if(i)if(s===w){for(n in t)if(!1===e.apply(t[n],i))break}else for(;o<s&&!1!==e.apply(t[o++],i););else if(s===w){for(n in t)if(!1===e.call(t[n],n,t[n]))break}else for(var a=t[0];o<s&&!1!==e.call(a,o,a);a=t[++o]);return t},prop:function(t,e,i,n,o){return"number"!=typeof(e=P.isFunction(e)?e.call(t,n):e)||"curCSS"!=i||s.test(o)?e:e+"px"},className:{add:function(i,t){P.each((t||"").split(/\s+/),function(t,e){1!=i.nodeType||P.className.has(i.className,e)||(i.className+=(i.className?" ":"")+e)})},remove:function(t,e){1==t.nodeType&&(t.className=e!==w?P.grep(t.className.split(/\s+/),function(t){return!P.className.has(e,t)}).join(" "):"")},has:function(t,e){return t&&-1<P.inArray(e,(t.className||t).toString().split(/\s+/))}},swap:function(t,e,i){var n,o={};for(n in e)o[n]=t.style[n],t.style[n]=e[n];for(n in i.call(t),e)t.style[n]=o[n]},css:function(t,e,i,n){if("width"!=e&&"height"!=e)return P.curCSS(t,e,i);var o,s="width"==e?["Left","Right"]:["Top","Bottom"];function a(){o="width"==e?t.offsetWidth:t.offsetHeight,"border"!==n&&P.each(s,function(){n||(o-=parseFloat(P.curCSS(t,"padding"+this,!0))||0),"margin"===n?o+=parseFloat(P.curCSS(t,"margin"+this,!0))||0:o-=parseFloat(P.curCSS(t,"border"+this+"Width",!0))||0})}return 0!==t.offsetWidth?a():P.swap(t,{position:"absolute",visibility:"hidden",display:"block"},a),Math.max(0,Math.round(o))},curCSS:function(t,e,i){var n,o,s=t.style;return"opacity"!=e||P.support.opacity?(e.match(/float/i)&&(e=b),!i&&s&&s[e]?o=s[e]:a.getComputedStyle?(e=(e=e.match(/float/i)?"float":e).replace(/([A-Z])/g,"-$1").toLowerCase(),(n=a.getComputedStyle(t,null))&&(o=n.getPropertyValue(e)),"opacity"==e&&""==o&&(o="1")):t.currentStyle&&(n=e.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),o=t.currentStyle[e]||t.currentStyle[n],!/^\d+(px)?$/i.test(o)&&/^\d/.test(o)&&(e=s.left,n=t.runtimeStyle.left,t.runtimeStyle.left=t.currentStyle.left,s.left=o||0,o=s.pixelLeft+"px",s.left=e,t.runtimeStyle.left=n)),o):""==(o=P.attr(s,"opacity"))?"1":o},clean:function(t,r,e){if(void 0===(r=r||document).createElement&&(r=r.ownerDocument||r[0]&&r[0].ownerDocument||document),!e&&1===t.length&&"string"==typeof t[0]){var i=/^<(\w+)\s*\/?>$/.exec(t[0]);if(i)return[r.createElement(i[1])]}var h=[],n=[],l=r.createElement("div");if(P.each(t,function(t,e){if("number"==typeof e&&(e+=""),e){if("string"==typeof e){var i=(e=e.replace(/(<(\w+)[^>]*?)\/>/g,function(t,e,i){return i.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?t:e+"></"+i+">"})).replace(/^\s+/,"").substring(0,10).toLowerCase(),n=(i.indexOf("<opt")?!i.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]:[1,"<select multiple='multiple'>","</select>"])||i.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!i.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!i.indexOf("<td")||!i.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!i.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!P.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];for(l.innerHTML=n[1]+e+n[2];n[0]--;)l=l.lastChild;if(!P.support.tbody)for(var o=/<tbody/i.test(e),s=i.indexOf("<table")||o?"<table>"!=n[1]||o?[]:l.childNodes:l.firstChild&&l.firstChild.childNodes,a=s.length-1;0<=a;--a)P.nodeName(s[a],"tbody")&&!s[a].childNodes.length&&s[a].parentNode.removeChild(s[a]);!P.support.leadingWhitespace&&/^\s/.test(e)&&l.insertBefore(r.createTextNode(e.match(/^\s*/)[0]),l.firstChild),e=P.makeArray(l.childNodes)}e.nodeType?h.push(e):h=P.merge(h,e)}}),e){for(var o=0;h[o];o++)!P.nodeName(h[o],"script")||h[o].type&&"text/javascript"!==h[o].type.toLowerCase()?(1===h[o].nodeType&&h.splice.apply(h,[o+1,0].concat(P.makeArray(h[o].getElementsByTagName("script")))),e.appendChild(h[o])):n.push(h[o].parentNode?h[o].parentNode.removeChild(h[o]):h[o]);return n}return h},attr:function(t,e,i){if(!t||3==t.nodeType||8==t.nodeType)return w;var n=!P.isXMLDoc(t),o=i!==w;if(e=n&&P.props[e]||e,t.tagName){var s=/href|src|style/.test(e);if("selected"==e&&t.parentNode&&t.parentNode.selectedIndex,e in t&&n&&!s){if(o){if("type"==e&&P.nodeName(t,"input")&&t.parentNode)throw"type property can't be changed";t[e]=i}if(P.nodeName(t,"form")&&t.getAttributeNode(e))return t.getAttributeNode(e).nodeValue;if("tabIndex"!=e)return t[e];var a=t.getAttributeNode("tabIndex");return a&&a.specified?a.value:t.nodeName.match(/(button|input|object|select|textarea)/i)||t.nodeName.match(/^(a|area)$/i)&&t.href?0:w}if(!P.support.style&&n&&"style"==e)return P.attr(t.style,"cssText",i);o&&t.setAttribute(e,""+i);s=!P.support.hrefNormalized&&n&&s?t.getAttribute(e,2):t.getAttribute(e);return null===s?w:s}return P.support.opacity||"opacity"!=e?(e=e.replace(/-([a-z])/gi,function(t,e){return e.toUpperCase()}),o&&(t[e]=i),t[e]):(o&&(t.zoom=1,t.filter=(t.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(i)+""=="NaN"?"":"alpha(opacity="+100*i+")")),t.filter&&0<=t.filter.indexOf("opacity=")?parseFloat(t.filter.match(/opacity=([^)]*)/)[1])/100+"":"")},trim:function(t){return(t||"").replace(/^\s+|\s+$/g,"")},makeArray:function(t){var e=[];if(null!=t){var i=t.length;if(null==i||"string"==typeof t||P.isFunction(t)||t.setInterval)e[0]=t;else for(;i;)e[--i]=t[i]}return e},inArray:function(t,e){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},merge:function(t,e){var i,n=0,o=t.length;if(P.support.getAll)for(;null!=(i=e[n++]);)t[o++]=i;else for(;null!=(i=e[n++]);)8!=i.nodeType&&(t[o++]=i);return t},unique:function(e){var i=[],t={};try{for(var n=0,o=e.length;n<o;n++){var s=P.data(e[n]);t[s]||(t[s]=!0,i.push(e[n]))}}catch(t){i=e}return i},grep:function(t,e,i){for(var n=[],o=0,s=t.length;o<s;o++)!i!=!e(t[o],o)&&n.push(t[o]);return n},map:function(t,e){for(var i=[],n=0,o=t.length;n<o;n++){var s=e(t[n],n);null!=s&&(i[i.length]=s)}return i.concat.apply([],i)}});var t=navigator.userAgent.toLowerCase();function n(t,e){return t[0]&&parseInt(P.curCSS(t[0],e,!0),10)||0}P.browser={version:(t.match(/(?:rv|webkit|opera|msie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(t),opera:/opera/.test(t),msie:/msie/.test(t)&&!/opera/.test(t),mozilla:/mozilla/.test(t)&&!/(compatible|webkit)/.test(t)},P.each({parent:function(t){return t.parentNode},parents:function(t){return P.dir(t,"parentNode")},next:function(t){return P.nth(t,2,"nextSibling")},prev:function(t){return P.nth(t,2,"previousSibling")},nextAll:function(t){return P.dir(t,"nextSibling")},prevAll:function(t){return P.dir(t,"previousSibling")},siblings:function(t){return P.sibling(t.parentNode.firstChild,t)},children:function(t){return P.sibling(t.firstChild)},contents:function(t){return P.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:P.makeArray(t.childNodes)}},function(i,n){P.fn[i]=function(t){var e=P.map(this,n);return t&&"string"==typeof t&&(e=P.multiFilter(t,e)),this.pushStack(P.unique(e),i,t)}}),P.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,r){P.fn[a]=function(t){for(var e=[],i=P(t),n=0,o=i.length;n<o;n++){var s=(0<n?this.clone(!0):this).get();P.fn[r].apply(P(i[n]),s),e=e.concat(s)}return this.pushStack(e,a,t)}}),P.each({removeAttr:function(t){P.attr(this,t,""),1==this.nodeType&&this.removeAttribute(t)},addClass:function(t){P.className.add(this,t)},removeClass:function(t){P.className.remove(this,t)},toggleClass:function(t,e){"boolean"!=typeof e&&(e=!P.className.has(this,t)),P.className[e?"add":"remove"](this,t)},remove:function(t){t&&!P.filter(t,[this]).length||(P("*",this).add([this]).each(function(){P.event.remove(this),P.removeData(this)}),this.parentNode&&this.parentNode.removeChild(this))},empty:function(){for(P(this).children().remove();this.firstChild;)this.removeChild(this.firstChild)}},function(t,e){P.fn[t]=function(){return this.each(e,arguments)}});var r="jQuery"+g(),h=0,c={};function u(){return!1}function d(){return!0}function p(t){for(var e=t.relatedTarget;e&&e!=this;)try{e=e.parentNode}catch(t){e=this}e!=this&&(t.type=t.data,P.event.handle.apply(this,arguments))}function _(n){var o=RegExp("(^|\\.)"+n.type+"(\\.|$)"),t=!0,s=[];return P.each(P.data(this,"events").live||[],function(t,e){var i;!o.test(e.type)||(i=P(n.target).closest(e.data)[0])&&s.push({elem:i,fn:e})}),s.sort(function(t,e){return P.data(t.elem,"closest")-P.data(e.elem,"closest")}),P.each(s,function(){if(!1===this.fn.call(this.elem,n,this.fn.data))return t=!1}),t}function f(t,e){return["live",t,e.replace(/\./g,"`").replace(/ /g,"|")].join(".")}P.extend({cache:{},data:function(t,e,i){var n=(n=(t=t==m?c:t)[r])||(t[r]=++h);return e&&!P.cache[n]&&(P.cache[n]={}),i!==w&&(P.cache[n][e]=i),e?P.cache[n][e]:n},removeData:function(e,t){var i=(e=e==m?c:e)[r];if(t){if(P.cache[i]){for(t in delete P.cache[i][t],t="",P.cache[i])break;t||P.removeData(e)}}else{try{delete e[r]}catch(t){e.removeAttribute&&e.removeAttribute(r)}delete P.cache[i]}},queue:function(t,e,i){var n;return t&&(e=(e||"fx")+"queue",!(n=P.data(t,e))||P.isArray(i)?n=P.data(t,e,P.makeArray(i)):i&&n.push(i)),n},dequeue:function(t,e){var i=P.queue(t,e),n=i.shift();(n=!e||"fx"===e?i[0]:n)!==w&&n.call(t)}}),P.fn.extend({data:function(t,e){var i=t.split(".");if(i[1]=i[1]?"."+i[1]:"",e!==w)return this.trigger("setData"+i[1]+"!",[i[0],e]).each(function(){P.data(this,t,e)});var n=this.triggerHandler("getData"+i[1]+"!",[i[0]]);return(n=n===w&&this.length?P.data(this[0],t):n)===w&&i[1]?this.data(i[0]):n},removeData:function(t){return this.each(function(){P.removeData(this,t)})},queue:function(e,i){return"string"!=typeof e&&(i=e,e="fx"),i===w?P.queue(this[0],e):this.each(function(){var t=P.queue(this,e,i);"fx"==e&&1==t.length&&t[0].call(this)})},dequeue:function(t){return this.each(function(){P.dequeue(this,t)})}}),function(){var _=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,a=0,f=Object.prototype.toString,m=function(t,e,i,n){if(i=i||[],1!==(e=e||document).nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return i;var o,s,a,r=[],h=!0;for(_.lastIndex=0;null!==(o=_.exec(t));)if(r.push(o[1]),o[2]){a=RegExp.rightContext;break}if(1<r.length&&v.exec(t))if(2===r.length&&g.relative[r[0]])c=x(r[0]+r[1],e);else for(c=g.relative[r[0]]?[e]:m(r.shift(),e);r.length;)t=r.shift(),g.relative[t]&&(t+=r.shift()),c=x(t,c);else{var l=n?{expr:r.pop(),set:b(n)}:m.find(r.pop(),1===r.length&&e.parentNode?e.parentNode:e,M(e)),c=m.filter(l.expr,l.set);for(0<r.length?s=b(c):h=!1;r.length;){var u=r.pop(),d=u;g.relative[u]?d=r.pop():u="",null==d&&(d=e),g.relative[u](s,d,M(e))}}if(!(s=s||c))throw"Syntax error, unrecognized expression: "+(u||t);if("[object Array]"===f.call(s))if(h)if(1===e.nodeType)for(var p=0;null!=s[p];p++)s[p]&&(!0===s[p]||1===s[p].nodeType&&C(e,s[p]))&&i.push(c[p]);else for(p=0;null!=s[p];p++)s[p]&&1===s[p].nodeType&&i.push(c[p]);else i.push.apply(i,s);else b(s,i);if(a&&(m(a,e,i,n),y&&(hasDuplicate=!1,i.sort(y),hasDuplicate)))for(p=1;p<i.length;p++)i[p]===i[p-1]&&i.splice(p--,1);return i};m.matches=function(t,e){return m(t,null,null,e)},m.find=function(t,e,i){var n;if(!t)return[];for(var o=0,s=g.order.length;o<s;o++){var a,r=g.order[o];if(a=g.match[r].exec(t)){var h=RegExp.leftContext;if("\\"!==h.substr(h.length-1)&&(a[1]=(a[1]||"").replace(/\\/g,""),null!=(n=g.find[r](a,e,i)))){t=t.replace(g.match[r],"");break}}}return{set:n=n||e.getElementsByTagName("*"),expr:t}},m.filter=function(t,e,i,n){for(var o,s=t,a=[],r=e,h=e&&e[0]&&M(e[0]);t&&e.length;){for(var l in g.filter)if(null!=(o=g.match[l].exec(t))){var c,u,d=g.filter[l],p=!1;if(r==a&&(a=[]),g.preFilter[l])if(o=g.preFilter[l](o,r,i,a,n,h)){if(!0===o)continue}else p=c=!0;if(o)for(var _,f=0;null!=(u=r[f]);f++)u&&(_=n^!!(c=d(u,o,f,r)),i&&null!=c?_?p=!0:r[f]=!1:_&&(a.push(u),p=!0));if(c!==w){if(i||(r=a),t=t.replace(g.match[l],""),!p)return[];break}}if(t==s){if(null==p)throw"Syntax error, unrecognized expression: "+t;break}s=t}return r};var t,g=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")}},relative:{"+":function(t,e,i){var n="string"==typeof e,o=n&&!/\W/.test(e),s=n&&!o;o&&!i&&(e=e.toUpperCase());for(var a,r=0,h=t.length;r<h;r++)if(a=t[r]){for(;(a=a.previousSibling)&&1!==a.nodeType;);t[r]=s||a&&a.nodeName===e?a||!1:a===e}s&&m.filter(e,t,!0)},">":function(t,e,i){var n="string"==typeof e;if(n&&!/\W/.test(e)){e=i?e:e.toUpperCase();for(var o,s=0,a=t.length;s<a;s++)(r=t[s])&&(o=r.parentNode,t[s]=o.nodeName===e&&o)}else{for(var r,s=0,a=t.length;s<a;s++)(r=t[s])&&(t[s]=n?r.parentNode:r.parentNode===e);n&&m.filter(e,t,!0)}},"":function(t,e,i){var n,o=a++,s=h;e.match(/\W/)||(n=e=i?e:e.toUpperCase(),s=r),s("parentNode",e,o,t,n,i)},"~":function(t,e,i){var n,o=a++,s=h;"string"!=typeof e||e.match(/\W/)||(n=e=i?e:e.toUpperCase(),s=r),s("previousSibling",e,o,t,n,i)}},find:{ID:function(t,e,i){if(void 0!==e.getElementById&&!i){t=e.getElementById(t[1]);return t?[t]:[]}},NAME:function(t,e,i){if(void 0!==e.getElementsByName){for(var n=[],o=e.getElementsByName(t[1]),s=0,a=o.length;s<a;s++)o[s].getAttribute("name")===t[1]&&n.push(o[s]);return 0===n.length?null:n}},TAG:function(t,e){return m.getElementsByTagName(e,t[1])}},preFilter:{CLASS:function(t,e,i,n,o,s){if(t=" "+t[1].replace(/\\/g,"")+" ",s)return t;for(var a,r=0;null!=(a=e[r]);r++)a&&(o^(a.className&&0<=(" "+a.className+" ").indexOf(t))?i||n.push(a):i&&(e[r]=!1));return!1},ID:function(t){return t[1].replace(/\\/g,"")},TAG:function(t,e){for(var i=0;!1===e[i];i++);return e[i]&&M(e[i])?t[1]:t[1].toUpperCase()},CHILD:function(t){var e;return"nth"==t[1]&&(e=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(("even"==t[2]?"2n":"odd"==t[2]&&"2n+1")||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]),t[2]=+(e[1]+(e[2]||1)),t[3]=+e[3]),t[0]=a++,t},ATTR:function(t,e,i,n,o,s){var a=t[1].replace(/\\/g,"");return!s&&g.attrMap[a]&&(t[1]=g.attrMap[a]),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(t,e,i,n,o){if("not"===t[1]){if(!(1<t[3].match(_).length||/^\w/.test(t[3]))){o=m.filter(t[3],e,i,!0^o);return i||n.push.apply(n,o),!1}t[3]=m(t[3],null,null,e)}else if(g.match.POS.test(t[0])||g.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return!1===t.disabled&&"hidden"!==t.type},disabled:function(t){return!0===t.disabled},checked:function(t){return!0===t.checked},selected:function(t){return t.parentNode.selectedIndex,!0===t.selected},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,i){return!!m(i[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){return"text"===t.type},radio:function(t){return"radio"===t.type},checkbox:function(t){return"checkbox"===t.type},file:function(t){return"file"===t.type},password:function(t){return"password"===t.type},submit:function(t){return"submit"===t.type},image:function(t){return"image"===t.type},reset:function(t){return"reset"===t.type},button:function(t){return"button"===t.type||"BUTTON"===t.nodeName.toUpperCase()},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,i,n){return e===n.length-1},even:function(t,e){return e%2==0},odd:function(t,e){return e%2==1},lt:function(t,e,i){return e<+i[3]},gt:function(t,e,i){return e>+i[3]},nth:function(t,e,i){return+i[3]==e},eq:function(t,e,i){return+i[3]==e}},filter:{PSEUDO:function(t,e,i,n){var o=e[1],s=g.filters[o];if(s)return s(t,i,e,n);if("contains"===o)return 0<=(t.textContent||t.innerText||"").indexOf(e[3]);if("not"===o){for(var a=e[3],i=0,r=a.length;i<r;i++)if(a[i]===t)return!1;return!0}},CHILD:function(t,e){var i=e[1],n=t;switch(i){case"only":case"first":for(;n=n.previousSibling;)if(1===n.nodeType)return!1;if("first"==i)return!0;n=t;case"last":for(;n=n.nextSibling;)if(1===n.nodeType)return!1;return!0;case"nth":var o=e[2],s=e[3];if(1==o&&0==s)return!0;var a=e[0],r=t.parentNode;if(r&&(r.sizcache!==a||!t.nodeIndex)){for(var h=0,n=r.firstChild;n;n=n.nextSibling)1===n.nodeType&&(n.nodeIndex=++h);r.sizcache=a}s=t.nodeIndex-s;return 0==o?0==s:s%o==0&&0<=s/o}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||t.nodeName===e.replace("\\:",":")},CLASS:function(t,e){return-1<(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)},ATTR:function(t,e){var i=e[1],n=g.attrHandle[i]?g.attrHandle[i](t):null!=t[i]?t[i]:t.getAttribute(i),t=n+"",i=e[2],e=e[4];return null==n?"!="===i:"="===i?t===e:"*="===i?0<=t.indexOf(e):"~="===i?0<=(" "+t+" ").indexOf(e):e?"!="===i?t!=e:"^="===i?0===t.indexOf(e):"$="===i?t.substr(t.length-e.length)===e:"|="===i&&(t===e||t.substr(0,e.length+1)===e+"-"):t&&!1!==n},POS:function(t,e,i,n){var o=e[2],o=g.setFilters[o];if(o)return o(t,i,e,n)}}},v=g.match.POS;for(t in g.match)g.match[t]=RegExp(g.match[t].source+/(?![^\[]*\])(?![^\(]*\))/.source);var y,e,o,i,b=function(t,e){return t=Array.prototype.slice.call(t),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(t){b=function(t,e){var i=e||[];if("[object Array]"===f.call(t))Array.prototype.push.apply(i,t);else if("number"==typeof t.length)for(var n=0,o=t.length;n<o;n++)i.push(t[n]);else for(n=0;t[n];n++)i.push(t[n]);return i}}function r(t,e,i,n,o,s){for(var a="previousSibling"==t&&!s,r=0,h=n.length;r<h;r++){var l=n[r];if(l){a&&1===l.nodeType&&(l.sizcache=i,l.sizset=r),l=l[t];for(var c=!1;l;){if(l.sizcache===i){c=n[l.sizset];break}if(1!==l.nodeType||s||(l.sizcache=i,l.sizset=r),l.nodeName===e){c=l;break}l=l[t]}n[r]=c}}}function h(t,e,i,n,o,s){for(var a="previousSibling"==t&&!s,r=0,h=n.length;r<h;r++){var l=n[r];if(l){a&&1===l.nodeType&&(l.sizcache=i,l.sizset=r),l=l[t];for(var c=!1;l;){if(l.sizcache===i){c=n[l.sizset];break}if(1===l.nodeType)if(s||(l.sizcache=i,l.sizset=r),"string"!=typeof e){if(l===e){c=!0;break}}else if(0<m.filter(e,[l]).length){c=l;break}l=l[t]}n[r]=c}}}document.documentElement.compareDocumentPosition?y=function(t,e){e=4&t.compareDocumentPosition(e)?-1:t===e?0:1;return 0==e&&(hasDuplicate=!0),e}:"sourceIndex"in document.documentElement?y=function(t,e){e=t.sourceIndex-e.sourceIndex;return 0==e&&(hasDuplicate=!0),e}:document.createRange&&(y=function(t,e){var i=t.ownerDocument.createRange(),n=e.ownerDocument.createRange();i.selectNode(t),i.collapse(!0),n.selectNode(e),n.collapse(!0);n=i.compareBoundaryPoints(Range.START_TO_END,n);return 0===n&&(hasDuplicate=!0),n}),function(){var t=document.createElement("form"),e="script"+(new Date).getTime();t.innerHTML="<input name='"+e+"'/>";var i=document.documentElement;i.insertBefore(t,i.firstChild),document.getElementById(e)&&(g.find.ID=function(t,e,i){if(void 0!==e.getElementById&&!i){e=e.getElementById(t[1]);return e?e.id===t[1]||void 0!==e.getAttributeNode&&e.getAttributeNode("id").nodeValue===t[1]?[e]:w:[]}},g.filter.ID=function(t,e){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&i&&i.nodeValue===e}),i.removeChild(t)}(),(e=document.createElement("div")).appendChild(document.createComment("")),0<e.getElementsByTagName("*").length&&(g.find.TAG=function(t,e){var i=m.getElementsByTagName(e,t[1]);if("*"===t[1]){for(var n=[],o=0;i[o];o++)1===i[o].nodeType&&n.push(i[o]);i=n}return i}),e.innerHTML="<a href='#'></a>",e.firstChild&&void 0!==e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(g.attrHandle.href=function(t){return t.getAttribute("href",2)}),document.querySelectorAll&&(o=m,(i=document.createElement("div")).innerHTML="<p class='TEST'></p>",i.querySelectorAll&&0===i.querySelectorAll(".TEST").length||((m=function(t,e,i,n){if(e=e||document,!n&&9===e.nodeType&&!M(e))try{return b(e.querySelectorAll(t),i)}catch(t){}return o(t,e,i,n)}).find=o.find,m.filter=o.filter,m.selectors=o.selectors,m.matches=o.matches)),P.browser.msie&&(!document.documentMode||document.documentMode<8||9<=document.documentMode)?m.getElementsByTagName=function(t,e){var i=e.indexOf(":");if(-1==i)return t.getElementsByTagName(e);var n,o=e.slice(0,i),s=[];e=e.slice(i+1);for(var a=0,r=(n=t.getElementsByTagName(e)).length;a<r;a++)n[a].scopeName==o&&s.push(n[a]);return s}:m.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},document.getElementsByClassName&&document.documentElement.getElementsByClassName&&(P.browser.opera&&parseFloat(P.browser.version)<9.5||P.browser.mozilla&&parseFloat(P.browser.version)<1.9||((i=document.createElement("div")).innerHTML="<div class='test e'></div><div class='test'></div>",0!==i.getElementsByClassName("e").length&&(i.lastChild.className="e",1!==i.getElementsByClassName("e").length&&(g.order.splice(1,0,"CLASS"),g.find.CLASS=function(t,e,i){if(void 0!==e.getElementsByClassName&&!i)return e.getElementsByClassName(t[1])}))));var C=document.compareDocumentPosition?function(t,e){return 16&t.compareDocumentPosition(e)}:function(t,e){return t!==e&&(!t.contains||t.contains(e))},M=function(t){return 9===t.nodeType&&"HTML"!==t.documentElement.nodeName||!!t.ownerDocument&&M(t.ownerDocument)},x=function(t,e){for(var i,n=[],o="",s=e.nodeType?[e]:e;i=g.match.PSEUDO.exec(t);)o+=i[0],t=t.replace(g.match.PSEUDO,"");t=g.relative[t]?t+"*":t;for(var a=0,r=s.length;a<r;a++)m(t,s[a],n);return m.filter(o,n)};P.find=m,P.filter=m.filter,P.expr=m.selectors,P.expr[":"]=P.expr.filters,m.selectors.filters.hidden=function(t){return 0===t.offsetWidth||0===t.offsetHeight},m.selectors.filters.visible=function(t){return 0<t.offsetWidth||0<t.offsetHeight},m.selectors.filters.animated=function(e){return P.grep(P.timers,function(t){return e===t.elem}).length},P.multiFilter=function(t,e,i){return i&&(t=":not("+t+")"),m.matches(t,e)},P.dir=function(t,e){for(var i=[],n=t[e];n&&n!=document;)1==n.nodeType&&i.push(n),n=n[e];return i},P.nth=function(t,e,i,n){e=e||1;for(var o=0;t&&(1!=t.nodeType||++o!=e);t=t[i]);return t},P.sibling=function(t,e){for(var i=[];t;t=t.nextSibling)1==t.nodeType&&t!=e&&i.push(t);return i}}(),P.event={add:function(o,t,s,a){var r,h;3!=o.nodeType&&8!=o.nodeType&&(o.setInterval&&o!=m&&(o=m),s.guid||(s.guid=this.guid++),a!==w&&((s=this.proxy(s)).data=a),r=P.data(o,"events")||P.data(o,"events",{}),(h=P.data(o,"handle")||P.data(o,"handle",function(){return void 0===P||P.event.triggered?w:P.event.handle.apply(arguments.callee.elem,arguments)})).elem=o,P.each(t.split(/\s+/),function(t,e){var i=e.split(".");e=i.shift(),s.type=i.slice().sort().join(".");var n=r[e];P.event.specialAll[e]&&P.event.specialAll[e].setup.call(o,a,i),n||(n=r[e]={},P.event.special[e]&&!1!==P.event.special[e].setup.call(o,a,i)||(o.addEventListener?o.addEventListener(e,h,!1):o.attachEvent&&o.attachEvent("on"+e,h))),n[s.guid]=s,P.event.global[e]=!0}),o=null)},guid:1,global:{},remove:function(s,t,a){if(3!=s.nodeType&&8!=s.nodeType){var r,e,h=P.data(s,"events");if(h){if(t===w||"string"==typeof t&&"."==t.charAt(0))for(var i in h)this.remove(s,i+(t||""));else t.type&&(a=t.handler,t=t.type),P.each(t.split(/\s+/),function(t,e){var i=e.split(".");e=i.shift();var n=RegExp("(^|\\.)"+i.slice().sort().join(".*\\.")+"(\\.|$)");if(h[e]){if(a)delete h[e][a.guid];else for(var o in h[e])n.test(h[e][o].type)&&delete h[e][o];for(r in P.event.specialAll[e]&&P.event.specialAll[e].teardown.call(s,i),h[e])break;r||(P.event.special[e]&&!1!==P.event.special[e].teardown.call(s,i)||(s.removeEventListener?s.removeEventListener(e,P.data(s,"handle"),!1):s.detachEvent&&s.detachEvent("on"+e,P.data(s,"handle"))),r=null,delete h[e])}});for(r in h)break;r||((e=P.data(s,"handle"))&&(e.elem=null),P.removeData(s,"events"),P.removeData(s,"handle"))}}},trigger:function(t,e,i,n){var o=t.type||t;if(!n){if(t="object"==typeof t?t[r]?t:P.extend(P.Event(o),t):P.Event(o),0<=o.indexOf("!")&&(t.type=o=o.slice(0,-1),t.exclusive=!0),i||(t.stopPropagation(),this.global[o]&&P.each(P.cache,function(){this.events&&this.events[o]&&P.event.trigger(t,e,this.handle.elem)})),!i||3==i.nodeType||8==i.nodeType)return w;t.result=w,t.target=i,(e=P.makeArray(e)).unshift(t)}t.currentTarget=i;var s=P.data(i,"handle");if(s&&s.apply(i,e),(!i[o]||P.nodeName(i,"a")&&"click"==o)&&i["on"+o]&&!1===i["on"+o].apply(i,e)&&(t.result=!1),!n&&i[o]&&!t.isDefaultPrevented()&&(!P.nodeName(i,"a")||"click"!=o)){this.triggered=!0;try{i[o]()}catch(t){}}this.triggered=!1,t.isPropagationStopped()||(n=i.parentNode||i.ownerDocument)&&P.event.trigger(t,e,n,!0)},handle:function(t){var e;(t=arguments[0]=P.event.fix(t||m.event)).currentTarget=this;var i=t.type.split(".");t.type=i.shift(),e=!i.length&&!t.exclusive;var n,o,s=RegExp("(^|\\.)"+i.slice().sort().join(".*\\.")+"(\\.|$)");for(n in o=(P.data(this,"events")||{})[t.type]){var a=o[n];if(e||s.test(a.type)){t.handler=a,t.data=a.data;a=a.apply(this,arguments);if(a!==w&&!1===(t.result=a)&&(t.preventDefault(),t.stopPropagation()),t.isImmediatePropagationStopped())break}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(e){if(e[r])return e;var t=e;e=P.Event(t);for(var i,n=this.props.length;n;)e[i=this.props[--n]]=t[i];if(e.target||(e.target=e.srcElement||document),3==e.target.nodeType&&(e.target=e.target.parentNode),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement),e.relatedTarget&&Pt.mozilla)try{e.relatedTarget.nodeType}catch(t){e.relatedTarget=null}null==e.pageX&&null!=e.clientX&&(o=document.documentElement,s=document.body,e.pageX=e.clientX+(o&&o.scrollLeft||s&&s.scrollLeft||0)-(o.clientLeft||0),e.pageY=e.clientY+(o&&o.scrollTop||s&&s.scrollTop||0)-(o.clientTop||0)),!e.which&&(e.charCode||0===e.charCode?e.charCode:e.keyCode)&&(e.which=e.charCode||e.keyCode),!e.metaKey&&e.ctrlKey&&(e.metaKey=e.ctrlKey),!e.which&&e.button&&(e.which=1&e.button?1:2&e.button?3:4&e.button?2:0);var o=document.documentElement,s=document.body;return Pt.opera&&Pt.version<=9.27||(e.clientX-=o.clientLeft||s.clientLeft||0,e.clientY-=o.clientTop||s.clientTop||0),e},proxy:function(t,e){return(e=e||function(){return t.apply(this,arguments)}).guid=t.guid=t.guid||e.guid||this.guid++,e},special:{ready:{setup:y,teardown:function(){}}},specialAll:{live:{setup:function(t,e){P.event.add(this,e[0],_)},teardown:function(t){var e,i;t.length&&(e=0,i=RegExp("(^|\\.)"+t[0]+"(\\.|$)"),P.each(P.data(this,"events").live||{},function(){i.test(this.type)&&e++}),e<1&&P.event.remove(this,t[0],_))}}}},P.Event=function(t){if(!this.preventDefault)return new P.Event(t);t&&t.type?(this.originalEvent=t,this.type=t.type):this.type=t,this.timeStamp=g(),this[r]=!0},P.Event.prototype={preventDefault:function(){this.isDefaultPrevented=d;var t=this.originalEvent;t&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=d;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d,this.stopPropagation()},isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u},P.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(t,e){P.event.special[e]={setup:function(){P.event.add(this,t,p,e)},teardown:function(){P.event.remove(this,t,p)}}}),P.fn.extend({bind:function(t,e,i){return"unload"==t?this.one(t,e,i):this.each(function(){P.event.add(this,t,i||e,i&&e)})},one:function(t,e,i){var n=P.event.proxy(i||e,function(t){return P(this).unbind(t,n),(i||e).apply(this,arguments)});return this.each(function(){P.event.add(this,t,n,i&&e)})},unbind:function(t,e){return this.each(function(){P.event.remove(this,t,e)})},trigger:function(t,e){return this.each(function(){P.event.trigger(t,e,this)})},triggerHandler:function(t,e){if(this[0]){t=P.Event(t);return t.preventDefault(),t.stopPropagation(),P.event.trigger(t,e,this[0]),t.result}},toggle:function(t){for(var e=arguments,i=1;i<e.length;)P.event.proxy(t,e[i++]);return this.click(P.event.proxy(t,function(t){return this.lastToggle=(this.lastToggle||0)%i,t.preventDefault(),e[this.lastToggle++].apply(this,arguments)||!1}))},hover:function(t,e){return this.mouseenter(t).mouseleave(e)},ready:function(t){return y(),P.isReady?t.call(document,P):P.readyList.push(t),this},live:function(t,e){e=P.event.proxy(e);return e.guid+=this.selector+t,P(document).bind(f(t,this.selector),this.selector,e),this},die:function(t,e){return P(document).unbind(f(t,this.selector),e?{guid:e.guid+this.selector+t}:null),this}}),P.extend({isReady:!1,readyList:[],ready:function(){P.isReady||(P.isReady=!0,P.readyList&&(P.each(P.readyList,function(){this.call(document,P)}),P.readyList=null),P(document).triggerHandler("ready"))}});var v=!1;function y(){v||(v=!0,document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),P.ready()},!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),P.ready())}),document.documentElement.doScroll&&m==m.top&&function(){if(!P.isReady){try{document.documentElement.doScroll("left")}catch(t){return setTimeout(arguments.callee,0)}P.ready()}}()),P.event.add(m,"load",P.ready))}P.each("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error".split(","),function(t,e){P.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)}}),P(m).bind("unload",function(){for(var t in P.cache)1!=t&&P.cache[t].handle&&P.event.remove(P.cache[t].handle.elem)}),function(){P.support={};var t=document.documentElement,e=document.createElement("script"),i=document.createElement("div"),n="script"+(new Date).getTime();i.style.display="none",i.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var o=i.getElementsByTagName("*"),s=i.getElementsByTagName("a")[0];if(o&&o.length&&s){P.support={leadingWhitespace:3==i.firstChild.nodeType,tbody:!i.getElementsByTagName("tbody").length,objectAll:!!i.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!i.getElementsByTagName("link").length,style:/red/.test(s.getAttribute("style")),hrefNormalized:"/a"===s.getAttribute("href"),opacity:"0.5"===s.style.opacity,cssFloat:!!s.style.cssFloat,scriptEval:!1,noCloneEvent:!0,boxModel:null},e.type="text/javascript";try{e.appendChild(document.createTextNode("window."+n+"=1;"))}catch(t){}t.insertBefore(e,t.firstChild),m[n]&&(P.support.scriptEval=!0,delete m[n]),t.removeChild(e),i.attachEvent&&i.fireEvent&&(i.attachEvent("onclick",function(){P.support.noCloneEvent=!1,i.detachEvent("onclick",arguments.callee)}),i.cloneNode(!0).fireEvent("onclick")),P(function(){var t=document.createElement("div");t.style.width=t.style.paddingLeft="1px",document.body.appendChild(t),P.boxModel=P.support.boxModel=2===t.offsetWidth,document.body.removeChild(t).style.display="none"})}}();var b=P.support.cssFloat?"cssFloat":"styleFloat";P.props={for:"htmlFor",class:"className",float:b,cssFloat:b,styleFloat:b,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"},P.fn.extend({_load:P.fn.load,load:function(t,e,i){if("string"!=typeof t)return this._load(t);var n,o=t.indexOf(" ");0<=o&&(n=t.slice(o,t.length),t=t.slice(0,o));o="GET";e&&(P.isFunction(e)?(i=e,e=null):"object"==typeof e&&(e=P.param(e),o="POST"));var s=this;return P.ajax({url:t,type:o,dataType:"html",data:e,complete:function(t,e){"success"!=e&&"notmodified"!=e||s.html(n?P("<div/>").append(t.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(n):t.responseText),i&&s.each(i,[t.responseText,e,t])}}),this},serialize:function(){return P.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?P.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(t,i){var e=P(this).val();return null==e?null:P.isArray(e)?P.map(e,function(t,e){return{name:i.name,value:t}}):{name:i.name,value:e}}).get()}}),P.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(t,e){P.fn[e]=function(t){return this.bind(e,t)}});var C=g();P.extend({get:function(t,e,i,n){return P.isFunction(e)&&(i=e,e=null),P.ajax({type:"GET",url:t,data:e,success:i,dataType:n})},getScript:function(t,e){return P.get(t,null,e,"script")},getJSON:function(t,e,i){return P.get(t,e,i,"json")},post:function(t,e,i,n){return P.isFunction(e)&&(i=e,e={}),P.ajax({type:"POST",url:t,data:e,success:i,dataType:n})},ajaxSetup:function(t){P.extend(P.ajaxSettings,t)},ajaxSettings:{url:location.href,global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,xhr:function(){return m.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(i){var n,o,s,t=/=\?(&|$)/g,e=(i=P.extend(!0,i,P.extend(!0,{},P.ajaxSettings,i))).type.toUpperCase();i.data&&i.processData&&"string"!=typeof i.data&&(i.data=P.param(i.data)),"jsonp"==i.dataType&&("GET"==e?i.url.match(t)||(i.url+=(i.url.match(/\?/)?"&":"?")+(i.jsonp||"callback")+"=?"):i.data&&i.data.match(t)||(i.data=(i.data?i.data+"&":"")+(i.jsonp||"callback")+"=?"),i.dataType="json"),"json"==i.dataType&&(i.data&&i.data.match(t)||i.url.match(t))&&(n=i.jsonpCallback||"jsonp"+C++,i.data&&(i.data=(i.data+"").replace(t,"="+n+"$1")),i.url=i.url.replace(t,"="+n+"$1"),i.dataType="script",m[n]=m[n]||function(t){s=t,_(),f(),m[n]=w;try{delete m[n]}catch(t){}h&&h.removeChild(l)}),"script"==i.dataType&&null==i.cache&&(i.cache=!1),!1===i.cache&&"GET"==e&&(a=g(),t=i.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+a+"$2"),i.url=t+(t==i.url?(i.url.match(/\?/)?"&":"?")+"_="+a:"")),i.data&&"GET"==e&&(i.url+=(i.url.match(/\?/)?"&":"?")+i.data,i.data=null),i.global&&!P.active++&&P.event.trigger("ajaxStart");var a=/^(\w+:)?\/\/([^\/?#]+)/.exec(i.url);if("script"==i.dataType&&"GET"==e&&a&&(a[1]&&a[1]!=location.protocol||a[2]!=location.host)){var r,h=document.getElementsByTagName("head")[0],l=document.createElement("script");return i.scriptCharset&&(l.charset=i.scriptCharset),l.src=i.url,n||(r=!1,l.onload=l.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,_(),f(),l.onload=l.onreadystatechange=null,h.removeChild(l))}),h.appendChild(l),w}var c=!1,u=i.xhr();i.username?u.open(e,i.url,i.async,i.username,i.password):u.open(e,i.url,i.async);try{i.data&&u.setRequestHeader("Content-Type",i.contentType),i.ifModified&&u.setRequestHeader("If-Modified-Since",P.lastModified[i.url]||"Thu, 01 Jan 1970 00:00:00 GMT"),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.setRequestHeader("Accept",i.dataType&&i.accepts[i.dataType]?i.accepts[i.dataType]+", */*":i.accepts._default)}catch(t){}if(i.beforeSend&&!1===i.beforeSend(u,i))return i.global&&!--P.active&&P.event.trigger("ajaxStop"),u.abort(),!1;i.global&&P.event.trigger("ajaxSend",[u,i]);function d(t){if(0==u.readyState)p&&(clearInterval(p),p=null,i.global&&!--P.active&&P.event.trigger("ajaxStop"));else if(!c&&u&&(4==u.readyState||"timeout"==t)){if(c=!0,p&&(clearInterval(p),p=null),"success"==(o="timeout"==t?"timeout":P.httpSuccess(u)?i.ifModified&&P.httpNotModified(u,i.url)?"notmodified":"success":"error"))try{s=P.httpData(u,i.dataType,i)}catch(t){o="parsererror"}if("success"==o){var e;try{e=u.getResponseHeader("Last-Modified")}catch(t){}i.ifModified&&e&&(P.lastModified[i.url]=e),n||_()}else P.handleError(i,u,o);f(),t&&u.abort(),i.async&&(u=null)}}var p;i.async&&(p=setInterval(d,13),0<i.timeout&&setTimeout(function(){u&&!c&&d("timeout")},i.timeout));try{u.send(i.data)}catch(t){P.handleError(i,u,null,t)}function _(){i.success&&i.success(s,o),i.global&&P.event.trigger("ajaxSuccess",[u,i])}function f(){i.complete&&i.complete(u,o),i.global&&P.event.trigger("ajaxComplete",[u,i]),i.global&&!--P.active&&P.event.trigger("ajaxStop")}return i.async||d(),u},handleError:function(t,e,i,n){t.error&&t.error(e,i,n),t.global&&P.event.trigger("ajaxError",[e,t,n])},active:0,httpSuccess:function(t){try{return!t.status&&"file:"==location.protocol||200<=t.status&&t.status<300||304==t.status||1223==t.status}catch(t){}return!1},httpNotModified:function(t,e){try{var i=t.getResponseHeader("Last-Modified");return 304==t.status||i==P.lastModified[e]}catch(t){}return!1},httpData:function(t,e,i){var n=t.getResponseHeader("content-type"),n="xml"==e||!e&&n&&0<=n.indexOf("xml"),t=n?t.responseXML:t.responseText;if(n&&"parsererror"==t.documentElement.tagName)throw"parsererror";return"string"==typeof(t=i&&i.dataFilter?i.dataFilter(t,e):t)&&("script"==e&&P.globalEval(t),"json"==e&&(t=m.eval("("+t+")"))),t},param:function(t){var i=[];function e(t,e){i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}if(P.isArray(t)||t.jquery)P.each(t,function(){e(this.name,this.value)});else for(var n in t)P.isArray(t[n])?P.each(t[n],function(){e(n,this)}):e(n,P.isFunction(t[n])?t[n]():t[n]);return i.join("&").replace(/%20/g,"+")}});var M,x={},S=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function T(t,e){var i={};return P.each(S.concat.apply([],S.slice(0,e)),function(){i[this]=t}),i}P.fn.extend({show:function(t,e){if(t)return this.animate(T("show",3),t,e);for(var i=0,n=this.length;i<n;i++){var o,s,a=P.data(this[i],"olddisplay");this[i].style.display=a||"","none"===P.css(this[i],"display")&&(o=this[i].tagName,x[o]?s=x[o]:("none"===(s=(a=P("<"+o+" />").appendTo("body")).css("display"))&&(s="block"),a.remove(),x[o]=s),P.data(this[i],"olddisplay",s))}for(i=0,n=this.length;i<n;i++)this[i].style.display=P.data(this[i],"olddisplay")||"";return this},hide:function(t,e){if(t)return this.animate(T("hide",3),t,e);for(var i=0,n=this.length;i<n;i++){var o=P.data(this[i],"olddisplay");o||"none"===o||P.data(this[i],"olddisplay",P.css(this[i],"display"))}for(i=0,n=this.length;i<n;i++)this[i].style.display="none";return this},_toggle:P.fn.toggle,toggle:function(e,t){var i="boolean"==typeof e;return P.isFunction(e)&&P.isFunction(t)?this._toggle.apply(this,arguments):null==e||i?this.each(function(){var t=i?e:P(this).is(":hidden");P(this)[t?"show":"hide"]()}):this.animate(T("toggle",3),e,t)},fadeTo:function(t,e,i){return this.animate({opacity:e},t,i)},animate:function(c,t,e,i){var n=P.speed(t,e,i);return this[!1===n.queue?"each":"queue"](function(){var t,r=P.extend({},n),h=1==this.nodeType&&P(this).is(":hidden"),l=this;for(t in c){if("hide"==c[t]&&h||"show"==c[t]&&!h)return r.complete.call(this);"height"!=t&&"width"!=t||!this.style||(r.display=P.css(this,"display"),r.overflow=this.style.overflow)}return null!=r.overflow&&(this.style.overflow="hidden"),r.curAnim=P.extend({},c),P.each(c,function(t,e){var i,n,o,s,a=new P.fx(l,r,t);/toggle|show|hide/.test(e)?a["toggle"==e?h?"show":"hide":e](c):(i=e.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),n=a.cur(!0)||0,i?(o=parseFloat(i[2]),"px"!=(s=i[3]||"px")&&(l.style[t]=(o||1)+s,n=(o||1)/a.cur(!0)*n,l.style[t]=n+s),i[1]&&(o=("-="==i[1]?-1:1)*o+n),a.custom(n,o,s)):a.custom(n,e,""))}),!0})},stop:function(t,e){var i=P.timers;return t&&this.queue([]),this.each(function(){for(var t=i.length-1;0<=t;t--)i[t].elem==this&&(e&&i[t](!0),i.splice(t,1))}),e||this.dequeue(),this}}),P.each({slideDown:T("show",1),slideUp:T("hide",1),slideToggle:T("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(t,i){P.fn[t]=function(t,e){return this.animate(i,t,e)}}),P.extend({speed:function(t,e,i){var n="object"==typeof t?t:{complete:i||!i&&e||P.isFunction(t)&&t,duration:t,easing:i&&e||e&&!P.isFunction(e)&&e};return n.duration=P.fx.off?0:"number"==typeof n.duration?n.duration:P.fx.speeds[n.duration]||P.fx.speeds._default,n.old=n.complete,n.complete=function(){!1!==n.queue&&P(this).dequeue(),P.isFunction(n.old)&&n.old.call(this)},n},easing:{linear:function(t,e,i,n){return i+n*t},swing:function(t,e,i,n){return(-Math.cos(t*Math.PI)/2+.5)*n+i}},timers:[],fx:function(t,e,i){this.options=e,this.elem=t,this.prop=i,e.orig||(e.orig={})}}),P.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(P.fx.step[this.prop]||P.fx.step._default)(this),"height"!=this.prop&&"width"!=this.prop||!this.elem.style||(this.elem.style.display="block")},cur:function(t){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];t=parseFloat(P.css(this.elem,this.prop,t));return t&&-1e4<t?t:parseFloat(P.curCSS(this.elem,this.prop))||0},custom:function(t,e,i){this.startTime=g(),this.start=t,this.end=e,this.unit=i||this.unit||"px",this.now=this.start,this.pos=this.state=0;var n=this;function o(t){return n.step(t)}o.elem=this.elem,o()&&P.timers.push(o)&&!M&&(M=setInterval(function(){for(var t=P.timers,e=0;e<t.length;e++)t[e]()||t.splice(e--,1);t.length||(clearInterval(M),M=w)},13))},show:function(){this.options.orig[this.prop]=P.attr(this.elem.style,this.prop),this.options.show=!0,this.custom("width"==this.prop||"height"==this.prop?1:0,this.cur()),P(this.elem).show()},hide:function(){this.options.orig[this.prop]=P.attr(this.elem.style,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e=g();if(t||e>=this.options.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update();var i,n=this.options.curAnim[this.prop]=!0;for(i in this.options.curAnim)!0!==this.options.curAnim[i]&&(n=!1);if(n){if(null!=this.options.display&&(this.elem.style.overflow=this.options.overflow,this.elem.style.display=this.options.display,"none"==P.css(this.elem,"display")&&(this.elem.style.display="block")),this.options.hide&&P(this.elem).hide(),this.options.hide||this.options.show)for(var o in this.options.curAnim)P.attr(this.elem.style,o,this.options.orig[o]);this.options.complete.call(this.elem)}return!1}e-=this.startTime;return this.state=e/this.options.duration,this.pos=P.easing[this.options.easing||(P.easing.swing?"swing":"linear")](this.state,e,0,1,this.options.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update(),!0}},P.extend(P.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){P.attr(t.elem.style,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=t.now+t.unit:t.elem[t.prop]=t.now}}}),document.documentElement.getBoundingClientRect?P.fn.offset=function(){if(!this[0])return{top:0,left:0};if(this[0]===this[0].ownerDocument.body)return P.offset.bodyOffset(this[0]);var t=this[0].getBoundingClientRect(),e=this[0].ownerDocument,i=e.body,n=e.documentElement,o=n.clientTop||i.clientTop||0,e=n.clientLeft||i.clientLeft||0;return{top:t.top+(self.pageYOffset||P.boxModel&&n.scrollTop||i.scrollTop)-o,left:t.left+(self.pageXOffset||P.boxModel&&n.scrollLeft||i.scrollLeft)-e}}:document.getBoxObjectFor?P.fn.offset=function(){if(this[0]===document)return{top:0,left:0};for(var t=document.getBoxObjectFor(this[0]),e=0,i=0,n=this[0],o=n.ownerDocument,s=o.documentElement,a=o.body,o=o.defaultView.getComputedStyle(n,null);(n=n.parentNode)&&n!==a&&n!==s;)e+=n.scrollTop,i+=n.scrollLeft;return{top:t.y-parseInt(o.borderTopWidth,10)-e,left:t.x-parseInt(o.borderLeftWidth,10)-i}}:P.fn.offset=function(){if(!this[0])return{top:0,left:0};if(this[0]===this[0].ownerDocument.body)return P.offset.bodyOffset(this[0]);P.offset.initialized||P.offset.initialize();for(var t,e=this[0],i=e.offsetParent,n=e.ownerDocument,o=n.documentElement,s=n.body,a=n.defaultView,r=a.getComputedStyle(e,null),h=e.offsetTop,l=e.offsetLeft;(e=e.parentNode)&&e!==s&&e!==o;)t=a.getComputedStyle(e,null),(!Pt.opera||9.27<Pt.version||"TR"!=e.tagName&&"TBODY"!=e.tagName)&&(h-=e.scrollTop,l-=e.scrollLeft),e===i&&(h+=e.offsetTop,l+=e.offsetLeft,!P.offset.doesNotAddBorder||P.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(e.tagName)||(h+=parseInt(t.borderTopWidth,10)||0,l+=parseInt(t.borderLeftWidth,10)||0),i=e.offsetParent),P.offset.subtractsBorderForOverflowNotVisible&&"visible"!==t.overflow&&(h+=parseInt(t.borderTopWidth,10)||0,l+=parseInt(t.borderLeftWidth,10)||0),r=t;return"relative"!==r.position&&"static"!==r.position||(h+=s.offsetTop,l+=s.offsetLeft),"fixed"===r.position&&(h+=Math.max(o.scrollTop,s.scrollTop),l+=Math.max(o.scrollLeft,s.scrollLeft)),{top:h,left:l}},P.offset={initialize:function(){if(!this.initialized){var t,e,i,n,o=document.body,s=document.createElement("div"),a=o.style.marginTop,r={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(n in r)s.style[n]=r[n];s.innerHTML='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>',o.insertBefore(s,o.firstChild),e=(t=s.firstChild).firstChild,i=t.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==e.offsetTop,this.doesAddBorderForTableAndCells=5===i.offsetTop,t.style.overflow="hidden",t.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,o.style.marginTop="1px",this.doesNotIncludeMarginInBodyOffset=0===o.offsetTop,o.style.marginTop=a,o.removeChild(s),this.initialized=!0}},bodyOffset:function(t){P.offset.initialized||P.offset.initialize();var e=t.offsetTop,i=t.offsetLeft;return P.offset.doesNotIncludeMarginInBodyOffset&&(e+=parseInt(P.curCSS(t,"marginTop",!0),10)||0,i+=parseInt(P.curCSS(t,"marginLeft",!0),10)||0),{top:e,left:i}}},P.fn.extend({position:function(){var t,e,i;return this[0]&&(t=this.offsetParent(),e=this.offset(),i=/^body|html$/i.test(t[0].tagName)?{top:0,left:0}:t.offset(),e.top-=n(this,"marginTop"),e.left-=n(this,"marginLeft"),i.top+=n(t,"borderTopWidth"),i.left+=n(t,"borderLeftWidth"),i={top:e.top-i.top,left:e.left-i.left}),i},offsetParent:function(){for(var t=this[0].offsetParent||document.body;t&&!/^body|html$/i.test(t.tagName)&&"static"==P.css(t,"position");)t=t.offsetParent;return P(t)}});var E="number"==typeof m.pageXOffset;P.each(["Left","Top"],function(e,t){var i="scroll"+t;P.fn[i]=function(t){return this[0]?t!==w?this.each(function(){this==m||this==document?m.scrollTo(e?P(m).scrollLeft():t,e?t:P(m).scrollTop()):this[i]=t}):this[0]==m||this[0]==document?E?self[e?"pageYOffset":"pageXOffset"]:P.boxModel&&document.documentElement[i]||document.body[i]:this[0][i]:null}}),P.each(["Height","Width"],function(t,e){var i=e.toLowerCase();P.fn["inner"+e]=function(){return this[0]?P.css(this[0],i,!1,"padding"):null},P.fn["outer"+e]=function(t){return this[0]?P.css(this[0],i,!1,t?"margin":"border"):null};var n=e.toLowerCase();P.fn[n]=function(t){return this[0]==m?Pt.opera&&m["inner"+e]||"CSS1Compat"==document.compatMode&&document.documentElement["client"+e]||document.body["client"+e]:this[0]==document?Math.max(document.documentElement["client"+e],document.body["scroll"+e],document.documentElement["scroll"+e],document.body["offset"+e],document.documentElement["offset"+e]):t===w?this.length?P.css(this[0],n):null:this.css(n,"string"==typeof t?t:t+"px")}})}(),yt.jQuery.os={name:(/(win|mac|linux|sunos|solaris|iphone)/.exec(navigator.platform.toLowerCase())||["unknown"])[0].replace("sunos","solaris")},yt.jQuery.fn.removeFromDom=function(){return this.each(function(){this&&this.parentNode&&this.parentNode.removeChild(this)})},r=yt.jQuery,h=r.fn.bind,s=r.fn.unbind,n=/keydown|keypress|keyup/g,l={8:"backspace",9:"tab",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",107:"+",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scroll",144:"numlock"},c={},r.fn.bind=function(t,e,i){var n;if(n=a(t,e)){n.unhandled&&h.call(this,n.unhandled,e,i);var o=r.isFunction(e),s=o&&e||i,o="string"==typeof e?{shortcut:e}:o?{}:e;return o.__hotkeys__=n,h.call(this,n.handled,o,function(t,e,i){t.guid||(t.guid=r.event.guid++);c[t.guid]||(c[t.guid]={});return e.guid=c[t.guid][i]=e.guid||c[t.guid][i]||r.event.guid++,e}(s,function(t){!function(t){if(t.data&&t.data.__hotkeys__){var e=t.data.__hotkeys__.parsedData;t.altKey=t.altKey||t.originalEvent.altKey;try{if(e.disableInInput&&t.originalTarget&&t.originalTarget.nodeName){var i=t.originalTarget.nodeName.toLowerCase();if("input"==i||"textarea"==i)return!1}}catch(t){}if((l[t.which]==e.key||String.fromCharCode(t.which).toLowerCase()==e.key)&&function(e,i,t){var n=!0;return r.each(t,function(){var t=this.toString();n=n&&e[t]==i[t]}),n}(e,t,["altKey","ctrlKey","shiftKey"]))return!0}return!1}(t)||s.apply(this,arguments)},n.parsedData.shortcut))}return h.apply(this,arguments)},r.fn.unbind=function(t,e,i){var n;if((n=a(t,e))&&i.guid){n.unhandled&&s.call(this,n.unhandled,e,i);var o=c[i.guid][n.parsedData.shortcut];return s.call(this,n.handled,{guid:o})}return s.apply(this,arguments)},function(i){i.fn.wheel=function(t){return this[t?"bind":"trigger"]("wheel",t)},i.event.special.wheel={setup:function(){i.event.add(this,t,e,{})},teardown:function(){i.event.remove(this,t,e)}};var t=i.browser.mozilla?"DOMMouseScroll"+(i.browser.version<"1.9"?" mousemove":""):"mousewheel";function e(t){var e=t.originalEvent;switch(t.type){case"mousemove":return i.extend(t.data,{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY});case"DOMMouseScroll":i.extend(t,t.data),t.delta=-t.detail/3,void 0!==e.axis&&1==e.axis?(t.deltaX=t.delta,t.deltaY=0):(t.deltaX=0,t.deltaY=t.delta);break;case"mousewheel":t.delta=t.wheelDelta/120,void 0!==e.wheelDeltaX?(t.deltaX=e.wheelDeltaX/120,t.deltaY=e.wheelDeltaY/120):(t.deltaX=0,t.deltaY=t.delta),i.browser.opera&&i.browser.version<"9.2"&&(t.delta*=-1)}return t.type="wheel",i.event.handle.call(this,t,t.delta)}}(yt.jQuery),bt.loadByRequire&&(t=function(){document.body?yt.jQuery.ready():window.setTimeout(t,10)})();var Ct,Mt,xt=yt.Utils=bt.Utils={},wt=yt.jQuery,Pt=xt.browser=wt.extend({},wt.browser);Pt.version=parseFloat(Pt.version),Pt.quirksMode="BackCompat"==document.compatMode,Pt.ieDocumentMode=Pt.msie&&(document.documentMode||0);var St=xt.support=wt.extend({},wt.support);Pt.webkit=Pt.safari,A=window.navigator.userAgent.toLowerCase(),Pt.chrome=-1!=A.indexOf("chrome"),Pt.safari=-1!=A.indexOf("safari")&&!Pt.chrome,Pt.operaMobile=-1!=A.indexOf("opera mobi"),St.android=-1!=A.indexOf("android"),St.adobeAIR=-1!=A.indexOf("adobeair"),St.touchscreen=(Pt.safari||-1!=A.indexOf("dolfin"))&&-1!=A.indexOf("mobile")||St.android||Pt.operaMobile;var e,i,o,u,d,p,_,f,m,g,v,Tt=xt.UNDEF="undefined",Et=xt.extend=function(t,e){function i(){}return(i.prototype=e.prototype).constructor=e,t.prototype=new i},Lt=xt.bindContext=function(t,e){return function(){return t.apply(e,arguments)}},Ot=xt.callMethod=function(t,e){t=t instanceof Array?t:[t];for(var i,n=Array.prototype.slice.call(arguments,2),o=0,s=t.length;o<s;o++)(i=t[o])[e].apply(i,n)};function y(){this.originalEvent.preventDefault()}function b(){this.originalEvent.stopPropagation()}xt.NULL=function(){return null},xt.boundaryRestrict=function(t,e,i){return typeof t==Tt||typeof e==Tt||null==e||typeof i==Tt||null==i?NaN:Math.max(Math.min(t,i),e)},xt.cycleRestrict=function(t,e,i){return typeof t==Tt||typeof e==Tt||null==e||typeof i==Tt||null==i?NaN:t==Number.POSITIVE_INFINITY?i:t==Number.NEGATIVE_INFINITY?e:t-Math.floor((t-e)/(i-e))*(i-e)},xt.normalizeContent=function(t){return""===t||null===t||typeof t==Tt||9==t.nodeType?null:3==t.nodeType||1==t.nodeType?new bt.DOMLayout(null,null,t):"object"==typeof t?t:new bt.TextLayout(null,null,t,0)},xt.size=function(t,e,i){if(typeof e==Tt){var n=wt(t);return new yt.Size(n.width(),n.height())}var o,i=e instanceof kt?(o=e.x,e.y):(o=e,typeof i==Tt?e:i);t.style.width=o+"px",t.style.height=i+"px"},xt.position=function(t,e,i){if(typeof e==Tt)return new kt(t.offsetLeft,t.offsetTop);var n;i=e instanceof kt?(n=e.x,e.y):(n=e,typeof i==Tt?e:i),t.style.left=n+"px",t.style.top=i+"px"},xt.sign=function(t){t=Number(t);return t<0?-1:0<t?1:0},xt.fixIESize=function(t,e,i){t.css(e,t.parent().eq(0)["top"==e||"bottom"==e?"height":"width"]()%2?i[0]+"px":i[1]+"px")},xt.imagesOnLoad=function(t,o,s){for(var e=wt("img",t),a=0,r=0,i=0,n=e.length;i<n;i++)!function(e,i){var n=function(t){wt(i).css({visibility:""}),It(e).events.remove(["load","error"],n),a--,o&&o(i),0==a&&s&&s(r)};i.src&&(wt(i).css({visibility:"hidden"}),It(e).events.add(["load","error"],n),e.src=i.src,a++)}(document.createElement("img"),e[i]);0==(r=a)&&s&&window.setTimeout(function(){s(r)},0)},xt.touchEventFix=function(t,e,i){if(typeof t.fixedTouch!=Tt)return t;var n=wt.extend({},t.originalEvent||t),i=i?i.originalEvent||i:n,o=i.touches[0],s=i.touches[1];return n.preventDefault=y,n.stopPropagation=b,n.which=n.button=1,n.originalEvent=t,n.fixedTouch=!0,e&&"none"==e||wt.each(["clientX","clientY","pageX","pageY","screenX","screenY"],function(){var t=this.toString();n[t]="average"==e&&s?(o[t]+s[t])/2:o[t]}),n},e=0,wt.extend(xt,{uniqueIdField:"YMaps__id"+((new Date).getTime()+Math.round(1e4*Math.random())),windowId:"YMaps__id"+e,generateId:function(){return"YMaps__id"+ ++e},generateUniqueId:function(){return"YMaps__id"+((new Date).getTime()+Math.round(1e4*Math.random()))},getUniqueId:function(t){return t===window?this.windowId:t[this.uniqueIdField]||this.setUniqueId(t)},setUniqueId:function(t,e){return typeof e==Tt&&(e=xt.generateId()),t[this.uniqueIdField]=e}}),i=new function(){var o,s,n,i,a,r,h,l=Pt.mozilla&&Pt.version<1.9||Pt.opera&&Pt.version<9.2,c=[];function u(t){i&&i!=t&&e(),(i=t)&&(i.setCapture(),i.attachEvent("onlosecapture",g))}function e(){i&&(i.detachEvent("onlosecapture",g),i.releaseCapture(),i=null)}function d(t,e){Pt.msie&&Pt.ieDocumentMode<9?i.attachEvent("on"+t,e):document.addEventListener(t,e,!0)}function t(t,e){Pt.msie&&Pt.ieDocumentMode<9?i.detachEvent("on"+t,e):document.removeEventListener(t,e,!0)}function p(t,e){return e?!(3!=t.which||Pt.safari&&"mac"==wt.os.name):1==t[Pt.msie&&Pt.ieDocumentMode<9?"button":"which"]}function _(){l&&It(document).events.remove("mouseout",g),a?(t("click",b),t("mousemove",C),t("mousedown",C)):St.touchscreen?(t("touchmove",m),t("touchend",y),t("touchcancel",y)):(t("mousemove",m),t("mouseup",y)),Pt.msie&&Pt.ieDocumentMode<9&&e()}function f(t,e){var i=e.getEvent();!o&&p(i,t.byRightButton())&&(e.preventMapEvent(),a=s=0,o=t,n=Pt.mozilla?i.originalEvent.explicitOriginalTarget:i.target,Pt.msie&&Pt.ieDocumentMode<9&&u(o.getElement()),l&&It(document).events.add("mouseout",g),St.touchscreen?(d("touchmove",m),d("touchend",y),d("touchcancel",y)):(d("mousemove",m),d("mouseup",y)),i.preventDefault(),h=r=i,Dt.notify(o,"start",i))}function m(t){var e,i,n;St.touchscreen&&1<t.touches.length||(e=St.touchscreen?xt.touchEventFix(t):wt.event.fix(t),i=o.getTremor(),bt.preventMapEvent(e,"mousemove"),e.preventDefault(),r=e,s||(n=typeof i.offset!=Tt,t=typeof i.time!=Tt,n||t?(n&&(Math.abs(h.clientX-e.clientX)>i.offset||Math.abs(h.clientY-e.clientY)>i.offset)&&(s=1),t&&e.timeStamp-h.timeStamp>i.time&&(s=1)):s=1),s&&Dt.notify(o,"move",e))}function g(t){var e=wt.event.fix(t);"losecapture"!=(t=e).type&&("mouseout"!=t.type||t.relatedTarget)||v(e)}function v(t){_();var e=o;o=null,Dt.notify(e,"stop",St.touchscreen?r:t)}function y(t){var e=St.touchscreen?xt.touchEventFix(t,"first",r):wt.event.fix(t);o&&p(e,o.byRightButton())&&(v(e),s&&(bt.preventMapEvent(e,"mouseup"),e.preventDefault(),St.touchscreen||!p(e)||!Pt.msie&&n!=(Pt.mozilla?t.explicitOriginalTarget:e.target)||(a=1,Pt.msie&&Pt.ieDocumentMode<9&&u(document.body),d("click",b),d("mousemove",C),d("mousedown",C))))}function b(t){wt.event.fix(t).stopPropagation(),_()}function C(){_()}this.add=function(i){var t;-1==wt.inArray(i,c)&&(t=i.getMap(),c.push(i),i.listener=t?yt.Events.observe(t,t.Events.MouseDown,function(t,e){f(i,e)}):It(i.getElement()).events.eventListener().add("mousedown",function(t){t=new yt.MouseEvent(t,this._map);t.isMapEventPrevented()||f(i,t)}))},this.remove=function(t){var e=wt.inArray(t,c);-1!=e&&(o==t&&v(r),t.listener.cleanup?t.listener.cleanup():t.listener.removeAll(),c.splice(e,1))},this.abort=function(t){o==t&&(_(),o=null,s=0)}},xt.DragAndDrop={},xt.DragAndDrop.MouseMove=function(t,e,i,n){this._element=t,this._byRightButton=e,this._tremor=i||{},this._map=n,this._id=xt.generateUniqueId()},xt.DragAndDrop.MouseMove.prototype={getElement:function(){return this._element},getId:function(){return this._id},byRightButton:function(){return this._byRightButton},getTremor:function(){return this._tremor},getMap:function(){return this._map},beginListening:function(){i.add(this)},stopListening:function(){i.remove(this)},abort:function(){i.abort(this)}},(xt.ObjectStorage=function(){this._objects={}}).prototype={add:function(t,e){this._objects[t]=e},get:function(t){return"object"!=typeof t||t instanceof String?this._objects[t]:t},remove:function(t){var e=this.get(t);return delete this._objects[t],e}},yt.dataDispatcher={storage:{},add:function(t,e,i){t="string"==typeof t?t:xt.getUniqueId(t),t=this.storage[t]||(this.storage[t]={list:{},count:0});t.list[e]||t.count++,t.list[e]=i},get:function(t,e){t="string"==typeof t?t:xt.getUniqueId(t),t=this.storage[t];return t&&t.list[e]},remove:function(t,e){var i="string"==typeof t?t:xt.getUniqueId(t),t=this.storage[i];t&&t.list[e]&&(delete t.list[e],--t.count||delete this.storage[i])}},o=yt.dataDispatcher,Ct=yt.DataManager=function(t){this.object=t},(Mt=Ct.prototype).add=function(t,e){return o.add(this.object,t,e),this},Mt.get=function(t){return o.get(this.object,t)},Mt.remove=function(t){return o.remove(this.object,t),this},function(){Ct=yt.EventManager=function(t){this.object=t,this.types={},this.typesCount=0};var d=(Mt=Ct.prototype).getListenerId=function(t,e){return xt.getUniqueId(t)+xt.getUniqueId(e||window)};Mt.add=function(t,e,i){for(var n=this.types,o="string"==typeof t?[t]:t,s=d(e,i),a=0,r=o.length;a<r;a++){var h,l=o[a],c=n[l],u=!1;c||(c=n[l]={first:null,last:null,list:{}},this.typesCount++,u=!0),c.list[s]||(h={callback:e,context:i||window,next:null,prev:c.last},c.last?c.last.next=h:c.first=h,c.last=c.list[s]=h),u&&this.onStartListening(l)}return this},Mt.remove=function(t,e,i){for(var n="string"==typeof e?e:d(e,i),o="string"==typeof t?[t]:t,s=this.types,a=0,r=o.length;a<r;a++){var h,l=o[a],c=s[l];c&&c.list[n]&&((h=c.list[n]).deleted=!0,h.prev?h.prev.next=h.next:c.first==h&&(c.first=h.next),h.next?h.next.prev=h.prev:c.last==h&&(c.last=h.prev),delete c.list[n],c.last||(delete s[l],this.typesCount--,this.onStopListening(l)))}return this},Mt.onStartListening=function(t){this.fire("startlistening",t)},Mt.onStopListening=function(t){this.fire("stoplistening",t)},Mt.removeAll=function(){var t,e=this.types;for(t in e)e.hasOwnProperty(t)&&(delete e[t],this.typesCount--,this.onStopListening(t));return this};var s=Array.prototype.slice;Mt.fire=function(t){for(var e=this.types,i=e&&e[t],n=i&&i.first,o=s.call(arguments,1);n;)if(n.callback.apply(n.context,o),n.deleted){for(;n&&n.deleted;)n=n.prev;n=n?n.next:i.first}else n=n.next;return this},Mt.eventListener=function(){return new yt.EventListener(this)}}(),Ct=yt.EventListener=function(t){this.events=t,this.types={}},(Mt=Ct.prototype).add=function(t,e,i){for(var n="string"==typeof t?[t]:t,o=this.events,s=o.getListenerId(e,i),a=0,r=n.length;a<r;a++){var h=n[a],l=this.types[h]||(this.types[h]={count:0,listeners:{}});l.listeners[s]||(l.listeners[s]=!0,l.count++,o.add(h,e,i))}return this},Mt.remove=function(t,e,i){for(var n="string"==typeof t?[t]:t,o=this.events,s=o.getListenerId(e,i),a=0,r=n.length;a<r;a++){var h=n[a],l=this.types[h];l&&l.listeners[s]&&(delete l.listeners[s],--l.count||delete this.types[h],o.remove(h,e,i))}return this},Mt.removeAll=function(){var t,e=this.events;for(t in this.types)if(this.types.hasOwnProperty(t)){var i,n=this.types[t].listeners;for(i in n)n.hasOwnProperty(i)&&e.remove(t,i)}return this.types={},this},function(){function i(t){t=wt.event.fix(t),(e?a.get(this.window||this,r):a.get(this,r)).fire(t.type,t)}var n=Array.prototype.slice,a=yt.dataDispatcher,r="events",h="ieHandler",e=Pt.msie&&9<=Pt.ieDocumentMode,o=yt.domDispatcher={override:{startlistening:{start:xt.NULL,stop:xt.NULL},stoplistening:{start:xt.NULL,stop:xt.NULL}},add:function(t,e,i,n){var o,s=a.get(t,r);return s||(s=new l(t),a.add(t,r,s),Pt.msie&&Pt.ieDocumentMode<9&&a.add(t,h,(o=xt.getUniqueId(t),function(t){t=wt.event.fix(t);a.get(o,r).fire(t.type,t)}))),s.add(e,i,n),this},remove:function(t,e,i,n){t=a.get(t,r);return t&&t.remove(e,i,n),this},removeAll:function(t){t=a.get(t,r);return t&&t.removeAll(),this},fire:function(t){var e,i=a.get(t,r);return i&&(e=n.call(arguments,1),i.fire.apply(i,e)),this},startListening:function(t,e){this.override[e]?this.override[e].start(t):Pt.msie&&Pt.ieDocumentMode<9?t.object.attachEvent("on"+e,a.get(t.object,h)):t.object.addEventListener(e,i,!1)},stopListening:function(t,e){this.override[e]?this.override[e].stop(t):Pt.msie&&Pt.ieDocumentMode<9?t.object.detachEvent("on"+e,a.get(t.object,h)):t.object.removeEventListener(e,i,!1),t.typesCount||(a.remove(t.object,r),Pt.msie&&Pt.ieDocumentMode<9&&a.remove(t.object,h))}},l=function(t){yt.EventManager.call(this,t)};Mt=Et(l,yt.EventManager);var s=yt.EventManager.prototype;Mt.onStartListening=function(t){o.startListening(this,t),s.onStartListening.call(this,t)},Mt.onStopListening=function(t){s.onStopListening.call(this,t),o.stopListening(this,t)}}(),u=yt.domDispatcher,Ct=yt.DomEventManager=function(t){this.object=t},(Mt=Ct.prototype).add=function(t,e,i){return u.add(this.object,t,e,i),this},Mt.remove=function(t,e,i){return u.remove(this.object,t,e,i),this},Mt.removeAll=function(){return u.removeAll(this.object),this},Mt.fire=function(){var t=[this.object].concat(arguments);u.fire.apply(u,t)},Mt.getListenerId=yt.EventManager.prototype.getListenerId,Mt.eventListener=function(){return new yt.EventListener(this)},St.touchscreen||(d=Pt.mozilla&&Pt.version<1.9,p=null,_=["clientX","clientY","pageX","pageY","screenX","screenY"],f=Pt.mozilla?"DOMMouseScroll":"mousewheel",m="wheelHandler",g=function(t,e){var i,n=e.originalEvent;"mousemove"==n.type?p=e:(i=wt.extend({},e),Pt.opera&&Pt.version<9.2&&(i.delta*=-1),"DOMMouseScroll"==n.type?(i.delta=-i.detail/3,void 0!==n.axis&&1==n.axis?(i.deltaX=n.delta,i.deltaY=0):(i.deltaX=0,i.deltaY=i.delta),d&&p&&wt.each(_,function(t,e){i[e]=p[e]})):"mousewheel"==n.type&&(i.delta=i.wheelDelta/120,typeof n.wheelDeltaX!=Tt?(i.deltaX=n.wheelDeltaX/120,i.deltaY=n.wheelDeltaY/120):(i.deltaX=0,i.deltaY=i.delta)),i.type="wheel",t.fire("wheel",i))},yt.domDispatcher.override.wheel={start:function(e){function t(t){g(e,t)}e.add(d?[f,"mousemove"]:f,t),yt.dataDispatcher.add(e.object,m,t)},stop:function(t){xt.getUniqueId(t.object);t.remove(d?[f,"mousemove"]:f,yt.dataDispatcher.get(t.object,m)),yt.dataDispatcher.remove(t.object,m)}}),St.touchscreen||(v={start:function(e,i,t){function n(t){v.fire(e,i,t)}yt.dataDispatcher.add(e.object,i+"Handler",n),e.add(t,n)},stop:function(t,e,i){t.remove(i,yt.dataDispatcher.get(t.object,e+"Handler")),yt.dataDispatcher.remove(t.object,e+"Handler")},fire:function(t,e,i){for(var n=i.relatedTarget,o=t.object;n&&n!=o;)try{n=n.parentNode}catch(t){n=o}n!=o&&((i=wt.extend({},i)).type=e,t.fire(e,i))}},yt.domDispatcher.override.mouseenter={start:function(t){v.start(t,"mouseenter","mouseover")},stop:function(t){v.stop(t,"mouseenter","mouseover")}},yt.domDispatcher.override.mouseleave={start:function(t){v.start(t,"mouseleave","mouseout")},stop:function(t){v.stop(t,"mouseleave","mouseout")}}),St.touchscreen&&function(){for(var t=["mouseenter","mousemove","mouseleave","mousedown","mouseup","click","dblclick","contextmenu","wheel","multitouchstart","multitouchmove","multitouchend"],n="touchData",i=function(t,e){var i=yt.dataDispatcher.get(t.object,n);i||(i={types:{},count:0,touchMapper:new yt.TouchMapper(t)},yt.dataDispatcher.add(t.object,n,i)),i.types[e]||(i.count||i.touchMapper.start(),i.types[e]=!0,i.count++)},o=function(t,e){var i=yt.dataDispatcher.get(t.object,n);i&&i.types[e]&&(delete i.types[e],--i.count||(i.touchMapper.stop(),yt.dataDispatcher.remove(t.object,n)))},e=0,s=t.length;e<s;e++)!function(e){yt.domDispatcher.override[e]={start:function(t){i(t,e)},stop:function(t){o(t,e)}}}(t[e])}(),Ct=yt.TouchMapper=function(t){this.events=t,this.__state={started:0,moved:0,multitouch:0},this.__initialZoomDistance=0},(Mt=Ct.prototype).start=function(){this.__state={started:0,moved:0,multitouch:0},this.__listener=this.events.eventListener().add("touchstart",this.__onTouchStart,this).add("touchmove",this.__onTouchMove,this).add(["touchend","touchcancel"],this.__onTouchEnd,this)},Mt.stop=function(){this.__listener.removeAll(),this.__state.started&&this.__actionEnd(xt.touchEventFix(this.__state.moved?this.__lastTouchMove:this.__initTouch),+new Date),this.__state.started=0,this.__state.multitouch=0,this.__state.moved=0},Mt.__onTouchStart=function(t){t=t.originalEvent;this.__state.started||1!=t.touches.length||(this.__state.started=1,this.__initTouch=t,this.__actionBegin(xt.touchEventFix(t))),1<t.touches.length&&!this.__state.multitouch&&(this.__initialZoomDistance=this.__getZoomDistance(t),this.__state.multitouch=1,this.__notify("multitouchstart",xt.touchEventFix(t,"none")))},Mt.__getZoomDistance=function(t){var e=t.touches[0].clientX,i=t.touches[0].clientY,e=e-t.touches[1].clientX,t=i-t.touches[1].clientY;return Math.sqrt(e*e+t*t)},Mt.__onTouchMove=function(t){var e,i=t.originalEvent;1==(this.__lastTouchMove=i).touches.length?(this.__state.started||this.__onTouchStart(t),this.__state.moved||(this.__state.moved=1),this.__notify("mousemove",xt.touchEventFix(i))):(this.__state.multitouch=1,this.__notify("multitouchmove",xt.touchEventFix(i,"none")),0!=(t=(1<(t=(e=this.__getZoomDistance(i))/(this.__initialZoomDistance||1))?1:-1)*Math.floor(Math.abs(Math.log(t)/Math.log(2))))&&((i=xt.touchEventFix(i,"average")).delta=i.deltaY=t,i.deltaX=0,this.__notify("wheel",i),this.__initialZoomDistance=e))},Mt.__actionBegin=function(t){this.__notify("mouseenter",t),this.__notify("mousemove",t),this.__notify("mousedown",t)},Mt.__onTouchEnd=function(t){t=t.originalEvent;this.__state.started&&this.__actionEnd(xt.touchEventFix(t,"average",this.__state.moved?this.__lastTouchMove:this.__initTouch),t.timeStamp),this.__state.multitouch&&this.__notify("multitouchend",xt.touchEventFix(t,"none")),this.__state.started=0,this.__state.multitouch=0,this.__state.moved=0},Mt.__actionEnd=function(t,e){var i=bt.isMapEventPrevented(t,"mouseup");this.__notify("mouseup",t),i||this.__state.multitouch||(e-this.__initTouch.timeStamp>At.touch.contextMenuTimeout&&!this.__state.moved?(this.__notify("contextmenu",t),this.__lastClickTimestamp=null):this.__lastClickTimestamp&&e-this.__lastClickTimestamp<At.dblClickTimeout?(this.__notify("click",t),this.__notify("dblclick",t),this.__lastClickTimestamp=null):(this.__notify("click",t),this.__lastClickTimestamp=e)),this.__notify("mouseleave",t)},Mt.__notify=function(t,e){e.type=t,this.events.fire(t,e)};var It=yt.dom=function(t){return{events:new yt.DomEventManager(t),data:new yt.DataManager(t)}},At=yt.Constants={copyrights:{agreement:"Условия использования",agreementLink:"http://maps.yandex.ru/agreement.xml",logoLink:"http://maps.yandex.ru",addStateToLogoLink:!0},metric:{millimetre:"мм",centimetre:"см",metre:"м",kilometre:"км",days:"дн.",day:"д.",hours:"ч.",minutes:"мин.",seconds:"сек."},types:{MAP:"Схема",SATELLITE:"Спутник",HYBRID:"Гибрид"},tremor:{draggingControl:{offset:5,time:300},placemark:{offset:5,time:300},graphicsEditor:{offset:5,time:300}},dblClickTimeout:500,touch:{contextMenuTimeout:400},hints:{miniMap:{show:"Показать обзорную карту",hide:"Скрыть обзорную карту"},ruler:{close:"Удалить путь",sure:"Удалить все отметки? \n\n(для удаления только одной отметки\n дважды щелкните по ней)"},toolBar:{move:"Переместить карту",magnifier:"Увеличить",ruler:"Измерение расстояний на карте"},balloon:{close:"Закрыть"},zoom:[{index:2,value:"мир"},{index:5,value:"страна"},{index:9,value:"город"},{index:13,value:"улица"},{index:16,value:"дом"}],loading:{timeout:"Превышен интервал ожидания ответа от сервера"},searchControl:{mapSearch:"Поиск на карте",find:"Найти",wait:"Идет запрос к серверу...",notFound:"Искомая комбинация на карте не встречается",clear:"Очистить",quantity:[{found:"Найдено",objects:"объекта"},{found:"Найдено",objects:"объектов"},{found:"Найден",objects:"объект"}],correction:"По исходному запросу на карте ничего не найдено. Результаты для",previous:["Предыдущий","Предыдущие"],next:["Следующий","Следующие"],noname:"Без названия"},typeControl:{more:"Ещё"},graphicsEditor:{deleteVertex:"Удалить",startDrawing:"Продолжить",stopDrawing:"Завершить",removeInterior:"Удалить контур",addInterior:"Добавить внутренний контур"}}};At.imageRoot=bt.versionPath+"i/0.4/",At.images={transparentImage:At.imageRoot+"zero.gif",toolBar:{iconSprite:At.imageRoot+"icons/icon-hand-ruler-zoom.png"}},At.cursors={arrow:{class:"YMaps-cursor-default",cursor:"default"},crosshair:{class:"YMaps-cursor-crosshair",cursor:"crosshair"},grab:{class:"YMaps-cursor-grab",cursor:"url("+At.imageRoot+"cursors/grab.png) 16 16, url("+At.imageRoot+"cursors/grab.png), move"},grabbing:{class:"YMaps-cursor-grabbing",cursor:"url("+At.imageRoot+"cursors/grabbing.png) 16 16, url("+At.imageRoot+"cursors/grabbing.png), move"},help:{class:"YMaps-cursor-help",cursor:"url("+At.imageRoot+"cursors/help.png), help"},move:{class:"YMaps-cursor-move",cursor:"move"},pointer:{class:"YMaps-cursor-pointer",cursor:"pointer"},zoom:{class:"YMaps-cursor-zoom",cursor:"url("+At.imageRoot+"cursors/zoom_in.png) 6 6, url("+At.imageRoot+"cursors/zoom_in.png), crosshair"},inherit:{class:"YMaps-cursor-inherit",cursor:"inherit"}},yt.State={EMPTY:"Empty",LOADING:"Loading",SUCCESS:"Success",FAILURE:"Failure"},yt.ZIndex={POLYGON:10,POLYLINE:20,MAP_LAYER:5,LAYER_CONTAINER:1,COMMON_OBJECT_LAYER:50,OVERLAY_SHADOW:100,OVERLAY:110,OVERLAY_HOVER:120,OVERLAY_DRAG:130,EDITOR_GLASS_PANE:150,EDITOR_EDGE_MARKER:160,EDITOR_VERTEX_MARKER:170,BALLOON:200,OVERLAY_ACTIVE:210,CONTROL:1e3,POPUP:1001},yt.Cursor={ARROW:"arrow",CROSSHAIR:"crosshair",GRAB:"grab",GRABBING:"grabbing",HELP:"help",MOVE:"move",POINTER:"pointer",ZOOM:"zoom",INHERIT:"inherit"},yt.TILE_SIZE=256,yt.GraphicsEditingMenuIDs={Delete:"Delete",StartDrawing:"StartDrawing",StopDrawing:"StopDrawing",AddInterior:"AddInterior",RemoveInterior:"RemoveInterior"},At.MapDOMEvents=["click","dblclick","contextmenu","mouseup","mousedown","mousemove","wheel"],At.MapMultiTouchEvents=["multitouchstart","multitouchmove","multitouchend"],yt.Interactivity={NONE:0,STATIC:-1,INTERACTIVE:1},function(){var l=At.metric;yt.humanDistance=function(t,e){for(var i=e?r:a,n=i.length-1,o=0,s=n;o<s;o++)if(t<i[o+1][0]){n=o;break}return n=i[n],t=Math.round(t/n[1])*n[1],t/=n[2],t=Number(t.toFixed(n[3])),String(t).replace(".",",")+"&#160;"+n[4]};var t=l.metre,e=l.kilometre,a=[[0,1,1,0,t],[5e-5,1e-4,.001,1,l.millimetre],[.02,.001,.01,1,l.centimetre],[.2,.01,1,2,t],[2,.1,1,1,t],[20,1,1,0,t],[1e3,1,1e3,3,e],[2e3,10,1e3,2,e],[7e3,100,1e3,1,e],[5e4,1e3,1e3,0,e]],r=[[0,1,1,0,t],[10,10,1,0,t],[100,50,1,0,t],[1e3,100,1e3,1,e],[3e3,1e3,1e3,0,e]];yt.humanDuration=function(t){for(var e,i=[1,60,3600,86400],n=[60,60,24,0],o=[l.seconds,l.minutes,l.hours,l.days],s=[0,0,0,0],a=[],r=3,h=t;h&&0<=r;r--)e=Math.floor(t/i[r]),h=t%i[r],20<=e&&(e+=.5<=h/i[r]?1:0,h=0),e==n[r]&&n[r]?s[r+1]++:s[r]=e,t=h;for(r=0;r<=3;r++)s[r]&&(1==s[r]&&3==r&&(o[r]=l.day),a.unshift(s[r]+"&#160;"+o[r]));return a.length||a.unshift("0&#160;"+o[0]),a.join("&#160;")},bt.statCount=function(t){t.share&&!bt.counterShare||wt.ajax({url:[bt.statCounter+"jclck/dtype=stred","/pid="+t.pid,"/cid="+t.cid,"/path="+t.path,"/rnd="+((new Date).getTime()+Math.round(100*Math.random())),"/*"+bt.mapsUrl].join(""),cache:!0,type:"GET",dataType:"script"})};try{parent&&parent.WebUI&&bt.statCount({pid:443,cid:72959,path:"intranet.1C.1_1"})}catch(t){}bt.checkVisibility=function(t){try{if(document.elementFromPoint&&t.getBoundingClientRect){var e=t.getBoundingClientRect(),i=document.elementFromPoint(Math.round((e.left+e.right)/2),Math.round((e.top+e.bottom)/2));if(null===i)return"invisible";for(;i&&i!=t;)i=i.parentNode||null;return i?"visible":"blocked"}return"unable"}catch(t){return"unable"}}}(),bt.MathLib={ortho:function(t,e){function n(t,e){return Bt.getCoordPoint(t*o,e*o,s)}var i=[t],o=180/Math.PI,s=t.isUnbounded()&&e.isUnbounded(),a=t.getX()/o,r=t.getY()/o,h=(e.isUnbounded()?e.getX():xt.cycleRestrict(e.getX(),t.getX()-180,t.getX()+180))/o,l=e.getY()/o,t=h-a,c=Math.round(Math.abs(t)/Math.PI),u=Math.sin(t);if(1e-8<Math.abs(u)&&Math.cos(t)<1-1e-8)for(var d=Math.sin(r),p=Math.cos(r),_=Math.sin(l),f=Math.cos(l),m=Math.ceil(50*(2*Math.floor(c/2)*Math.PI+Math.acos(d*_+p*f*Math.cos(t))))||1,g=t/m,v=1;v<m;v++){var y=a+g*v,b=-Math.atan((d*f*Math.sin(y-h)-_*p*Math.sin(y-a))/(p*f*u));i.push(n(y,b))}else{function C(t,e,i){return[n(t,e),n(t,i)]}var l=0<Math.cos(t)?xt.sign(l-r):xt.sign(r+l),M=xt.sign(t);if(Math.abs(l)<1e-8&&(l=1),c){for(var x=l*Math.PI/2,i=C(a,r,x),v=1;v<c;v++)i.push(n(a+Math.PI*(v-.5)*M,x)),wt.merge(i,C(a+Math.PI*v*M,x,-x)),x=-x;i.push(n(h-.5*Math.PI*M,x),n(h,x))}}return i.push(e),i},intervalsIntersect:function(t,e,i,n){var o;return e<t&&(o=t,t=e,e=o),n<i&&(o=i,i=n,n=o),n<t||e<i?0:1},sectorsIntersect:function(t,e,i,n){return t=xt.cycleRestrict(t,0,360),e=xt.cycleRestrict(e,t,t+360),i=xt.cycleRestrict(i,e,e-360),n=xt.cycleRestrict(n,i,i+360),bt.MathLib.intervalsIntersect(t,e,i,n)}};var kt=yt.Point=function(t,e){this.x=("number"==typeof t?t:Number(t))||0,this.y=typeof e==Tt?this.x:("number"==typeof e?e:Number(e))||0};kt.fromString=function(t){return t=t.split(","),new kt(t[0],t[1])},kt.prototype={getX:function(){return this.x},getY:function(){return this.y},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},toString:function(t){return typeof t==Tt||isNaN(parseInt(t))?this.x+","+this.y:Number(this.x.toFixed(t))+","+Number(this.y.toFixed(t))},copy:function(){return new this.constructor(this.x,this.y)},moveToX:function(t){return this.x=t,this},moveToY:function(t){return this.y=t,this},moveTo:function(t){return this.x=t.x,this.y=t.y,this},moveByX:function(t){return this.x+=t,this},moveByY:function(t){return this.y+=t,this},moveBy:function(t){return this.x+=t.x,this.y+=t.y,this},diff:function(t){return new this.constructor(t.x-this.x,t.y-this.y)},equals:function(t){return this.x==t.x&&this.y==t.y},scale:function(t){var e=typeof t.x!=Tt&&typeof t.y!=Tt;return this.x*=e?t.x:t,this.y*=e?t.y:t,this},scaleX:function(t){return this.x*=t,this},scaleY:function(t){return this.y*=t,this},apply:function(t){return this.x=t(this.x),this.y=t(this.y),this},applyX:function(t){return this.x=t(this.x),this},applyY:function(t){return this.y=t(this.y),this},neg:function(){return new this.constructor(-this.x,-this.y)},distance:function(t){t=this.diff(t);return Math.sqrt(t.x*t.x+t.y*t.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},angle:function(){return Math.acos(this.x/this.length())}},kt.prototype.constructor=kt,yt.Size=kt,yt.GeoPoint=function(t,e,i){this._unbounded=i||0,this.setX(("number"==typeof t?t:Number(t))||0),this.setY(("number"==typeof e?e:Number(e))||0)},Mt=yt.GeoPoint.prototype,yt.GeoPoint.fromString=function(t){return t=t.split(","),new yt.GeoPoint(t[0],t[1])},Mt.toString=function(t){return t=typeof t!=Tt?t:6,Number(this.getX().toFixed(t))+","+Number(this.getY().toFixed(t))},Mt.isUnbounded=function(){return this._unbounded},Mt.setLng=function(t){return this.__lng=this._unbounded?t:xt.cycleRestrict(t,-180,180),this},Mt.setX=Mt.setLng,Mt.getLng=function(){return this.__lng},Mt.getX=Mt.getLng,Mt.setLat=function(t){return this.__lat=this._unbounded?t:xt.boundaryRestrict(t,-90,90),this},Mt.setY=Mt.setLat,Mt.getLat=function(){return this.__lat},Mt.getY=Mt.getLat,Mt.moveTo=function(t){return this.setX(t.getX()),this.setY(t.getY()),this},Mt.copy=function(){return new yt.GeoPoint(this.getX(),this.getY(),this._unbounded)},Mt.diff=function(t){var e,i=t.getX()-this.getX();return t._unbounded||(e=Math.round(i/360))&&(i-=360*e),new kt(i,t.getY()-this.getY())},Mt.moveBy=function(t){return this.setX(this.getX()+t.getX()),this.setY(this.getY()+t.getY()),this},Mt.distance=function(t){return Bt.distance(this,t)},Mt.equals=function(t){return Math.abs(t.getX()-this.getX())<2e-7&&Math.abs(t.getY()-this.getY())<2e-7&&t.isUnbounded()==this.isUnbounded()},(Ct=yt.Bounds=function(t,e){this._left=t.x,this._right=e.x,this._top=e.y,this._bottom=t.y}).prototype={_getResultPoint:function(t,e){return new kt(t,e)},_getDirection:function(t){return this.getLeftBottom().diff(t||this.getRightTop())},getTop:function(){return this._top},getRight:function(){return this._right},getBottom:function(){return this._bottom},getLeft:function(){return this._left},equals:function(t){return this.getLeftBottom().equals(t.getLeftBottom())&&this.getRightTop().equals(t.getRightTop())},getLeftTop:function(){return this._getResultPoint(this._left,this._top)},getRightTop:function(){return this._getResultPoint(this._right,this._top)},getRightBottom:function(){return this._getResultPoint(this._right,this._bottom)},getLeftBottom:function(){return this._getResultPoint(this._left,this._bottom)},getCenter:function(){return this._getResultPoint((this._left+this._right)/2,(this._top+this._bottom)/2)},getSpan:function(){return this._getDirection().apply(Math.abs)},contains:function(t){var e=this._getDirection(),t=this._getDirection(t);return t.getX()>=Math.min(0,e.getX())&&t.getX()<=Math.max(0,e.getX())&&t.getY()>=Math.min(0,e.getY())&&t.getY()<=Math.max(0,e.getY())},copy:function(){return new this.constructor(this.getLeftBottom(),this.getRightTop())},getMapZoom:function(t){var e=0,i=t.coordSystem,n=i.getCoordPoint(this._left,this._bottom,1),o=n.copy().moveBy(this._getDirection()),o=i.fromCoordPoint(n).diff(i.fromCoordPoint(o)).apply(Math.abs),s=t._state.size.x,a=o.x;for(a/s<o.y/t._state.size.y&&(a=o.y,s=t._state.size.y);s<a;)a=Math.floor(a/2),e++;return Math.max(i.getMaxZoom()-e,0)},intersects:function(t){return bt.MathLib.intervalsIntersect(this.getLeft(),this.getRight(),t.getLeft(),t.getRight())&&bt.MathLib.intervalsIntersect(this.getBottom(),this.getTop(),t.getBottom(),t.getTop())}},Ct=yt.GeoBounds=function(t,e){this._left=t.getX(),this._right=e.getX(),this._top=e.getY(),this._bottom=t.getY(),this._isResultUnbounded=t.isUnbounded()&&e.isUnbounded()},Mt=Et(Ct,yt.Bounds),Ct.fromCenterAndSpan=function(t,e){var i=Bt._radius,n=Math.PI,o=Bt._epsilon,s=Math.min(Math.max(t.getY()*n/180,-n/2+o),n/2-o),a=Math.max(Math.min(e.y,180),0),r=a*n/180,s=i*Math.log(Math.tan(s/2+n/4)),i=Math.exp(2*s/i),r=(i+1)*Math.tan(Math.min(Math.max(r/2,-n/2+o),n/2-o)),i=-i,i=Math.max(r*r-4*i,0),i=(-r+Math.sqrt(i))/2*1,n=2*(Math.atan(i)-n/4)*180/n,o=t.isUnbounded()?e.x/2:Math.min(e.x/2,180-o);return new yt.GeoBounds(new yt.GeoPoint(t.getX()-o,n,t.isUnbounded()),new yt.GeoPoint(t.getX()+o,n+a,t.isUnbounded()))},Mt._getResultPoint=function(t,e){return new yt.GeoPoint(t,e,this._isResultUnbounded)},Mt._getDirection=function(t){var e=(t=t||this.getRightTop()).isUnbounded()?t.getX()-this._left:xt.cycleRestrict(t.getX()-this._left,-1e-10,360-1e-10),t=t.getY()-this._bottom;return new kt(e,t)},Mt.getCenter=function(){var t=Bt.getCoordPoint(this._left,this._bottom,1),e=t.copy().moveBy(this._getDirection()),e=Bt.fromCoordPoint(t).moveBy(Bt.fromCoordPoint(e)).scale(.5),e=Bt.toCoordPoint(e,1);return this._getResultPoint(e.getX(),e.getY())},Mt.intersects=function(t){return bt.MathLib.intervalsIntersect(this.getBottom(),this.getTop(),t.getBottom(),t.getTop())&&(this._isResultUnbounded?bt.MathLib.intervalsIntersect(this.getLeft(),this.getRight(),t.getLeft(),t.getRight()):bt.MathLib.sectorsIntersect(this.getLeft(),this.getRight(),t.getLeft(),t.getRight()))},Ct=yt.CollectionBounds=function(t){var e=new kt;yt.Bounds.call(this,e,e),this._empty=1,t&&this.add(t)},(Mt=Et(Ct,yt.Bounds)).add=function(t){var e;t instanceof Array?(e=this,wt.each(t,function(){e.add(this)})):this._empty?(this._left=this._right=t.x,this._top=this._bottom=t.y,this._empty=0):(t.x>this._right?this._right=t.x:t.x<this._left&&(this._left=t.x),t.y<this._bottom?this._bottom=t.y:t.y>this._top&&(this._top=t.y))},Mt.clear=function(){this._left=this._top=this._right=this._bottom=0},Ct=yt.GeoCollectionBounds=function(t){var e=new yt.GeoPoint(0,0);yt.GeoBounds.call(this,e,e),this._empty=1,this._lngs=[],t&&this.add(t)},(Mt=Et(Ct,yt.GeoBounds)).clear=function(){this._left=this._top=this._right=this._bottom=0,this._lngs=[]},Mt._insert=function(t){var e=xt.cycleRestrict(t.getX(),-180,180),t=t.getY();return this._empty&&(this._left=this._right=e,this._top=this._bottom=t,this._empty=0),this._top<t?this._top=t:this._bottom>t&&(this._bottom=t),e},Mt.add=function(t){var e;t instanceof Array?(e=this,wt.each(t,function(){e._lngs.push(e._insert(this))})):this._lngs.push(this._insert(t)),this._lngs.sort(function(t,e){return t-e});var i=0,n=this._lngs.length;if(0<n&&180<this._lngs[n-1]-this._lngs[0]){for(var o=0;o<n-1;o++)this._lngs[o+1]-this._lngs[o]>this._lngs[i+1]-this._lngs[i]&&(i=o);this._lngs[0]+360-this._lngs[n-1]>this._lngs[i+1]-this._lngs[i]?(this._left=this._lngs[0],this._right=this._lngs[n-1]):(this._left=this._lngs[i+1],this._right=this._lngs[i])}else this._left=this._lngs[0],this._right=this._lngs[n-1]},Ct=yt.GeoCoordSystem=function(t,e){this._radius=t||6378137,this._equator=t?2*Math.PI*t:40075016.68557849,this._e=.0818191908426,this._e2=.00669437999014,this._epsilon=1e-10,this._maxZoom=e||23,this._worldSize=Math.pow(2,this._maxZoom+8),this._a=this._worldSize/this._equator,this._b=this._equator/2,this._latRestriction=89.3},(Mt=Ct.prototype).getCoordPoint=function(t,e,i){return new yt.GeoPoint(t,e,i)},Mt.getCoordBounds=function(t,e){return new yt.GeoBounds(t,e)},Mt.getWorldSize=function(){return new yt.Point(this._worldSize,this._worldSize)},Mt.getMaxZoom=function(){return this._maxZoom},Mt.fromCoordPoint=function(t,e){if(t.isUnbounded()||!e)return this._mercatorToPixels(this._geoToMercator(t));e=e.getX();return this._mercatorToPixels(this._geoToMercator(this.getCoordPoint(xt.cycleRestrict(t.getX(),e-180,e+180),t.getY(),1)))},Mt.toCoordPoint=function(t,e){return this._mercatorToGeo(this._pixelsToMercator(t),e)},Mt.restrict=function(t){return t.copy().setY(xt.boundaryRestrict(t.getY(),-this._latRestriction,this._latRestriction))},Mt.distance=function(t,e){var i=Math.PI/180,n=t.getX()*i,o=t.getY()*i,s=e.getX()*i,t=e.getY()*i,e=0;return Math.abs(t-o)<this._epsilon&&Math.abs(n-s)<this._epsilon||(i=Math.cos((o+t)/2),e=this._radius*Math.sqrt((1-this._e2)/(1-this._e2*i*i))*Math.acos(Math.sin(o)*Math.sin(t)+Math.cos(o)*Math.cos(t)*Math.cos(s-n))),e},Mt.rulerDistance=function(t,e){var i,n=t.getX(),o=t.getY(),s=e.getX(),a=e.getY(),r=0;return Math.abs(a-o)<this._epsilon&&Math.abs(n-s)<this._epsilon||(i=(o+(a-o)/2)*Math.PI/180,t=Math.atan((60*s-60*n)/(60*a-60*o)*Math.cos(i)),e=this._radius,e=2*Math.PI*e/360,r=Math.abs(a-o)<this._epsilon?Math.abs((s-n)/Math.sin(t)*Math.cos(i)*e):Math.abs(e*(a-o)/Math.cos(t))),r},Mt._mercatorToGeo=function(t,e){var i=Math.PI/2,n=this._radius,i=i-2*Math.atan(1/Math.exp(t.y/n)),i=i+.003356551468879694*Math.sin(2*i)+657187271079536e-20*Math.sin(4*i)+1.764564338702e-8*Math.sin(6*i)+5328478445e-20*Math.sin(8*i),n=t.x/n;return new yt.GeoPoint(180*n/Math.PI,180*i/Math.PI,e)},Mt._geoToMercator=function(t){var e=t.getX()*Math.PI/180,i=xt.boundaryRestrict(t.getY(),-90,90)*Math.PI/180,n=this._radius,o=this._e,t=o*Math.sin(i),o=(Math.tan(Math.PI/4+i/2)||this._epsilon)/Math.pow(Math.tan(Math.PI/4+Math.asin(t)/2),o);return new kt(n*e,n*Math.log(o))},Mt._mercatorToPixels=function(t){return new kt(Math.round((this._b+t.x)*this._a),Math.round((this._b-t.y)*this._a))},Mt._pixelsToMercator=function(t){return new kt(t.x/this._a-this._b,this._b-t.y/this._a)};var C,M,x,w,P,S,Bt=new yt.GeoCoordSystem;function T(t,e){if(Pt.msie){var i,n;try{i=t.clientX,n=t.clientY}catch(t){n=i=0}x==e&&("mousemove"!=x||i==w&&n==P)||("mousemove"==(x=e)&&(w=i,P=n),S={})}else{e=t.originalEvent||t;e!=M&&(M=e,S={})}}Ct=yt.CartesianCoordSystem=function(t,e,i,n){this._left=t.x,this._right=e.x,this._bottom=t.y,this._top=e.y,this._xRange=this._right-this._left,this._yRange=this._top-this._bottom,this._scale=i||1,this._maxZoom=n||23,this._worldSize=Math.pow(2,this._maxZoom+8),this._bitsPerTile=Math.round(Math.log(yt.TILE_SIZE)/Math.log(2)),this._pixelMask=(1<<this._bitsPerTile)-1},(Mt=Ct.prototype).getCoordPoint=function(t,e,i){return new kt(t,e)},Mt.getCoordBounds=function(t,e){return new yt.Bounds(t,e)},Mt.fromCoordPoint=function(t){return new kt(Math.round((t.getX()-this._left)/this._xRange*(this._worldSize-1)),Math.round((1-(t.getY()-this._bottom)/this._yRange)*(this._worldSize-1)))},Mt.toCoordPoint=function(t){return new kt(this._left+t.getX()/(this._worldSize-1)*this._xRange,this._bottom+(1-t.getY()/(this._worldSize-1))*this._yRange)},Mt.distance=function(t,e){e=t.diff(e).scale(this._scale);return Math.sqrt(e.x*e.x+e.y*e.y)},Mt.rulerDistance=Mt.distance,Mt.restrict=function(t){return new kt(xt.boundaryRestrict(t.getX(),Math.min(this._left,this._right),Math.max(this._left,this._right)),xt.boundaryRestrict(t.getY(),Math.min(this._bottom,this._top),Math.max(this._bottom,this._top)))},Mt.getWorldSize=function(){return new yt.Point(this._worldSize,this._worldSize)},Mt.getMaxZoom=function(){return this._maxZoom},Ct=yt.MouseEvent=function(t,e){var i=t.originalEvent&&!t.fixedTouch?t.originalEvent:t;St.touchscreen&&i.touches?(this._event=xt.touchEventFix(i),this._event.type=t.type):this._event=wt.event.fix(t),this._map=e},(Mt=Ct.prototype={getCoordPoint:function(t){return this._point||(this._point=this._map.converter.localPixelsToCoordinates(this.getLocalPixels(),1)),t?this._point.copy():this._map.coordSystem.getCoordPoint(this._point.getX(),this._point.getY())},getLocalPixels:function(){return this._posInPixels||(this._posInPixels=this._map.converter.clientPixelsToLocalPixels(new kt(this._event.clientX,this._event.clientY))),this._posInPixels},getEvent:function(){return this._event}}).getGeoPoint=Mt.getCoordPoint,S={},bt.preventMapEvent=function(t,e){var i;e=e||t.type,i=t,t=e,Pt.msie&&(C=C||window.setTimeout(function(){S={},C=null},0)),T(i,t),S[e]=!0},bt.isMapEventPrevented=function(t,e){return T(t,e=e||t.type),S[e]||!1},Mt.preventMapEvent=function(){bt.preventMapEvent(this._event)},Mt.isMapEventPrevented=function(){return bt.isMapEventPrevented(this._event)},yt.MultiTouchEvent=function(t,e){this._event=xt.touchEventFix(t,"none"),this.touches=[];for(var i=0,n=this._event.touches.length;i<n;i++)this.touches[i]=new bt.Touch(this._event.touches[i],e)},yt.MultiTouchEvent.prototype={getEvent:function(){return this._event},preventMapEvent:function(){bt.preventMapEvent(this._event)},isMapEventPrevented:function(){return bt.isMapEventPrevented(this._event)}},bt.Touch=function(t,e){this._touch=t,this._map=e},bt.Touch.prototype={getCoordPoint:function(t){return this._point||(this._point=this._map.converter.localPixelsToCoordinates(this.getLocalPixels(),1)),t?this._point.copy():this._map.coordSystem.getCoordPoint(this._point.getX(),this._point.getY())},getLocalPixels:function(){return this._posInPixels||(this._posInPixels=this._map.converter.clientPixelsToLocalPixels(new kt(this._touch.clientX,this._touch.clientY))),this._posInPixels}},Ct=yt.Group=function(){this._objects=[]},(Mt=Ct.prototype).Events={Add:"Add",Remove:"Remove"},Mt.add=function(t,i){typeof t!=Tt&&(i=typeof i!=Tt?this._normalizeIndex(i):this.length(),t instanceof Array?wt.each(t,Lt(function(t,e){this._add(e,i+t)},this)):this._add(t,i))},Mt._add=function(t,e){this._objects.splice(e,0,t),Dt.notify(this,this.Events.Add,this,t,e)},Mt.splice=function(i,t){i=this._normalizeIndex(i);for(var e=[],n=0;n<t&&i<this._objects.length;n++)e=e.concat(this._removeByIndex(i));return wt.each(Array.prototype.slice.call(arguments,2),Lt(function(t,e){this._add(e,i+t)},this)),e},Mt._normalizeIndex=function(t){return(t=Math.min(t,this.length()))<0?Math.max(0,t+this.length()):t},Mt.remove=function(t){if(t instanceof Array){var i=[];return wt.each(t,Lt(function(t,e){i=i.concat(this._removeObject(e))},this)),i}return this._removeObject(t)},Mt._removeObject=function(t){t=this.indexOf(t);return-1!=t?this._removeByIndex(t):[]},Mt._removeByIndex=function(t){var e=this._objects.splice(t,1);return Dt.notify(this,this.Events.Remove,this,e[0],t),e},Mt.removeAll=function(){for(;this._objects.length;)this._removeByIndex(0)},Mt.get=function(t){var e=this._objects.length;return t<0&&(t=e+t)<0||e<=t?null:this._objects[t]},Mt.indexOf=function(t){return wt.inArray(t,this._objects)},Mt.length=function(){return this._objects.length},Mt.forEach=function(e,i){var n=this;wt.each(this._objects,function(t){e.call(i,this,t,n)})},Mt.filter=function(t,e,i){var n=[];return this.__filter(n,this,t,e,i),n},Mt.__filter=function(t,e,i,n,o){for(var s,a=0,r=e.length();a<r;a++)i.call(n,s=e.get(a))&&t.push(s),!o&&s instanceof yt.Group&&this.__filter(t,s,i,n)},(Ct=yt.AGeoObject=function(){this.id=null,this.name=null,this.description=null,this.metaDataProperty={},this._boundedBy=null,this._parentGroup=null,this._style=null,this._computedStyle=null}).fullStyle={parentStyle:null,hasHint:!1,hasBalloon:!0,iconStyle:{href:At.imageRoot+"micro/pmlbs.png",size:new kt(28,29),offset:new kt(-7,-28),shadow:null,template:"default#icon"},iconContentStyle:{template:"default#iconContent"},hintStyle:{template:"default#hint"},hintContentStyle:{template:"default#hintContent"},balloonStyle:{template:"default#balloon"},balloonContentStyle:{template:"default#balloonContent"},lineStyle:{strokeColor:"ff0000",strokeWidth:1},polygonStyle:{strokeColor:"ff0000",strokeWidth:1,fillColor:"ff0000",fill:1,outline:1}},Ct.shadowStyle={template:"default#iconShadow",href:null,offset:new kt,size:new kt},(Mt=Ct.prototype).onAddToGroup=function(t){this._parentGroup=t,this.update()},Mt.onRemoveFromGroup=function(){this._parentGroup=null,this.update()},Mt.getParentGroup=function(){return this._parentGroup},Mt.setStyle=function(t){this._style=t,this.update()},Mt.getStyle=function(){return this._style},Mt.getComputedStyle=function(){if(!this._computedStyle){for(var t,e=this,i=yt.Style,n=yt.Styles;!t&&e;)t=e.getStyle(),e=e.getParentGroup();this._computedStyle=i.copy(n.get(t)||n.get(n.DefaultStyleKey));for(var o=this._computedStyle.parentStyle;o;)(o=n.get(o))&&(i.extendStyle(this._computedStyle,o,0),o=o.parentStyle);var s=this.getParentGroup();i.extendStyle(this._computedStyle,s?s.getComputedStyle():yt.AGeoObject.fullStyle,1);s=this._computedStyle.iconStyle.shadow;s?i.extendStyle(s,yt.AGeoObject.shadowStyle,1):s==Tt&&(this._computedStyle.iconStyle.shadow=null)}return this._computedStyle},Mt.update=function(){this._computedStyle=null},Mt.setBounds=function(t){this._boundedBy=t},Mt.getBounds=function(){return this._boundedBy},Ct=yt.AInteractiveGeoObject=function(t){yt.AGeoObject.call(this),t=t||{},this._style=t.style,this._hintOptions=wt.extend({},t.hintOptions),this._hasHint=t.hasHint,this._hintContent=null,this._hintCustomContent=null,this._hintCustomContentLayout=null,this._balloonOptions=wt.extend({},t.balloonOptions),this._hasBalloon=t.hasBalloon,this._balloonContent=null,this._balloonCustomContent=null,this._balloonCustomContentLayout=null},(Mt=Et(Ct,yt.AGeoObject)).setOptions=function(t,e){t=t||{};var i,n=e?{hintOptions:{},balloonOptions:{},style:yt.Styles.get(yt.Styles.DefaultStyleKey),hasHint:void 0,hasBalloon:void 0}:{style:this.getStyle(),hasHint:this._hasHint,hasBalloon:this._hasBalloon,hintOptions:this.getHintOptions(),balloonOptions:this.getBalloonOptions()};for(i in t)n[i]=t[i];this._hasHint=n.hasHint,this._hasBalloon=n.hasBalloon,this.setHintOptions(n.hintOptions,1),this.setBalloonOptions(n.balloonOptions,1),this.setStyle(n.style)},Mt.getOptions=function(){return{style:this.getStyle(),hasHint:typeof this._hasHint==Tt?this.getComputedStyle().hasHint:this._hasHint,hasBalloon:typeof this._hasBalloon==Tt?this.getComputedStyle().hasBalloon:this._hasBalloon,hintOptions:this.getHintOptions(),balloonOptions:this.getBalloonOptions()}},Mt.update=function(){yt.AGeoObject.prototype.update.call(this),this._hintContent=this._balloonContent=null},Mt.setHintContent=function(t){this._hintCustomContent=t,this._hintCustomContentLayout=xt.normalizeContent(t),this._hintContent=null},Mt.getHintContent=function(){return this._hintCustomContent},Mt._getHintContentLayout=function(){var t;return this._hintContent||(this._hintCustomContentLayout?this._hintContent=this._hintCustomContentLayout:(t=(t=yt.Templates.get(this.getComputedStyle().hintContentStyle.template))||yt.Templates.get(yt.AGeoObject.fullStyle.hintContentStyle.template),this._hintContent=t.build(this))),this._hintContent},Mt.setHintOptions=function(t,e){this._hintOptions=e?t:wt.extend(this._hintOptions,t)},Mt.getHintOptions=function(){return this._hintOptions||{}},Mt._getComputedHintOptions=function(){var t=this.getHintOptions();return(t=!t.style?wt.extend({},t,{style:this.getComputedStyle().hintStyle}):t).layoutContext=this,t},Mt.openBalloon=function(t,e){typeof t!=Tt&&this.setBalloonContent(t),e&&this.setBalloonOptions(e)},Mt.closeBalloon=function(){},Mt.setBalloonOptions=function(t,e){this._balloonOptions=e?t:wt.extend(this._balloonOptions,t)},Mt.getBalloonOptions=function(){return this._balloonOptions||{}},Mt._getComputedBalloonOptions=function(){var t=this.getBalloonOptions();return(t=!t.style?wt.extend({},t,{style:this.getComputedStyle().balloonStyle}):t).layoutContext=this,t},Mt.setBalloonContent=function(t){this._balloonCustomContent=t,this._balloonCustomContentLayout=xt.normalizeContent(t),this._balloonContent=null},Mt.getBalloonContent=function(){return this._balloonCustomContent},Mt._getBalloonContentLayout=function(){var t;return this._balloonContent||(this._balloonCustomContentLayout?this._balloonContent=this._balloonCustomContentLayout:(t=(t=yt.Templates.get(this.getComputedStyle().balloonContentStyle.template))||yt.Templates.get(yt.AGeoObject.fullStyle.balloonContentStyle.template),this._balloonContent=t.build(this))),this._balloonContent},bt.TileCoordinates=function(a){var n=a.coordSystem,r=n.getMaxZoom(),h=n.getWorldSize(),t=new yt.Point(h.getX()/2,h.getY()/2),e=n.toCoordPoint(t),i=n.toCoordPoint(t.copy().moveBy(h),1),t=n.fromCoordPoint(e,i).diff(t),l=!!t.getX(),c=!!t.getY();this.fromPixels=function(t,e,i){var n={number:null,offset:null},o=r-e,s=i||yt.TILE_SIZE,e=l?xt.cycleRestrict(t.getX(),0,h.getX()):t.getX(),i=c?xt.cycleRestrict(t.getY(),0,h.getY()):t.getY(),t=new kt(e,i).scale(Math.pow(2,-o)),o=t.copy().scale(1/s).apply(Math.floor);return 0<=e&&e<h.getX()&&0<=i&&i<h.getY()&&(n.number=o),n.offset=o.copy().scale(s).diff(t).scale(a.animator.getState().scaleCoefficient).apply(Math.round),n},this.toPixels=function(t,e,i,n){i=r-i,n=n||yt.TILE_SIZE;return t.copy().scale(n).moveBy(e.copy().scale(1/a.animator.getState().scaleCoefficient)).scale(Math.pow(2,i))},this.scale=function(t,e,i){e=typeof e===Tt?a.getZoom():Number(e),i=typeof i===Tt?n.getMaxZoom():Number(i);return t.copy().scale(Math.pow(2,i-e))}},bt.Animator=function(n){var o=1,i=null,s=new kt;this.getState=function(){return{startPixelCenter:i||n._state.centerInTiles,currentPixelCenter:n._state.centerInTiles,scaleCoefficient:o}},this.start=function(){i=n._state.centerInTiles.copy(),Dt.notify(n,n.Events.SmoothZoomStart,n),n.__layerManager.onSmoothZoomStart()},this.scale=function(t){var e=n.converter.coordinatesToLocalPixels(t.saveThisPosition);o=t.scaleCoefficient;var i=n.converter.coordinatesToLocalPixels(t.saveThisPosition),i=e.diff(i),i=n.tileCoordinates.scale(i.scale(1/o));n._state.centerInTiles.moveBy(i),n.__layerManager.onSmoothZoomTick(t)},this.move=function(t){n._state.centerInTiles.moveBy(n.tileCoordinates.scale(t).scale(1/o));var e=s.moveBy(t).copy().apply(Math.floor);(e.x||e.y)&&(s=e.diff(s),n._state.offset.moveBy(e.neg()),t=e.copy().apply(Math.abs),n._state.size.x<t.x||n._state.size.y<t.y?i?this.stop():n.update():(n.__layerManager.onMove(n._state.offset,e.neg()),Dt.notify(n,n.Events.Move,n,e)))},this.stop=function(t){i&&(i=null,n._state.zoom=xt.boundaryRestrict(t||Math.round(n._state.zoom+Math.log(o)/Math.log(2)),n.getCurrentMinZoom(),n.getCurrentMaxZoom()),o=1,n.__layerManager.onSmoothZoomEnd(),Dt.notify(n,n.Events.SmoothZoomEnd,n),n.update(),Dt.notify(n,n.Events.BoundsChange,n))}},bt.Converter=function(i){var n=i._state,o=i.coordSystem;this.localPixelsToCoordinates=function(t,e){t=n.centerInPixels.diff(t),t=i.tileCoordinates.scale(t);return t.scale(1/i.animator.getState().scaleCoefficient).moveBy(n.centerInTiles),o.toCoordPoint(t,e)},this.coordinatesToLocalPixels=function(t,e){t=e?t:i.coordSystem.restrict(t),t=o.fromCoordPoint(t,i.getCenter(1));return i.tileCoordinates.scale(n.centerInTiles.diff(t).scale(i.animator.getState().scaleCoefficient),o.getMaxZoom(),i.getZoom()).moveBy(n.centerInPixels)},this.clientPixelsToCoordinates=function(t,e){return this.localPixelsToCoordinates(this.clientPixelsToLocalPixels(t),e)},this.coordinatesToClientPixels=function(t,e){return this.localPixelsToClientPixels(this.coordinatesToLocalPixels(t,e))},this.clientPixelsToLocalPixels=function(t){return n.getDomOffset().diff(t).moveBy(new kt(wt(window).scrollLeft(),wt(window).scrollTop()))},this.localPixelsToClientPixels=function(t){return new kt(wt(window).scrollLeft(),wt(window).scrollTop()).diff(t.copy().moveBy(n.getDomOffset()))},this.coordinatesToMapPixels=function(t,e){return this.localPixelsToMapPixels(this.coordinatesToLocalPixels(t,e))},this.mapPixelsToCoordinates=function(t,e){return this.localPixelsToCoordinates(this.mapPixelsToLocalPixels(t),e)},this.mapPixelsToLocalPixels=function(t){return t.copy().moveBy(n.offset)},this.localPixelsToMapPixels=function(t){return n.offset.diff(t)}};var E,L,O,I,A,k,B,D,R,Y,N,j,z,H,Z,U,F,$,G,V,X,W,q,K,Dt=(E=new function(){var h={},l={};function c(t,e){t.listener.apply(t.context,e)}this.addObserver=function(t){var e=t.id;(h[e]||(h[e]=[])).push(t);var i=l[e];if(i)for(var n=0,o=i.length;n<o;n++)c(t,i[n])},this.removeObserver=function(t){var e,i=h[t.id];i&&-1!=(e=wt.inArray(t,i))&&(i.splice(e,1),0==i.length&&delete h[t.id])},this.notify=function(t,e,i,n){e=Q(e,t),t=h[e];if(n&&(l[e]||(l[e]=[])).push(i),t)for(var o,s=0,a=t.slice(),r=a.length;s<r;s++)(o=a[s]).added&&c(o,i)}},J.prototype={enable:function(){this.added||(E.addObserver(this),this.added=1)},disable:function(){this.added&&(E.removeObserver(this),this.added=0)},cleanup:function(){this.disable(),this.context=this.listener=null}},yt.Events=new function(){this.observe=function(t,e,i,n,o){if(o=typeof o!=Tt?o:1,e instanceof Array){for(var s=[],a=0,r=e.length;a<r;a++)s[a]=new J(e[a],i,t,o,n||t);return s}return new J(e,i,t,o,n||t)},this.notify=function(t,e){E.notify(t,e,Array.prototype.slice.call(arguments,2))},this.notifyPermanent=function(t,e){E.notify(t,e,Array.prototype.slice.call(arguments,2),1)}});function Q(t,e){var i=e;return t+"_"+(i=!e||"object"==typeof e?xt.getUniqueId(e||yt):i)}function J(t,e,i,n,o){this.id=Q(t,i),this.listener=e,this.context=o,this.added=0,n&&this.enable()}function tt(t,i){yt.Templates.add(t,{build:function(t,e){return xt.normalizeContent(i(t,e))}})}function et(t,e){bt.ABaseLayout.call(this,t,e),e=this._$elements=wt('<div class="YMaps-b-balloon-point">                        <div class="YMaps-b-balloon YMaps-b-balloon_hint">                            <table class="YMaps-b-balloon-frame">                            <tr>                                <td class="YMaps-b-balloon-tl"><i class="YMaps-b-balloon-bit"><i></i></i></td>                                <td class="YMaps-b-balloon-t"><i class="YMaps-b-balloon-bit"><i></i></i></td>                                <td class="YMaps-b-balloon-tr"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            </tr>                            <tr>                                <td class="YMaps-b-balloon-ml"></td>                                <td class="YMaps-b-balloon-m">                                    <div class="YMaps-b-balloon-content"></div>                                </td>                                <td class="YMaps-b-balloon-mr"></td>                            </tr>                            <tr>                                <td class="YMaps-b-balloon-b" colspan="3">                                    <i class="YMaps-b-balloon-corners">                                        <i class="YMaps-b-balloon-bit"><i></i></i>                                        <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_l"><i></i></i>                                        <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_r"><i></i></i>                                    </i>                                </td>                            </tr>                            </table>                        </div>                    </div>'),this._nodes={visContainer:e.find(".YMaps-b-balloon"),content:e.find(".YMaps-b-balloon-content"),table:e.find(".YMaps-b-balloon-frame")},this._topNode=e[0],this._size=null,this._hasContent=!1}function it(t,e,i){bt.ABaseLayout.call(this,t,e),e=this._$elements=wt('<div class="YMaps-b-balloon-point">                <div class="YMaps-b-balloon YMaps-b-balloon_full YMaps-b-balloon_close-on">                    <div class="YMaps-b-balloon-wrap">                        <table class="YMaps-b-balloon-frame">                        <tr>                            <td class="YMaps-b-balloon-tl"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-t"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-tr"><i class="YMaps-b-balloon-bit"><i></i></i></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-ml"></td>                            <td class="YMaps-b-balloon-m">                                <div class="YMaps-b-balloon-content"></div>                            </td>                            <td class="YMaps-b-balloon-mr"></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-b" colspan="3">                                <i class="YMaps-b-balloon-corners">                                    <i class="YMaps-b-balloon-bit"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_l"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_r"><i></i></i>                                </i>                            </td>                        </tr>                        </table>                        <i class="YMaps-b-balloon-close" title="Закрыть"><i></i></i>                        <i class="YMaps-b-balloon-shad"><i></i></i>                    </div>                    <i class="YMaps-b-balloon-tail-full">                        <i class="YMaps-b-balloon-tail-top"><i></i></i>                        <i class="YMaps-b-balloon-tail-middle"><i></i></i>                        <i class="YMaps-b-balloon-tail-bottom"><i></i></i>                    </i>                </div>                </div>'),this.__balloon=i,this._nodes={visContainer:e.find(".YMaps-b-balloon")[0],contentParent:e.find(".YMaps-b-balloon-m")[0],content:e.find(".YMaps-b-balloon-content")[0],$close:e.find(".YMaps-b-balloon-close"),$eventBlockNode:e.find(".YMaps-b-balloon-frame"),$shad:e.find(".YMaps-b-balloon-shad"),$tail:e.find(".YMaps-b-balloon-tail-full")},this._nodes.$eventBlockNode=this._nodes.$eventBlockNode.add(this._nodes.$tail).add(this._nodes.$close),this._nodes.$close[0].title=At.hints.balloon.close}function nt(){var t,e,i,n;return O||(e=t=null,n=i=0,Pt.msie?(t=wt('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>'),wt("body").append(t),i=wt("div",t).innerWidth(),t.css("overflow-y","scroll"),n=wt("div",t).innerWidth(),wt(t).remove()):(e=wt('<div style="width:100%;height:200px;"></div>'),t=wt('<div style="position:absolute;top:-1000px;left:-1000px;width:100px;height:50px;overflow:hidden;"></div>').append(e).appendTo(document.body),i=e.width(),t.css({overflow:"auto"}),n=e.width(),t.remove()),O=i-n),O}function ot(e,n,o){return function(){var i,t=new yt.ToolBarRadioButton(yt.ToolBar.DEFAULT_GROUP,{hint:At.hints.toolBar[e],icon:Pt.msie&&Pt.version<7?At.images.toolBar.iconSprite:At.images.transparentImage,width:"19"},{selected:o});return t._applyTemplate=function(){yt.ToolBarRadioButton.prototype._applyTemplate.call(this),wt(this._parentContainer).find("img").addClass("YMaps-icon_"+e)},n&&(i=e.charAt(0).toUpperCase()+e.substr(1).toLowerCase(),t.onAddToToolBar=function(t,e){yt.ToolBarRadioButton.prototype.onAddToToolBar.call(this,t,e),this._listeners=[Dt.observe(this,this.Events.Select,function(){t.getMap()["enable"+i]()}),Dt.observe(this,this.Events.Deselect,function(){t.getMap()["disable"+i]()})]},t.onRemoveFromToolBar=function(){Ot(this._listeners,"cleanup"),yt.ToolBarRadioButton.prototype.onRemoveFromToolBar.call(this)}),t}}function st(t,e,i){var n=t.options.minWayPoints||2;!t.wayPoints||t.wayPoints.length<n?(e.error={code:400,message:"bad request"},i(!0)):i()}function at(i,n,o){var s=i.wayPoints.length,a={boundedBy:i.options.boundedBy,strictBounds:i.options.strictBounds,origin:i.options.origin,results:1},r=!1;function h(t,e){return-1===wt.inArray(e,i.viaPoints)}function l(t,e){n.allWayPoints[e]={request:String(i.wayPoints[e]),status:t?"ok":"error",data:t},t||(r=!0),--s||(n.wayPoints=wt.grep(n.allWayPoints,h),o(r))}n.allWayPoints=[],wt.each(i.wayPoints,function(n,t){var e=function(t){if(2===(t=wt.map(String(t).split(","),Number)).length&&!wt.grep(t,isNaN).length)return t}(t);e?l({type:"coords",point:e},n):(t=new yt.Geocoder(t,a),Dt.observe(t,[t.Events.Load,t.Events.Fault],function(t){var e,i;l(t.get(0)&&(e=t.get(0),i=e.getGeoPoint(),t=e.getBounds(),{type:"geocoder",text:e.text,kind:e.kind,precision:e.precision,AddressDetails:e.AddressDetails,point:[i.getLng(),i.getLat()],boundedBy:[[t.getLeft(),t.getTop()],[t.getRight(),t.getBottom()]]}),n)}))})}function rt(t){switch(t.type){case"Feature":return wt.map(t.geometry.geometries,rt);case"Point":return{indexInPolyline:t.lodIndex}}}function ht(t,n){var e=t.properties.PathMetaData;return{distance:e.Distance.value,duration:e[n].value,boundedBy:t.properties.boundedBy,encodedPoints:t.properties.encodedCoordinates,routeSegments:wt.map(t.features,function(t){return i=n,{angle:(t=(e=t).properties.SegmentMetaData).angle,street:t.street||"",action:t.Action.value,distance:t.Distance.value,duration:t[i].value,indexInPolyline:e.geometry.geometries[0].lodIndex};var e,i}),viaPoints:wt.map(t.features,rt)}}function lt(t,s,a){var e,r=t.options.avoidTrafficJams?"DurationInTraffic":"Duration";wt.ajax({url:(e=t,t=s,t=wt.map(t.allWayPoints,function(t){return t.data.point.toString()}),bt.routeService+"2.0/?"+wt.param({key:bt.userKey||[],lang:"ru_RU",origin:e.options.origin,results:1,rll:t.join("~"),rtm:e.options.avoidTrafficJams?"dtr":"atm",token:bt.token,via:e.viaPoints.join("~")||[]})),dataType:"jsonp",cache:1,scriptCharset:"utf-8",success:function(t){var e,i,n,o=t.data;o?o.features&&o.features.length&&wt.extend(s,(e=o.features[0],i=r,{distance:(n=e.properties.RouteMetaData).Distance.value,duration:n[i].value,boundedBy:e.properties.boundedBy,routes:wt.map(e.features,function(t){return ht(t,i)})})):s.error=t.error||t,a(!o)}})}function ct(i,n){return function(t,e){i&&i.call(n,{request:t,response:e})}}function ut(t){return new yt.GeoPoint(t[0],t[1])}function dt(t){return new yt.GeoBounds(ut(t[0]),ut(t[1]))}function pt(t){return new yt.RouteSegment(t.indexInPolyline,t.distance,t.duration,t.action,t.angle,t.street)}function _t(t){return new yt.ViaPoint(t.indexInPolyline)}function ft(t){return new yt.Route(t.encodedPoints,t.levels,t.boundedBy&&dt(t.boundedBy),wt.map(t.routeSegments,pt),t.distance,t.duration,wt.map(t.viaPoints,_t))}function mt(t){var t=t.response,n=[];return wt.each(t.wayPoints,function(t,e){return"error"!==e.status&&void n.push((i=e.data,e=new yt.WayPoint(ut(i.point)),"geocoder"===i.type?(e.setBounds(dt(i.boundedBy)),e.AddressDetails=i.AddressDetails,e.precision=i.precision,e.kind=i.kind,e.text=i.text):e.text=e.getGeoPoint().toString(),e));var i}),{distance:t.distance,duration:t.duration,boundedBy:t.boundedBy&&dt(t.boundedBy),routes:wt.map(t.routes,ft),wayPoints:n,error:t.error}}function gt(t,e){for(var i=[],n=[],o=0,s=t.length;o<s;o++)-1==wt.inArray(t[o],e)&&n.push(t[o]);for(o=0,s=e.length;o<s;o++)-1==wt.inArray(e[o],t)&&i.push(e[o]);return{equals:!i.length&&!n.length,added:i,removed:n}}function vt(t,e){for(var i in t)t.hasOwnProperty(i)&&typeof e[i]!=Tt&&("object"==typeof e[i]?wt.extend(!0,t[i],e[i]):t[i]=e[i]);return t}function Rt(t){return t&&0!=parseInt(t)?1==parseInt(t)?t.toString()+"&#160;"+K.strings.points[0]:parseInt(t)<5?t.toString()+"&#160;"+K.strings.points[1]:t.toString()+"&#160;"+K.strings.points[2]:"0&#160;"+K.strings.points[2]}function Yt(t){return t>=K.localTrafficMinZoom}function Nt(t,e){return t+":"+(e<10?"0":"")+e}function jt(t,e){for(var i=new yt.GeoObjectCollection,n=0,o=t.length;n<o;n++){var s,a=z.coverage.getRegionById(t[n].regionId);a&&((s=new yt.Placemark(a.view.point)).name=a.name,s.stat=t[n],t[n].nodata?s.setStyle(e.nodata):s.setStyle(e[t[n].style||"nolevel"]),i.add(s))}return i}function zt(t){z.coverage.regions=t.regions,z.coverage.state=yt.State.SUCCESS;for(var e=0,i=B.length;e<i;e++)B[e]()}Ct=yt.OverlayGroup=function(){yt.Group.call(this),this._map=this._parentContainer=null,this.__listeners=[Dt.observe(this,this.Events.Add,function(t,e,i){this._onAddObject(e,i)},this),Dt.observe(this,this.Events.Remove,function(t,e,i){this._onRemoveObject(e,i)},this)]},(Mt=Et(Ct,yt.Group)).getMap=function(){return this._map},Mt.getParentContainer=function(){return this._parentContainer},Mt.onAddToMap=function(t,e){this._map=t,this._parentContainer=e,this.forEach(this.__addObjectToMap,this)},Mt._onAddObject=function(t){this.__addObjectToMap(t)},Mt.__addObjectToMap=function(t){this._map&&t.onAddToMap(this._map,this._parentContainer)},Mt.onRemoveFromMap=function(){this.forEach(this.__removeObjectFromMap,this),this._map=this._parentContainer=null},Mt._onRemoveObject=function(t){this.__removeObjectFromMap(t)},Mt.__removeObjectFromMap=function(t){this._map&&t.onRemoveFromMap()},Mt.onMapUpdate=function(){Ot(this._objects.slice(),"onMapUpdate")},(Ct=bt.ALayer=function(t){this._options=wt.extend({},bt.ALayer.fullOptions,t),this._$element=wt('<div class="YMaps-layer" style="z-index: '+this._options.zIndex+';"></div>')}).fullOptions={zIndex:yt.ZIndex.MAP_LAYER},(Mt=bt.ALayer.prototype).onAddToMap=function(t,e){this._map=t,this._$element.appendTo(e),xt.position(this._$element[0],this._map._state.offset)},Mt.onRemoveFromMap=function(){this._$element.removeFromDom(),this._map=null},Mt.onMapUpdate=function(){xt.position(this._$element[0],this._map._state.offset)},Mt.update=function(){this._map&&this.onMapUpdate()},Mt.getMap=function(){return this._map},Mt.getContainer=function(){return this._$element[0]},Mt.onMove=function(t,e){xt.position(this._$element[0],t)},Mt.onSmoothZoomStart=function(){this._$element.addClass("YMaps-display-none")},Mt.onSmoothZoomTick=xt.NULL,Mt.onSmoothZoomEnd=function(){this._$element.removeClass("YMaps-display-none")},Mt.getCopyright=function(t,e){return""},Mt.setOptions=function(t,e){t=wt.extend({},e?bt.ALayer.fullOptions:this._options,t);t.zIndex!=this._options.zIndex&&this._$element.css("z-index",t.zIndex),this._options=t},Mt.getOptions=function(){return this._options},Ct=yt.Layer=function(t,e){bt.ALayer.call(this,e),this._dataSource=t},(Mt=Et(Ct,bt.ALayer)).getTileDataSource=function(){return this._dataSource},Mt.onAddToMap=function(t,e){bt.ALayer.prototype.onAddToMap.call(this,t,e);e=this._master;e||(this._master=e=new bt.TileContainer(this._dataSource),e.setZIndex(6)),e.setVisible(1),e.onAddToMap(this.getMap(),this.getContainer()),e.update(),this._slave&&(this._slave.setVisible(0),this._slave.onAddToMap(this.getMap(),this.getContainer())),this.__eventListener=It(this.getContainer()).events.eventListener().add(["selectstart","dragstart"],function(t){t.preventDefault()})},Mt.onRemoveFromMap=function(){this._master.onRemoveFromMap(),this._slave&&this._slave.onRemoveFromMap(),this.__eventListener.removeAll(),bt.ALayer.prototype.onRemoveFromMap.call(this)},Mt.onMove=function(t,e){var i;bt.ALayer.prototype.onMove.call(this,t,e),Pt.opera?(i=this,window.setTimeout(function(){i._master.onMove(e)},0)):this._master.onMove(e)},Mt.onMapUpdate=function(){bt.ALayer.prototype.onMapUpdate.call(this),this._slave&&!this._afterSmoothZoom&&this._slave.setVisible(0),this._master.update(),this._afterSmoothZoom=0},Mt.getTileInPosition=function(t){return this._master?this._master.getTileInPosition(t):null},Pt.opera&&Pt.version<9.5?Mt.onSmoothZoomStart=Mt.onSmoothZoomTick=Mt.onSmoothZoomEnd=xt.NULL:(Mt.onSmoothZoomStart=function(){this._dataSource.smoothZoomEnabled()?this._slave&&this._slave.setVisible(0):this._master.setVisible(0)},Mt.onSmoothZoomTick=function(t){this._dataSource.smoothZoomEnabled()&&this._master.scale(t.scaleCoefficient,t.saveThisPosition?this.getMap().converter.coordinatesToMapPixels(t.saveThisPosition):null)},Mt.onSmoothZoomEnd=function(){var t,e;this._dataSource.smoothZoomEnabled()?(t=this._master,(e=this._slave)||(e=new bt.TileContainer(this._dataSource)).onAddToMap(this.getMap(),this.getContainer()),t.setPosition(t.getPosition().moveBy(this.getMap()._state.offset)),t.setZIndex(5),e.setZIndex(6),e.setVisible(1),this._dataSource.isTransparent()&&t.setVisible(0),this._master=e,this._slave=t,this._afterSmoothZoom=1):this._master.setVisible(1)}),yt.ImageTile=function(t){this._state=yt.State.EMPTY,this._dataSource=t,this._pngInIE=t.isTransparent()&&Pt.msie&&Pt.version<7&&5.4<Pt.version;t=this._image=wt("<img />")[0];t.galleryImg=!1,this._element=this._pngInIE?wt("<span />")[0]:t,this._position=new kt,this._size=null,this._url="",this._element.style.position="absolute",this.scale(1)},(Mt=yt.ImageTile.prototype).getState=function(){return this._state},Mt.onAddToMap=function(t,e){It(this._image).events.add("load",this._onLoad,this).add("error",this._onError,this),this._map=t,e.appendChild(this._element)},Mt.onRemoveFromMap=function(){It(this._image).events.remove("load",this._onLoad,this).remove("error",this._onError,this),this._element.parentNode.removeChild(this._element)},Mt.scale=function(t){t=this._dataSource.getTileSize()*t;t!=this._size&&this._setSize(t)},Mt._setSize=function(t){xt.size(this._element,this._size=t)},Mt.setPosition=function(t){this._position.moveTo(t),xt.position(this._element,this._position)},Mt.getPosition=function(){return this._position.copy()},Mt.load=function(t,e){t&&typeof e!=Tt&&this._setUrl(this._dataSource.getTileUrl(t,e))},Mt._setUrl=function(t){t?(this._state=yt.State.LOADING,this._setSrc(t)):this._onError()},Mt._setSrc=function(t){this._url=t,(!Pt.opera||9.5<=Pt.version)&&(this._element.style.display="none"),this._image.src=t,Pt.webkit&&this._image.complete&&this._onLoad()},Mt.abort=function(){this._image.complete||this._onError()},Mt.error=function(){this._onError()},Mt._onError=function(){this._state=yt.State.FAILURE;var t=this._dataSource.getErrorTileUrl();this._url!=t&&this._setSrc(t)},Pt.opera&&Pt.version<9.5?Mt._onLoad=function(){this._state=yt.State.SUCCESS,this._map&&Dt.notify(this._map,this._map.Events._NeedRedraw)}:Mt._onLoad=function(){this._state=yt.State.SUCCESS,this._pngInIE?(this._element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this._image.src+")",this._element.style.display="block"):this._element.style.display=""},bt.TileContainer=function(t){this._dataSource=t,this._curTileSize=t.getTileSize(),this._scaleCoefficient=1,this._freeTiles=[],this._addedTiles=[],this._visible=1,this._zIndex=""},bt.TileContainer.prototype={onAddToMap:function(t,e){this._map!=t&&(this._map&&this._parentContainer.removeChild(this._element),this._map=t,this._parentContainer=e,this._element=wt('<div style="'+(this._visible?"":"display:none;")+(this._zIndex?"z-index:"+this._zIndex+";":"")+'" />').addClass("YMaps-tile-container")[0],e.appendChild(this._element))},onRemoveFromMap:function(){for(var t=0,e=this._addedTiles.length;t<e;t++){var i=this;wt.each(this._addedTiles[t],function(){i._releaseTile(this)})}this._addedTiles=[]},onMove:function(t){var e,i;this._isEmpty()||(e=this.getSize(),i=t.copy().apply(Math.abs),e.x<i.x||e.y<i.y?this._centering():this._updateCells(0<t.x?1:0,0<t.y?1:0))},update:function(){this._curTileSize!=this._dataSource.getTileSize()&&this.scale(1);var t=0,e=0,i=this._map.getContainerSize();i.x&&i.y&&(t=Math.ceil((i.y+1)/this._curTileSize)+1,e=Math.ceil((i.x+1)/this._curTileSize)+1),this._fill(t,e),this._isEmpty()||this._centering()},_fill:function(t,e){var i=this._addedTiles.length,n=this._addedTiles[0]?this._addedTiles[0].length:0;if(t<i){for(var o=t;o<i;o++){var s=this;wt.each(this._addedTiles[o],function(){s._releaseTile(this)})}this._addedTiles.splice(t,i-t),i=t}if(e<n){for(o=0;o<i;o++){for(a=e;a<n;a++)this._releaseTile(this._addedTiles[o][a]);this._addedTiles[o].splice(e,n-e)}n=e}if(i<t||n<e){for(o=0;o<i;o++)for(a=n;a<e;a++)this._addedTiles[o].push(this._occupyTile());for(var a,r,o=i;o<t;o++){for(r=[],a=0;a<e;a++)r.push(this._occupyTile());this._addedTiles.push(r)}}},_centering:function(){var t=this._map._state,e=this._curTileSize,i=this._map.getZoom(),n=t.centerInTiles,o=this._addedTiles.length,s=0<o?this._addedTiles[0].length:0,a=new kt((s>>1)*e,(o>>1)*e),i=this._map.tileCoordinates.fromPixels(n,i,this._dataSource.getTileSize()).offset;a.moveBy(new kt(1&s?i.x:i.x-e*(i.x>e/2),1&o?i.y:i.y-e*(i.y>e/2))),a=t.centerInPixels.diff(a).moveBy(t.offset).neg(),this.setPosition(a,1)},_releaseTile:function(t){t.abort(),this._freeTiles.push(t),t.onRemoveFromMap()},_occupyTile:function(){var t=this._freeTiles.shift()||this._dataSource.getTile();return t.onAddToMap(this._map,this._element),t.scale(this._scaleCoefficient),t},_callMethod:function(t){for(var e,i,n,o=Array.prototype.slice.call(arguments,1),s=0,a=this._addedTiles.length;s<a;s++)for(i=0,n=(e=this._addedTiles[s]).length;i<n;i++)e[i][t].apply(e[i],o)},setPosition:function(t,e){for(var i=0,n=this._addedTiles.length;i<n;i++)this._updateRow(i,t.copy(),e),t.moveByY(this._curTileSize)},getPosition:function(){return this._isEmpty()?new kt:this._addedTiles[0][0].getPosition().copy()},setZIndex:function(t){this._zIndex=t,wt(this._element).css("zIndex",t)},setVisible:function(t){this._visible=t,this._callMethod("abort"),wt(this._element).css("display",t?"":"none")},scale:function(t,e){var i=this.getPosition();e&&(i=e.diff(i).scale(t/this._scaleCoefficient).moveBy(e)),this._curTileSize=this._dataSource.getTileSize()*t,this._callMethod("scale",t),this.setPosition(i),this._scaleCoefficient=t},getSize:function(){return this._isEmpty()?new kt:new kt(this._addedTiles[0].length*this._curTileSize,this._addedTiles.length*this._curTileSize)},_updateCells:function(t,e){for(var i=this._map._state.offset,n=this._map.getContainerSize(),o=this._curTileSize;;){var s=this.getPosition(),a=this.getSize();if(!t&&s.x+i.x+o<0)this._shift(0,0);else if(!e&&s.y+i.y+o<0)this._shift(1,0);else if(t&&s.x+a.x+i.x-o>n.x)this._shift(0,1);else{if(!(e&&s.y+a.y+i.y-o>n.y))break;this._shift(1,1)}}},_shift:function(t,e){var i=this.getPosition(),n=this.getSize(),o=this._addedTiles.length;if(t)e?(a=new kt(i.x,i.y-this._curTileSize),s=this._addedTiles.pop(),this._addedTiles.splice(0,0,s),this._updateRow(0,a,1)):(a=new kt(i.x,i.y+n.y),l=this._addedTiles.shift(),this._addedTiles.splice(o,0,l),this._updateRow(o-1,a,1));else if(e){for(var s,a=new kt(i.x-this._curTileSize,i.y),r=0;r<o;r++)s=this._addedTiles[r].pop(),this._addedTiles[r].splice(0,0,s);this._updateColumn(0,a,1)}else{for(var h,l,a=new kt(i.x+n.x,i.y),r=0;r<o;r++)l=(h=this._addedTiles[r]).shift(),h.splice(h.length,0,l);this._updateColumn(this._addedTiles[0].length-1,a,1)}},_updateRow:function(t,e,i){for(var n=0,o=this._addedTiles[t],s=o.length;n<s;n++)e&&(o[n].setPosition(e.copy()),e.moveByX(this._curTileSize)),i&&this._updateTileUrl(o[n])},_updateColumn:function(t,e,i){for(var n=0,o=this._addedTiles.length;n<o;n++)e&&(this._addedTiles[n][t].setPosition(e.copy()),e.moveByY(this._curTileSize)),i&&this._updateTileUrl(this._addedTiles[n][t])},_updateTileUrl:function(t){var e=t.getPosition().copy();e.moveBy(new kt(this._curTileSize/2));var i=this._map,n=i.getZoom(),e=i.converter.mapPixelsToLocalPixels(e),e=i._state.centerInPixels.diff(e),e=i.tileCoordinates.scale(e).scale(1/i.animator.getState().scaleCoefficient).moveBy(i._state.centerInTiles),e=i.tileCoordinates.fromPixels(e,n,this._dataSource.getTileSize()).number;e?t.load(e,n):t.error()},_isEmpty:function(){return!this._addedTiles[0]||!this._addedTiles[0].length},getTileInPosition:function(t){if(!this._map||this._isEmpty())return null;var e=this._map.converter.mapPixelsToLocalPixels(this._addedTiles[0][0].getPosition()),i=this._addedTiles[0].length,n=this._addedTiles.length,o=Math.floor((t.x-e.x)/this._curTileSize),e=Math.floor((t.y-e.y)/this._curTileSize);return o<0||i<=o||e<0||n<=e?null:this._addedTiles[e][o]}},Ct=bt.CursorManager=function(t){this._$element=wt(t),this._stack=[]},(Mt=Ct.prototype).addCursor=function(t){At.cursors[t]&&(this._stack.push(t),this._setCursor(t))},Mt._setCursor=function(t){var e,i,n=At.cursors[t];Pt.msie?n.cursor!==yt.Cursor.INHERIT||8<=Pt.version&&8<=document.documentMode?(i=n.cursor.replace(/[^,]+\s+\d+\s+\d+\s*,?\s*/g,""),this._$element.css("cursor",i)):this._$element[0].style.cursor=this._$element[0].parentNode.currentStyle.cursor:Pt.opera||(this._$element[0].namespaceURI&&"http://www.w3.org/2000/svg"==this._$element[0].namespaceURI?(i=this._$element[0].className.baseVal.split(" "),this._current&&(e=At.cursors[this._current].class,i=wt.map(i,function(t){if(t!=e)return t})),i.push(n.class),this._$element[0].className.baseVal=i.join(" ")):(this._current&&this._$element.removeClass(At.cursors[this._current].class),this._$element.addClass(n.class))),this._current=t},Mt.removeCursor=function(t){for(var e,i=this._stack.length-1;0<=i&&this._stack[i]!==t;)i--;-1!=i&&(this._stack.splice(i,1),(e=this._stack.length)==i&&(0<e?this._setCursor(this._stack[e-1]):this._unsetCursor()))},Mt._unsetCursor=function(){var e,t;this._current&&(Pt.msie?this._$element.css("cursor",""):Pt.opera||(this._$element[0].namespaceURI&&"http://www.w3.org/2000/svg"==this._$element[0].namespaceURI?(t=this._$element[0].className.baseVal.split(" "),e=At.cursors[this._current].class,t=wt.map(t,function(t){if(t!=e)return t}),this._$element[0].className.baseVal=t.join(" ")):this._$element.removeClass(At.cursors[this._current].class)),this._current=null)},bt.ControlsLayer=function(i,t,n){var e=Dt.observe(i,i.Events.MouseDown,function(){try{Pt.msie&&document.selection&&"None"!=document.selection.type?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}catch(t){}}),o=It(t).events.eventListener().add(At.MapDOMEvents,function(t){var e;"wheel"==t.type&&Pt.mozilla&&Pt.version<=1.8&&t.clientX==t.originalEvent.clientX&&t.clientY==t.originalEvent.clientY&&(e=i.converter.coordinatesToClientPixels(i.getCenter()),t.clientX=e.getX(),t.clientY=e.getY()),s(t.type,new yt.MouseEvent(t,i),i)});function s(t,e,i){Dt.notify(i,"before"+t,i,e),e.isMapEventPrevented()||Dt.notify(i,t,i,e),n||Pt.mozilla&&Pt.version<1.9&&"contextmenu"==t&&e.isMapEventPrevented()||e.getEvent().stopPropagation()}St.touchscreen&&o.add(At.MapMultiTouchEvents,function(t){s(t.type,new yt.MultiTouchEvent(t,i),i)}),Dt.observe(i,i.Events.Destruct,function(){e.cleanup(),o.removeAll()})},bt.LayerManager=function(a){var i=wt("<div />").addClass("YMaps-layer-container").css("z-index",yt.ZIndex.LAYER_CONTAINER)[0],n=wt("<div />").addClass("YMaps-map-type-layer-container")[0],r=[];function o(t,e){for(var i,n=null,o=null,s=0,a=r.length;s<a;s++)r[s].getZoomRange&&(i=r[s].getZoomRange(t,e))&&(o=null==o?i.max:Math.max(o,i.max),n=null==n?i.min:Math.min(n,i.min));return{min:n,max:o}}a.getContainer().appendChild(i),i.appendChild(n),this.getContainer=function(){return i},this.add=function(t){r.push(t)},this.addToMap=function(t,e){t.onAddToMap(a,e?n:i)},this.remove=function(t){t=wt.inArray(t,r);-1!=t&&r.splice(t,1)},this.removeFromMap=function(t){t.onRemoveFromMap()},this.onMapUpdate=function(){Ot(r.slice(),"onMapUpdate")},this.onMove=function(t,e){Ot(r.slice(),"onMove",t,e)},this.onSmoothZoomStart=function(){Ot(r.slice(),"onSmoothZoomStart")},this.onSmoothZoomTick=function(t){Ot(r.slice(),"onSmoothZoomTick",t)},this.onSmoothZoomEnd=function(){Ot(r.slice(),"onSmoothZoomEnd")},this.getCopyrights=function(){for(var t,e=[],i=a.getBounds(),n=a.getZoom(),o=0,s=r.length;o<s;o++)(t=r[o].getCopyright(i,n))&&e.push(t);return e},this.getMinZoom=function(t,e){return o(t,e).min},this.getMaxZoom=function(t,e){return o(t,e).max}},(Ct=yt.Layers=new xt.ObjectStorage).get=function(t){t=this._objects[t];return"function"==typeof t?new t:t||null},yt.MapType=function(t,e,i){for(var n in t=t instanceof Array?t.slice():[],this.getLayers=function(){return t.slice()},(i=wt.extend({},{textColor:"#000",minZoom:null,maxZoom:null},i)).name=e,this.setName=function(t){i.name=t},i)!function(t,e){e["get"+t.charAt(0).toUpperCase()+t.substr(1)]=function(){return i[t]}}(n,this)},(Ct=yt.TileDataSource=function(t,e,i){this._tileUrlTemplate=t,this._isTransparent=!!e,this._smoothZoomEnabled=typeof i!=Tt?i:1}).ERROR_TILE_URL=At.imageRoot+"404.gif",Ct.TRANSPARENT_TILE_URL=Ct.TRANPARENT_TILE_URL=At.imageRoot+"404t.png",Ct.prototype={__gStrings:["","G","Ga","Gag","Gaga","Gagar","Gagari","Gagarin"],getTile:function(){return new yt.ImageTile(this)},getTileUrl:function(t,e){return this._tileUrlTemplate.replace("%d",2*(1&t.x)+(1&t.y)+1).replace("%c","x="+t.x+"&y="+t.y+"&z="+e).replace("%g","g="+this.__gStrings[(3*t.x+t.y)%8])},getErrorTileUrl:function(){return yt.TileDataSource[(this.isTransparent()?"TRANSPARENT":"ERROR")+"_TILE_URL"]},getTileUrlTemplate:function(){return this._tileUrlTemplate},setTileUrlTemplate:function(t){this._tileUrlTemplate=t},isTransparent:function(){return this._isTransparent},smoothZoomEnabled:function(){return this._smoothZoomEnabled},getTileSize:function(){return yt.TILE_SIZE}},function(){var t=new function(){var a={},r={};this.getLayerInfo=function(t,e,i,n){var o={layerId:t,callback:n},n=e.toString(8),s=n+"&"+i,e=a[s];e?(-1===wt.inArray(t,e.layerIds)&&e.layerIds.push(t),e.listeners.push(o)):(a[s]={ll:n,z:i,layerIds:[t],listeners:[o]},window.setTimeout(function(){var e,n,t;e=a[s],n=wt.param({l:e.layerIds.join(","),ll:e.ll,z:e.z,lang:"ru_RU"}),(t=r[n])?t.listeners=t.listeners.concat(e.listeners):(r[n]=e,wt.ajax({url:bt.coverageService+"v2/?"+n,dataType:"jsonp",jsonpCallback:decodeURIComponent(n).replace(/\W/g,"_"),scriptCharset:"utf-8",cache:1,success:function(t){var i;delete r[n],t&&"success"===t.status&&(i=t.data,wt.map(e.listeners,function(e){var t=wt.grep(i,function(t){return t.id===e.layerId})[0];t&&e.callback(t)}))}})),delete a[s]},0))}};function o(t,e,i){yt.Layer.call(this,e),this.id=t,this._copyright="",this._zoomRange=this._staticZoomRange=i}function e(t,e,i){function n(){o.call(this,t,e,i)}Et(n,o),yt.Layers.add(t,n)}Et(o,yt.Layer),wt.extend(o.prototype,{onAddToMap:function(t){yt.Layer.prototype.onAddToMap.apply(this,arguments),this._mapListener=Dt.observe(t,t.Events.BoundsChange,this._onBoundsChange,this),this._onBoundsChange()},onRemoveFromMap:function(){this._mapListener.cleanup(),this._mapListener=null,yt.Layer.prototype.onRemoveFromMap.apply(this,arguments)},_onBoundsChange:function(){var e=this,i=this.getMap(),n=i.getCenter(),o=i.getZoom();t.getLayerInfo(this.id,n,o,function(t){n.equals(i.getCenter())&&o===i.getZoom()&&(t.copyrights&&e.setCopyright(t.copyrights.join(", ")),t.zoomRange&&e.setZoomRange({min:t.zoomRange[0],max:t.zoomRange[1]}))})},setCopyright:function(t){this._copyright!==t&&(this._copyright=t,this.getMap()&&this.getMap().updateCopyrights())},getCopyright:function(){return this._copyright},setZoomRange:function(t){this._zoomRange.min===t.min&&this._zoomRange.max===t.max||(this._zoomRange=t,this.getMap()&&this.getMap().updateZoomRange())},getZoomRange:function(t,e){return e?this._zoomRange:this._staticZoomRange}}),e("map",new yt.TileDataSource(bt.mapTiles),{min:1,max:18}),e("sat",new yt.TileDataSource(bt.satTiles),{min:1,max:15}),e("skl",new yt.TileDataSource(bt.sklTiles,1,0),{min:1,max:18});var i={textColor:"#444",minZoom:0,maxZoom:7};function n(t,e){yt.MapType[t]=new yt.MapType(e,At.types[t],i)}n("MAP",["map"]),i.textColor="#ddd",i.maxZoom=10,n("SATELLITE",["sat"]),n("HYBRID",["sat","skl"])}(),yt.Map=function(t,e){t&&(this._options=wt.extend({ignoreResize:0,coordSystem:Bt,propagateEvents:!1},e||{}),this._native=!0,this._construct(t),this.__copyrights=new bt.CopyrightsControl,this.addControl(this.__copyrights),this.enableDblClickZoom(),this.enableDragging(),this._options.ignoreResize||It(window).events.add("resize",this.__onResize,this),wt.isReady||It(window).events.add("load",function(){this._inited&&this.redraw()},this))},(Mt=yt.Map.prototype).Events={Update:"update",TypeChange:"typechange",AddLayer:"addlayer",RemoveLayer:"removelayer",_NeedRedraw:"_needredraw",Redraw:"redraw",BalloonOpen:"BalloonOpen",BalloonClose:"BalloonClose",MoveStart:"movestart",Move:"move",MoveEnd:"moveend",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",BoundsChange:"boundschange",ZoomRangeChange:"ZoomRangeChange",SmoothZoomStart:"smoothzoomstart",SmoothZoomEnd:"smoothzoomend",BeforeClick:"beforeclick",Click:"click",BeforeDblClick:"beforedblclick",DblClick:"dblclick",BeforeContextMenu:"beforecontextmenu",ContextMenu:"contextmenu",BeforeMouseDown:"beforemousedown",MouseDown:"mousedown",BeforeDOMMouseScroll:"beforewheel",DOMMouseScroll:"wheel",BeforeMouseUp:"beforemouseup",MouseUp:"mouseup",BeforeMouseMove:"beforemousemove",MouseMove:"mousemove",BeforeMultiTouchStart:"beforemultitouchstart",MultiTouchStart:"multitouchstart",BeforeMultiTouchMove:"beforemultitouchmove",MultiTouchMove:"multitouchmove",BeforeMultiTouchEnd:"beforemultitouchend",MultiTouchEnd:"multitouchend",Destruct:"destruct"},Mt.Events.ChangeType=Mt.Events.TypeChange,Mt._construct=function(t){var e=this,t=wt(t);this._inited=0,this._element=t[0],t.addClass("YMaps"),document.compatMode&&"BackCompat"==document.compatMode&&t.addClass("YMaps-quirks-mode"),Pt.safari&&t.addClass("YMaps-safari"),this.__overlays=[],this.__overlays_internal=[],this.__createdLayers={},this.__layers=[];t=new kt;this._state={cache:!1,size:t,offset:new kt,centerInTiles:null,centerInPixels:t,_domOffset:t,getDomOffset:function(){return this.cache||e.__updateDomOffset(),this._domOffset}},this.__updateContainerSize(),this.coordSystem=this._options.coordSystem,this.tileCoordinates=new bt.TileCoordinates(this),this.converter=new bt.Converter(this),this.animator=new bt.Animator(this),this.__cursorManager=new bt.CursorManager(this._element),this.__layerManager=new bt.LayerManager(this),this.__objectLayer=new bt.CommonObjectLayer,this.addLayer(this.__objectLayer),this.__controlLayer=new bt.ControlsLayer(this,this.__layerManager.getContainer(),this._options.propagateEvents),this.__initPredefControls(),this.__setNewType(yt.MapType.MAP),this._state.zoom=this.getMinZoom(),this.hint=new bt.Hint(this),this.__listeners=[]},Mt.__initPredefControls=function(){var n={},o=this;wt.each(["Dragging","DblClickZoom","ScrollZoom","Magnifier","Ruler","HotKeys","RightButtonMagnifier"],function(t,e){var i;n[e]={enabled:0,control:null},o[i="enable"+e]||(o[i]=function(t){o.__setEnabledControl(e,1,t)}),o[i="disable"+e]||(o[i]=function(){o.__setEnabledControl(e,0)}),o[i=e.charAt(0).toLowerCase()+e.substr(1)+"Enabled"]||(o[i]=function(){return n[e].enabled})});var t=this.__layerManager.getContainer();n.Dragging.control=new bt.DraggingControl(t),n.Magnifier.control=new bt.MagnifierControl(t),n.RightButtonMagnifier.control=new bt.RightButtonMagnifierControl(t),St.touchscreen&&(n.ScrollZoom.control=new bt.TouchZoomControl(t)),this.__actionControls=n,this.__controls=[],this.__controlsPositions=[]},Mt.__setEnabledControl=function(t,e,i){var n=this.__actionControls[t];n&&n.enabled!=e&&(e?this.addControl(n.control||(n.control=new bt[t+"Control"]),null,i):n.enabled&&this.removeControl(n.control),n.enabled=e)},Mt.enableMagnifier=function(t){this.draggingEnabled()&&this.__actionControls.Dragging.control._stopListening(),this.__setEnabledControl("Magnifier",1,t)},Mt.disableMagnifier=function(){this.draggingEnabled()&&this.__actionControls.Dragging.control._beginListening(),this.__setEnabledControl("Magnifier",0)},Mt.addCursor=function(t){this.__cursorManager.addCursor(t)},Mt.removeCursor=function(t){this.__cursorManager.removeCursor(t)},Mt.getRulerState=function(){return this.__actionControls.Ruler.control?this.__actionControls.Ruler.control.getStateString():""},Mt.setRulerState=function(t){this.__actionControls.Ruler.control||(this.enableRuler(),this.disableRuler()),this.__actionControls.Ruler.control.setStateString(t)},Mt.redraw=function(t,e){var i;this._inited&&(i=this.converter.localPixelsToCoordinates(xt.size(this.getContainer()).scale(.5).apply(Math.ceil)),this.__updateContainerSize()&&(t?(this.__baseResizeCenter=this.__baseResizeCenter||this.getCenter(),this.setCenter(i),this.panTo(this.__baseResizeCenter,{callback:Lt(function(){this.__baseResizeCenter=null,e&&e.apply(null,arguments)},this)})):(this.update(),Dt.notify(this,this.Events.BoundsChange,this)),Dt.notify(this,this.Events.Redraw,this)))},Mt.__updateContainerSize=function(){var t=xt.size(this._element);return this._state.size.equals(t)?this.__updateDomOffset():(this._state.size=t,this._state.centerInPixels=new kt(Math.ceil(t.x/2),Math.ceil(t.y/2)),1)},Mt.__updateDomOffset=function(){var t=this._element,e=wt(this._element).offset(),i=parseInt(wt.curCSS(t,"borderLeftWidth",!0),10),t=parseInt(wt.curCSS(t,"borderTopWidth",!0),10),e=new kt(e.left,e.top).moveBy(new kt(i,t));return this._state._domOffset.equals(e)?0:(this._state._domOffset=e,1)},Mt.panTo=function(t,n){n=n||{};var o=t instanceof Array?t:[t],s=n.callback,a=this;if(!this._inited)return this.setCenter(o.pop()),void(s&&s(yt.State.SUCCESS));function r(t){var e,i;o.length&&t!=yt.State.FAILURE?(e=o.shift(),i=a.converter.coordinatesToLocalPixels(a._restrictCenter(e)).diff(a._state.centerInPixels),3*a._state.size.x<Math.abs(i.x)||3*a._state.size.y<Math.abs(i.y)?n.flying?a._flyBy(i.neg(),n):(a.setCenter(e),r(yt.State.SUCCESS)):a.moveBy(i.neg(),1,n)):s&&s(t)}(n.callback=r)()},Mt._flyBy=function(e,i){for(var n=this.getZoom(),t=n,o=3*this._state.size.x,s=3*this._state.size.y;o<Math.abs(e.x)||s<Math.abs(e.y);)e.scale(.5),t--;function a(t){i&&i.callback&&i.callback(t)}var r=this;this.setZoom(t,{smooth:1,callback:function(t){t==yt.State.SUCCESS?r.moveBy(e,1,{callback:function(t){t==yt.State.SUCCESS?r.setZoom(n,{smooth:1,callback:a}):a(t)}}):a(t)}})},Mt.moveBy=function(t,e,i){e?this.__getSmoothMoving().start(t,i):(this._moveStart(),this._move(t),this._moveEnd(),i&&i.callback&&i.callback(yt.State.SUCCESS))},Mt.startMove=function(t,e){(e=e||{}).nonstop=1,this.__getSmoothMoving().start(t,e)},Mt.stopMove=function(){this.__getSmoothMoving().stop(0)},Mt.__getSmoothMoving=function(){return this.__smoothMover=this.__smoothMover||new bt.SmoothMoving(this)},Mt._moveStart=function(){this._movingCnt=(this._movingCnt||0)+1,1==this._movingCnt&&Dt.notify(this,this.Events.MoveStart,this)},Mt._move=function(t){this.animator.move(t)},Mt._moveEnd=function(){--this._movingCnt,this._movingCnt||(Dt.notify(this,this.Events.MoveEnd,this),Dt.notify(this,this.Events.BoundsChange,this))},Mt._dragStart=function(){this._draggingCnt=(this._draggingCnt||0)+1,1==this._draggingCnt&&Dt.notify(this,this.Events.DragStart,this)},Mt._drag=function(){this._draggingCnt&&Dt.notify(this,this.Events.Drag,this)},Mt._dragEnd=function(){--this._draggingCnt,this._draggingCnt||Dt.notify(this,this.Events.DragEnd,this)},Mt.update=function(){this._inited&&(this.__updatePos(),this.__layerManager.onMapUpdate(),Dt.notify(this,this.Events.Update,this))},Mt.__onResize=function(){this.__resizeTimeout&&window.clearTimeout(this.__resizeTimeout);var t=this;this.__resizeTimeout=window.setTimeout(function(){t.redraw(1),t.__resizeTimeout=null},0)},Mt.__updatePos=function(){this._state.offset=new kt},Mt.setCenter=function(t,e,i){var n=this.coordSystem.fromCoordPoint(this._restrictCenter(t)),o=this._inited,t=0,i=i&&this.__setNewType(i);this.__getZoomer().stop(),this._state.centerInTiles&&this._state.centerInTiles.equals(n)||(this._state.centerInTiles=n,o||(this.__init(),this.__updatePos(),this._inited=1),this._state.zoom=xt.boundaryRestrict(this._state.zoom,this.getCurrentMinZoom(),this.getCurrentMaxZoom()),t=1),typeof e!=Tt&&e!=this._state.zoom&&(this._state.zoom=xt.boundaryRestrict(e,this.getCurrentMinZoom(),this.getCurrentMaxZoom()),t=1),!i&&o||(this.__applyCurType(),o&&Dt.notify(this,this.Events.TypeChange,this)),o||(this.__addLayers(),this.__addOverlays(),this.__addControls(),this.getRulerState()&&!this.rulerEnabled()&&(this.enableRuler(),this.disableRuler())),t&&o&&(this.update(),Dt.notify(this,this.Events.BoundsChange,this))},Mt._restrictCenter=function(t){return this.coordSystem.restrict(t)},Mt.__init=function(){var t,e,i,n;this.__updateContainerSize(),Pt.opera&&Pt.version<9.5&&(e=null,i=function(){wt(t.__layerManager.getContainer()).toggleClass("fakeClassName"),e=null},n=function(){e=e||window.setTimeout(i,0)},(t=this).__listeners.push(Dt.observe(this,this.Events.Move,n)),this.__listeners.push(Dt.observe(this,this.Events._NeedRedraw,n))),this.__listeners=this.__listeners.concat(Dt.observe(this,[this.Events.BoundsChange,this.Events.TypeChange],this.updateZoomRange)),this._native&&(bt.statCount({share:!0,pid:443,cid:72717,path:"created.1_1"}),this.__setupVisibilityCheck())},Mt.getCenter=function(t){var e=this.animator.getState().startPixelCenter;return e&&this.coordSystem.toCoordPoint(e,t)},Mt.getBounds=function(t){if(!this._inited)return null;var e=this.getContainerSize(),i=new yt.Point(-e.x%2/2,-e.y%2/2),n=this.converter.localPixelsToCoordinates(new kt(-i.x,e.y-i.y),1),o=this.converter.localPixelsToCoordinates(new kt(e.x-i.x,-i.y),1),s=this.coordSystem;if(t)return s.getCoordBounds(n,o);e=s.fromCoordPoint(n),i=s.fromCoordPoint(o),t=s.getWorldSize(),n=this.coordSystem.getCoordPoint(n.getX(),n.getY()),o=this.coordSystem.fromCoordPoint(n,o);return i.getX()-e.getX()>t.getX()&&Math.abs(o.getX()-e.getX())>=t.getX()-1e-7&&(e.setX(this._state.centerInTiles.x+.5*t.getX()+.5),i.setX(this._state.centerInTiles.x+.5*t.getX()-.5)),i.getY()-e.getY()>t.getY()&&Math.abs(o.getY()-e.getY())>=t.getY()-1e-7&&(e.setY(this._state.centerInTiles.y+.5*t.getY()+.5),i.setY(this._state.centerInTiles.y+.5*t.getY()-.5)),s.getCoordBounds(s.toCoordPoint(e),s.toCoordPoint(i))},Mt.setBounds=function(t){this._inited||this.__updateContainerSize(),this.setCenter(t.getCenter(),t.getMapZoom(this))},Mt.setType=function(t){this.__setNewType(t)&&(this._inited?(this.__applyCurType(),Dt.notify(this,this.Events.TypeChange,this)):this.updateZoomRange())},Mt.__setNewType=function(t){var e=this._state.type;return!!(t&&t instanceof yt.MapType&&e!=t)&&(this._state.type=t,e&&(this.__mapTypeAction("remove",e),this._inited&&this.__mapTypeAction("removeFromMap",e)),this.__mapTypeAction("add",t),!0)},Mt.__applyCurType=function(){this.__mapTypeAction("addToMap",this._state.type)},Mt.__mapTypeAction=function(t,e){for(var i=0,n=e.getLayers(),o=n.length;i<o;i++)this.__layerManager[t](this.__prepareLayer(n[i]),1)},Mt.getType=function(){return this._state.type},Mt.__prepareLayer=function(t){return"string"==typeof t?this.__createdLayers[t]||(this.__createdLayers[t]=yt.Layers.get(t)):t},Mt.addLayer=function(t){this.__layers.push(t),this._inited&&this.__assignLayer(t,1)},Mt.__assignLayer=function(t,e){t=this.__prepareLayer(t),this.__layerManager[e?"add":"remove"](t),this.__layerManager[e?"addToMap":"removeFromMap"](t),Dt.notify(this,this.Events[e?"AddLayer":"RemoveLayer"],this,t),this.updateZoomRange()},Mt.__addLayers=function(){for(var t=0,e=this.__layers.length;t<e;t++)this.__assignLayer(this.__layers[t],1)},Mt.removeLayer=function(t){var e=wt.inArray(t,this.__layers);-1!==e&&(this.__layers.splice(e,1),this._inited&&this.__assignLayer(t,0))},Mt._getLayerCopyrights=function(){return this.__layerManager.getCopyrights()},Mt.setZoom=function(t,e){this.__getZoomer().zoomTo(Number(t),e)},Mt.zoomBy=function(t,e){this.__getZoomer().zoomBy(t,e)},Mt.__getZoomer=function(){return this.__zoomer||(this.__zoomer=new bt.Zoomer(this))},Mt.getZoom=function(){return this._state.zoom},Mt.setMaxZoom=function(t){this._userMaxZoom=t,this.updateZoomRange()},Mt.setMinZoom=function(t){this._userMinZoom=t,this.updateZoomRange()},wt.each(["Min","Max"],function(t,e){var n=e.toLowerCase(),o="min"==n?"max":"min",s="get"+e+"Zoom",a="max"==n;Mt[s]=function(t,e,i){i=this._inited?this.__layerManager[s](t||this.getBounds(),i):null;return e||(null!=(e=this._state.type[s]())&&(i=null==i?e:Math[n](i,e)),typeof(e=a?this._userMaxZoom:this._userMinZoom)!=Tt&&null!==e&&(i=null==i?e:Math[o](i,e)),e=a?this.coordSystem.getMaxZoom():0,i=null==i?e:Math[o](i,e)),i},Mt["getCurrent"+e+"Zoom"]=function(){return this[s](null,null,!0)}}),Mt.updateZoomRange=function(){var t=this.getCurrentMinZoom(),e=this.getCurrentMaxZoom();this.__zoomRange&&this.__zoomRange.min==t&&this.__zoomRange.max==e||(this.__zoomRange={min:t,max:e},yt.Events.notify(this,this.Events.ZoomRangeChange,this,{min:t,max:e}))},Mt.getContainer=function(){return this._element},Mt.getContainerSize=function(){return this._state.size.copy()},Mt.addOverlay=function(t,e){this.__overlays.push(t),this.__overlays_internal.push(!!e),this._inited&&this.__objectLayer.add(t)},Mt.__addOverlays=function(){for(var t=0,e=this.__overlays.length;t<e;t++)this.__objectLayer.add(this.__overlays[t])},Mt.removeOverlay=function(t){var e=wt.inArray(t,this.__overlays);-1!==e&&(this.__overlays.splice(e,1),this.__overlays_internal.splice(e,1),this._inited&&this.__objectLayer.remove(t))},Mt.removeAllOverlays=function(){for(var t=0,e=this.__overlays.slice(),i=this.__overlays_internal.slice(),n=e.length;t<n;t++)i[t]||this.removeOverlay(e[t])},Mt.addControl=function(t,e,i){this.__controls.push(t),this.__controlsPositions.push(e),this._inited&&t.onAddToMap(this,e,i)},Mt.__addControls=function(){for(var t=0,e=this.__controls.length;t<e;t++)this.__controls[t].onAddToMap(this,this.__controlsPositions[t])},Mt.removeControl=function(t){var e=wt.inArray(t,this.__controls);-1!==e&&(this.__controls.splice(e,1),this.__controlsPositions.splice(e,1),this._inited&&t.onRemoveFromMap())},Mt.openBalloon=function(t,e,i){var n;t&&(i=i||{},this.closeBalloon(),(n=this.__balloon)||(this.__balloon=n=new yt.Balloon,this.__listeners.push(Dt.observe(n,n.Events.Close,this.closeBalloon,this))),(this.__curBalloon=n).setGeoPoint(t.copy()),n.setContent(e),this.__balloonCloseCallback="function"==typeof i.onClose?i.onClose:null,n.setOptions(i,1),this.addOverlay(n),Dt.notify(this,this.Events.BalloonOpen,this))},Mt.closeBalloon=function(){return this.__curBalloon?(this.__balloonCloseCallback&&this.__balloonCloseCallback(),this.__curBalloon=null,this.__balloon._setContent(null),this.removeOverlay(this.__balloon),Dt.notify(this,this.Events.BalloonClose,this),1):0},Mt.getBalloon=function(){return this.__curBalloon},Mt.addCopyright=function(t){this.__copyrights.addCopyright(t)},Mt.removeCopyright=function(t){this.__copyrights.removeCopyright(t)},Mt.updateCopyrights=function(){this.__copyrights&&this.__copyrights.update()},Mt.__setupVisibilityCheck=function(){var t=this;bt.counterShare&&(this.__visibilityCheckInterval=window.setInterval(function(){t.__checkVisibility()},1e3))},Mt.__checkVisibility=function(){var t=this.getContainerSize();0<t.x&&0<t.y&&("visible"!=(t=bt.checkVisibility(this._element))&&"unable"!=t||this.__teardownVisibilityCheck(),"visible"==t&&(bt.statCount({pid:443,cid:72717,path:"visible.1_1"}),this.__copyrights.checkVisibility()))},Mt.__teardownVisibilityCheck=function(){this.__visibilityCheckInterval&&(window.clearInterval(this.__visibilityCheckInterval),this.__visibilityCheckInterval=null)},Mt.destructor=function(){Dt.notify(this,this.Events.Destruct,this),this.__listeners&&Ot(this.__listeners,"cleanup"),this.__resizeTimeout&&window.clearTimeout(this.__resizeTimeout),this._element&&wt(this._element).empty(),this._options&&!this._options.ignoreResize&&It(window).events.remove("resize",this.__onResize,this),this.__teardownVisibilityCheck(),this.converter=this.__overlays=this.__overlays_internal=this._element=this.__controls=this.__actionControls=this.__controlsPositions=this.__layers=this._inited=this.__layerManager=this.__objectLayer=this._graphicsLayer=this.__controlLayer=this._state=this.__createdLayers=this.__copyrights=this.__balloon=this.__curBalloon=this.__listeners=null},Ct=bt.CommonObjectLayer=function(){yt.Group.call(this),bt.ALayer.call(this,{zIndex:yt.ZIndex.COMMON_OBJECT_LAYER}),wt(this.getContainer()).addClass("YMaps-common-object-layer"),this.__listeners=[Dt.observe(this,this.Events.Add,function(t,e,i){this.__addObjectToMap(e,i)},this),Dt.observe(this,this.Events.Remove,function(t,e,i){this.__removeObjectFromMap(e,i)},this)]},Mt=Et(Ct,bt.ALayer),wt.extend(!0,Ct.prototype,yt.Group.prototype),Mt.onAddToMap=function(t,e){bt.ALayer.prototype.onAddToMap.call(this,t,e),this.forEach(this.__addObjectToMap,this)},Mt.__addObjectToMap=function(t){this.getMap()&&t.onAddToMap(this.getMap(),this.getContainer())},Mt.onRemoveFromMap=function(){this.forEach(this.__removeObjectFromMap,this),bt.ALayer.prototype.onRemoveFromMap.call(this)},Mt.__removeObjectFromMap=function(t){this.getMap()&&t.onRemoveFromMap()},Mt.onSmoothZoomStart=function(){wt(this.getContainer()).css("visibility","hidden")},Mt.onSmoothZoomEnd=function(){wt(this.getContainer()).css("visibility","visible")},Mt.onMapUpdate=function(){bt.ALayer.prototype.onMapUpdate.call(this),Ot(this._objects.slice(),"onMapUpdate")},yt.Templates=new xt.ObjectStorage,(Ct=yt.Styles=new xt.ObjectStorage).DefaultStyleKey="default#style",Ct=bt.ABaseLayout=function(t,e){this._context=t,this._map=e,this._parentNode=null},(Mt=Ct.prototype)._setContent=function(t,e){this._contentLayout&&this._contentLayout.onRemoveFromParent(),t&&t.onAddToParent(e),this._contentLayout=t},Mt.getRootNodes=function(){return this._$elements},Mt.onAddToParent=function(t){this._parentNode=t,wt(t).append(this._$elements)},Mt.onRemoveFromParent=function(){this._parentNode=null,this._$elements.removeFromDom()},Ct=bt.TextLayout=function(t,e,i,n){bt.ABaseLayout.call(this,t,e),this._text=String(i),(this._isTemplate=n)||(this.update=function(){})},(Mt=Et(Ct,bt.ABaseLayout)).onAddToParent=function(t){this._parentNode=t,this._isTemplate||!this._$elements?(this._$elements=wt("<div />"),this._$elements.html(this._isTemplate?this.__prepareTemplate(this._text,this._context):this._text),this._$elements=this._$elements.contents(),wt(t).append(this._$elements),Pt.msie&&Pt.version<7&&this.__pngFix()):wt(t).append(this._$elements)},Mt.__pngFix=function(){for(var t=this._$elements.filter("img").add(this._$elements.find("img")),o=this,e=0,i=t.length;e<i;e++)!function(i){var n=It(i).events.eventListener().add("load",function(){var t=wt("<div />").css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.src+"', sizingMethod='scale')"})[0];xt.size(t,xt.size(i));var e=o._$elements.index(i);-1!=e&&(o._$elements[e]=t),wt(i).replaceWith(t),n.removeAll()})}(t[e])},Mt.__prepareTemplate=function(t,e){var i=new RegExp("\\$\\[[^\\]]*\\]","g"),n=t.match(i);if(n)for(var o,s=0,a=n.length,r=new RegExp("\\|([^\\]]*)");s<a;s++)null==(o=this.__getTemplateVal(n[s],e))&&(o=n[s].match(r))&&2==o.length&&(o=o[1]),t=t.replace(n[s],null==o?"":o);return t},Mt.__getTemplateVal=function(t,e){if(t){for(var i,n=e,o=new RegExp("[^\\$\\[\\]\\|\\s]+"),s=t.match(o)[0].split(".");s.length&&n;)"style"==(i=s.shift())&&n==e&&"function"==typeof e.getComputedStyle?n=e.getComputedStyle():("0"!=i||n instanceof Array)&&(n=n[i]);return n}return null},Mt.update=function(){var t=wt("<div />");t.html(this.__prepareTemplate(this._text,this._context)),t=t.contents(),this._parentNode&&(this._$elements.remove(),t.appendTo(this._parentNode)),this._$elements=t,Pt.msie&&Pt.version<7&&this.__pngFix()},Ct=bt.DOMLayout=function(t,e,i){bt.ABaseLayout.call(this,t,e),this._$elements=wt(i)},(Mt=Et(Ct,bt.ABaseLayout)).update=xt.NULL,yt.Template=function(t){this._text=t||""},yt.Template.prototype={build:function(t,e){return new bt.TextLayout(t,e,this._text,1)}},yt.LayoutTemplate=function(t){this._layoutClass=t},yt.LayoutTemplate.prototype={build:function(t,e,i){return new this._layoutClass(t,e,i)}},tt("default#iconContent",xt.NULL),tt("default#hintContent",function(t){return t.name||null}),tt("default#balloonContent",function(t){return"<b>"+(t.name||"")+"</b><div>"+(t.description||"")+"</div>"}),(Ct=yt.Style=function(t){this.parentStyle=t}).copy=function(t){var e=yt.Style.extendStyle({},t,0);return e.parentStyle=t.parentStyle,e},Ct.extendStyle=function(t,e,i){var n,o,s;for(s in e)n=e[s],"parentStyle"!=s&&typeof n!=Tt&&(o=t[s],"shadow"==s&&null===o||(o=typeof o==Tt||i&&null===o,"template"==s||null===n||"object"!=typeof n?o&&(t[s]=n):n.copy?o&&(t[s]=n.copy()):(o&&(t[s]={}),yt.Style.extendStyle(t[s],n,i))));return t},yt.IconStyle=function(t){this.template=t},yt.IconShadowStyle=function(t){this.template=t},yt.IconContentStyle=function(t){this.template=t},yt.BalloonStyle=function(t){this.template=t},yt.BalloonContentStyle=function(t){this.template=t},yt.HintStyle=function(t){this.template=t},yt.HintContentStyle=function(t){this.template=t},yt.LineStyle=function(){},yt.PolygonStyle=function(){yt.LineStyle.call(this)},function(){function t(t,e){var i=new yt.Style(null);return i.iconStyle={offset:new kt(-7,-28),href:At.imageRoot+"micro/pm"+e+"s.png",size:new kt(28,29),shadow:null,template:"default#"+t+"PointIcon"},yt.Styles.add("default#"+t+"Point",i),i}var e,i,n,o,s={white:"wt",green:"gn",red:"rd",yellow:"yw",darkblue:"db",night:"nt",grey:"gr",blue:"bl",orange:"or",darkorange:"do",pink:"pn",violet:"vv"};for(e in s)t(e,s[e]),n=s[i=e],o=void 0,(o=new yt.Style(null)).iconStyle={offset:new kt(-7,-19),href:At.imageRoot+"placemarks/pm"+n+"s.png",size:new kt(19,20),shadow:null,template:"default#"+i+"PointIcon"},yt.Styles.add("default#"+i+"SmallPoint",o);yt.Styles.add(yt.Styles.DefaultStyleKey,t("lightblue","lb"))}(),bt.Popup=function(t,e){e=e||{},this._map=t,this._style=e.style||yt.AGeoObject.fullStyle.hintStyle,this._vpNode=document.body,this._vpPaddings=this.DEFAULT_VIEWPORT_PADDINGS,this._maxSize=[0,0],this.__actualMaxSize=[0,0],this.__setMaxSize(e.maxWidth||0,e.maxHeight||0),this._layoutContext=null,this._currentLayoutContext=null,this.__showed=0,this._holdOnMouseOver=typeof e.holdOnMouseOver!=Tt?e.holdOnMouseOver:1,this._onHide=e.onHide||null,this._recalcActualMaxSize(),this._showTimeout=this.DEFAULT_SHOW_TIMEOUT,typeof e.showTimeout!=Tt&&this._setShowTimeout(e.showTimeout),this._hideTimeout=this.DEFAULT_HIDE_TIMEOUT,typeof e.hideTimeout!=Tt&&this._setHideTimeout(e.hideTimeout),this.__onShowTimeout=Lt(this.quickShow,this),this.__onHideTimeout=Lt(this.quickHide,this),this._owner=e.owner},(Mt=bt.Popup.prototype).Events={Hide:"Hide",Show:"Show"},Mt.DEFAULT_SHOW_TIMEOUT=250,Mt.DEFAULT_HIDE_TIMEOUT=700,Mt.DEFAULT_VIEWPORT_PADDINGS=[10,10,10,10],Mt.setPosition=function(t){t instanceof kt&&(this._position=t.copy(),this._layout&&this.__showed&&this.__applyPosition())},Mt.getPosition=function(){return this._position},Mt.__applyPosition=function(){var t,e,i,n,o,s,a;this._position&&((t=this._map.converter.localPixelsToClientPixels(this._position)).moveBy(new kt(wt(window).scrollLeft(),wt(window).scrollTop())),e=(s=this._getActualViewportBounds()).getLeft(),i=s.getTop(),n=s.getRight(),o=s.getBottom(),a=this._layout.getSize?this._layout.getSize():xt.size(this._container),s=t.x+a.x,a=t.y+a.y,n<s?t.x-=s-n:t.x<e&&(t.x+=e-t.x),o<a?t.y-=a-o:t.y<i&&(t.y+=i-t.y),xt.position(this._container,t.moveBy(this._getBodyOffset().neg())))},Mt._getActualViewportBounds=function(){var t=this._vpPaddings,e=t[0],i=t[1],n=t[2],o=t[3],s=wt(window),a=s.scrollLeft(),r=s.scrollTop(),h=s.width(),l=s.height(),t=o+i,s=e+n;return h<t&&(o-=t=Math.ceil((t-h)/2),i-=t),l<s&&(e-=s=Math.ceil((s-l)/2),n-=s),new yt.Bounds(new kt(o+a,-n+l+r),new kt(-i+h+a,e+r))},Mt._getBodyOffset=function(){var t=wt("body"),e=t.css("position");if("absolute"!=e&&"relative"!=e)return new kt(0,0);t=t.offset();return new kt(t.left,t.top)},Mt._setStyle=function(t){this._style!=t&&(this._style=t,this.update())},Mt.update=function(){yt.Templates.get(this._style.template)==this._currentTemplate&&this._currentLayoutContext==this._layoutContext&&this._layout?this.__showed&&this._layout.update():(this._removeLayout(),this.__showed&&this._recreate())},Mt._recreate=function(){this._removeLayout(),this._createLayout(),this._layout&&(this.__rewriteContent(),this._layout.setMaxSize&&this._layout.setMaxSize.apply(this._layout,this.__actualMaxSize),this.__showed&&this.__showLayout())},Mt._removeLayout=function(){this._layout&&(It(this._container).events.remove("mouseenter",this._onMouseOver,this),this.__showed&&this._layout.onRemoveFromParent(),this._layout=null)},Mt._createLayout=function(){this._container||(this._container=document.createElement("div"),this._container.style.zIndex=yt.ZIndex.POPUP,this._container.className="YMaps-popup");var t=(t=yt.Templates.get(this._style.template))||yt.Templates.get(yt.AGeoObject.fullStyle.hintStyle.template);this._currentTemplate=t,this._currentLayoutContext=this._layoutContext,this._layout=t.build(this._layoutContext,this._map,this._owner),this._layout.onAddToParent(this._container)},Mt.__showLayout=function(){this._container.style.visibility="hidden",this._vpNode.appendChild(this._container),this._layout.update(),this.__applyPosition(),this._container.style.visibility="visible"},Mt.setContent=function(t){this._content=t,this._contentLayout=xt.normalizeContent(t),this._layout&&(this.__rewriteContent(),this.__showed&&(this._layout.update(),this.__applyPosition()))},Mt.getContent=function(){return this._content},Mt.getLayout=function(){return this.__showed?this._layout:null},Mt.getContentLayout=function(){return this.__showed&&this._contentLayout||null},Mt.__rewriteContent=function(){this._layout.setContent&&this._layout.setContent(this._contentLayout)},Mt.setOptions=function(t,e){t=t||{};var i,n=e?{style:yt.AGeoObject.hintStyle,maxWidth:0,maxHeight:0,showTimeout:this.DEFAULT_SHOW_TIMEOUT,hideTimeout:this.DEFAULT_HIDE_TIMEOUT,holdOnMouseOver:1,onHide:null,layoutContext:null}:this.getOptions();for(i in t)n[i]=t[i];this._layoutContext=n.layoutContext,this.__setMaxSize(n.maxWidth,n.maxHeight),this._recalcActualMaxSize(),this._setShowTimeout(n.showTimeout),this._setHideTimeout(n.hideTimeout),this._holdOnMouseOver=n.holdOnMouseOver,this._onHide=n.onHide,this._setStyle(n.style)},Mt.getOptions=function(){return{style:this._style,maxWidth:this._maxSize[0],maxHeight:this._maxSize[1],showTimeout:this._showTimeout,hideTimeout:this._hideTimeout,holdOnMouseOver:this._holdOnMouseOver,onHide:this._onHide,layoutContext:this._layoutContext}},Mt.__setMaxSize=function(t,e){t=Math.max(t,0)||0,e=Math.max(e,0)||0;var i=0;return this._maxSize[0]!=t&&(this._maxSize[0]=t,i=1),this._maxSize[1]!=e&&(this._maxSize[1]=e,i=1),i},Mt._recalcActualMaxSize=function(){var t=this._getActualViewportBounds();this.__actualMaxSize=[Math.min(t.getRight()-t.getLeft(),this._maxSize[0]||1/0),Math.min(t.getBottom()-t.getTop(),this._maxSize[1]||1/0)],this._layout&&(this._layout.setMaxSize&&this._layout.setMaxSize.apply(this._layout,this.__actualMaxSize),this.__showed&&(this._layout.update(),this.__applyPosition()))},Mt._setShowTimeout=function(t){"number"!=typeof t||isNaN(t)||(this._showTimeout=t)},Mt._setHideTimeout=function(t){"number"!=typeof t||isNaN(t)||(this._hideTimeout=t)},Mt._clearAllTimeouts=function(){this._clearShowTimeout(),this._clearHideTimeout()},Mt._clearShowTimeout=function(){this.__showTimeoutID&&(window.clearTimeout(this.__showTimeoutID),this.__showTimeoutID=null)},Mt._clearHideTimeout=function(){this.__hideTimeoutID&&(window.clearTimeout(this.__hideTimeoutID),this.__hideTimeoutID=null)},Mt.show=function(t){this._clearHideTimeout(),t&&this.setPosition(t),this.__showed||(0==this._showTimeout?this.quickShow(t):this.__showTimeoutID||(this.__showTimeoutID=window.setTimeout(this.__onShowTimeout,this._showTimeout)))},Mt.quickShow=function(t){this._clearAllTimeouts(),t&&this.setPosition(t),this.__showed||(this.__showed=1,this._layout?(this._layout.onAddToParent(this._container),this.__showLayout()):this._recreate(),Dt.notify(this,this.Events.Show,this),this._hiding=0,It(this._container).events.add("mouseenter",this._onMouseOver,this))},Mt.hide=function(){this._hiding=1,this._clearShowTimeout(),this.__showed?0==this._hideTimeout?this.quickHide():this.__hideTimeoutID||(this.__hideTimeoutID=window.setTimeout(this.__onHideTimeout,this._hideTimeout)):this._onHide&&this._onHide()},Mt.quickHide=function(){this._clearAllTimeouts(),!this.__showed||this._holdOnMouseOver&&this.__isMouseOver||this._hide()},Mt._hide=function(){this._clearAllTimeouts(),this.__showed&&(this.__showed=0,this.__isMouseOver=0,It(this._container).events.remove("mouseenter",this._onMouseOver,this).remove("mousemove",this._onMouseOut,this),this._layout.onRemoveFromParent(),this._vpNode.removeChild(this._container),this._onHide&&this._onHide(),Dt.notify(this,this.Events.Hide,this))},Mt.isShown=function(){return this.__showed},Mt._onMouseOver=function(t){this.__isMouseOver=1,this._holdOnMouseOver&&this._clearAllTimeouts(),It(this._container).events.remove("mouseenter",this._onMouseOver,this).add("mouseleave",this._onMouseOut,this)},Mt._onMouseOut=function(t){this.__isMouseOver=0,It(this._container).events.remove("mouseleave",this._onMouseOut,this).add("mouseenter",this._onMouseOver,this),this._holdOnMouseOver&&this._hiding&&this.hide()},Mt.destructor=function(){this._clearAllTimeouts(),this._removeLayout(),this._vpNode=null},Ct=bt.Hint=function(t){this.__popup=new bt.Popup(t,{owner:this}),this._offset=null,this._onHide=null;var e=this;Dt.observe(this.__popup,this.__popup.Events.Show,function(){Dt.notify(this,this.Events.Show,this)},this),Dt.observe(this.__popup,this.__popup.Events.Hide,function(){Dt.notify(this,this.Events.Hide,this)},this),this._onHideCallback=function(){e._onHide&&(e._onHide(),e._onHide=null)}},(Mt=Ct.prototype).Events={Hide:"Hide",Show:"Show"},Mt.show=function(t,e,i){var n=this.isShown();n&&Dt.notify(this,this.Events.Hide,this),this._onHideCallback(),this.setOptions(i),this.setContent(e),this.__popup.show(t.copy().moveBy(this._offset)),n&&Dt.notify(this,this.Events.Show,this)},Mt.setOptions=function(t){t=t||{};var e,i={style:yt.AGeoObject.fullStyle.hintStyle,showTimeout:250,maxWidth:750,maxHeight:300,offset:new kt(15,15)};for(e in t)i[e]=t[e];var n=i.hintOffset||i.offset;this._offset&&!this._offset.equals(n)&&this.isShown()&&this.__popup.setPosition(this.__popup._position.copy().moveBy(this._offset.neg()).moveBy(n)),this._offset=n,this._onHide=i.onHide,i.onHide=this._onHideCallback,this.__popup.setOptions(i,1)},Mt.setContent=function(t){this.__popup.setContent(t)},Mt.getLayout=function(){return this.__popup.getLayout()},Mt.getContentLayout=function(){return this.__popup.getContentLayout()},Mt.moveTo=function(t){this.__popup.setPosition(t.copy().moveBy(this._offset))},Mt.isShown=function(){return this.__popup.isShown()},Mt.hide=function(t){this.__popup.setOptions({hideTimeout:typeof t==Tt?this.__popup.DEFAULT_HIDE_TIMEOUT:t},0),this.__popup.hide()},(Mt=Et(et,bt.ABaseLayout)).DEFAULT_MIN_WIDTH=42,Mt.update=function(){var t,e,i,n;this._parentNode&&this._hasContent&&(Pt.msie&&this._$elements.toggleClass("fakeClassName"),t=this._nodes.content,e=this._maxSize,i=this._nodes.visContainer,(!L||L.x<0)&&(L=new yt.Point(i.find(".YMaps-b-balloon-ml").width()+i.find(".YMaps-b-balloon-mr").width()-2,i.find(".YMaps-b-balloon-t").height()+i.find(".YMaps-b-balloon-b").height()),Pt.opera&&9.5<=Pt.version&&--L.x),i.css("width","10000px"),t.css({width:"",height:"",overflow:"",float:"left"}),n=t.width(),("mac"==wt.os.name&&Pt.mozilla||Pt.msie&&9==Pt.ieDocumentMode)&&n++,n=n+L.getX(),e[0]&&n>e[0]?n=e[0]:n<this.DEFAULT_MIN_WIDTH&&(n=this.DEFAULT_MIN_WIDTH),t.css("width",Math.max(0,n-L.getX())),n=t.height()+L.getY(),e[1]&&n>e[1]&&(n=e[1]),t.css({height:Math.max(0,n-L.getY()),overflow:"hidden",float:""}),i.css("width",""))},Mt.setMaxSize=function(t,e){this._maxSize=[t,e]},Mt.setContent=function(t){var e;this._setContent(t,this._nodes.content[0]),t?(this._$elements.css({display:""}),e=this,xt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()}),this._hasContent=!0):(this._$elements.css({display:"none"}),this._hasContent=!1),this._size=null},Mt.getSize=function(){return this._size||(this._size=xt.size(this._nodes.table[0])),this._size},yt.Templates.add("default#hint",new yt.LayoutTemplate(et)),Ct=yt.Balloon=function(t){t=t||{},this._style=t.style||yt.AGeoObject.fullStyle.balloonStyle,this._layoutContext=null,this._currentLayoutContext=null,this._maxSize=[0,0],this.__setMaxSize(t.maxWidth||0,t.maxHeight||0),this._hasCloseButton=typeof t.hasCloseButton==Tt?1:t.hasCloseButton,this._margin=this.MARGIN,typeof t.margin!=Tt&&this.__setMargin.apply(this,[].concat(t.margin)),this._mapAutoPan=typeof t.mapAutoPan==Tt?1:t.mapAutoPan;var e=this;this.__closeHandler=function(t){e._onCloseClick(t)}},(Mt=Ct.prototype).Events={Close:"Close",CloseButtonClick:"Close"},Mt.MARGIN=[33,10,20,33],Mt.setOptions=function(t,e){t=t||{};var i,n=e?{style:yt.AGeoObject.fullStyle.balloonStyle,maxWidth:0,maxHeight:0,hasCloseButton:1,margin:this.MARGIN,mapAutoPan:1,layoutContext:null}:this.getOptions();for(i in t)n[i]=t[i];this._layoutContext=n.layoutContext,this._setHasCloseButton(n.hasCloseButton),this._setMaxSize(n.maxWidth,n.maxHeight),this.__setMargin.apply(this,[].concat(n.margin)),this._mapAutoPan=n.mapAutoPan,this._setStyle(n.style)},Mt.getOptions=function(){return{style:this._style,maxWidth:this._maxSize[0],maxHeight:this._maxSize[1],hasCloseButton:this._hasCloseButton,margin:this._margin,mapAutoPan:this._mapAutoPan,layoutContext:this._layoutContext}},Mt._setMaxSize=function(t,e){this.__setMaxSize(t,e)&&this._layout&&this._layout.setMaxSize&&(this._layout.setMaxSize(this._maxSize[0],this._maxSize[1]),this._parentContainer&&(this._layout.update(),this.__updatePosition()))},Mt.__setMaxSize=function(t,e){t=Math.max(t,0)||0,e=Math.max(e,0)||0;var i=0;return this._maxSize[0]!=t&&(this._maxSize[0]=t,i=1),this._maxSize[1]!=e&&(this._maxSize[1]=e,i=1),i},Mt.__setMargin=function(t,e,i,n){"number"==typeof t&&(this._margin=[t,"number"==typeof e?e:e=t,"number"==typeof i?i:i=t,"number"==typeof n?n:n=e])},Mt._setContent=function(t){this._content=t,this._contentLayout=xt.normalizeContent(t),this._layout&&(this.__rewriteContent(),this._parentContainer&&(this._layout.update(),this.__updatePosition()))},Mt.setContent=function(t){this._setContent(t),this._mapAutoPan&&this._layout&&this._parentContainer&&this.mapAutoPan()},Mt.getContent=function(){return this._content},Mt.getLayout=function(){return this._map&&this._layout||null},Mt.getContentLayout=function(){return this._map&&this._contentLayout||null},Mt.__rewriteContent=function(){this._layout.setContent&&this._contentLayout&&this._layout.setContent(this._contentLayout)},Mt.setCoordPoint=function(t){this._point=t,this.__updatePosition()},Mt.setGeoPoint=Mt.setCoordPoint,Mt.getCoordPoint=function(){return this._point},Mt.getGeoPoint=Mt.getCoordPoint,Mt._setStyle=function(t){this._style!=t&&(this._style=t,this.update())},Mt.update=function(){yt.Templates.get(this._style.template)==this._currentTemplate&&this._currentLayoutContext==this._layoutContext&&this._layout?this._parentContainer&&this._layout.update():(this.__clearLayout(),this._parentContainer&&(this.__createLayout(),this._layout.setMaxSize&&this._layout.setMaxSize(this._maxSize[0],this._maxSize[1]),this.__rewriteContent(),this.__applyHasCloseButton(),this.__addToParentContainer(),this.__updatePosition()))},Mt.__addToParentContainer=function(){this._layout.onAddToParent(this._container)},Mt.__updatePosition=function(){if(this._parentContainer){if(!this._point)throw"Balloon position point is not defined.";this.__posInPixels=this._map.converter.coordinatesToMapPixels(this._point),xt.position(this._container,this.__posInPixels)}},Mt.onMapUpdate=function(){this.__updatePosition()},Mt.__clearLayout=function(){this._layout&&(this._parentContainer&&this._layout.onRemoveFromParent(),this._layout=this.__writtenContent=null)},Mt.__createLayout=function(){var t=(t=yt.Templates.get(this._style.template))||yt.Templates.get(yt.AGeoObject.fullStyle.balloonStyle.template);this._currentTemplate=t,this._currentLayoutContext=this._layoutContext,this._layout=t.build(this._layoutContext,this._map,this)},Mt._onCloseClick=function(t){bt.preventMapEvent(t),Dt.notify(this,this.Events.CloseButtonClick,this)},Mt._setHasCloseButton=function(t){typeof t!=Tt&&(this._hasCloseButton=t,this._layout&&(this.__applyHasCloseButton(),this._parentContainer&&this._layout.update()))},Mt.__applyHasCloseButton=function(){this._hasCloseButton?this._layout.enableClose&&this._layout.enableClose(this.__closeHandler):this._layout.disableClose&&this._layout.disableClose()},Mt.onAddToMap=function(t,e){this._map=t,this._parentContainer=e,this._container||(this._container=wt('<div class="YMaps-balloon" style="position: absolute; z-index:'+yt.ZIndex.BALLOON+';"></div>')[0],It(this._container).events.add("contextmenu",this.__onContextMenu,this)),e.appendChild(this._container),this._layout?(this.__addToParentContainer(),this.__updatePosition()):this.update(),this.__mapMoveEndListener=Dt.observe(this._map,this._map.Events.MoveEnd,this._onMapMoveEnd,this),this._mapAutoPan&&this.mapAutoPan()},Mt.__onContextMenu=function(t){var e=new yt.MouseEvent(t,this._map);e.isMapEventPrevented()||(t.preventDefault(),e.preventMapEvent())},Mt._onMapMoveEnd=function(){this.__posInPixels&&this.__updatePosition()},Mt.onRemoveFromMap=function(){It(this._container).events.remove("contextmenu",this.__onContextMenu,this),this._parentContainer.removeChild(this._container),this._parentContainer=this._map=null,this._autoPanTimeout&&window.clearTimeout(this._autoPanTimeout),this._layout&&this._layout.onRemoveFromParent(),this.__mapMoveEndListener&&(this.__mapMoveEndListener.cleanup(),this.__mapMoveEndListener=null)},Mt.mapAutoPan=function(t){var e,i,n,o,s,a,r;this._map&&this._map._state&&(Pt.webkit&&this._container.offsetParent==document.body?(e=this)._autoPanTimeout=window.setTimeout(function(){e._autoPanTimeout=null,e.mapAutoPan()},100):(o=this._map.converter,i=this._map.getContainerSize(),a=o.coordinatesToLocalPixels(this._point),r=this._margin,s=this._layout.getSize?this._layout.getSize():xt.size(this._container),this._layout.getOffset&&a.moveBy(this._layout.getOffset()),n=a.y-r[0],o=a.x+s.x+r[1],s=a.y+s.y+r[2],a=a.x-r[3],r=new kt,a<=0?r.moveToX(-1*a):o>i.x&&r.moveToX(i.x-o),n<=0?r.moveToY(-1*n):s>i.y&&r.moveToY(i.y-s),r.x||r.y?this._map.moveBy(r.neg(),Math.abs(r.x)<3*i.x&&Math.abs(r.y)<3*i.y,{callback:t}):t&&window.setTimeout(function(){t(yt.State.SUCCESS)},0)))},V=Et(it,bt.ABaseLayout),I="YMaps-balloon-content-overflow-hidden",V.onAddToParent=function(t){var e;wt(t).append(this._$elements),Pt.mozilla&&(this._ffObservers=[],this._ffObservers.push(Dt.observe(this._map,this._map.Events.MoveStart,function(){e||(e=1,wt(this._nodes.content).addClass(I))},this)),this._ffObservers.push(Dt.observe(this._map,this._map.Events.MoveEnd,function(){e&&(wt(this._nodes.content).removeClass(I),e=0)},this))),It(this._nodes.content).events.add("contextmenu",bt.preventMapEvent);for(var i=0,n=this._nodes.$eventBlockNode.length;i<n;i++)It(this._nodes.$eventBlockNode[i]).events.add(["click","dblclick","mouseup","mousedown","mousemove","wheel","multitouchstart","multitouchmove","multitouchend"],bt.preventMapEvent);It(this._nodes.$close[0]).events.add("click",this.__onCloseButtonClick,this),this.update()},V.__onCloseButtonClick=function(t){this._closeCallback&&this._closeCallback(t),bt.preventMapEvent(t)},V.onRemoveFromParent=function(){this._ffObservers&&(Ot(this._ffObservers,"cleanup"),this._ffObservers=null),It(this._nodes.content).events.removeAll();for(var t=0,e=this._nodes.$eventBlockNode.length;t<e;t++)It(this._nodes.$eventBlockNode[t]).events.removeAll();It(this._nodes.$close[0]).events.removeAll(),wt(this._nodes.content).removeClass(I),this._$elements.removeFromDom()},V.DEFAULT_MAX_WIDTH=520,V.DEFAULT_MAX_HEIGHT=100,V.DEFAULT_WIDE_MIN_WIDTH=42,V.DEFAULT_TINY_MIN_WIDTH=58,V.DEFAULT_MIN_HEIGHT=15,V.update=function(){var t,e,i,n,o,s,a,r,h;this.__balloon&&this.__balloon._map&&this.__balloon._map._state&&(h=this._nodes.visContainer,a=this._nodes.content,t=wt(a),n=this._maxSize[0],o=this._maxSize[1],(e=t.hasClass(I))&&t.removeClass(I),xt.size(h,1e4),t.css({overflow:"auto",width:"auto",height:"auto"}),8==Pt.ieDocumentMode&&t.css("overflow","visible"),Pt.opera&&wt(h).css("overflow","hidden"),n&&o||(i=this._map.getContainerSize(),n=n||Math.max(this.DEFAULT_MAX_WIDTH,i.x-60),o=o||(250<i.y?i.y-100:this.DEFAULT_MAX_HEIGHT)),Pt.msie||t.css("maxWidth",n),(i=Math.max(a.scrollWidth,a.offsetWidth)>n)&&Pt.msie&&t.css("width",n),null!=o&&(Pt.opera&&t.css("overflow","hidden"),Pt.msie||t.css("maxHeight",o),(r=Math.max(a.scrollHeight,a.offsetHeight)>o)&&Pt.msie&&t.css("height",o)),i&&(Pt.opera&&t.css("overflow","auto"),Pt.msie&&(o=a.offsetHeight-a.clientHeight,t.css("height",a.offsetHeight+o))),Pt.webkit&&this._$elements[0].offsetParent==document.body?(s=this)._updateTimeout=window.setTimeout(function(){s._updateTimeout=null,s.update()},100):(a=xt.size(a),(Pt.msie&&9<=Pt.version&&!Pt.quirksMode||"mac"==wt.os.name&&wt.browser.mozilla)&&(a.x=Math.min(n,a.x+1)),a.y=Math.max(a.y,this.DEFAULT_MIN_HEIGHT),this._closeCallback?a.x=Math.max(a.x,this.DEFAULT_WIDE_MIN_WIDTH):a.x=Math.max(a.x,this.DEFAULT_TINY_MIN_WIDTH),8<=Pt.ieDocumentMode&&(i&&(a.y+=nt()+1),r&&(a.x+=nt()+1)),Pt.msie&&Pt.version<8&&(i&&a.y++,r&&a.x++),Pt.msie&&(a.x=a.x+a.x%2),t.css({width:a.x,height:a.y,overflow:i||r?"auto":"hidden"}),r=this._nodes.contentParent.offsetWidth-a.x,a.x+r<52&&(a.x=52-r,t.css("width",a.x)),e&&t.addClass(I),this._nodes.$shad[(50<a.y?"remove":"add")+"Class"]("YMaps-b-balloon-shad_short"),Pt.opera&&wt(h).css("overflow",""),wt(h).css({width:"",height:""}),Pt.msie&&(6==Pt.version||Pt.quirksMode)&&(h=9<=Pt.version&&Pt.version<=10,xt.fixIESize(this._nodes.$shad,"right",h?[-20,-21]:[-22,-21]),xt.fixIESize(this._nodes.$shad,"bottom",[0,1]),xt.fixIESize(this._nodes.$tail,"right",h?[16,15]:[14,15]),xt.fixIESize(this._nodes.$tail,"bottom",[-38,-37])),Pt.msie&&(Pt.version<7||Pt.quirksMode)&&wt(this._nodes.content).addClass("YMaps-fake").removeClass("YMaps-fake")))},V.setMaxSize=function(t,e){this._maxSize=[t,e]},V.getOffset=function(){var t=this.getSize();return new kt(45-t.x,1-t.y)},V.getSize=function(){return xt.size(this._nodes.visContainer).moveByY(37)},V.enableClose=function(t){this._closeCallback=t,wt(this._nodes.visContainer).addClass("YMaps-b-balloon_close-on")},V.disableClose=function(){this._closeCallback&&(this._closeCallback=null),wt(this._nodes.visContainer).removeClass("YMaps-b-balloon_close-on")},V.setContent=function(t){var e;this._setContent(t,this._nodes.content),t&&(e=this,xt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update(),e.__balloon&&"function"==typeof e.__balloon.mapAutoPan&&e.__balloon.getOptions().mapAutoPan&&e.__balloon.mapAutoPan()}))},yt.Templates.add("default#balloon",new yt.LayoutTemplate(it)),Ct=yt.Placemark=function(t,e){yt.AInteractiveGeoObject.call(this,e),this.setGeoPoint(t),e=e||{},this.__draggable=!!e.draggable,this.__hideIcon=typeof e.hideIcon!=Tt?e.hideIcon:1,this.__actualHideIcon=this.__hideIcon,this._map=this._parentContainer=null,this.__iconEventListeners=[],this._interactive=typeof e.interactive!=Tt?e.interactive:yt.Interactivity.INTERACTIVE,this.__eventsBound=!1,this.__eventsInitialized=!1;var i=this;this._onHintHide=function(){i._hintVisible=0},this._cursor=e.cursor,this._state={interactive:0,drag:0,hover:0,active:0},this._zIndexManager=new bt.PlacemarkZIndexManager(this,e)},(Mt=Et(Ct,yt.AInteractiveGeoObject)).isPlacemark=1,Mt.__cursors={Default:yt.Cursor.POINTER,Drag:yt.Cursor.GRABBING},Mt._states={interactive:"Default",drag:"Drag",hover:"Hover",active:"Active",hidden:"Hidden"},Mt.Events={Click:"Click",DblClick:"DblClick",DragStart:"DragStart",Drag:"Drag",DragEnd:"DragEnd",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove",PositionChange:"PositionChange",BalloonOpen:"BalloonOpen",BalloonClose:"BalloonClose",OptionsChange:"OptionsChange",AddToMap:"AddToMap",RemoveFromMap:"RemoveFromMap"},Mt.getMap=function(){return this._map},Mt.getParentContainer=function(){return this._parentContainer},Mt.onAddToMap=function(t,e){this._map=t,this._parentContainer=e,this._ensureContainers(),this._$iconShadowContainer&&(this._$iconShadowContainer.appendTo(this._parentContainer),this._shadowContainerAdded=1),this._$iconContainer.appendTo(this._parentContainer),this._updateIcon(!0),this.__updatePosition(),this._interactive!=yt.Interactivity.NONE&&this.__addIconEventListeners(),this.__mapMoveEndListener=Dt.observe(this._map,this._map.Events.MoveEnd,this._onMapMoveEnd,this),this.__destructListener=Dt.observe(this._map,this._map.Events.Destruct,this._destruct,this),this._zIndexManager.enable(),Dt.notify(this,this.Events.AddToMap,this)},Mt._destruct=Mt.onRemoveFromMap=function(){this.closeBalloon(),this._hideHintIfVisible(),this._interactive!=yt.Interactivity.NONE&&this.__removeIconEventListeners(),this.__mapMoveEndListener&&this.__mapMoveEndListener.cleanup(),this.__isMouseOver&&(this._setState({hover:0}),this.__isMouseOver=0),this._icon&&this._icon.onRemoveFromParent(),this._$iconContainer&&this._$iconContainer.removeFromDom(),this._iconShadow&&this._iconShadow.onRemoveFromParent(),this._$iconShadowContainer&&(this._$iconShadowContainer.removeFromDom(),this._shadowContainerAdded=0),this.__destructListener.cleanup(),this.__destructListener=this.__mapMoveEndListener=this._map=this._parentContainer=null,this._zIndexManager.disable(),Dt.notify(this,this.Events.RemoveFromMap,this)},Mt.onRemoveFromGroup=function(){this._parentGroup=null},Mt.__updatePosition=function(t){if(this._parentContainer){if(!this._point)throw"Placemark position point is not defined.";this.__posInPixels=t||this._map.converter.coordinatesToMapPixels(this._point);t=this.getComputedStyle().iconStyle;this._icon&&xt.position(this._$iconContainer[0],this.__posInPixels.copy().moveBy(this._icon.getOffset?this._icon.getOffset():t.offset)),this._iconShadow&&xt.position(this._$iconShadowContainer[0],this.__posInPixels.copy().moveBy(this._iconShadow.getOffset?this._iconShadow.getOffset():t.shadow.offset)),this._balloonVisible&&this._map.getBalloon().setGeoPoint(this._point)}},Mt.onMapUpdate=function(){this.__updatePosition()},Mt._onMapMoveEnd=function(){var t,e;this.__posInPixels&&(t=this.__posInPixels,e=this._map.converter.coordinatesToMapPixels(this._point),(1<Math.abs(t.getX()-e.getX())||1<Math.abs(t.getY()-e.getY()))&&this.__updatePosition(e))},Mt.update=function(){yt.AInteractiveGeoObject.prototype.update.call(this),this._ensureContainers(),this._parentContainer&&(this._balloonVisible&&this.__actualHideIcon||this._updateIcon(),this._$iconShadowContainer&&!this._shadowContainerAdded&&(this._$iconShadowContainer.prependTo(this._parentContainer),this._shadowContainerAdded=1)),this._updateHint(),this._updateBalloon(),this.__updatePosition()},Mt.setOptions=function(t,e){t=t||{},yt.AInteractiveGeoObject.prototype.setOptions.call(this,t,e);var i,n=e?{draggable:0,hideIcon:1,interactive:yt.Interactivity.INTERACTIVE,cursor:null}:this.getOptions();for(i in t)n[i]=t[i];this.__draggable&&!n.draggable&&(this.__mouseMove&&this.__mouseMove.abort(),this._onMoveEnd()),this.__draggable=n.draggable,this.__hideIcon=n.hideIcon,this._interactive!=n.interactive&&(this._interactive==yt.Interactivity.NONE?this._$iconContainer&&this._map&&this.__addIconEventListeners():this.__eventsBound&&n.interactive==yt.Interactivity.NONE&&this.__removeIconEventListeners(),this._$iconContainer&&this._setState(n.interactive!=yt.Interactivity.NONE?{interactive:1}:{interactive:0,drag:0,hover:0,active:0}),this._interactive=n.interactive),this._cursor!=n.cursor&&(n.interactive!=yt.Interactivity.NONE?(this.__isDragged&&this.__cursorManager.removeCursor(this.__cursors.Drag),this.__cursorManager.removeCursor(this.__cursor||this.__cursors.Default),this.__cursorManager.addCursor(n.cursor||this.__cursors.Default),this.__isDragged&&this.__cursorManager.addCursor(this.__cursors.Drag)):this.__cursorManager.removeCursor(this.__cursor||this.__cursors.Default),this._cursor=n.cursor),this._zIndexManager.setOptions(n),Dt.notify(this,this.Events.OptionsChange,this)},Mt.getOptions=function(){var t=yt.AInteractiveGeoObject.prototype.getOptions.call(this);return t.draggable=this.__draggable,t.hideIcon=this.__hideIcon,t.interactive=this._interactive,t.cursor=this._cursor,wt.extend(t,this._zIndexManager.getOptions()),t},Mt._ensureContainers=function(){this._$iconContainer||(this._$iconContainer=wt("<div />").addClass("YMaps-placemark").css({"z-index":this._zIndexManager.getZIndex()}),this.__cursorManager=new bt.CursorManager(this._$iconContainer[0]),this._interactive!=yt.Interactivity.NONE&&this._setState({interactive:1}));var t=this.getComputedStyle().iconStyle.shadow;!this._$iconShadowContainer&&t&&(this._$iconShadowContainer=wt("<div />").addClass("YMaps-placemark-shadow").css({"z-index":this._zIndexManager.getShadowZIndex()})),this._$iconShadowContainer&&!t&&(this._$iconShadowContainer.removeFromDom(),this._$iconShadowContainer=null,this._shadowContainerAdded=0)},Mt._updateIcon=function(t){var e=this.getComputedStyle().iconStyle,i=yt.Templates.get(e.template),n=!this._icon,i=i||yt.Templates.get(yt.AGeoObject.fullStyle.iconStyle.template);this._icon&&this.__currentIconTemplate!=i&&(this._icon.onRemoveFromParent(),n=!0),n?(this._icon=i.build(this,this._map,this),this._icon.onAddToParent(this._$iconContainer[0]),this._icon.setContent&&this._icon.setContent(this._getIconContentLayout()),this.__currentIconTemplate=i):this._icon&&(t&&this._icon.onAddToParent(this._$iconContainer[0]),this._icon.setContent&&this._icon.setContent(this._getIconContentLayout()),this._icon.update());e=e.shadow;e?(e=yt.Templates.get(e.template))&&(n=!this._iconShadow,this._iconShadow&&this.__currentIconShadowTemplate!=e&&(this._iconShadow.onRemoveFromParent(),n=!0),n?(this._iconShadow=e.build(this,this._map,this),this._iconShadow.onAddToParent(this._$iconShadowContainer[0]),this.__currentIconShadowTemplate=e):this._iconShadow&&(t&&this._iconShadow.onAddToParent(this._$iconShadowContainer[0]),this._iconShadow.update())):this._iconShadow&&(this._iconShadow.onRemoveFromParent(),this._iconShadow=null,this.__currentIconShadowTemplate=null)},Mt._setState=function(t){for(var e in t){var i=this._states[e],n=t[e],o=this.__cursors[i];this._state[e]!=t[e]&&(this._state[e]=t[e],i="YMaps-"+i,"interactive"==e&&this._cursor&&(o=this._cursor),n?(this._$iconContainer.addClass(i),o&&this.__cursorManager.addCursor(o)):(this._$iconContainer.removeClass(i),o&&this.__cursorManager.removeCursor(o)),this._$iconShadowContainer&&"hidden"==e&&(n?this._$iconShadowContainer.addClass(i):this._$iconShadowContainer.removeClass(i)))}},Mt.applyZIndex=function(t){this._$iconContainer&&this._$iconContainer.css({"z-index":t})},Mt.applyShadowZIndex=function(t){this._$iconShadowContainer&&this._$iconShadowContainer.css({"z-index":t})},Mt.setIconContent=function(t){this._iconCustomContent=t,this._iconCustomContentLayout=xt.normalizeContent(t),this._iconContent=null,this._updateIconContent()},Mt._updateIconContent=function(){this._parentContainer&&(this._balloonVisible&&this.__actualHideIcon||(this._icon.setContent&&this._icon.setContent(this._getIconContentLayout()),this._updateIcon(),this.__updatePosition()))},Mt._getIconContentLayout=function(){var t;return this._iconContent||(this._iconCustomContentLayout?this._iconContent=this._iconCustomContentLayout:(t=(t=yt.Templates.get(this.getComputedStyle().iconContentStyle.template))||yt.Templates.get(yt.AGeoObject.fullStyle.iconContentStyle.template),this._iconContent=t.build(this,this._map,this))),this._iconContent},Mt.getIconContent=function(){return this._iconCustomContent},Mt.getIconLayout=function(){return this._map&&this._icon||null},Mt.getIconShadowLayout=function(){return this._map&&this._iconShadow||null},Mt.getContentLayout=function(){return this._map&&this._iconContent||null},Mt.__createIconEventListeners=function(){var t=this._$iconContainer;this.__mouseMove=new xt.DragAndDrop.MouseMove(t[0],0,At.tremor.placemark),this.__bindPlacemarkListeners(),this.__mouseMove.beginListening(),this.__iconEventListeners=[].concat(Dt.observe(this.__mouseMove,"start",this._onMoveStart,this),Dt.observe(this.__mouseMove,"move",this._onMove,this),Dt.observe(this.__mouseMove,"stop",this._onMoveEnd,this)),this.__eventsBound=!0},Mt.__bindPlacemarkListeners=function(){this._iconListener=It(this._$iconContainer[0]).events.eventListener(),this._iconListener.add("contextmenu",function(t){bt.preventMapEvent(t),t.preventDefault()}).add("click",this._onClick,this).add("mousemove",this._onMouseMove,this).add("mouseout",this._onMouseOut,this).add("mouseover",this._onMouseOver,this).add("dblclick",this._onDblClick,this)},Mt.__removeIconEventListeners=function(){this.__eventsBound&&(this.__mouseMove.stopListening(),this._iconListener.removeAll(),Ot(this.__iconEventListeners,"disable"),this.__eventsBound=!1)},Mt.__addIconEventListeners=function(){this.__eventsBound||(this.__eventsInitialized?(this.__mouseMove.beginListening(),this.__bindPlacemarkListeners(),Ot(this.__iconEventListeners,"enable"),this.__eventsBound=!0):(this.__createIconEventListeners(),this.__eventsInitialized=!0))},Mt._onDblClick=function(t){t=new yt.MouseEvent(t,this._map);this._interactive==yt.Interactivity.INTERACTIVE&&t.preventMapEvent(),Dt.notify(this,this.Events.DblClick,this,t)},Mt._onMoveStart=function(t){var e;this.__draggable&&(this._setState({drag:1}),e=this.__dragMoveMapOptions.edge,t=new kt(t.clientX,t.clientY),this.__dragMoveMapBounds=new yt.Bounds(new kt(e,e),new kt(this._map._state.size.x-e,this._map._state.size.y-e)),this.__startMovePos=this._point.copy(),this.__prevDragPixels=t,this.__grabOffset=t.diff(this._map.converter.coordinatesToClientPixels(this._point)),this._hideHintIfVisible(0))},Mt.__dragMoveMapOptions={edge:20,speed:10,maxSpeed:10},Mt.__dragMoveMapStop=function(){this.__dragMoveMapActive&&(this.__dragMoveMapActive=0,this.__getDragMoveMapListener().disable())},Mt.__dragMoveMapTick=function(t,e){var i=this._map.converter.coordinatesToLocalPixels(this._point);i.moveBy(e),this._point.moveTo(this._map.converter.localPixelsToCoordinates(i,1)),this.__updatePosition(),Dt.notify(this,this.Events.Drag,this,e)},Mt.__getDragMoveMapListener=function(){return this.__dragMoveMapListener=this.__dragMoveMapListener||yt.Events.observe(this._map,this._map.Events.Move,this.__dragMoveMapTick,this)},Mt._onMove=function(t){var e,i,n;this.__draggable&&(this.__isDragged||(this.__isDragged=1,this._hideHintIfVisible(),Dt.notify(this,this.Events.DragStart,this)),e=new kt(t.clientX,t.clientY),this._point.moveTo(this._map.coordSystem.restrict(this._map.converter.clientPixelsToCoordinates(e.copy().moveBy(this.__grabOffset),1))),this.__updatePosition(),this._map.draggingEnabled()&&this._map&&(i=this._map.converter.coordinatesToLocalPixels(this._point),this.__dragMoveMapBounds.contains(i)?this.__dragMoveMapActive&&this._map.stopMove():(t=this.__dragMoveMapBounds,t=new kt(i.x<t.getLeft()?-1:i.x>t.getRight()?1:0,i.y<t.getBottom()?-1:i.y>t.getTop()?1:0),this.__dragMoveMapActive&&this.__dragMoveMapOldDirection.equals(t)||((n=this).__dragMoveMapStartOptions=this.__dragMoveMapStartOptions||wt.extend({callback:function(){n.__dragMoveMapStop()}},this.__dragMoveMapOptions),this._map.startMove(t,this.__dragMoveMapStartOptions),this.__getDragMoveMapListener().enable(),this.__dragMoveMapActive=!0,this.__dragMoveMapOldDirection=t))),Dt.notify(this,this.Events.Drag,this,this.__prevDragPixels.diff(e)),this.__prevDragPixels=e)},Mt._onMoveEnd=function(){this.__draggable&&(this._setState({drag:0}),this.__isDragged&&(this.__dragMoveMapActive&&this._map.stopMove(),this.__stopMove()))},Mt._onClick=function(t){t=new yt.MouseEvent(t,this._map);this._interactive==yt.Interactivity.INTERACTIVE&&t.preventMapEvent(),Dt.notify(this,this.Events.Click,this,t),this.getOptions().hasBalloon&&this._interactive==yt.Interactivity.INTERACTIVE&&(this._balloonVisible?this.closeBalloon():this.openBalloon())},Mt.__stopMove=function(){this.__isDragged=0,Dt.notify(this,this.Events.DragEnd,this),Dt.notify(this,this.Events.PositionChange,this,{oldPoint:this.__startMovePos,newPoint:this._point.copy()})},Mt._onMouseMove=function(t){var e=new yt.MouseEvent(t,this._map);this._interactive==yt.Interactivity.INTERACTIVE&&(e.preventMapEvent(),this._mouseMoveAction(t)),Dt.notify(this,this.Events.MouseMove,this,e)},Mt._onMouseOver=function(t){this.__isMouseOver||t.relatedTarget&&-1!=wt(t.relatedTarget).parents().index(this._$iconContainer)||(this.__isMouseOver=1,this._interactive==yt.Interactivity.INTERACTIVE&&(this._setState({hover:1}),!this.getOptions().hasHint||this._balloonVisible||this.__isDragged||(this._map.hint.show(this._map.converter.clientPixelsToLocalPixels(new kt(t.clientX,t.clientY)),this._getHintContentLayout(),this._getComputedHintOptions()),this._hintVisible=1)),Dt.notify(this,this.Events.MouseEnter,this,new yt.MouseEvent(t,this._map)))},Mt._onMouseOut=function(t){!this.__isMouseOver||t.relatedTarget&&-1!=wt(t.relatedTarget).parents().index(this._$iconContainer)||(this.__isMouseOver=0,this._interactive==yt.Interactivity.INTERACTIVE&&(this._setState({hover:0}),this._hideHintIfVisible()),Dt.notify(this,this.Events.MouseLeave,this,new yt.MouseEvent(t,this._map)))},Mt._mouseMoveAction=function(t){this._hintVisible&&this._map.hint.moveTo(this._map.converter.clientPixelsToLocalPixels(new kt(t.clientX,t.clientY)))},Mt.setHintContent=function(t){yt.AInteractiveGeoObject.prototype.setHintContent.call(this,t),this._updateHint()},Mt.setHintOptions=function(t){yt.AInteractiveGeoObject.prototype.setHintOptions.call(this,t),this._hintVisible&&this._map.hint.setOptions(this._getComputedHintOptions())},Mt._getComputedHintOptions=function(){var t=yt.AInteractiveGeoObject.prototype._getComputedHintOptions.call(this,t);return t.onHide=this._onHintHide,t},Mt._updateHint=function(){this._hintVisible&&(this._map.hint.setOptions(this._getComputedHintOptions()),this._map.hint.setContent(this._getHintContentLayout()))},Mt._hideHintIfVisible=function(t){this._hintVisible&&this._map.hint.hide(t)},Mt._updateBalloon=function(){var t;this._balloonVisible&&((t=this._map.getBalloon()).setOptions(this._getComputedBalloonOptions(),1),t.setContent(this._getBalloonContentLayout()))},Mt.getBalloon=function(){return this._balloonVisible?this._map.getBalloon():null},Mt.openBalloon=function(t,e){if(yt.AInteractiveGeoObject.prototype.openBalloon.call(this,t,e),this._map){this._balloonVisible&&this.closeBalloon(),this._hideHintIfVisible();var i,n=this,o={},s=this._getComputedBalloonOptions();for(i in s)o[i]=s[i];o.onClose=function(){s.onClose&&s.onClose(),n._onCloseBalloon()},this.__hideIcon?this._setState({hidden:1,hover:0}):this._setState({active:1}),this.__actualHideIcon=this.__hideIcon,this._balloonVisible=1,this._map.openBalloon(this._point,this._getBalloonContentLayout(),o),Dt.notify(this,this.Events.BalloonOpen,this)}},Mt.closeBalloon=function(){yt.AInteractiveGeoObject.prototype.closeBalloon.call(this),this._balloonVisible&&this._map.closeBalloon()},Mt.setBalloonOptions=function(t){yt.AInteractiveGeoObject.prototype.setBalloonOptions.call(this,t),this._balloonVisible&&this._map.getBalloon().setOptions(this._getComputedBalloonOptions(),1)},Mt._onCloseBalloon=function(){this._balloonVisible=0,this.__actualHideIcon?this._setState({hidden:0}):this._setState({active:0}),this._updateIcon(),this.__updatePosition(),Dt.notify(this,this.Events.BalloonClose,this)},Mt.setBalloonContent=function(t){yt.AInteractiveGeoObject.prototype.setBalloonContent.call(this,t),this._updateBalloon()},Mt.setCoordPoint=function(t){var e=this._point||t;this._point=t.copy(),this.__updatePosition(),Dt.notify(this,this.Events.PositionChange,this,{oldPoint:e,newPoint:t})},Mt.setGeoPoint=Mt.setCoordPoint,Mt.getCoordPoint=function(){return this._point},Mt.getGeoPoint=Mt.getCoordPoint,bt.PlacemarkZIndexManager=Ct=function(t,e){this._placemark=t,this._zIndexes={},this._interactiveObservers=[],this.resetState(),this.setOptions(e)},(Mt=Ct.prototype).zIndexPriority=["Active","Drag","Hover","Default"],Mt.zIndexes={Default:{defaultState:1,defaultValue:yt.ZIndex.OVERLAY,optionName:"zIndex"},Active:{defaultState:0,defaultValue:yt.ZIndex.OVERLAY_ACTIVE,optionName:"zIndexActive"},Drag:{defaultState:0,defaultValue:yt.ZIndex.OVERLAY_DRAG,optionName:"zIndexDrag"},Hover:{defaultState:0,defaultValue:yt.ZIndex.OVERLAY_HOVER,optionName:"zIndexHover"},Shadow:{defaultValue:yt.ZIndex.OVERLAY_SHADOW,optionName:"zIndexShadow"}},Mt.resetState=function(){for(var t in this._zIndexState={},this.zIndexes)this._zIndexState[t]=this.zIndexes[t].defaultState},Mt.enable=function(){this._enabled=!0;var t=this._placemark;this.resetState(),this._inited||(this._interactiveObservers=[Dt.observe(t,t.Events.BalloonOpen,function(){this._zIndexState.Active=1,this.applyZIndex()},this,!1),Dt.observe(t,t.Events.BalloonClose,function(){this._zIndexState.Active=0,this.applyZIndex()},this,!1),Dt.observe(t,t.Events.MouseEnter,function(){this._zIndexState.Hover=1,this.applyZIndex()},this,!1),Dt.observe(t,t.Events.MouseLeave,function(){this._zIndexState.Hover=0,this.applyZIndex()},this,!1),Dt.observe(t,t.Events.DragStart,function(){this._zIndexState.Drag=1,this.applyZIndex()},this,!1),Dt.observe(t,t.Events.DragEnd,function(){this._zIndexState.Drag=0,this.applyZIndex()},this,!1)],this._inited=!0,this.setOptions(t.getOptions())),this._interactive&&Ot(this._interactiveObservers,"enable")},Mt.disable=function(){this._enabled=!1,Ot(this._interactiveObservers,"disable")},Mt.setOptions=function(t){var e,i,n=!1;for(i in this.zIndexes)e=this.zIndexes[i].optionName,void 0!==this._zIndexes[i]&&this._zIndexes[i]==t[e]||(n=!0,this._zIndexes[i]=void 0!==t[e]?t[e]:this.zIndexes[i].defaultValue);t.interactive!=yt.Interactivity.INTERACTIVE?(this._interactive&&(n=!0),this._interactive=!1,this._enabled&&Ot(this._interactiveObservers,"disable")):(this._interactive||(this.resetState(),n=!0),this._enabled&&Ot(this._interactiveObservers,"enable"),this._interactive=!0),n&&this.applyZIndex()},Mt.getOptions=function(){var t,e={};for(t in this.zIndexes)e[this.zIndexes[t].optionName]=this._zIndexes[t];return e},Mt.getZIndex=function(){for(var t,e=0,i=this.zIndexPriority.length;e<i;e++)if(t=this.zIndexPriority[e],this._zIndexState[t])return this._zIndexes[t]},Mt.getShadowZIndex=function(){return this._zIndexes.Shadow},Mt.applyZIndex=function(){this._placemark.applyZIndex(this.getZIndex()),this._placemark.applyShadowZIndex(this.getShadowZIndex())},function(){var o=Pt.msie&&Pt.quirksMode?26:13,t=function(t,i){function e(t,e){bt.ABaseLayout.call(this,t,e),e=this._$elements=wt('<div class="YMaps-b-balloon-point">                <div class="YMaps-b-balloon YMaps-b-balloon_small YMaps-b-balloon_'+i+'">                    <div class="YMaps-b-balloon-wrap">                        <table class="YMaps-b-balloon-frame">                        <tr>                            <td class="YMaps-b-balloon-tl"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-t"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-tr"><i class="YMaps-b-balloon-bit"><i></i></i></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-ml"></td>                            <td class="YMaps-b-balloon-m">                                <div class="YMaps-b-balloon-content"></div>                            </td>                            <td class="YMaps-b-balloon-mr"></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-b" colspan="3">                                <i class="YMaps-b-balloon-corners">                                    <i class="YMaps-b-balloon-bit"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_l"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_r"><i></i></i>                                </i>                            </td>                        </tr>                        </table>                        <i class="YMaps-b-balloon-shad"><i></i></i>                    </div>                    <i class="YMaps-b-balloon-tail"><i></i></i>                </div></div>'),this._nodes={visContainer:e.find(".YMaps-b-balloon"),content:e.find(".YMaps-b-balloon-content"),shad:e.find(".YMaps-b-balloon-shad"),tail:e.find(".YMaps-b-balloon-tail")}}(Mt=Et(e,bt.ABaseLayout)).onAddToParent=function(t){bt.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},Mt.update=function(){var t=this._nodes.visContainer;t.css({visibility:"hidden",width:790}),Pt.opera&&t.css("overflow","hidden"),this._nodes.content.css({overflow:"",width:"auto",height:"auto"});var e,i,n=xt.size(this._nodes.content);"mac"==wt.os.name&&wt.browser.mozilla&&n.x++,Pt.msie&&(e=new kt,i=this._nodes.content[0],wt.each([["y","Top"],["x","Right"],["y","Bottom"],["x","Left"]],function(){e[this[0]]+=(parseFloat(wt.curCSS(i,"padding"+this[1],!0))||0)+(parseFloat(wt.curCSS(i,"border"+this[1]+"Width",!0))||0)}),n.moveBy(e)),xt.size(this._nodes.content[0],new kt(Math.min(790,Math.max(o,n.x)),Math.max(13,n.y))),this._nodes.content.css("overflow","hidden"),Pt.opera&&t.css("overflow",""),t.css({width:"",visibility:""}),Pt.msie&&(6==Pt.version||7<=Pt.version&&Pt.version<8&&"BackCompat"==document.compatMode)&&(xt.fixIESize(this._nodes.shad,"right",[-6,-5]),xt.fixIESize(this._nodes.shad,"bottom",[-1,0]),xt.fixIESize(this._nodes.tail,"bottom",[-13,-12]),xt.fixIESize(this._nodes.tail,"right",[-1,0]))},Mt.setContent=function(t){this._setContent(t,this._nodes.content);var e=this;xt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()})},Mt.getOffset=function(){return new kt(0,0)};var n=function(t,e){this._context=t,this._map=e,this._content=null,this._parentNode=null};(Mt=n.prototype).onAddToParent=function(t){this._parentNode=t,this._getLayout().onAddToParent(t)},Mt.onRemoveFromParent=function(){this._parentNode=null,this._getLayout().onRemoveFromParent()},Mt.update=function(){this._getLayout().update()},Mt.getRootNodes=function(){return this._getLayout().getRootNodes()},Mt.setContent=function(t){var e;this._content!=t&&(e=this._parentNode,!this._content!=!(this._content=t)?(e&&this._getLayout().onRemoveFromParent(),this._currentLayout=null,this._getLayout(),t&&this._currentLayout.setContent(t),e&&this._currentLayout.onAddToParent(this._parentNode)):this._currentLayout.setContent(t))},Mt._getLayout=function(){return this._currentLayout||(this._content?this._currentLayout=new e(this._context,this._map):this._currentLayout=new s(this._context,this._map)),this._currentLayout},Mt.getOffset=function(){return this._currentLayout.getOffset()};n=new yt.LayoutTemplate(n);return yt.Templates.add("default#"+t+"PointIcon",n),n};t("white","white"),t("green","green"),t("red","red"),t("yellow","yellow"),t("darkblue","blue-d"),t("night","night"),t("grey","grey"),t("blue","blue"),t("orange","orange"),t("darkorange","orange-d"),t("pink","pink"),t("violet","violet"),yt.Templates.add("default#icon",t("lightblue","blue-l"));var s=function(t,e){bt.ABaseLayout.call(this,t,e);this.__getStyleData();this._$elements=wt(Pt.msie&&Pt.version<7?"<div />":"<img />")};(Mt=Et(s,bt.ABaseLayout)).__getStyleData=function(){return this._context.getComputedStyle().iconStyle},Mt.onAddToParent=function(t){bt.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},Mt.update=function(){var t=this.__getStyleData();Pt.msie&&Pt.version<7?this._$elements.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+(t&&t.href)+"', sizingMethod='scale')","line-height":"0px"}):this._$elements[0].src=t&&t.href,t.size&&xt.size(this._$elements[0],t.size)},Mt.setContent=xt.NULL,Mt.getOffset=function(){return this.__getStyleData().offset||new kt(0,0)},(Mt=Et(t=function(){s.apply(this,arguments)},s)).__getStyleData=function(){return this._context.getComputedStyle().iconStyle.shadow},yt.Templates.add("default#iconShadow",new yt.LayoutTemplate(t));for(var e=["airplane.png","anchor.png","arrowDownLeft.png","arrowDownRight.png","arrowLeft.png","arrowRight.png","arrowUp.png","attention.png","badminton.png","bank.png","bar.png","barberShop.png","bicycle.png","bowling.png","buildings.png","bus.png","cafe.png","camping.png","car.png","cellular.png","cinema.png","downhillSkiing.png","dps.png","dryCleaner.png","electricTrain.png","factory.png","fishing.png","gasStation.png","gym.png","hospital.png","house.png","keyMaster.png","mailPost.png","metroKiev.png","metroMoscow.png","metroStPetersburg.png","metroYekaterinburg.png","motobike.png","mushroom.png","phone.png","photographer.png","pingPong.png","restauraunt.png","ship.png","shop.png","skating.png","skiing.png","smartphone.png","stadium.png","storehouse.png","swimming.png","tailorShop.png","teather.png","tennis.png","theater.png","tire.png","train.png","tramway.png","trolleybus.png","truck.png","turnLeft.png","turnRight.png","wifi.png","wifiLogo.png","workshop.png"],i=new yt.Point(-10,-25),n=new yt.Point(27,26),a=new yt.LayoutTemplate(s),r=0,h=e.length;r<h;r++){var l=new yt.Style(null);l.iconStyle={offset:i,size:n,shadow:null,href:At.imageRoot+"icons/"+e[r],template:a},yt.Styles.add("default#"+e[r].replace(".png","Icon"),l)}}(),yt.ObjectManager=function(t){var c,u,l,n,d=typeof(t=t||{}).cellSize!=Tt?Number(t.cellSize):256,e=typeof t.padding!=Tt?Number(t.padding):100,p=typeof t.trackObjects==Tt||!!t.trackObjects,_=0,f=[],m=[],g={},v={},y={},s=[],b=[],r=[];function h(t){for(var e in f[t]=[],m[t]=Math.ceil((256<<t)/d),g)if(g.hasOwnProperty(e)&&t<=e)for(var i,n,o=g[e],s=Math.min(t+1,o.length),a=0;a<s;a++)if(o[a])for(i=0,n=o[a].length;i<n;i++){var r=o[a][i],h=M(r.getGeoPoint(),t);S(h.x,h.y,t).push(r)}}function C(){return function(t,e,i){var n=t.getLeftBottom(),o=t.getRightTop(),s=M(n,e,new kt(-i,i)),t=M(o,e,new kt(i,-i)),i=m[e];(o.getX()<n.getX()||t.x<s.x)&&(s.x-=i);t.x-s.x+1>=i&&(s.x=0,t.x=i-1);t=new yt.Bounds(s,t);return t.zoom=e,t}(c.getBounds(),u,e)}function M(t,e,i){e=c.tileCoordinates.scale(c.coordSystem.fromCoordPoint(t),c.coordSystem.getMaxZoom(),e);return i=i||new kt,new kt(Math.floor((e.x+i.x)/d),Math.floor((e.y+i.y)/d))}function x(t,e,i){if(c)for(var n=Math.min(i,f.length-1),o=M(t.getGeoPoint(),n);e<=n;n--)f[n]&&S(o.x,o.y,n).push(t),o.x=o.x>>1,o.y=o.y>>1;else s.push([t,e,i])}function w(t){var e=l.getLeftTop(),i=l.getRightBottom(),n=e.y<=t.y&&t.y<=i.y,o=e.x<=t.x&&t.x<=i.x;return!o&&e.x<0&&(i=m[l.zoom],o=e.x+i<=t.x&&t.x<=i-1),n&&o}function P(t,e){o(t,e.oldPoint,e.newPoint)}function o(t,e,i){if(c)for(var n,o=f.length-1,s=M(e,o),a=M(i,o);0<=o&&(s.x!=a.x||s.y!=a.y);)f[o]&&((n=A(s.x,s.y,o))&&D(n,t)&&S(a.x,a.y,o).push(t),o==u&&(w(s)?w(a)||k(t):w(a)&&B(t))),s.x=s.x>>1,s.y=s.y>>1,a.x=a.x>>1,a.y=a.y>>1,--o;else r.push([t,e,i])}function S(t,e,i){t<0&&(t+=m[i]);var n=f[i],i=n[t];return i?i[e]||(i[e]=[]):(n[t]=[])[e]=[]}function T(e){return function(t){e.push(t)}}function E(t,e){for(var i=t.getLeft(),n=t.getRight();i<=n;i++)for(var o=t.getTop(),s=t.getBottom();o<=s;o++)a(i,o,t.zoom,e)}function L(t,e,i){a(t,e,i,k)}function O(t,e,i){a(t,e,i,B)}function a(t,e,i,n){var o=A(t,e,i);if(o)for(var s=o.length-1;0<=s;s--)n.call(this,o[s])}function I(i,t,n){!function(t,e,i){var n,o,s=t.getLeft(),a=t.getTop(),r=t.getRight(),h=t.getBottom(),l=e.getLeft(),c=e.getTop(),u=e.getRight(),d=e.getBottom();for(n=s;n<=r;n++){for(o=a;o<=h&&o<c;o++)i(n,o);for(o=Math.max(d+1,a);o<=h;o++)i(n,o)}for(o=Math.max(a,c);o<=Math.min(h,d);o++){for(n=Math.min(r+1,l)-1;s<=n;n--)i(n,o);for(n=Math.max(s,u+1);n<=r;n++)i(n,o)}}(i,t,function(t,e){n.apply(null,[t,e,i.zoom])})}function A(t,e,i){return f[i]?(t<0&&(t+=m[i]),f[i][t]&&f[i][t][e]||null):null}function k(t){c.removeOverlay(t),_--}function B(t){c.addOverlay(t),_++}function D(t,e){for(var i=0,n=0;n<t.length;++n)t[n]===e&&(t.splice(n--,1),i++);return i}this.onAddToMap=function(t){var e,i;if(u=(c=t).getZoom(),f[u])for(e=0,i=s.length;e<i;e++)x.apply(this,s[e]);else h(u);for(s=[],l=C(),n&&n.cleanup(),n=Dt.observe(c,c.Events.MoveEnd,this.onMapUpdate,this),E(l,B),e=0,i=b.length;e<i;e++)this.remove(b[e]);for(b=[],e=0,i=r.length;e<i;e++)o.apply(this,r[e]);r=[]},this.onRemoveFromMap=function(){c&&(E(l,k),n&&n.cleanup(),c=n=null)},this.removeAll=function(){c&&E(l,k),f=[],m=[],g={},y={},function(t,e){for(var i in t)t.hasOwnProperty(i)&&t[i][e]()}(v,"cleanup"),v={},this._update()},this.add=function(t,e,i){if(t){i=typeof i==Tt?1/0:Number(i),e=typeof e==Tt?0:Math.min(Number(e),i),a=t,r=e,h=i,wt.each([].concat(a),function(t,e){var i=xt.getUniqueId(e);p&&(v[i]=Dt.observe(e,e.Events.PositionChange,P)),y[i]=[h,r]}),g[h]||(g[h]=[]),g[h][r]=(g[h][r]||[]).concat(a);for(var n=[].concat(t),o=0,s=n.length;o<s;o++)x(n[o],e,i);if(c)if(10<n.length&&!_)E(l,B);else for(o=0,s=n.length;o<s;o++)w(M(n[o].getGeoPoint(),u))&&l.zoom>=e&&l.zoom<=i&&B(n[o])}var a,r,h},this.remove=function(t){var e,i,n,o;if(t instanceof Array)for(var s=0,a=t.length;s<a;s++)this.remove(t[s]);else if(c){e=t,i=xt.getUniqueId(e),n=v[i],o=y[i],o=g[o[0]][o[1]],e=wt.inArray(e,o),n&&n.cleanup(),-1!=e&&o.splice(e,1),delete v[i],!void delete y[i];for(var r,h=f.length-1,l=M(t.getGeoPoint(),h);0<=h;)f[h]&&((r=A(l.x,l.y,h))&&D(r,t),h==u&&c&&w(l)&&k(t)),l.x=l.x>>1,l.y=l.y>>1,--h}else b.push(t)},this.onMapUpdate=function(){setTimeout(this._update,0)},this._update=function(){if(c){u=c.getZoom(),f[u]||h(u);var t=C();if(t.zoom!=l.zoom){var e=[],i=[],n=T(e),o=T(i);E(l,n),E(t,o);for(var s=e.length-1;0<=s;s--){var a=e[s],r=wt.inArray(a,i);-1==r?k(a):i.splice(r,1)}for(s=i.length-1;0<=s;s--)B(i[s])}else t.equals(l)||(I(l,t,L),I(t,l,O));l=t}}},Ct=yt.GeoObjectCollection=function(t){yt.OverlayGroup.call(this),yt.AGeoObject.call(this),this._style=t},Mt=Et(Ct,yt.OverlayGroup),wt.extend(!1,Ct,yt.AGeoObject),wt.extend(!0,Ct.prototype,yt.AGeoObject.prototype),Mt._onAddObject=function(t,e){t.onAddToGroup(this),yt.OverlayGroup.prototype._onAddObject.call(this,t,e)},Mt._onRemoveObject=function(t,e){yt.OverlayGroup.prototype._onRemoveObject.call(this,t,e),t.onRemoveFromGroup(this)},Mt.update=function(){yt.AGeoObject.prototype.update.call(this),Ot(this._objects.slice(),"update")},yt.GeocodeProviders=new xt.ObjectStorage,yt.GeocodeProviders.add("yandex#map",new function(){var s={house:"0.005,0.005",street:"0.005,0.005",metro:"0.5,0.5",locality:"0.5,0.5"};function n(t){return new yt.GeoPoint(t[0],t[1])}function i(t){var e=t.properties.boundedBy,i=t.properties.GeocoderMetaData;return(t=new yt.GeocoderResult(n(t.geometry.coordinates))).setBounds(new yt.GeoBounds(n(e[0]),n(e[1]))),t.AddressDetails=i.AddressDetails,t.precision=i.precision,t.text=i.text,t.kind=i.kind,t}function a(t){return{found:t.properties.ResponseMetaData.SearchResponse.found,suggest:(e=t.properties.ResponseMetaData.SearchRequest.suggest)&&wt.map(e,function(t){return"string"==typeof t?t:"<fix>"+t+"</fix>"}).join(""),results:wt.map(t.features,i)};var e}this.geocode=function(t,e,i,n){var o;wt.ajax({url:(o=t,e=(t=e).boundedBy,bt.searchService+"v1/?"+wt.param({geocoder_kind:t.kind||[],geocoder_sco:"longlat",key:bt.userKey||[],lang:t.prefLang||"ru_RU",ll:e&&e.getCenter().toString()||[],origin:t.origin||"jsGeocoder",properties:"addressdetails",results:t.results||[],rspn:t.strictBounds?1:[],skip:t.skip||[],spn:e&&e.getSpan().toString(6)||s[t.kind]||[],text:String(o),token:bt.token,type:"geo"})),dataType:"jsonp",scriptCharset:"utf-8",cache:1,success:function(t){"success"===t.status?i(a(t.data)):n(t.message)}})}}),yt.Geocoder=function(t,e){yt.GeoObjectCollection.call(this,"geocoder#result"),e=e||{},this.geocodeProvider=yt.GeocodeProviders.get(e.geocodeProvider||"yandex#map"),this.request=t,this.suggest=null,this.found=0,this.prefLang=e.prefLang||null,this.geocodeProvider.geocode(t,e,Lt(this.__successCallback,this),Lt(this.__failureCallback,this))},(Mt=Et(yt.Geocoder,yt.GeoObjectCollection)).Events.Load="Load",Mt.Events.Fault="Fault",Mt.__successCallback=function(t){this.found=t.found,this.suggest=t.suggest||null,this.add(t.results),Dt.notifyPermanent(this,this.Events.Load,this)},Mt.__failureCallback=function(t){Dt.notifyPermanent(this,this.Events.Fault,this,t)},yt.Templates.add("geocoder#template",new yt.Template("<div>$[text]</div>")),yt.Styles.add("geocoder#result",{balloonContentStyle:{template:"geocoder#template"}}),yt.GeocoderResult=function(t,e){yt.Placemark.call(this,t,e),this.kind="",this.text="",this.precision="",this.AddressDetails=null},Et(yt.GeocoderResult,yt.Placemark),function(){function t(t){var e=bt.geoxmlService+"1.2/geoxml.xml",s=/^[a-zA-Z]+:\/\//;this.loadDocument=function(i,n,o){s.test(i)||(i="http://"+i),wt.ajax({url:e,data:{key:bt.userKey||[],origin:t,url:i},dataType:"jsonp",scriptCharset:"utf-8",cache:1,success:function(t){var e={url:i};t.response?e.data=t.response:e.error=t.error&&t.error.message||"internal server error",n.call(o,e)}})}}var e=new t("jsapi1KML"),a={setUrl:function(t){this._url=t},getUrl:function(){return this._url},extend:function(n,o,t,s){return wt.each(t,function(t,e){var i=s?s[t]:e;o.hasOwnProperty(i)&&(t=a.formatters[e],n[e]=t?t(o[i],o):o[i])}),n},formatters:{balloonContentStyle:function(t){return new yt.BalloonContentStyle(new yt.Template(t.text))},fill:Number,fillColor:function(t){return t.slice(6,8)+t.slice(4,6)+t.slice(2,4)+t.slice(0,2)},geoObject:function(t){var e=t.Style?a.formatters.style(t.Style):a.formatters.key(t.styleUrl);switch(!0){case Boolean(t.Point):var i=a.formatters.points(t.Point.coordinates)[0],n=new yt.Placemark(i,{style:e});break;case Boolean(t.LineString):var o=a.formatters.points(t.LineString.coordinates);n=new yt.Polyline(o,{style:e});break;case Boolean(t.LinearRing||t.Polygon):i=t.LinearRing||t.Polygon.outerBoundaryIs.LinearRing,o=a.formatters.points(i.coordinates);n=new yt.Polygon(o,{style:e});break;default:var s=[];wt.each(t,function(t,e){0<=wt.inArray(t,["Document","Folder","Placemark"])&&(s=s.concat(e))}),n=new yt.GeoObjectCollection(e),wt.map(s,function(t){n.add(a.formatters.geoObject(t))})}return a.extend(n,t,["id","name","description"])},iconStyle:function(t){var e=new yt.IconStyle;return e.offset=new yt.Point(-16,-32),e.size=new yt.Point(32,32),e.href=t.Icon.href,e},key:function(t){return t&&t.match(/^#/)?a.getUrl()+t:t},kml:function(t){var e=t.Style||t.Document&&t.Document[0].Style;return{Styles:a.formatters.styles(e),Objects:a.formatters.geoObject(t)}},lineStyle:function(t){var e=new yt.LineStyle;return a.extend(e,t,["strokeColor","strokeWidth"],["color","width"])},outline:Number,point:function(t){t=t.split(",").map(Number);return new yt.GeoPoint(t[0],t[1])},points:function(t){t=t.match(/\S+/g);return wt.map(t,a.formatters.point)},polygonStyle:function(t,e){var i=new yt.PolygonStyle;return a.extend(i,e.LineStyle||{},["strokeColor","strokeWidth"],["color","width"]),a.extend(i,t,["fill","fillColor","outline"],["fill","color","outline"])},strokeColor:function(t){return t.slice(6,8)+t.slice(4,6)+t.slice(2,4)+t.slice(0,2)},strokeWidth:Number,style:function(t){var e=new yt.Style;return t.BalloonStyle&&t.BalloonStyle.text&&a.extend(e,t,["balloonContentStyle"],["BalloonStyle"]),a.extend(e,t,["iconStyle","lineStyle","polygonStyle"],["IconStyle","LineStyle","PolyStyle"])},styles:function(t){var i={};return wt.map(t||[],function(t){var e=a.getUrl()+"#"+t.id;i[e]=a.formatters.style(t)}),i}}};yt.KML=function(t){yt.GeoObjectCollection.call(this),e.loadDocument(t,this.__onLoaded,this)},(Mt=Et(yt.KML,yt.GeoObjectCollection)).Events.Load="Load",Mt.Events.Fault="Fault",Mt.__onLoaded=function(t){t.error?Dt.notifyPermanent(this,this.Events.Fault,this,t.error):(a.setUrl(t.url),t=a.formatters.kml(t.data.kml),wt.each(t.Styles,function(t,e){yt.Styles.add(t,e)}),this.add(t.Objects),Dt.notifyPermanent(this,this.Events.Load,this))};var i=new t("jsapi1GPX"),o={formatters:{boundedBy:function(t){return t&&new yt.GeoBounds(new yt.GeoPoint(Number(t.minlon),Number(t.minlat)),new yt.GeoPoint(Number(t.maxlon),Number(t.maxlat)))},gpx:function(e){var t=e.metadata||e,i=wt.extend(new yt.Style,{lineStyle:wt.extend(new yt.LineStyle,{strokeColor:"006CFFC8",strokeWidth:5})}),n=wt.extend(new yt.GeoObjectCollection(i),{metaDataProperty:{gpxMetaData:{gpxTagName:"gpx"}},description:t.desc,name:t.name});return wt.map(["wpt","rte","trk"],function(t){n.add(wt.map(e[t],o.formatters[t]))}),{View:{boundedBy:o.formatters.boundedBy(t.bounds)},Objects:n}},point:function(t){return new yt.GeoPoint(Number(t.lon),Number(t.lat))},rte:function(t){var e=wt.map(t.rtept,o.formatters.point);return wt.extend(new yt.Polyline(e),{metaDataProperty:{gpxMetaData:{gpxTagName:"rte",gpxStartTime:t.rtept[0].time,gpxEndTime:t.rtept.slice(-1)[0].time}},description:t.desc,name:t.name})},trk:function(t){var e=wt.extend(new yt.GeoObjectCollection,{metaDataProperty:{gpxMetaData:{gpxTagName:"trk"}},description:t.desc,name:t.name});return e.add(wt.map(t.trkseg,o.formatters.trkseg)),e},trkseg:function(t){var e=wt.map(t.trkpt,o.formatters.point);return wt.extend(new yt.Polyline(e),{metaDataProperty:{gpxMetaData:{gpxTagName:"trkseg",gpxStartTime:t.trkpt[0].time,gpxEndTime:t.trkpt.slice(-1)[0].time}}})},wpt:function(t){var e=o.formatters.point(t);return wt.extend(new yt.Placemark(e),{metaDataProperty:{gpxMetaData:{gpxTagName:"wpt",sym:t.sym,time:t.time}},description:t.desc,name:t.name})}}};yt.GPX=function(t,e){yt.GeoObjectCollection.call(this),this._options=wt.extend({},{viewAutoApply:1},e),i.loadDocument(t,this.__onLoaded,this)},(Mt=Et(yt.GPX,yt.GeoObjectCollection)).Events.Load="Load",Mt.Events.Fault="Fault",Mt.__onLoaded=function(t){t.error?Dt.notifyPermanent(this,this.Events.Fault,this,t.error):(t=o.formatters.gpx(t.data.gpx),this.add(t.Objects),this.view=t.View,this._options.viewAutoApply&&this.applyView(),Dt.notifyPermanent(this,this.Events.Load,this))},Mt.onAddToMap=function(t,e){yt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._options.viewAutoApply&&this.applyView()},Mt.applyView=function(){this.getMap()&&this.view&&this.view.boundedBy&&this.getMap().setBounds(this.view.boundedBy)};var n=new t("jsapi1YMapsML"),s={setUrl:function(t){this._url=t},getUrl:function(){return this._url},extend:function(i,n,t){return wt.map(t,function(t){var e;n.hasOwnProperty(t)&&(e=s.formatters[t],i[t]=e?e(n[t]):n[t])}),i},formatters:{balloonContentStyle:function(t){return new yt.BalloonContentStyle(s.formatters.key(t.template))},boundedBy:function(t){return new yt.GeoBounds(s.formatters.point(t.Envelope.lowerCorner.split(" ")),s.formatters.point(t.Envelope.upperCorner.split(" ")))},fill:Number,geoObject:function(t){var e=s.formatters.key(t.style);switch(!0){case Boolean(t.Point):var i=s.formatters.point(t.Point),n=new yt.Placemark(i,{style:e});break;case Boolean(t.polylod):var o=t.polylod;n=yt.Polyline.fromEncodedPoints(o.polyline,o.levels,{style:e});break;case Boolean(t.Polygon):o=t.Polygon.exterior.polylod;n=yt.Polygon.fromEncodedPoints(o.polyline,o.levels,{style:e});break;default:n=new yt.GeoObjectCollection(e),wt.map(t.featureMembers||[],function(t){t=t.GeoObjectCollection||t.GeoObject,n.add(s.formatters.geoObject(t))})}return t.boundedBy&&n.setBounds(s.formatters.boundedBy(t.boundedBy)),s.extend(n,t,["id","metaDataProperty","name","description"])},hasBalloon:Number,hasHint:Number,hintContentStyle:function(t){return new yt.HintContentStyle(s.formatters.key(t.template))},iconContentStyle:function(t){return new yt.IconContentStyle(s.formatters.key(t.template))},iconStyle:function(t){var e=new yt.IconStyle(s.formatters.key(t.template));return s.extend(e,t,["href","offset","size","shadow"])},key:function(t){return t&&t.match(/^#/)?s.getUrl()+t:t},lineStyle:function(t){var e=new yt.LineStyle;return s.extend(e,t,["strokeColor","strokeWidth"])},metaDataProperty:function(t){var i={};return wt.each(t,function(t,e){e=e[0];"string"==typeof e.value?i[t]=e.value:i[t]=s.formatters.metaDataProperty(e)}),i},offset:function(t){return new yt.Point(Number(t.x),Number(t.y))},outline:Number,point:function(t){return new yt.GeoPoint(Number(t[0]),Number(t[1]))},polygonStyle:function(t){var e=new yt.PolygonStyle;return s.extend(e,t,["fill","fillColor","outline","strokeColor","strokeWidth"])},shadow:function(t){var e=new yt.IconShadowStyle(s.formatters.key(t.template));return s.extend(e,t,["href","offset","size"])},size:function(t){return new yt.Point(Number(t.x),Number(t.y))},strokeWidth:Number,style:function(t){var e=new yt.Style(s.formatters.key(t.parentStyle),!0);return s.extend(e,t,["balloonContentStyle","hasBalloon","hasHint","hintContentStyle","iconContentStyle","iconStyle","lineStyle","polygonStyle"])},styles:function(t){var i={};return wt.each(t||[],function(t,e){t=s.getUrl()+"#"+t;i[t]=s.formatters.style(e)}),i},template:function(t){return new yt.Template(t.text)},templates:function(t){var i={};return wt.each(t||[],function(t,e){t=s.getUrl()+"#"+t;i[t]=s.formatters.template(e)}),i},view:function(t){return s.extend({},t||{},["boundedBy","mapType"])},ymaps:function(t){var e=t.Representation||{};return{View:s.formatters.view(e.View),Styles:s.formatters.styles(e.Style),Templates:s.formatters.templates(e.Template),Objects:s.formatters.geoObject(t.GeoObjectCollection)}}}};yt.YMapsML=function(t,e){yt.GeoObjectCollection.call(this),this._options=wt.extend({},{viewAutoApply:1},e),n.loadDocument(t,this.__onLoaded,this)},(Mt=Et(yt.YMapsML,yt.GeoObjectCollection)).Events.Load="Load",Mt.Events.Fault="Fault",Mt.__onLoaded=function(t){t.error?Dt.notifyPermanent(this,this.Events.Fault,this,t.error):(s.setUrl(t.url),t=s.formatters.ymaps(t.data.ymaps),wt.each(t.Styles,function(t,e){yt.Styles.add(t,e)}),wt.each(t.Templates,function(t,e){yt.Templates.add(t,e)}),this.add(t.Objects),this.view=t.View,this._options.viewAutoApply&&this.applyView(),Dt.notifyPermanent(this,this.Events.Load,this))},Mt.onAddToMap=function(t,e){yt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._options.viewAutoApply&&this.applyView()},Mt.applyView=function(){var t=this.getMap();t&&this.view&&(this.view.mapType&&t.setType(yt.MapType[this.view.mapType]),this.view.boundedBy&&t.setBounds(this.view.boundedBy))}}(),function(){function r(t,e){var i=t.length;if(!i)return null;for(var n=t[0],o={point:n,index:0,distance:n.diff(e).length()},s=1,a=1/0;s<i;s++){var r,h,l,c,u,d,p=t[s];n.equals(p)||(r=n.diff(p),h=n.diff(e),(d=(r.x*h.x+r.y*h.y)/(r.x*r.x+r.y*r.y))<0?(l=e.diff(u=n),c=s-1):1<d?(l=e.diff(u=p),c=s):(l=h.diff(r.copy().scale(d)),c=s-1,u=e.copy().moveBy(l)),(d=l.length())<a&&(o={point:u,index:c,distance:a=d}),n=p)}return o}function o(t,e,i){for(var n=0,o=0,s=t.length;o<s;o++){for(var a=t[o],r=0,h=a.length;r<h;r++)if(a[r].equals(e))return 1;for(var l=a[h-1],r=0;r<h;r++){var c=a[r];if(l.y==c.y&&l.y==e.y&&e.x>Math.min(l.x,c.x)&&e.x<Math.max(l.x,c.x))return 1;if(e.y>Math.min(l.y,c.y)&&e.y<=Math.max(l.y,c.y)&&e.x<=Math.max(l.x,c.x)&&l.y!=c.y){var u=(e.y-l.y)*(c.x-l.x)/(c.y-l.y)+l.x;if(u==e.x)return 1;(l.x==c.x||e.x<=u)&&(n+=i?xt.sign(c.y-l.y):n?-1:1)}l=c}}return n}function a(t,e){for(var i=[],n=[],o=0,s=t.length-1;o<s;o++){var a=t[o].diff(t[o+1]),r=a.scale(1/Math.sqrt(a.x*a.x+a.y*a.y)).scale(e).scale(.5),a=new kt(r.y,-r.x);n.unshift(t[o].copy().moveBy(a)),n.unshift(t[o+1].copy().moveBy(a)),h(n);r=new kt(-r.y,r.x);i.unshift(t[o].copy().moveBy(r)),i.unshift(t[o+1].copy().moveBy(r)),h(i)}return Ot(i,"apply",Math.round),Ot(n,"apply",Math.round),n.reverse(),i.concat(n)}function i(){var o=[];this.add=function(t,e){o.push([t,e])},this.remove=function(t,e){for(var i=0,n=o.length;i<n;i++)if(o[0]==t&&o[1]==e){o.splice(i,1);break}},this.invoke=function(){for(var t=0,e=o.length;t<e;t++)o[t][0].apply(o[t][1],arguments)}}var h=function(t){var e,i,n;t[3]&&(e=t[3].diff(t[2]),i=t[0].diff(t[1]),0==(n=e.y*i.x-e.x*i.y)?t.splice(1,1):(n=(e.x*(t[0].y-t[3].y)-e.y*(t[0].x-t[3].x))/n)<1&&0<n&&t.splice(1,2,t[0].copy().moveBy(i.copy().scale(n))))};yt.CoordVertex=function(t,e){this._coordPoint=t,this._zoom=Number(e)||0,this._changeCallbacks=new i},(Mt=yt.CoordVertex.prototype).getVisibilityZoom=function(){return this._zoom},Mt.setVisibilityZoom=function(t){this._zoom=Number(t),this._changeCallbacks.invoke(this)},Mt.getCoordPoint=function(){return this._coordPoint},Mt.setCoordPoint=function(t){this._coordPoint=t,this._changeCallbacks.invoke(this)},Mt.addChangeCallback=function(t,e){this._changeCallbacks.add(t,e)},Mt.removeChangeCallback=function(t,e){this._changeCallbacks.remove(t,e)};var _=yt.CoordPath=function(t){this._vertices=t||[],this._addVertexCallbacks(this._vertices),this._zoomIndexCache={},this._changeCallbacks=new i};(Mt=_.prototype).setVertices=function(t){this._removeVertexCallbacks(this._vertices),this._addVertexCallbacks(t),this._vertices=t,this._resetCache(),this._changeCallbacks.invoke(this)},Mt.getVertices=function(){return this._vertices.slice(0)},Mt.getNumVertices=function(){return this._vertices.length},Mt.getVertex=function(t){return t=t<0?this._vertices.length+t:t,this._vertices[t]},Mt.spliceVertices=function(t,e){this._addVertexCallbacks(Array.prototype.slice.call(arguments,2));var i=this._vertices.splice.apply(this._vertices,arguments);return this._removeVertexCallbacks(i),this._resetCache(),this._changeCallbacks.invoke(this),i},Mt.getIndexesByZoom=function(t){return this._zoomIndexCache[t]||this._refreshCacheForZoom(t),this._zoomIndexCache[t]},Mt._refreshCacheForZoom=function(t){this._zoomIndexCache[t]=[];for(var e=0,i=this._vertices.length;e<i;e++)this._vertices[e].getVisibilityZoom()<=t&&this._zoomIndexCache[t].push(e)},Mt._resetCache=function(){this._zoomIndexCache={}},Mt._onVertexChange=function(){this._resetCache(),this._changeCallbacks.invoke(this)},Mt.addChangeCallback=function(t,e){this._changeCallbacks.add(t,e)},Mt.removeChangeCallback=function(t,e){this._changeCallbacks.remove(t,e)},Mt._addVertexCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].addChangeCallback(this._onVertexChange,this)},Mt._removeVertexCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].removeChangeCallback(this._onVertexChange,this)};var l,c,n,s,m=bt.Graphics=new function(){var a=[];this.getContainer=function(t,e){var i,n;t=t||l;for(var o=0,s=a.length;o<s;o++)if((i=a[o]).map==e&&i.container instanceof t){n=i.container;break}return n||(n=new t,a.push({map:e,container:n})),n.getMap()||e.addOverlay(n,1),n}},t=0,e=0,u=0,d=Pt.webkit&&523.15<Pt.version&&!St.android&&!St.adobeAIR,p=Pt.mozilla&&1.8<=Pt.version,f=8<Pt.ieDocumentMode,g=Pt.msie&&5.4<Pt.version,v=Pt.opera&&9.5<=Pt.version;function x(e){this._map=e,this._listeners=[Dt.observe(e,e.Events.DragStart,this._onMapDragStart,this),Dt.observe(e,e.Events.DragEnd,this._onMapDragEnd,this)],this._layerContainerListener=It(e.__layerManager.getContainer()).events.eventListener(),this._layerContainerListener.add("mousemove",function(t){this._drawMapAutoPan(e,new yt.MouseEvent(t,e))},this).add("mouseleave",function(t){this._stopMapAutoPan()},this)}function y(e,i){var n,o,s,a,r,h=Dt.observe(e,"MouseMove",t);function t(t,e){h.cleanup(),h=Dt.observe(t,"MouseLeave",l),(n=new xt.DragAndDrop.MouseMove(e.getEvent().target,0,At.tremor.graphicsEditor)).beginListening(),o=[Dt.observe(n,"start",d,this),Dt.observe(n,"move",p,this),Dt.observe(n,"stop",f,this)]}function l(){h.cleanup(),h=Dt.observe(e,"MouseMove",t),n.stopListening(),Ot(o,"cleanup")}function c(){r=1,h.cleanup(),h=Dt.observe(e,"MouseMove",u)}function u(){r=0,h.cleanup(),h=Dt.observe(e,"MouseLeave",c)}function d(t){r=0,h.cleanup(),h=Dt.observe(e,"MouseLeave",c),i.dragStart&&i.dragStart(t)}function p(t){i.dragMove&&(m.VML?(a=t,s=s||setInterval(_,10)):i.dragMove(t))}function _(){a?(i.dragMove(a),a=null):(clearInterval(s),s=null)}function f(t){m.VML&&_(),r?l():(h.cleanup(),h=Dt.observe(e,"MouseLeave",l)),i.dragStop&&i.dragStop(t)}this.destruct=function(){n&&(n.stopListening(),Ot(o,"cleanup")),h.cleanup()}}function b(t){var n,o,e,s=function(){var t=wt("<div class='YMaps-gEditor-glassPane' style='position:absolute;' />");Pt.msie&&t.css("background","url("+At.images.transparentImage+")");return t}().css("zIndex",t),a=It(s[0]).events.eventListener(),i={Update:"Update",Click:"Click",DblClick:"DblClick",MouseMove:"MouseMove",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",AddToMap:"AddToMap",RemoveFromMap:"RemoveFromMap"},r={Click:"click",DblClick:"dblclick",MouseMove:"mousemove",MouseEnter:"mouseenter",MouseLeave:"mouseleave"},h={};for(e in r)r.hasOwnProperty(e)&&(h[e]=function(e,i){return function(t){Dt.notify(i,e,i,new yt.MouseEvent(t,n))}}(i[e],this));function l(){var t=n.getContainerSize(),e=n.converter.localPixelsToMapPixels(new kt(0,0));s.css({top:e.getY()+"px",left:e.getX()+"px",width:t.getX()+"px",height:t.getY()+"px"}),Dt.notify(this,this.Events.Update,this)}this.getMap=function(){return n},this.onMapUpdate=l,this.onAddToMap=function(t,e){for(var i in n=t,s.appendTo(e),o=Dt.observe(n,n.Events.MoveEnd,l,this),h)h.hasOwnProperty(i)&&a.add(r[i],h[i]);l.call(this),Dt.notify(this,this.Events.AddToMap,this)},this.onRemoveFromMap=function(){a.removeAll(),o.cleanup(),s.removeFromDom(),n=null,Dt.notify(this,this.Events.RemoveFromMap,this)},this.Events=i}function C(){this._map=null,this._$container=wt("<div />").css({position:"absolute",width:0,height:0,zIndex:0}),this.hide(),this._size=null,this._position=null,this._delta=null,this._shift=new kt(0,0),this._graphics=[]}function M(){this.styles={},this._eventHandlers={DblClick:this._dblClick,Click:this._click,MouseEnter:this._mouseEnter,MouseLeave:this._mouseLeave,MouseMove:this._mouseMove}}function w(){M.call(this)}function P(t,e){this._id=xt.generateId(),this._coords=t||[],this._zIndex=e||0}function S(i){var n={},s={heads:{},tails:{},maxZIndex:0};function o(t,e){if(t.next=function(t){{if(s.heads[t])return s.heads[t];if(s.maxZIndex<t)return s.heads[s.maxZIndex];for(var e=t-1;0<=e;e--)if(s.heads[e])return s.heads[e]}}(e),t.next&&(t.next.prev=t),t.prev=function(t){if(s.maxZIndex>t)for(var e=t+1;e<=s.maxZIndex;e++)if(s.tails[e])return s.tails[e]}(e),t.prev&&(t.prev.next=t),t.next&&t.next.hotspot.getZIndex()==e){var i=t.hotspot.getUID();if(i){for(var n=t.next;n&&(n.hotspot.getUID()!=i||n.hotspot.getZIndex()!=e);)n=n.next;n&&n.hotspot.getUID()==i&&n.hotspot.getZIndex()==e&&(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=n,t.prev=n.prev,(n.prev=t).prev&&(t.prev.next=t))}}s.heads[e]||(s.tails[e]=t),t.prev&&t.prev.hotspot.getZIndex()==e||(s.heads[e]=t),s.maxZIndex=Math.max(s.maxZIndex,e)}function a(t){var e=t.getId(),i=n[e];i&&(delete n[e],Ot(i.listeners,"cleanup"),r(i,t.getZIndex()))}function r(t,e){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),s.heads[e]==t)if(t.next&&t.next.hotspot.getZIndex()==e)s.heads[e]=t.next;else if(delete s.heads[e],s.maxZIndex==e)for(var i in s.maxZIndex=0,s.heads)s.heads.hasOwnProperty(i)&&(s.maxZIndex=Math.max(s.maxZIndex,i));s.tails[e]==t&&(t.prev&&t.prev.hotspot.getZIndex()==e?s.tails[e]=t.prev:delete s.tails[e])}function h(t,e,i){t=n[t.getId()];r(t,e),o(t,i)}this.add=function(t){var e=t.getId(),i={hotspot:t,listeners:[Dt.observe(t,"ZIndexChange",h),Dt.observe(t,"Destruction",a)]};o(n[e]=i,t.getZIndex())},this.remove=a;var l,c,t=[Dt.observe(i,i.Events.Click,function(t,e){t=u(e,t.getMap());t&&t.click(e)}),Dt.observe(i,i.Events.DblClick,function(t,e){t=u(e,t.getMap());t&&t.dblClick(e)}),Dt.observe(i,i.Events.MouseMove,function(t,e){t=u(e,t.getMap());l&&l!=t&&(l.mouseLeave(e),l=null);t&&(l||(t.mouseEnter(e),l=t),t.mouseMove(e));d()}),Dt.observe(i,i.Events.MouseEnter,function(t,e){t=u(e,t.getMap());t&&(t.mouseEnter(e),l=t);d()}),Dt.observe(i,i.Events.MouseLeave,function(t,e){l&&l.mouseLeave(e);l=null,d()})];function u(t,e){for(var i=s.heads[s.maxZIndex],n=(e=e,t=t.getCoordPoint(1),e.tileCoordinates.scale(e.coordSystem.fromCoordPoint(t),e.coordSystem.getMaxZoom(),e.getZoom())),o=null;i;){if(i.hotspot.contains(n)){o=i.hotspot;break}i=i.next}return o}function d(){var t=i.getMap(),e=l&&l.getCursor();c!=e&&(c&&t.removeCursor(c),e&&t.addCursor(e)),c=e}this.destruct=function(){yt.jQuery.each(n,function(t,e){Ot(e.listeners,"cleanup")}),Ot(t,"cleanup"),n=null}}function T(){C.call(this)}function E(){w.call(this),this._containerClass=T,this._htmlElement=wt("<div />").css("position","absolute")[0]}function L(t){M.call(this),this._geometry=null,this._shape=null,this._shapeListeners=null,this._shapeClass=t}function O(t){yt.AInteractiveGeoObject.call(this,t),t=t||{},this._interactive=typeof t.interactive!=Tt?t.interactive:yt.Interactivity.INTERACTIVE,this._geodesic=!!t.geodesic,this._cursor=t.cursor||null,this._zIndex=typeof t.zIndex!=Tt?t.zIndex:null,this._draggable=!!t.draggable}function I(t,e,i,n){this._coordPath=t,this._parentModel=i,this._editor=n,this._graphicsObject=i.getGraphicsObject(),this._map=this._graphicsObject.getMap(),this._edgeModels=[],this._vertexModels=[],this.updateStructure(e)}function A(t,e,i,n){I.call(this,t,e,i,n)}function k(t,e){this._graphicsObject=t,this._editor=e,this._pathModels=[],this._graphicsListener=Dt.observe(t,t.Events.Update,this.update,this),this._updateStructure()}function B(t,e){this._graphicsObject=t,this._editor=e,this._pathModel=new I(t.getCoordPath(),this._graphicsObject.getPixelPoints({geodesic:0}),this,e),this._graphicsListener=Dt.observe(t,t.Events.Update,this.update,this)}d||p||v||f?t=1:g?e=1:u=1,m.SVG=t,m.VML=e,m.SSG=u,yt.PolylineCoordRenderer=function(){function g(t){return[t.getLeftBottom(),t.getLeftTop(),t.getCenter(),t.getRightBottom(),t.getRightTop()]}function v(t,e,i){var n=i.coordSystem,i=n.restrict(t),t=n.fromCoordPoint(i);return t.diff(n.fromCoordPoint(i,n.toCoordPoint(t.copy().moveBy(e),1)))}this._prevPixelBounds=null,this.renderCoords=function(t,e){if(!e)return[];var i,n,o,s=[],a=e.coordSystem,r=e._state.centerInTiles;if(t&&t.length){for(var h,l=0,c=t.length;l<c;l++)h=s[l-1],s.push(a.fromCoordPoint(a.restrict(t[l]),h?a.toCoordPoint(h,1):null));var u,d,p=new yt.CollectionBounds(s),_=r,f=p.getCenter();this._prevPixelBounds&&(u=g(this._prevPixelBounds),d=u,i=r,o=1/0,wt.map(d,function(t,e){t=i.diff(t).length();t<o&&(o=t,n=e)}),d=n,f=g(p)[d],_=u[d]);var _=a.fromCoordPoint(a.toCoordPoint(f),a.toCoordPoint(_,1)),m=v(t[0],f.diff(_),e),f=p.getCenter().moveBy(m).diff(r),_=a.getWorldSize(),r=new kt(Math.ceil(p.getSpan().getX()/_.getX())||1,Math.ceil(p.getSpan().getY()/_.getY())||1),f=new kt(f.getX()/_.getX()/r.getX(),f.getY()/_.getY()/r.getY()).apply(Math.round);(f.getX()||f.getY())&&m.moveBy(v(t[0],f.scale(r.scale(_)),e)),(m.getX()||m.getY())&&(wt.each(s,function(t,e){e.moveBy(m)}),p=new yt.CollectionBounds(s)),this._prevPixelBounds=p}return s}},yt.PolygonCoordRenderer=function(){function y(t){return[t.getLeftBottom(),t.getLeftTop(),t.getCenter(),t.getRightBottom(),t.getRightTop()]}function b(t,e,i){var n=i.coordSystem,i=n.restrict(t),t=n.fromCoordPoint(i);return t.diff(n.fromCoordPoint(i,n.toCoordPoint(t.copy().moveBy(e),1)))}this._exteriorPixelBounds=null,this.renderCoords=function(t,e){if(!e)return[];for(var i=[],n=e.coordSystem,o=e._state.centerInTiles,s=0,a=t.length;s<a;s++){var r=t[s],h=[];if(r&&r.length){for(var l,c=0,u=r.length;c<u;c++)l=h[c-1],h.push(n.fromCoordPoint(n.restrict(r[c]),l?n.toCoordPoint(l,1):null));var d,p=new yt.CollectionBounds(h),_=o,f=p.getCenter();this._exteriorPixelBounds&&(g=function(t,i){var n,o=1/0;return wt.map(t,function(t,e){t=i.diff(t).length();t<o&&(o=t,n=e)}),n}(d=y(this._exteriorPixelBounds),o),f=y(p)[g],_=d[g]);var m,g=n.fromCoordPoint(n.toCoordPoint(f),n.toCoordPoint(_,1)),v=b(r[0],f.diff(g),e),_=p.getCenter().moveBy(v).diff(o),f=n.getWorldSize(),g=new kt(Math.ceil(p.getSpan().getX()/f.getX())||1,Math.ceil(p.getSpan().getY()/f.getY())||1),_=new kt(_.getX()/f.getX()/g.getX(),_.getY()/f.getY()/g.getY()).apply(Math.round);(_.getX()||_.getY())&&v.moveBy(b(r[0],_.scale(g.scale(f)),e)),(v.getX()||v.getY())&&(wt.each(h,function(t,e){e.moveBy(v)}),p=new yt.CollectionBounds(h)),0==s?this._exteriorPixelBounds=p:this._exteriorPixelBounds.intersects(p)||(g=p.getCenter().diff(this._exteriorPixelBounds.getCenter()),m=new kt(g.getX()/f.getX(),g.getY()/f.getY()).apply(function(t){return t/Math.abs(t)}),m=b(r[0],m.scale(f),e),g=p,f=m,f=new yt.Bounds(g.getLeftBottom().moveBy(f),g.getRightTop().moveBy(f)),this._exteriorPixelBounds.intersects(f)&&(wt.each(h,function(t,e){e.moveBy(m)}),p=f))}i.push(h)}return i}},(Mt=x.prototype)._drawMapAutoPan=function(t,e){var i=this._map.converter.localPixelsToMapPixels(e.getLocalPixels()),n=this._map.getContainerSize().scale(.5),o=this._map.converter.localPixelsToMapPixels(n),s=n.copy().moveBy(new kt(-20)),e=new yt.Bounds(o.copy().moveBy(s.neg()),o.copy().moveBy(s)),n=new yt.Bounds(o.copy().moveBy(n.neg()),o.copy().moveBy(n));e.contains(i)||!n.contains(i)?this._stopMapAutoPan():this._mapDraged||(this._isMapPanned=1,i=(o=o.diff(i)).copy().apply(Math.abs),i=new kt(i.getX()>s.getX(),i.getY()>s.getY()).scale(o.copy().scale(new kt(1/i.getX(),1/i.getY()))),this._map.startMove(i,{startSpeed:4,speed:8}))},Mt._onMapDragStart=function(){this._mapDraged=1},Mt._onMapDragEnd=function(){this._mapDraged=0},Mt._stopMapAutoPan=function(){this._isMapPanned&&(this._isMapPanned=0,this._map.stopMove())},Mt.destruct=function(){this._stopMapAutoPan(),Ot(this._listeners,"cleanup"),this._layerContainerListener.removeAll()},(Mt=C.prototype).Events={Update:"Update"},Mt.onAddToMap=function(t,e){this._map=t,this._$container.appendTo(e),this._moveEndListener=Dt.observe(t,t.Events.MoveEnd,this.onMapMoveEnd,this,1),this._smoothZoomListeners=[Dt.observe(t,t.Events.SmoothZoomStart,this.hide,this,1),Dt.observe(t,t.Events.SmoothZoomEnd,this.show,this,1)],this.update()},Mt.onRemoveFromMap=function(){this._moveEndListener.cleanup(),Ot(this._smoothZoomListeners,"cleanup"),this._$container.removeFromDom(),this._map=this._moveEndListener=this._smoothZoomListeners=null},Mt.getMap=function(){return this._map},Mt.getSize=function(){return this._size},Mt.getDelta=function(){return this._shift.diff(this._delta)},Mt.getPosition=function(){return this._position},Mt.update=function(){var t=this._map.getContainerSize(),e=this._map.converter.localPixelsToMapPixels(new kt(0,0));this._shift=new kt(0,0),this.__mapCenter=this._map.getCenter(1),this._delta=t.copy().scale(1),this._position=this._delta.diff(e),this._size=t.moveBy(this._delta.copy().scale(2)),xt.position(this._$container[0],this._position)},Mt.show=function(){this._$container.removeClass("YMaps-display-none")},Mt.hide=function(){this._$container.addClass("YMaps-display-none")},Mt.onMapMoveEnd=function(){var t=this._map.converter,e=this._map.getCenter(1),e=t.coordinatesToLocalPixels(e,1).diff(t.coordinatesToLocalPixels(this.__mapCenter,1)),t=e.copy().apply(Math.abs);t.getX()>this._delta.getX()/2||t.getY()>this._delta.getY()/2?this.onMapUpdate():this._shift=e},Mt.onMapUpdate=function(){this.update(),Dt.notify(this,this.Events.Update,this)},Mt.add=function(t){this._graphics.length||this.show(),this._graphics.push(t)},Mt.remove=function(t){t=wt.inArray(t,this._graphics);-1!=t&&this._graphics.splice(t,1),this._graphics.length||this.hide()},Mt.destructor=function(){this._map&&this.onRemoveFromMap(),this._$container=null},(Mt=M.prototype).Events={DblClick:"DblClick",Click:"Click",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove"},Mt.getMap=function(){return this._map},Mt.onAddToMap=function(t){this._map=t,this._container=m.getContainer(this._containerClass,t),this._createListeners()},Mt.onRemoveFromMap=function(){this._map&&(this._destroyListeners(),this._map=this._container=null)},Mt.onMapUpdate=function(){this.update()},Mt.setCursor=function(t){this._cursor=t},Mt.setZIndex=function(t){this._zIndex=t},Mt.setGeometry=function(t){this._geometry=t},Mt._createListeners=Mt._destroyListeners=Mt.update=Mt._dblClick=Mt._click=Mt._mouseEnter=Mt._mouseLeave=Mt._mouseMove=xt.NULL,Mt.setUID=function(t){this._uid=t},(Mt=Et(w,M)).__translatedEventNames={DblClick:"dblclick",Click:"click",MouseEnter:"mouseenter",MouseLeave:"mouseleave",MouseMove:"mousemove"},Mt.onAddToMap=function(t){M.prototype.onAddToMap.call(this,t),this._container.add(this._htmlElement)},Mt.onRemoveFromMap=function(){this._mouseChecksReset(),this._map&&(this._container.remove(this._htmlElement),M.prototype.onRemoveFromMap.call(this))},Mt.setCursor=function(t){this._cursorManager?this._cursorManager.removeCursor(this._cursor):this._cursorManager=new bt.CursorManager(this._htmlElement),M.prototype.setCursor.call(this,t),this._cursorManager.addCursor(this._cursor)},Mt._createListeners=function(){for(var t in this.domListener=It(this._htmlElement).events.eventListener(),this._eventHandlers)this.domListener.add(this.__translatedEventNames[t],this._eventHandlers[t],this)},Mt._destroyListeners=function(){this.domListener.removeAll()},Mt._dblClick=function(t){Dt.notify(this,this.Events.DblClick,this,new yt.MouseEvent(t,this._map))},Mt._click=function(t){Dt.notify(this,this.Events.Click,this,new yt.MouseEvent(t,this._map))},Mt._mouseEnter=function(t){this.isMouseOver||(this.isMouseOver=1,(Pt.opera||Pt.mozilla)&&(this.mapBeforeMouseMoveListener=Dt.observe(this._map,this._map.Events.BeforeMouseMove,this._mapMouseMove,this)),Dt.notify(this,this.Events.MouseEnter,this,new yt.MouseEvent(t,this._map)))},Mt._mouseLeave=function(t){this.isMouseOver&&(this.isMouseOver=0,(Pt.opera||Pt.mozilla)&&this._mouseChecksReset(),Dt.notify(this,this.Events.MouseLeave,this,new yt.MouseEvent(t,this._map)))},Mt._mouseChecksReset=function(){this.mapBeforeMouseMoveListener&&this.mapBeforeMouseMoveListener.cleanup()},Mt._mouseMove=function(t){this.isMouseOver||this._mouseEnter(t),this.isMouseOver&&Dt.notify(this,this.Events.MouseMove,this,new yt.MouseEvent(t,this._map))},Mt._mapMouseMove=function(t,e){e=e.getEvent();e.target!=this._htmlElement&&this._mouseLeave(e)},Mt.setUID=function(t){M.prototype.setUID.call(this,t),this._htmlElement.uid=t},(Mt=function(){}.prototype).setPoints=function(t){this._points=t},Mt.getPoints=function(){return this._points},(Mt=P.prototype).setUID=function(t){var e=this._uid;this._uid=t,Dt.notify(this,"UidChange",this,e,t)},Mt.getUID=function(){return this._uid},Mt.getId=function(){return this._id},Mt.setZIndex=function(t){var e=this._zIndex;this._zIndex=t,Dt.notify(this,"ZIndexChange",this,e,t)},Mt.getZIndex=function(){return this._zIndex},Mt.setCoords=function(t){this._coords=t,this._cachedBounds=null,Dt.notify(this,"CoordsChange",this)},Mt.getCoords=function(){return this._coords},Mt.contains=function(t){if(this.getBounds().contains(t))for(var e=this._coords,i=0,n=e.length;i<n;i++)if(o(e[i].coords,t,e[i].nonzero))return 1},Mt.getBounds=function(){if(!this._cachedBounds){this._cachedBounds=new yt.CollectionBounds;for(var t=0,e=this._coords.length;t<e;t++)this._cachedBounds.add(this._coords[t].coords)}return this._cachedBounds},Mt.setCursor=function(t){this._cursor=t},Mt.getCursor=function(){return this._cursor},Mt.destruct=function(){Dt.notify(this,"Destruction",this)},Mt.click=function(t){Dt.notify(this,"Click",this,t)},Mt.dblClick=function(t){Dt.notify(this,"DblClick",this,t)},Mt.mouseEnter=function(t){Dt.notify(this,"MouseEnter",this,t)},Mt.mouseLeave=function(t){Dt.notify(this,"MouseLeave",this,t)},Mt.mouseMove=function(t){Dt.notify(this,"MouseMove",this,t)},u&&((Mt=Et(l=function(){C.call(this),this._viewBox=wt("<div />").css({position:"absolute"})[0],this._$container.append(this._viewBox),this._glassPane=new b(0),this._hotspotField=new S(this._glassPane)},C)).onAddToMap=function(t,e){C.prototype.onAddToMap.call(this,t,e),this._map.addOverlay(this._glassPane,1)},Mt.onRemoveFromMap=function(){C.prototype.onRemoveFromMap.call(this),this._map.removeOverlay(this._glassPane)},Mt.getHotspotField=function(){return this._hotspotField},Mt.add=function(t){C.prototype.add.call(this,t);var e=t.name;if("polyline"==e||"polygon"==e){for(var i=0,n=wt(this._viewBox).children(),o=n.length;i<o;i++)if(n[i].uid>t.uid)return void wt(t).insertBefore(n[i]);this._viewBox.appendChild(t)}},Mt.remove=function(t){var e=t.parentNode;e==this._viewBox&&(C.prototype.remove.call(this,t),e.removeChild(t))},(Mt=Et(c=function(){M.call(this);var t='<img style="position:absolute;"/>';this._htmlElement=wt(t)[0],this._htmlElementClon=wt(t)[0],this._$imageLoader=wt(t),this._imageLoaderListener=It(this._$imageLoader[0]).events.eventListener()},M)).onRemoveFromMap=function(){this._map&&(this._imageLoaderListener.removeAll(),this._hotspot&&(this._container.getHotspotField().remove(this._hotspot),this._hotspot=null),this._container.remove(this._htmlElement),M.prototype.onRemoveFromMap.call(this))},Mt.setCursor=function(t){M.prototype.setCursor.call(this,t),this._hotspot&&this._hotspot.setCursor(this._cursor)},Mt.setZIndex=function(t){M.prototype.setZIndex.call(this,t),wt([this._htmlElement,this._htmlElementClon]).css("zIndex",this._zIndex),this._hotspot&&this._hotspot.setZIndex(this._zIndex)},Mt.setUID=function(t){M.prototype.setUID.call(this,t),this._htmlElement.uid=t,this._htmlElementClon.uid=t,this._hotspot&&this._hotspot.setUID(t)},Mt._destroyListeners=function(){this._hotspotListeners&&(Ot(this._hotspotListeners,"cleanup"),this._hotspotListeners=null)},Mt.update=function(){var t;this._map&&this._geometry&&(this._containerPosCache&&xt.position(this._htmlElement,this._containerPosCache.diff(this._container.getPosition()).diff(xt.position(this._htmlElement))),this._mapZoom!=this._map.getZoom()&&this._container.remove(this._htmlElement),t=this._constructImg(),this._size=new kt(t.width,t.height),this._position=this._map.converter.mapPixelsToLocalPixels(new kt(t.left,t.top)),this._containerPosCache=this._container.getPosition(),this._mapZoom=this._map.getZoom(),this._imageLoaderListener.add("load",this._onImageLoad,this),this._$imageLoader.attr("src",t.src),(Pt.opera||Pt.webkit)&&this._$imageLoader.attr("complete")&&this._onImageLoad())},Mt._constructImg=function(){var t=wt.map(this._geometry,function(t){return t}),e=new yt.CollectionBounds(t),i=this.styles,n=e.getSpan().apply(Math.round),o=Math.round(i.strokeWidth),s=n.x+o,a=n.y+o,r=Math.floor(o/2),t=this._getGeoPoint(e.getCenter(),this._map.coordSystem==Bt),n=this._container.getDelta(),o=i.outline?"c:"+i.strokeColor+this._stringUp(Math.round(255*i.strokeOpacity).toString(16),2,"0")+",w:"+o+",":"w:0,",i=i.fill?"f:"+i.fillColor+this._stringUp(Math.round(255*i.fillOpacity).toString(16),2,"0")+",":"",i=bt.printerApi+"1.x/?origin=javascriptapi&ll="+t.toString()+"&size="+s+","+a+"&z="+this._map.getZoom()+"&key="+bt.userKey+"&pl="+o+i+this._encodeGeometry();return{width:s,height:a,left:e.getLeft()+n.x-r,top:e.getBottom()+n.y-r,src:i}},Mt._stringUp=function(t,e,i){for(;t.length<e;)t=i+t;return t},Mt._encode4bytes=function(t){for(var e=[],i=this._preparePoints(t),n=0,o=i.length;n<o;n++)e=e.concat(vt.encode4bytes(i[n].getX()),vt.encode4bytes(i[n].getY()));return e},Mt._preparePoints=function(t){for(var e,i=[],n=0,o=t.length,s=Bt.getCoordPoint(0,0);n<o;n++)e=this._getGeoPoint(t[n],this._map.coordSystem==Bt),i.push(s.diff(e).scale(vt.codingCoefficient).apply(Math.round)),s=e;return i},Mt._getGeoPoint=function(t,e){return e?this._map.converter.mapPixelsToCoordinates(t,1):Bt.toCoordPoint(this._map.coordSystem.fromCoordPoint(this._map.converter.mapPixelsToCoordinates(t,1)),1)},Mt._onImageLoad=function(){this._imageLoaderListener.removeAll(),xt.position(this._htmlElementClon,this._position),xt.size(this._htmlElementClon,this._size),this._htmlElementClon.src=this._$imageLoader.attr("src"),this._container.remove(this._htmlElement);var t=this._htmlElement;if(this._htmlElement=this._htmlElementClon,this._htmlElementClon=t,this._container.add(this._htmlElement),this._hotspot||(this._hotspot=new P,this._hotspot.setCursor(this._cursor),this._hotspot.setZIndex(this._zIndex),this._hotspot.setUID(this._uid),this._container.getHotspotField().add(this._hotspot)),!this._hotspotListeners)for(var e in this._hotspotListeners=[],this._eventHandlers)this._hotspotListeners.push(Dt.observe(this._hotspot,e,this._eventHandlers[e],this));this._hotspot.setCoords(this._getCoordsArray())},Mt._getCoordsArray=xt.NULL,Mt._mapPixelsToGlobalPixel=function(t){for(var e=this._map,i=e._state,n=[],o=0,s=t.length;o<s;o++){var a=i.centerInPixels.diff(t[o].copy().moveBy(i.offset));n.push(a.scale(1/e.animator.getState().scaleCoefficient).moveBy(e.tileCoordinates.scale(i.centerInTiles,e.coordSystem.getMaxZoom(),e.getZoom())))}return n},Mt._dblClick=function(t,e){Dt.notify(this,this.Events.DblClick,this,e)},Mt._click=function(t,e){Dt.notify(this,this.Events.Click,this,e)},Mt._mouseEnter=function(t,e){Dt.notify(this,this.Events.MouseEnter,this,e)},Mt._mouseLeave=function(t,e){Dt.notify(this,this.Events.MouseLeave,this,e)},Mt._mouseMove=function(t,e){Dt.notify(this,this.Events.MouseMove,this,e)},(Mt=Et(n=function(){c.call(this),this._htmlElement.name=this._htmlElementClon.name="polyline",this.styles.fill=0,this.styles.outline=1},c))._getCoordsArray=function(){return[{coords:[a(this._mapPixelsToGlobalPixel(this._geometry),this.styles.strokeWidth)],nonzero:1}]},Mt._encodeGeometry=function(){return vt.encode(this._encode4bytes(this._geometry))},(Mt=Et(s=function(){c.call(this),this._htmlElement.name=this._htmlElementClon.name="polygon"},c)).setGeometry=function(t){c.prototype.setGeometry.call(this,t);for(var e=0,i=t.length;e<i;e++){var n=t[e];n[0]&&n.push(n[0])}},Mt._getCoordsArray=function(){for(var t=this._geometry,e=[],i=0,n=t.length;i<n;i++)t[i]=this._mapPixelsToGlobalPixel(t[i]),e[i]=a(t[i],this.styles.strokeWidth);return[{coords:t,nonzero:0},{coords:e,nonzero:1}]},Mt._encodeGeometry=function(){return wt.map(this._geometry,Lt(function(t){return vt.encode(this._encode4bytes(t))},this)).join(";")},Mt._preparePoints=function(t){var e,i=c.prototype._preparePoints.call(this,t),n=0,o=i.length-1;if(0<o){for(;n<o;n++)e=(e||i[n].copy()).moveBy(i[n+1]);i[o].moveBy(e.diff(i[0]))}return i}),e&&((Mt=Et(l=function(){C.call(this);var t=document.createStyleSheet(),e="behavior: url(#default#VML);display:inline-block;";t.addRule("vml\\:group",e),t.addRule("vml\\:shape",e);try{document.namespaces.vml||document.namespaces.add("vml","urn:schemas-microsoft-com:vml")}catch(t){}this.coordSizeCoef=10;t=this._viewBox=document.createElement("vml:group"),e=t.style;e.position="absolute",e.top=e.left="-1px",this._$container.append(t)},C)).add=function(t){C.prototype.add.call(this,t);for(var e=this._viewBox,i=0,n=e.childNodes,o=n.length;i<o;i++)if(n[i].uid>t.uid)return void e.insertBefore(t,n[i]);e.appendChild(t)},Mt.remove=function(t){t.parentElement==this._viewBox&&(C.prototype.remove.call(this,t),this._viewBox.removeChild(t))},Mt.update=function(){C.prototype.update.call(this);var t=this._viewBox,e=t.style;e.visibility="hidden",xt.size(t,this._size),t.coordsize=this._size.copy().scale(this.coordSizeCoef).toString(),t.coordorigin=this._position.copy().scale(this.coordSizeCoef).toString(),e.visibility="visible"},Mt.refresh=function(){var t=this._map;clearTimeout(this._refreshTimeoutId),this._refreshTimeoutId=setTimeout(function(){wt(t.getContainer()).addClass("YMaps-fake-class").removeClass("YMaps-fake-class")},250)},(Mt=Et(c=function(){w.call(this)},w)).update=function(){var t=this.styles;this._htmlElement.stroke&&(this._htmlElement.stroke.opacity=Math.round(100*t.strokeOpacity)+"%"),this._htmlElement.strokeweight=t.strokeWidth+"px",this._htmlElement.strokecolor="#"+t.strokeColor,Pt.version<8&&this._container.refresh()},Mt.setZIndex=function(t){M.prototype.setZIndex.call(this,t),this._htmlElement.style.zIndex=t},(Mt=Et(n=function(){c.call(this),this._htmlElement=document.createElement("vml:shape");var t=this._htmlElement.style;t.margin="auto",t.height=t.width="100%",t.zIndex=2,this._htmlElement.name="polyline",this._htmlElement.filled=!1},c)).update=function(){c.prototype.update.call(this);var e=this._container.coordSizeCoef,t=wt.map(this._geometry,function(t){return t.copy().scale(e).apply(Math.round).toString()}),i=this._htmlElement;i.path="m "+t.shift()+" l "+t.join(" ")+" e",i.coordorigin=this._container.getPosition().copy().scale(e).toString(),i.coordsize=this._container.getSize().copy().scale(e).toString(),i.stroked=!!this.styles.strokeWidth,i.stroke&&(i.stroke.endcap="round")},(Mt=Et(s=function(){c.call(this),this._interiors=[],this._htmlElement=document.createElement("vml:shape");var t=this._htmlElement.style;t.margin="auto",t.width=t.height="100%",t.zIndex=1,this._htmlElement.name="polygon"},c)).update=function(){c.prototype.update.call(this);for(var t,e=this._container.coordSizeCoef,i=this.styles,n=this._htmlElement,o=this._geometry,s="",a=0,r=o.length;a<r;a++)1!=(t=wt.map(o[a],function(t){return t.copy().scale(e).apply(Math.round).toString()})).length&&(s+=" m "+t.shift()+" l "+t.join(" ")+" x ");s+=" e",n.path=s,n.coordorigin=this._container.getPosition().copy().scale(e).toString(),n.coordsize=this._container.getSize().copy().scale(e).toString(),n.stroked=i.outline&&i.strokeWidth,n.filled=i.fill,n.fillcolor="#"+i.fillColor,n.fill&&(n.fill.opacity=Math.round(100*i.fillOpacity)+"%")},Mt.setInteriors=function(t){this._interiors=t}),t&&((Mt=Et(l=function(){C.call(this),this._viewBox=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._viewBox.setAttribute("zoomAndPan","disable"),this._$container.append(this._viewBox),this._zIndexGroups=[]},C)).add=function(t){C.prototype.add.call(this,t);var e=t.zIndex,i=this._zIndexGroups[e];if(!i){(i=this._zIndexGroups[e]=document.createElementNS("http://www.w3.org/2000/svg","g")).zIndex=e;for(var n=0,o=(s=this._viewBox.childNodes).length;n<o;n++)if(s[n].zIndex>e){this._viewBox.insertBefore(i,s[n]);break}i.parentNode||this._viewBox.appendChild(i)}for(var s,n=0,o=(s=i.childNodes).length;n<o;n++)if(s[n].uid>t.uid)return void i.insertBefore(t,s[n]);i.appendChild(t)},Mt.remove=function(t){var e=this._zIndexGroups[t.zIndex];t.parentNode==e&&(C.prototype.remove.call(this,t),e.removeChild(t))},Mt.update=function(){C.prototype.update.call(this),this._viewBox.setAttribute("viewBox",this._position.x+" "+this._position.y+" "+this._size.x+" "+this._size.y),this._viewBox.setAttribute("width",this._size.x),this._viewBox.setAttribute("height",this._size.y)},(Mt=Et(c=function(){w.call(this),Pt.chrome&&this.styles.outline&&!this.styles.strokeWidth&&(this.styles.outline=0)},w)).update=function(){this._setAttrs(this._getFreshAttrs())},Mt._getFreshAttrs=function(){var t=this.styles;return{fill:t.fill?"#"+t.fillColor:"none",stroke:t.outline?"#"+t.strokeColor:"none","stroke-opacity":t.strokeOpacity,"stroke-width":t.strokeWidth+"px"}},Mt._setAttrs=function(t){for(var e in t)t.hasOwnProperty(e)&&this._htmlElement.setAttribute(e,t[e])},Mt.setZIndex=function(t){M.prototype.setZIndex.call(this,t);var e=this._container,i=this._htmlElement;i.zIndex=t,e&&(e.remove(i),e.add(i))},(Mt=Et(n=function(){c.call(this),this._htmlElement=document.createElementNS("http://www.w3.org/2000/svg","polyline"),this._setAttrs({"stroke-linecap":"round","stroke-linejoin":"round",name:"polyline",zIndex:"2"})},c))._getFreshAttrs=function(){for(var t=c.prototype._getFreshAttrs.call(this),e=0,i=this._geometry.length,n=[];e<i;e++)n.push(this._geometry[e].toString());return t.points=n.join(" "),t},(Mt=Et(s=function(){c.call(this),this._htmlElement=document.createElementNS("http://www.w3.org/2000/svg","path"),this._setAttrs({"stroke-linejoin":"round","fill-rule":"evenodd",name:"polygon",zIndex:"1"})},c))._getFreshAttrs=function(){var t=c.prototype._getFreshAttrs.call(this);t["fill-opacity"]=this.styles.fillOpacity;for(var e=this._geometry,i=0,n=e.length;i<n;i++){for(var o=e[i],s=0,a=o.length,r=[];s<a;s++)r[s]=o[s].toString();e[i]="M "+r.join(" L ")+" Z"}return t.d=e.join(" "),t}),(Mt=Et(T,C)).add=function(t){C.prototype.add.call(this,t),this._$container.append(t)},Mt.remove=function(t){t.parentNode==this._$container[0]&&(C.prototype.remove.call(this,t),this._$container[0].removeChild(t))},(Mt=Et(E,w)).update=function(){if(this._map){for(var t=this._geometry,e=new yt.CollectionBounds(t),i=this.styles,n=1.7*i.strokeWidth+7,o=Math.max(i.strokeWidth/1.2,2),s="",a=0,r=t.length-1;a<r;a++)for(var h=t[a],l=t[a+1],c=h.diff(l),u=Math.sqrt(c.x*c.x+c.y*c.y),c=Math.atan(c.y/c.x),l=h.x<=l.x?1:-1,d=l*n*Math.cos(c),p=l*n*Math.sin(c),_=0,f=u/n,m=e.getLeft(),g=e.getTop(),v=new kt(m,g).moveBy(this._container.getDelta());_<f;_++)s+='<div style="position:absolute;font-size:0px;left:'+(h.x-m+_*d)+"px;top:"+(h.y-g+_*p)+"px;width:"+Math.round(o)+"px;height:"+Math.round(o)+"px;background-color:#"+i.strokeColor+";opacity:"+i.strokeOpacity+";filter:alpha(opacity="+100*i.strokeOpacity+');"></div>';xt.position(this._htmlElement,this._map.converter.mapPixelsToLocalPixels(v).moveBy(new kt(-Math.floor(o/2)))),wt(this._htmlElement).html(s)}},(Mt=Et(L,M)).onAddToMap=function(t){M.prototype.onAddToMap.call(this,t),this._shape&&this._shape.onAddToMap(t)},Mt.onRemoveFromMap=function(){this._shape&&(this._shape.onRemoveFromMap(),this._shape=null),M.prototype.onRemoveFromMap.call(this)},Mt.setGeometry=function(t){this._geometry=t},Mt._createListeners=function(){this._createShapeListeners()},Mt._createShapeListeners=function(){if(this._shape)for(var t in this._shapeListeners=[],this._eventHandlers)this._shapeListeners.push(Dt.observe(this._shape,t,this._eventHandlers[t],this))},Mt._destroyListeners=function(){this._destroyShapeListeners()},Mt._destroyShapeListeners=function(){this._shapeListeners&&(Ot(this._shapeListeners,"cleanup"),this._shapeListeners=null)},Mt.setCursor=function(t){M.prototype.setCursor.call(this,t),this._shape&&this._shape.setCursor(this._cursor)},Mt.setZIndex=function(t){M.prototype.setZIndex.call(this,t),this._shape&&this._shape.setZIndex(this._zIndex)},Mt.update=function(){var t=this._shape;if(this._geometry){for(var e in t||(t=this._shape=new this._shapeClass,this._createShapeListeners()),t.setCursor(this._cursor),t.setZIndex(this._zIndex),this.styles)this.styles.hasOwnProperty(e)&&(t.styles[e]=this.styles[e]);t.setGeometry(this._geometry),t.getMap()||t.onAddToMap(this._map),t.update()}else t&&t.onRemoveFromMap()},Mt._dblClick=function(t,e){Dt.notify(this,this.Events.DblClick,this,e)},Mt._click=function(t,e){Dt.notify(this,this.Events.Click,this,e)},Mt._mouseEnter=function(t,e){Dt.notify(this,this.Events.MouseEnter,this,e)},Mt._mouseLeave=function(t,e){Dt.notify(this,this.Events.MouseLeave,this,e)},Mt._mouseMove=function(t,e){Dt.notify(this,this.Events.MouseMove,this,e)},Mt.destructor=Mt.onRemoveFromMap,(Mt=Et(O,yt.AInteractiveGeoObject)).Events={DblClick:"DblClick",Click:"Click",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove",DragStart:"DragStart",Drag:"Drag",DragEnd:"DragEnd",BalloonOpen:"BalloonOpen",BalloonClose:"BalloonClose",PositionChange:"PositionChange",StartEditing:"StartEditing",StopEditing:"StopEditing",StartDrawing:"StartDrawing",StopDrawing:"StopDrawing",AddToMap:"AddToMap",RemoveFromMap:"RemoveFromMap",Update:"Update"},Mt.getShape=function(){return this._shape},Mt.getMap=function(){return this._map},Mt.onAddToMap=function(t){this._map=t,this._shape.onAddToMap(this._map),this._createShapeListeners(),this._container=m.getContainer(this._containerClass,t),this._eventListeners.push(Dt.observe(this._container,this._container.Events.Update,this.updateGraphics,this)),this._shape.setCursor(this._getActualCursor()),this._shape.setZIndex(this._getCalculatedZIndex()),this._draggable&&this._enableDragger(),this.update(),Dt.notify(this,this.Events.AddToMap,this)},Mt.onRemoveFromMap=function(){this._map&&(this._draggable&&this._disableDragger(),this.stopEditing(),this.closeBalloon(),this._hideHint(0),this._shape.onRemoveFromMap(),this._destroyShapeListeners(),this._map=null,Dt.notify(this,this.Events.RemoveFromMap,this))},Mt._createShapeListeners=function(){this._eventListeners=[Dt.observe(this._shape,this.Events.DblClick,this._onDblClick,this),Dt.observe(this._shape,this.Events.Click,this._onClick,this),Dt.observe(this._shape,this.Events.MouseEnter,this._onMouseEnter,this),Dt.observe(this._shape,this.Events.MouseLeave,this._onMouseLeave,this),Dt.observe(this._shape,this.Events.MouseMove,this._onMouseMove,this)]},Mt._destroyShapeListeners=function(){Ot(this._eventListeners,"cleanup"),this._eventListeners=null},Mt.onMapUpdate=xt.NULL,Mt.update=function(){yt.AInteractiveGeoObject.prototype.update.call(this),this._applyStyle(),this._updateHint(),this._updateBalloon(),this.updateGraphics()},Mt.updateGraphics=function(){this._map&&(this._shape.update(),this._balloonVisible&&this._map.getBalloon().setGeoPoint(this._getBalloonPosition())),Dt.notify(this,this.Events.Update,this)},Mt.getPixelPoints=xt.NULL,Mt._toGeodesicPixels=function(t){for(var e=this._map,i=this._getSegments(wt.map(t,function(t){return e.coordSystem.toCoordPoint(t,1)})),n=[],o=0,s=i.length;o<s;o++)n=n.concat(bt.MathLib.ortho(i[o][0],i[o][1]));return n=wt.map(n,function(t){return e.coordSystem.fromCoordPoint(t)})},Mt._getClippedPixels=xt.NULL,Mt._applyStyle=xt.NULL,Mt.setOptions=function(t,e){yt.AInteractiveGeoObject.prototype.setOptions.call(this,t,e),t=t||{};var i,n=e?{draggable:0,interactive:yt.Interactivity.INTERACTIVE,geodesic:0,cursor:null,zIndex:null}:this.getOptions(),o=0;for(i in t)n[i]=t[i];this._interactive==n.interactive&&this._cursor==n.cursor||(this._interactive=n.interactive,this._cursor=n.cursor,this._shape.setCursor(this._getActualCursor())),this._geodesic!=n.geodesic&&(this._geodesic=n.geodesic,o=1),this._zIndex!=n.zIndex&&(this._zIndex=n.zIndex,this._shape.setZIndex(this._getCalculatedZIndex())),this._draggable!=n.draggable&&((this._draggable=n.draggable)?this._enableDragger():this._disableDragger()),(o=this._setChildOptions(t,e)||o)&&this.updateGraphics()},Mt._setChildOptions=xt.NULL,Mt.getOptions=function(){var t=yt.AInteractiveGeoObject.prototype.getOptions.call(this);return t.interactive=this._interactive,t.geodesic=this._geodesic,t.cursor=this._cursor,t.zIndex=this._zIndex,t.draggable=this._draggable,t.coordRenderer=this._coordRenderer,t},Mt._getActualCursor=function(){return this._interactive!=yt.Interactivity.NONE?this._cursor||"pointer":""},Mt._getCalculatedZIndex=function(){},Mt._enableDragger=function(){this._dragger=new y(this,{dragStart:Lt(this._onDragStart,this),dragMove:Lt(this._onDragMove,this),dragStop:Lt(this._onDragStop,this)})},Mt._disableDragger=function(){this._dragger.destruct()},Mt._onDragStart=function(t){this._forbidHint(),this._mapAutoPanner=new x(this._map),this._mapMoveListener=Dt.observe(this._map,this._map.Events.Move,this._onMapMoveOnDrag,this),this._shape.setCursor(yt.Cursor.GRABBING),this._prevPixels=new yt.MouseEvent(t,this._map).getLocalPixels(),Dt.notify(this,this.Events.DragStart,this)},Mt._onDragMove=function(t){var e=new yt.MouseEvent(t,this._map).getLocalPixels(),t=this._prevPixels.diff(e);this._dragByShift(t),this._prevPixels=e,Dt.notify(this,this.Events.Drag,this,t)},Mt._onMapMoveOnDrag=function(t,e){this._dragByShift(e),Dt.notify(this,this.Events.Drag,this,e)},Mt._dragByShift=function(t){this._pathShift(this.getCoordPath(),t)},Mt._pathShift=function(t,e){for(var i=this._map,n=t.getVertices(),o=0,s=n.length;o<s;o++){var a=n[o].getCoordPoint();a.moveTo(i.converter.localPixelsToCoordinates(i.converter.coordinatesToLocalPixels(a).moveBy(e),1))}t.setVertices(n)},Mt._onDragStop=function(t){this._allowHint(),this._mapAutoPanner.destruct(),this._mapMoveListener.cleanup(),this._shape.setCursor(this._getActualCursor()),Dt.notify(this,this.Events.DragEnd,this)},Mt._fireEvent=function(t,e){this._interactive!=yt.Interactivity.NONE&&(this._interactive==yt.Interactivity.INTERACTIVE&&e.preventMapEvent(),Dt.notify(this,this.Events[t],this,e))},Mt._onDblClick=function(t,e){this._fireEvent("DblClick",e)},Mt._onClick=function(t,e){this._fireEvent("Click",e),this._interactive==yt.Interactivity.INTERACTIVE&&this.getOptions().hasBalloon&&(this._balloonVisible?this.closeBalloon():(this._balloonOpenEvent=e,this.openBalloon()))},Mt._onMouseEnter=function(t,e){this._fireEvent("MouseEnter",e),this._interactive!=yt.Interactivity.INTERACTIVE||this._hintForbidden||this._hintVisible||this._balloonVisible||!this.getOptions().hasHint||(this._map.hint.show(e.getLocalPixels(),this._getHintContentLayout(),this._getComputedHintOptions()),this._hintVisible=1,this._mouseMoveAction(e))},Mt._onMouseLeave=function(t,e){this._fireEvent("MouseLeave",e),this._interactive==yt.Interactivity.INTERACTIVE&&this._hideHint()},Mt._hideHint=function(t){this._hintVisible&&(this._map.hint.hide(t),this._hintVisible=0)},Mt._forbidHint=function(){this._hintForbidden=!0,this._hideHint(0)},Mt._allowHint=function(){this._hintForbidden=!1},Mt._onMouseMove=function(t,e){this._fireEvent("MouseMove",e),this._interactive==yt.Interactivity.INTERACTIVE&&this._mouseMoveAction(e)},Mt._mouseMoveAction=function(t){this._hintVisible&&this._map.hint.moveTo(t.getLocalPixels())},Mt.setHintContent=function(t){yt.AInteractiveGeoObject.prototype.setHintContent.call(this,t),this._updateHint()},Mt.setHintOptions=function(t){yt.AInteractiveGeoObject.prototype.setHintOptions.call(this,t),this._hintVisible&&this._map.hint.setOptions(this._getComputedHintOptions())},Mt._updateHint=function(){this._hintVisible&&(this._map.hint.setOptions(this._getComputedHintOptions()),this._map.hint.setContent(this._getHintContentLayout()))},Mt._updateBalloon=function(){var t;this._balloonVisible&&((t=this._map.getBalloon()).setOptions(this._getComputedBalloonOptions(),1),t.setContent(this._getBalloonContentLayout()))},Mt.openBalloon=function(t,e){yt.AInteractiveGeoObject.prototype.openBalloon.call(this,t,e);e=this._getBalloonPosition(this._balloonOpenEvent);if(this._map&&e){this._hideHint(0);var i,n=this,o={},s=this._getComputedBalloonOptions();for(i in s)o[i]=s[i];o.onClose=function(){s.onClose&&s.onClose(),n._onCloseBalloon()},this._map.openBalloon(e,this._getBalloonContentLayout(),o),this._balloonOpenEvent=null,this._balloonVisible=1,Dt.notify(this,this.Events.BalloonOpen,this)}},Mt._getBalloonPosition=xt.NULL,Mt.closeBalloon=function(){yt.AInteractiveGeoObject.prototype.closeBalloon.call(this),this._balloonVisible&&this._map.closeBalloon()},Mt.setBalloonOptions=function(t){yt.AInteractiveGeoObject.prototype.setBalloonOptions.call(this,t),this._balloonVisible&&this._map.getBalloon().setOptions(this._getComputedBalloonOptions(),1)},Mt._onCloseBalloon=function(){this._firstPointShift=null,this._balloonVisible=0,Dt.notify(this,this.Events.BalloonClose,this)},Mt.getBalloon=function(){return this._balloonVisible?this._map.getBalloon():null},Mt.setBalloonContent=function(t){yt.AInteractiveGeoObject.prototype.setBalloonContent.call(this,t),this._updateBalloon()},Mt._parseColor=function(t){var e=[];return e[0]=t.slice(0,6),t=parseInt("0x"+(t.slice(6,8)||"ff"))/255,isNaN(t)||(e[1]=t),e},Mt.getNumPoints=function(){return this._path.getNumVertices()},Mt.getPoint=function(t){t=this._path.getVertex(t);return t&&t.getCoordPoint()},Mt.getPoints=function(){for(var t=[],e=this._path.getVertices(),i=0,n=e.length;i<n;i++)t[i]=e[i].getCoordPoint().copy();return t},Mt.setPoints=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e[i]=new yt.CoordVertex(t[i]);this._path.setVertices(e)},Mt.addPoint=function(t,e){t instanceof Array||(t=[t]),e=typeof e!=Tt?e:this._path.getNumVertices();for(var i=0,n=t.length;i<n;i++)t[i]=new yt.CoordVertex(t[i]);this._path.spliceVertices.apply(this._path,[e,0].concat(t))},Mt.removePoint=function(t){t=this._path.spliceVertices(t,1);return t[0]&&t[0].getCoordPoint()},Mt.splicePoints=function(t,e){for(var i=[t,e],n=2,o=arguments.length;n<o;n++)i[n]=new yt.CoordVertex(arguments[n]);for(var s=this._path.spliceVertices.apply(this._path,i),n=0,o=s.length;n<o;n++)s[n]=s[n].getCoordPoint();return s},Mt.getCoordPath=function(){return this._path},Mt._onPathPointsChange=function(){this._pathChangeTimeId||(this._pathChangeTimeId=setTimeout(Lt(function(){this._pathChangeTimeId=null,Dt.notify(this,this.Events.PositionChange,this)},this),1)),this.updateGraphics()},Mt.startEditing=xt.NULL,Mt.stopEditing=function(){var t;this._editor&&(t=this._editor,this._editor=null,t.stopEditing(),this._draggable&&this._enableDragger())},Mt.setEditingOptions=function(t){t&&(this._editor&&this._editor.setOptions(t),this._editorOptions=wt.extend(this._editorOptions,t))},Mt.getEditingOptions=function(){return this._editor?this._editor.getOptions():this._editorOptions},Mt.isEditing=function(){return!!this._editor},Mt.isDrawing=function(){return!(!this._editor||!this._editor.getOptions().drawing)},Mt._coordsToVertices=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e[i]=new yt.CoordVertex(t[i],0);return e},Ct=yt.Polyline=function(t,e){O.call(this,e),this._shape=new L(n),(t=t||new _)instanceof Array&&(t=new _(this._coordsToVertices(t))),this._path=t,this._path.addChangeCallback(this._onPathPointsChange,this),this._coordRenderer=e&&e.coordRenderer||new yt.PolylineCoordRenderer},Mt=Et(Ct,O),Ct.fromEncodedPoints=function(t,e,i,n){var o=vt.decodePoints(t,n||Bt),s=[],a=[];e&&(s=vt.decodeLevels(e));for(var r=0;r<o.length;r++)a[r]=new yt.CoordVertex(o[r],s[r]);return new yt.Polyline(new _(a),i)},Mt._setChildOptions=function(t,e){e=t.coordRenderer||e?new yt.PolylineCoordRenderer:this._coordRenderer;return this._coordRenderer!=e?(this._coordRenderer=e,1):0},Mt.updateGraphics=function(){var e,t;this._map&&(e=this._map,t=this._getClippedPixels(wt.map(this.getPixelPoints(),function(t){return e.converter.coordinatesToMapPixels(e.coordSystem.toCoordPoint(t,1))}),this._container.getPosition(),this._container.getSize()),this._shape.setGeometry(t.length?t:null)),O.prototype.updateGraphics.call(this)},Mt.getPixelPoints=function(t){if(this._map){var e=typeof(t=t||{}).geodesic==Tt?this._geodesic:t.geodesic,t=typeof t.zoom==Tt?this._map.getZoom():t.zoom,i=this._path,t=this._coordRenderer.renderCoords(wt.map(i.getIndexesByZoom(t),function(t){return i.getVertex(t).getCoordPoint()}),this._map);return t=e?this._toGeodesicPixels(t):t}},Mt.startEditing=function(){this._editor||(this._draggable&&this._disableDragger(),this._editor=new ft(this,this._editorOptions))},Mt._applyStyle=function(){var t=this.getComputedStyle(),e={};if(t)for(var i in e.strokeWidth=Number(t.lineStyle.strokeWidth),t=this._parseColor(t.lineStyle.strokeColor),e.strokeColor=t[0],e.strokeOpacity=t[1],e.fill=0,e.outline=1,e)e.hasOwnProperty(i)&&(this._shape.styles[i]=e[i])},Mt.getClosestPoint=function(t){t=r(this.getPixelPoints(),this._map.coordSystem.fromCoordPoint(t));return t&&(t.point=this._map.coordSystem.toCoordPoint(t.point,1),t.index=this._path.getIndexesByZoom(this._map.getZoom())[t.index]),t},Mt._getBalloonPosition=function(t){var e=this.getPixelPoints();if(!e.length)return null;var i=this._map.coordSystem.toCoordPoint(e[0],1),e=t?t.getCoordPoint(1):this._firstPointShift?i.copy().moveBy(this._firstPointShift):this._map.coordSystem.toCoordPoint(new yt.CollectionBounds(e).getCenter(),1),e=this.getClosestPoint(e).point;return this._firstPointShift=i.diff(e),e},Mt._getClippedPixels=function(t,e,i){for(var n=[],o=[e,e.copy().moveBy(i)],s=0,a=t.length-1;s<a;s++){var r=t[s],h=t[s+1],r=gt.getIntersection(r,h,o);r.intersection&&(n.push(r.from),r.to.equals(h)&&s!=a-1||n.push(r.to))}return n},Mt._getSegments=function(t){for(var e=[],i=1,n=t.length;i<n;i++)e.push([t[i-1],t[i]]);return e},Mt._getCalculatedZIndex=function(){return null===this._zIndex?yt.ZIndex.POLYLINE:this._zIndex},Ct=yt.PaintPolyline=function(t,e){(e=e||{}).interactive=e.interactive||yt.Interactivity.NONE,yt.Polyline.call(this,t,e),this._containerClass=T,this._shape=new E},Mt=Et(Ct,yt.Polyline),t=yt.PolygonPoints=bt.PolygonPoints=function(){_.call(this)},(Mt=Et(t,_)).setEncodedPoints=function(t,e,i){var n=vt.decodePoints(t,i||Bt);e=vt.decodeLevels(e);for(var o=0;o<n.length;o++)n[o]=new yt.CoordVertex(n[o],e[o]);this.setVertices(n)},Mt.getPoints=function(){for(var t=[],e=0;e<this._vertices.length;e++)t[e]=this._vertices[e].getCoordPoint();return t},Ct=yt.Polygon=function(t,e){O.call(this,e),this._shape=new L(s),(t=t||new _)instanceof Array&&(t=new _(this._coordsToVertices(t))),this._path=t,this._path.addChangeCallback(this._onPathPointsChange,this),e=e||{},this._interiors=[],e.interiors&&e.interiors.length&&(this._interiors=this._castInteriorsOption(e.interiors),this._addPathCallbacks(this._interiors)),this._coordRenderer=e.coordRenderer||new yt.PolygonCoordRenderer},(Mt=Et(Ct,O))._castInteriorsOption=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var o=t[i];o instanceof Array&&(o=new _(this._coordsToVertices(o))),e[i]=o}return e},Mt._addPathCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].addChangeCallback(this._onPathPointsChange,this)},Mt._removePathCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].removeChangeCallback(this._onPathPointsChange,this)},Ct.fromEncodedPoints=function(t,e,i,n){for(var o=t.split(";"),s=e.split(";"),a=[],r=0,h=o.length;r<h;r++){var l=vt.decodePoints(o[r],n||Bt),c=[],u=[];s[r]&&(c=vt.decodeLevels(s[r]));for(var d=0,p=l.length;d<p;d++)u[d]=new yt.CoordVertex(l[d],c[d]);a.push(new _(u))}return new yt.Polygon(a.shift(),wt.extend({},i,{interiors:a}))},Mt._setChildOptions=function(t,e){var i=0,e=t.coordRenderer||e?new yt.PolygonCoordRenderer:this._coordRenderer;return this._coordRenderer!=e&&(this._coordRenderer=e,i=1),t.interiors&&(this._removePathCallbacks(this._interiors),this._interiors=t.interiors&&this._castInteriorsOption(t.interiors),this._addPathCallbacks(this._interiors),i=1,Dt.notify(this,this.Events.PositionChange,this)),i},Mt.getOptions=function(){var t=O.prototype.getOptions.call(this);return t.interiors=this._interiors.slice(0),t},Mt.updateGraphics=function(){if(this._map){for(var t=this.getPixelPoints(),e=[],i=0,n=t.length;i<n;i++){for(var o=t[i],s=0,a=o.length;s<a;s++){var r=o[s];o[s]=this._map.converter.coordinatesToMapPixels(this._map.coordSystem.toCoordPoint(r,1))}var h=this._getClippedPixels(o,this._container.getPosition(),this._container.getSize());h.length&&e.push(h)}this._shape.setGeometry(e.length?e:null)}O.prototype.updateGraphics.call(this)},Mt.getPixelPoints=function(t){if(this._map){for(var e=typeof(t=t||{}).geodesic==Tt?this._geodesic:t.geodesic,i=typeof t.zoom==Tt?this._map.getZoom():t.zoom,n=[this._path].concat(this._interiors),o=0,s=n.length;o<s;o++){var a=n[o];n[o]=wt.map(a.getIndexesByZoom(i),function(t){return a.getVertex(t).getCoordPoint()})}var r=this._coordRenderer.renderCoords(n,this._map);if(e)for(o=0,s=r.length;o<s;o++)r[o]=this._toGeodesicPixels(r[o]);return r}},Mt._dragByShift=function(t){O.prototype._dragByShift.call(this,t);for(var e=0,i=this._interiors.length;e<i;e++)this._pathShift(this._interiors[e],t)},Mt.startEditing=function(){this._editor||(this._draggable&&this._disableDragger(),this._editor=new mt(this,this._editorOptions))},Mt._applyStyle=function(){var t,e=this.getComputedStyle(),i={};if(e)for(var n in i.strokeWidth=Number(e.polygonStyle.strokeWidth),t=this._parseColor(e.polygonStyle.strokeColor),i.strokeColor=t[0],i.strokeOpacity=t[1],t=this._parseColor(e.polygonStyle.fillColor),i.fillColor=t[0],i.fillOpacity=t[1],i.fill=!!e.polygonStyle.fill,i.outline=!!e.polygonStyle.outline,i)i.hasOwnProperty(n)&&(this._shape.styles[n]=i[n])},Mt.getClosestPoint=function(t){for(var e=this.getPixelPoints(),i=1/0,n=null,o=0,s=e.length;o<s;o++){var a=e[o];a.length&&a.push(a[0]);a=r(a,this._map.coordSystem.fromCoordPoint(t));a&&a.distance<i&&(i=a.distance,n=a)}return n&&(n.point=this._map.coordSystem.toCoordPoint(n.point,1),n.index=this._path.getIndexesByZoom(this._map.getZoom())[n.index]),n},Mt.contains=function(t){return o(this.getPixelPoints(),this._map.coordSystem.fromCoordPoint(t),0)},Mt._getBalloonPosition=function(t){for(var e,i,n=this.getPixelPoints(),o=[],s=null,a=0,r=n.length;a<r;a++)o=o.concat(n[a]);return o.length&&(e=new yt.CollectionBounds(o),s=t?t.getCoordPoint(1):this._balloonPosCoef?this._map.coordSystem.toCoordPoint(e.getLeftBottom().moveBy(e.getSpan().scale(this._balloonPosCoef)),1):(i=new kt(0,0),wt.each(o,function(t,e){i.moveBy(e)}),this._map.coordSystem.toCoordPoint(i.scale(1/o.length),1)),this.contains(s)||(s=this.getClosestPoint(s).point),this._balloonPosCoef=e.getSpan().apply(function(t){return Math.pow(t,-1)}).scale(e.getLeftBottom().diff(this._map.coordSystem.fromCoordPoint(s)))),s},Mt._getClippedPixels=function(t,e,i){for(var n=new yt.CollectionBounds([e,e.copy().moveBy(i)]),o=0;o<4;o++){for(var s,a=[new kt(0==o?n.getLeft():-1/0,3==o?n.getBottom():-1/0),new kt(2==o?n.getRight():1/0,1==o?n.getTop():1/0)],r=[],h=0,l=t.length;h<l;h++){var c=t[h+1==l?0:h+1],u=gt.getIntersection(t[h],c,a);u.intersection&&(r.push(u.from),(s=u.to).equals(c)||r.push(s))}t=r,s=null}return t},Mt._getSegments=function(t){for(var e=[],i=1,n=t.length;i<=n;i++)e.push([t[i-1],i==n?t[0]:t[i]]);return e},Mt._getCalculatedZIndex=function(){return null===this._zIndex?yt.ZIndex.POLYGON:this._zIndex},(Mt=I.prototype).Events={Destruct:"Destruct"},Mt.updateStructure=function(t){this.updateVertexModels(t),this.updateEdgeModels()},Mt.getGraphicsModel=function(){return this._parentModel},Mt.getCoordPath=function(){return this._coordPath},Mt.getVertexModels=function(){return this._vertexModels},Mt.getEdgeModels=function(){return this._edgeModels},Mt.getEdgeCoord=function(t){var e,i=t.prev.getPoint(),n=t.next.getPoint(),o=this._map.coordSystem;this._graphicsObject.getOptions().geodesic&&(i=(e=bt.MathLib.ortho(i,n))[t=Math.floor((e.length-1)/2)],n=e[t+1]);i=o.fromCoordPoint(i);return o.toCoordPoint(i.moveBy(i.diff(o.fromCoordPoint(n)).scale(.5)),1)},Mt.getVertexCoord=function(t){return this._map.coordSystem.toCoordPoint(t.pixels,1)},Mt.updateVertexModels=function(t){for(var e=this._map.getZoom(),i=this._coordPath.getIndexesByZoom(e),n=[],o=0,s=i.length;o<s;o++){for(var a=null,r=this._coordPath.getVertex(i[o]),h=r.getCoordPoint(),l=0,c=this._vertexModels.length;l<c;l++)if(this._vertexModels[l].originalPoint==h){a=this._vertexModels.splice(l,1)[0];break}a?a.prev=a.next=null:a=new D(r,this,{originalPoint:h}),wt.extend(a,{pixels:t[o],index:i[o]});r=n[o-1];r&&((r.next=a).prev=r),n.push(a)}this._vertexModels=n},Mt.updateEdgeModels=function(){for(var t=[],e=0,i=this._vertexModels.length;e<i;e++){var n=null,o=this._vertexModels[e],s=o.next;if(s){for(var a=0,r=this._edgeModels.length;a<r;a++){var h=this._edgeModels[a];if(h.nextOriginalPoint==s.originalPoint&&h.prevOriginalPoint==o.originalPoint){n=this._edgeModels.splice(a,1)[0];break}}(n=n||new R(this,{nextOriginalPoint:s.originalPoint,prevOriginalPoint:o.originalPoint})).next=s,n.prev=o,t.push(n)}}this._edgeModels=t},Mt.insertVertex=function(t,e){var i=this._vertexModels[e],n=this._vertexModels[e-1],o=null,s=null;n?(o=n.index,s=n.next?n.next.index:null,e=n.index+1):i&&(o=i.prev?i.prev.index:null,s=i.index,e=i.index);s=this._excludeLowZoomVertices(o,s);s.splice(e,0,t),this._coordPath.setVertices(this._collapseArray(s))},Mt.removeVertex=function(t){var e=this._excludeLowZoomVertices(t.prev?t.prev.index:null,t.next?t.next.index:null);e.splice(t.index,1),this._coordPath.setVertices(this._collapseArray(e))},Mt.setVertexCoordPoint=function(t,e){var i=this._excludeLowZoomVertices(t.prev?t.prev.index:null,t.next?t.next.index:null);t.getVertex().getCoordPoint().moveTo(e),this._coordPath.setVertices(this._collapseArray(i))},Mt._collapseArray=function(t){for(var e=0,i=t.length,n=[];e<i;e++)typeof t[e]!=Tt&&n.push(t[e]);return n},Mt._excludeLowZoomVertices=function(t,e){for(var i=this._coordPath.getVertices(),n=[],o=0,s=i.length;o<s;o++){var a=i[o];(null!=t&&(t<e&&t<o&&o<e||e<t&&(t<o||o<e))||null==t&&o<e||null==e&&t<o)&&a.getVisibilityZoom()>this._map.getZoom()&&-1==wt.inArray(a.getCoordPoint(),this._editor.getOptions().lockedPoints)||(n[o]=a)}return n},Mt.destruct=function(){Dt.notify(this,this.Events.Destruct,this),this._coordPath=this._parentModel=this._editor=null},(Mt=Et(A,I)).updateVertexModels=function(t){I.prototype.updateVertexModels.call(this,t);var e=this._vertexModels.length,i=this._vertexModels[e-1],t=this._vertexModels[0];e&&((i.next=t).prev=i)},Mt.removeCoordPath=function(){this._parentModel.removeCoordPath(this)},(Mt=k.prototype).Events={Update:"Update"},Mt.update=function(){this._updateStructure(),Dt.notify(this,this.Events.Update,this)},Mt._updateStructure=function(){for(var t=[this._graphicsObject.getCoordPath()].concat(this._graphicsObject.getOptions().interiors),e=this._graphicsObject.getPixelPoints({geodesic:0}),i=[],n=0,o=t.length;n<o;n++){for(var s=null,a=0,r=this._pathModels.length;a<r;a++)if(this._pathModels[a].getCoordPath()==t[n]){s=this._pathModels.splice(a,1)[0];break}s?s.updateStructure(e[n]):s=new A(t[n],e[n],this,this._editor),i.push(s)}Ot(this._pathModels,"destruct"),this._pathModels=i},Mt.getGraphicsObject=function(){return this._graphicsObject},Mt.getCoordPathModels=function(){return this._pathModels},Mt.removeCoordPath=function(t){var e=t.getCoordPath();this._graphicsObject.getCoordPath()!=e&&(t=this._graphicsObject.getOptions().interiors,-1!=(e=wt.inArray(e,t))&&(t.splice(e,1),this._graphicsObject.setOptions({interiors:t})))},Mt.getCoordPathModelByCoordPath=function(t){for(var e=0,i=this._pathModels.length;e<i;e++){var n=this._pathModels[e];if(n.getCoordPath()==t)return n}},Mt.getPointsNum=function(){for(var t=0,e=[this._graphicsObject.getCoordPath()].concat(this._graphicsObject.getOptions().interiors),i=0,n=e.length;i<n;i++)t+=e[i].getIndexesByZoom(this._graphicsObject.getMap().getZoom()).length;return t},Mt.destruct=function(){this._graphicsListener.cleanup(),Ot(this._pathModels,"destruct")},(Mt=B.prototype).Events={Update:"Update"},Mt.update=function(){this._pathModel.updateStructure(this._graphicsObject.getPixelPoints({geodesic:0})),Dt.notify(this,this.Events.Update,this)},Mt.getGraphicsObject=function(){return this._graphicsObject},Mt.getCoordPathModel=function(){return this._pathModel},Mt.getPointsNum=function(){return this._graphicsObject.getCoordPath().getIndexesByZoom(this._graphicsObject.getMap().getZoom()).length},Mt.destruct=function(){this._graphicsListener.cleanup(),this._pathModel.destruct()};var D=function(t,e,i){this._vertex=t,this._parentModel=e,wt.extend(this,i)};(Mt=D.prototype).getCoordPathModel=function(){return this._parentModel},Mt.getVertex=function(){return this._vertex},Mt.getPoint=function(){return this._parentModel.getVertexCoord(this)},Mt.setVertexCoordPoint=function(t){this._parentModel.setVertexCoordPoint(this,t)},Mt.removeVertex=function(){this._parentModel.removeVertex(this)};var R=function(t,e){this._parentModel=t,wt.extend(this,e)};function Y(t,e,i,n){this._model=t,this._view=e,this._graphicsObject=i,this._editor=n,this._map=i.getMap(),this._editLines=new rt(this._map,this.createStyleForLines()),this._listeners=[Dt.observe(n,n.Events.OptionsChange,this._onOptionsChange,this),Dt.observe(t,t.Events.Update,this._hideContextMenu,this)],(n=n.getOptions()).drawing&&this._enableDrawing(),n.dragging&&this._enableDragging()}function N(t,e,i,n){Y.call(this,t,e,i,n)}function j(t,e,i,n){Y.call(this,t,e,i,n)}(Mt=R.prototype).getPoint=function(){return this._parentModel.getEdgeCoord(this)},(Mt=Y.prototype)._onOptionsChange=function(t,e){"drawing"in e&&(e.drawing?this._enableDrawing():this._disableDrawing()),"dragging"in e&&(e.dragging?this._enableDragging():this._disableDragging()),this._hideContextMenu()},Mt._hideContextMenu=function(){var t=J.get(this._map);t.isVisible()&&t.hide()},Mt._enableDrawing=function(){this._model.getPointsNum()<this._editor.getOptions().maxPoints?(this._drawingControl=this._createDrawingControl(),this._vertexAddListener=Dt.observe(this._drawingControl,this._drawingControl.Events.VertexDraw,this._onVertexAdd,this)):this._editor.setOptions({drawing:0})},Mt._createDrawingControl=xt.NULL,Mt._onVertexAdd=function(){this._lastVertexAddDate=new Date},Mt._disableDrawing=function(){this._drawingControl&&(this._vertexAddListener.cleanup(),this._drawingControl.destruct(),this._drawingControl=null)},Mt._enableDragging=xt.NULL,Mt._disableDragging=function(){this._draggingControl.destruct(),this._draggingControl=null},Mt.getGlassPane=function(){return this._glassPane||(this._glassPane=new b(yt.ZIndex.EDITOR_GLASS_PANE)),this._glassPane},Mt.getVertexHandlers=function(){return{Click:Lt(this._onVertexClick,this),DblClick:Lt(this._onVertexDblClick,this),DragStart:Lt(this._onVertexDragStart,this),Drag:Lt(this._onVertexDrag,this),DragEnd:Lt(this._onVertexDragEnd,this)}},Mt._onVertexDblClick=function(t){var e;(!this._lastVertexAddDate||new Date-this._lastVertexAddDate>z.DBLCLICKTIME)&&(e=t.metaDataProperty.rec,(t=this._editor.getOptions()).onDblClick?t.onDblClick(this._graphicsObject,e.index,e.getCoordPathModel().getCoordPath()):-1==wt.inArray(e.originalPoint,t.lockedPoints)&&e.removeVertex())},Mt._onVertexDragStart=function(t){var e=t.metaDataProperty.rec,t=this._onPointDragging(e.getCoordPathModel(),t.getCoordPoint(),e.index,1,0);t&&this._editLines.setCoords(t,this._getLinePoints(e))},Mt._onVertexDrag=function(t){var e=t.metaDataProperty.rec,t=this._onPointDragging(e.getCoordPathModel(),t.getCoordPoint(),e.index,1,0);t&&this._editLines.setCoords(t,this._getLinePoints(e))},Mt._onVertexDragEnd=function(t){var e=t.metaDataProperty.rec,t=this._onPointDragging(e.getCoordPathModel(),t.getCoordPoint(),e.index,1,1);this._editLines.hide(),t?e.setVertexCoordPoint(t):this._view.update()},Mt._onVertexClick=function(t){var e=J.get(this._map);e.setOwner(t),e.isVisible()||(this._menuContent&&this._menuContent.destruct(),this._menuContent=this._getVertexMenuContent(t.metaDataProperty.rec),null!=this._menuContent&&(e.setContent(this._menuContent.getContainer()),e.show()))},Mt._getVertexMenuContent=function(t){for(var e=this._getVertexMenuItems(t),i=null,n=0,o=e.length;n<o;n++)(i=i||new nt).addItem(this._buildMenuItem(t,e[n]));return i},Mt._getVertexMenuItems=function(t){var e=this._getNativeMenuItems(t),i=this._editor.getOptions();return e=i.menuManager?i.menuManager(t.index,e,t.getCoordPathModel().getCoordPath()):e},Mt._getNativeMenuItems=function(t){var e=[],i=this._editor,n=i.getOptions();return-1==wt.inArray(t.originalPoint,n.lockedPoints)&&e.push({id:yt.GraphicsEditingMenuIDs.Delete,title:At.hints.graphicsEditor.deleteVertex,onClick:function(){t.removeVertex()}}),n.drawing&&e.push({id:yt.GraphicsEditingMenuIDs.StopDrawing,title:At.hints.graphicsEditor.stopDrawing,onClick:function(){i.setOptions({drawing:0})}}),e},Mt._buildMenuItem=function(e,i){var t=wt('<span style="white-space: nowrap;cursor: '+yt.Cursor.POINTER+';">'+i.title+"</span><br />"),n=It(t[0]).events.eventListener();return i.hint&&(t[0].title=i.hint),i.onClick&&n.add("click",function(t){new yt.MouseEvent(t,this._map).preventMapEvent(),i.onClick.call(this._graphicsObject,this._graphicsObject,e.index,e.getCoordPathModel().getCoordPath())},this),n.add("mouseenter",function(){t.css("color","#ff0000")}),n.add("mouseleave",function(){t.css("color","")}),t.data("eventListener",n),t},Mt.getEdgeHandlers=function(){return{DragStart:Lt(this._onEdgeDragStart,this),Drag:Lt(this._onEdgeDrag,this),DragEnd:Lt(this._onEdgeDragEnd,this)}},Mt._onEdgeDragStart=function(t){var e=t.metaDataProperty.rec,i=e.prev,i=this._onPointDragging(i.getCoordPathModel(),t.getCoordPoint(),i.index+1,0,0);i&&this._editLines.setCoords(i,this._getLinePoints(e))},Mt._onEdgeDrag=function(t){var e=t.metaDataProperty.rec,i=e.prev,i=this._onPointDragging(i.getCoordPathModel(),t.getCoordPoint(),i.index+1,0,0);i&&this._editLines.setCoords(i,this._getLinePoints(e))},Mt._onEdgeDragEnd=function(t){var e=t.metaDataProperty.rec.prev,i=e.getCoordPathModel(),t=this._onPointDragging(i,t.getCoordPoint(),e.index+1,0,1);this._editLines.hide(),t?i.insertVertex(new yt.CoordVertex(this._map.coordSystem.getCoordPoint(t.getX(),t.getY()),this._editor.getOptions().visibilityZoomForNewPoints),wt.inArray(e,i.getVertexModels())+1):this._view.update()},Mt._onPointDragging=function(t,e,i,n,o){var s,a=this._editor.getOptions().onPointDragging;return a&&(s=this._map,t=wt.map(t.getVertexModels(),function(t){return t.pixels}),(t=wt.map(t,function(t){return s.converter.coordinatesToMapPixels(s.coordSystem.toCoordPoint(t,1))})).splice(i,n?1:0,s.converter.coordinatesToMapPixels(e)),e=(e=a(t,i,o))&&s.converter.mapPixelsToCoordinates(e,1)),e},Mt._getLinePoints=function(t){return wt.map([t.next,t.prev],function(t){return t?t.getPoint():null})},Mt.destruct=function(){this._editLines.destruct(),Ot(this._listeners,"cleanup"),this._drawingControl&&this._drawingControl.destruct(),this._draggingControl&&this._draggingControl.destruct()},(Mt=Et(N,Y))._createDrawingControl=function(){return new H(this._model.getCoordPathModel(),this._model,this._graphicsObject,this,this._map,this._editor)},Mt._enableDragging=function(){this._draggingControl=new F(this,this._graphicsObject,this._map,this._editor)},Mt.createStyleForLines=function(){return this._graphicsObject.getComputedStyle()},Mt._getNativeMenuItems=function(t){var e=Y.prototype._getNativeMenuItems.call(this,t),i=this._editor.getOptions(),n=t.getCoordPathModel().getVertexModels(),o=t==n[0],n=t==n[n.length-1];return this._model.getPointsNum()<i.maxPoints&&(i.drawing&&(i.fromStart?n:o)||!i.drawing&&(n||o))&&e.push({id:yt.GraphicsEditingMenuIDs.StartDrawing,title:At.hints.graphicsEditor.startDrawing,onClick:Lt(function(){this._editor.setOptions({fromStart:o?1:0,drawing:1})},this)}),e},(Mt=Et(j,Y))._onOptionsChange=function(t,e){Y.prototype._onOptionsChange.call(this,t,e),"fromIndex"in e&&this._rearrangeCoordPathByIndex(t.getOptions().drawingCoordPath,e.fromIndex)},Mt._createDrawingControl=function(){return new Z(this._model.getCoordPathModelByCoordPath(this._editor.getOptions().drawingCoordPath),this._model,this._graphicsObject,this,this._map,this._editor)},Mt._enableDragging=function(){this._draggingControl=new $(this,this._graphicsObject,this._map,this._editor)},Mt.createStyleForLines=function(){var t=yt.Style.copy(this._graphicsObject.getComputedStyle()),e=t.lineStyle,i=t.polygonStyle;return e.strokeColor=i.strokeColor,e.strokeWidth=i.strokeWidth,t},Mt._getNativeMenuItems=function(t){var e=Y.prototype._getNativeMenuItems.call(this,t),i=this._editor.getOptions(),n=t.getCoordPathModel(),o=n.getCoordPath();!(this._model.getPointsNum()<i.maxPoints)||i.drawing&&i.drawingCoordPath==o&&this._isLastVertexInCoordPath(n,t)||e.push({id:yt.GraphicsEditingMenuIDs.StartDrawing,title:At.hints.graphicsEditor.startDrawing,onClick:Lt(function(){this._editor.setOptions({fromIndex:t.index,drawingCoordPath:o,drawing:1})},this)});var s=this._graphicsObject.getCoordPath();return o==s||this._isLockedPointsInCoordPath(o)||e.push({id:yt.GraphicsEditingMenuIDs.RemoveInterior,title:At.hints.graphicsEditor.removeInterior,onClick:Lt(function(){i.drawingCoordPath==o&&this._editor.setOptions({drawingCoordPath:s,drawing:0}),n.removeCoordPath()},this)}),this._model.getPointsNum()<i.maxPoints&&i.drawNewInteriors&&e.push({id:yt.GraphicsEditingMenuIDs.AddInterior,title:At.hints.graphicsEditor.addInterior,onClick:Lt(function(){var t=new yt.CoordPath,e=this._graphicsObject.getOptions().interiors;e.push(t),this._graphicsObject.setOptions({interiors:e}),this._editor.setOptions({drawingCoordPath:t,drawing:1})},this)}),e},Mt._isLastVertexInCoordPath=function(t,e){t=t.getVertexModels();return t[t.length-1]==e},Mt._isLockedPointsInCoordPath=function(t){for(var e=t.getVertices(),i=0,n=e.length;i<n;i++)if(-1!=wt.inArray(e[i].getCoordPoint(),this._editor.getOptions().lockedPoints))return 1},Mt._rearrangeCoordPathByIndex=function(t,e){var i=t.getVertices(),n=t.getNumVertices()-e,n=i.splice(e+1,n);n.length&&(i.splice.apply(i,[0,0].concat(n)),t.setVertices(i))};var z=function(t,e,i,n,o,s){this._coordPathModel=t,this._model=e,this._graphicsObject=i,this._controller=n,this._map=o,this._editor=s,Dt.notify(z,"DrawingStart"),this._lines=new rt(this._map,n.createStyleForLines());n=this._editor.getOptions();this._glassPane=this._createGlassPane(n.drawOver),this._map.addOverlay(this._glassPane,1),this._drawingTool=new dt(this._glassPane,n.drawingCursor,this._map,Lt(this._drawVertex,this),Lt(this._showLines,this),Lt(this._hideLines,this)),this._listeners=[Dt.observe(z,"DrawingStart",this._onDrawingStart,this),Dt.observe(s,s.Events.OptionsChange,this._onOptionsChange,this),Dt.observe(e,e.Events.Update,this._onModelUpdate,this),Dt.observe(o,o.Events.BeforeDblClick,this._stopDrawingByDblClick,this)],Dt.notify(i,i.Events.StartDrawing,i)};Mt=z.prototype,z.DBLCLICKTIME=250,Mt.Events={GlassPaneChange:"GlassPaneChange",VertexDraw:"VertexDraw"},Mt._onDrawingStart=function(){this._editor.setOptions({drawing:0})},Mt._onOptionsChange=function(t,e){"maxPoints"in e&&this._maxPointsCheck(),"drawingCursor"in e&&this._drawingTool.setCursor(e.drawingCursor),"drawOver"in e&&(this._map.removeOverlay(this._glassPane),this._glassPane=this._createGlassPane(e.drawOver),this._map.addOverlay(this._glassPane,1),this._drawingTool.setGlassPane(this._glassPane),Dt.notify(this,this.Events.GlassPaneChange,this))},Mt._onModelUpdate=function(){this._hideLines(),this._lines.setStyle(this._controller.createStyleForLines()),this._maxPointsCheck()},Mt._maxPointsCheck=function(){this._model.getPointsNum()>=this._editor.getOptions().maxPoints&&this._editor.setOptions({drawing:0})},Mt._createGlassPane=function(t){return t?this._controller.getGlassPane():new pt},Mt._showLines=function(t){t=this._onPointDrawing(t.getCoordPoint(1),0);t&&this._lines.setCoords(t,this._getLineEndPoints())},Mt._hideLines=function(){this._lines.hide()},Mt._onPointDrawing=function(t,e){var i,n,o,s=this._editor.getOptions().onPointDrawing;return s&&(i=this._map,n=this._getDrawPointIndex(),o=wt.map(this._coordPathModel.getVertexModels(),function(t){return t.pixels}),(o=wt.map(o,function(t){return i.converter.coordinatesToMapPixels(i.coordSystem.toCoordPoint(t,1))})).splice(n,0,i.converter.coordinatesToMapPixels(t)),t=(t=s(o,n,e))&&i.converter.mapPixelsToCoordinates(t,1)),t},Mt._drawVertex=function(t){t=this._onPointDrawing(t.getGeoPoint(),1);t&&this._coordPathModel.insertVertex(new yt.CoordVertex(this._map.coordSystem.getCoordPoint(t.getX(),t.getY()),this._editor.getOptions().visibilityZoomForNewPoints),this._getDrawPointIndex()),this._lastAddDate=new Date,Dt.notify(this,this.Events.VertexDraw,this)},Mt._stopDrawingByDblClick=function(t,e){this._editor.getOptions().stopDrawingByDblClick&&this._lastAddDate&&new Date-this._lastAddDate<z.DBLCLICKTIME&&(e.isMapEventPrevented()||e.preventMapEvent(),this._editor.setOptions({drawing:0}))},Mt.destruct=function(){Ot(this._listeners,"cleanup"),this._drawingTool.destruct(),this._map.removeOverlay(this._glassPane),this._lines.destruct(),Dt.notify(this._graphicsObject,this._graphicsObject.Events.StopDrawing,this._graphicsObject)};var H=function(t,e,i,n,o,s){z.call(this,t,e,i,n,o,s)};(Mt=Et(H,z))._getDrawPointIndex=function(){return this._editor.getOptions().fromStart?0:this._coordPathModel.getVertexModels().length},Mt._getLineEndPoints=function(){var t=this._coordPathModel.getVertexModels(),t=t[this._editor.getOptions().fromStart?0:t.length-1];return t?[t.getPoint()]:[]};var Z=function(t,e,i,n,o,s){z.call(this,t,e,i,n,o,s),this._createCoordPathListener()};function U(t,e,i,n){this._controller=t,this._graphicsObject=e,this._map=i,this._editor=n,t=this._glassPane=t.getGlassPane(),this._glassPaneListeners=Dt.observe(t,[t.Events.AddToMap,t.Events.RemoveFromMap],this._rebuildDraggableObject,this),this._draggingTool=new ct(this._draggableObject=this._createDraggableObject(),n.getOptions().draggingCursor,i,Lt(this._dragGraphicsObject,this)),this._optionsChangeListener=Dt.observe(n,n.Events.OptionsChange,this._onOptionsChange,this)}(Mt=Et(Z,z))._onOptionsChange=function(t,e){z.prototype._onOptionsChange.call(this,t,e),"drawingCoordPath"in e&&(this._coordPathListener.cleanup(),this._coordPathModel=this._model.getCoordPathModelByCoordPath(e.drawingCoordPath),this._createCoordPathListener())},Mt._createCoordPathListener=function(){this._coordPathListener=Dt.observe(this._coordPathModel,this._coordPathModel.Events.Destruct,this._stopDrawing,this)},Mt._stopDrawing=function(){this._editor.setOptions({drawingCoordPath:this._graphicsObject.getCoordPath(),drawing:0})},Mt._getDrawPointIndex=function(){return this._coordPathModel.getVertexModels().length},Mt._getLineEndPoints=function(){var t=this._coordPathModel.getVertexModels(),t=t[t.length-1];return t?[t.getPoint(),t.next.getPoint()]:[]},Mt.destruct=function(){this._coordPathListener.cleanup(),z.prototype.destruct.call(this)},(Mt=U.prototype)._rebuildDraggableObject=function(){this._draggableObject.destruct(),this._draggingTool.setDraggableObject(this._draggableObject=this._createDraggableObject())},Mt._onOptionsChange=function(t,e){"draggingCursor"in e&&this._draggingTool.setCursor(e.draggingCursor)},Mt._shiftCoordPath=function(t,e){for(var i=t.getVertices(),n=0,o=i.length;n<o;n++){var s=i[n].getCoordPoint();-1==wt.inArray(s,this._editor.getOptions().lockedPoints)&&s.moveTo(this._map.converter.localPixelsToCoordinates(this._map.converter.coordinatesToLocalPixels(s).moveBy(e),1))}t.setVertices(i)},Mt.destruct=function(){Ot(this._glassPaneListeners,"cleanup"),this._optionsChangeListener.cleanup(),this._draggableObject.destruct(),this._draggingTool.destruct()};var F=function(t,e,i,n){U.call(this,t,e,i,n)};(Mt=Et(F,U))._createDraggableObject=function(){return this._glassPane.getMap()?new ht(this._graphicsObject,this._glassPane):new ut(this._graphicsObject)},Mt._dragGraphicsObject=function(t){this._shiftCoordPath(this._graphicsObject.getCoordPath(),t)};var $=function(t,e,i,n){U.call(this,t,e,i,n)};function G(t,e,i,n,o){this._coordPathModel=t,this._model=e,this._map=n,this._editor=o,this._controller=i,this._edgePool=new st(n,i.getEdgeHandlers(),o),this._vertexPool=new ot(n,i.getVertexHandlers(),o),this._optionsChangeListener=Dt.observe(o,o.Events.OptionsChange,this._onOptionsChange,this),this.update()}function V(t,e,i){this._model=t,this._graphicsObject=e,this._editor=i,this._controller=new j(t,this,e,i),this._coordPathViews=[],e=e.getMap(),this._updateListeners=[Dt.observe(e,e.Events.MoveEnd,this.update,this),Dt.observe(t,t.Events.Update,this.update,this)],this.update()}function X(t,e,i){this._model=t,this._graphicsObject=e,this._editor=i,this._controller=new N(t,this,e,i);var n=e.getMap();this._updateListeners=[Dt.observe(n,n.Events.MoveEnd,this.update,this),Dt.observe(t,t.Events.Update,this.update,this)],this._coordPathView=new G(t.getCoordPathModel(),t,this._controller,e.getMap(),i)}function W(t,e){bt.ABaseLayout.call(this,t,e),this._$elements=wt("<div class='YMaps-gEditor-edgePoint' style='position:absolute;top:0;left:0;width:10px;height:10px;overflow:hidden;font-size:0;z-index:1;'></div>"),e=this._$elements[0].style,this.cssRounded=""==e.OBorderRadius||""==e.MozBorderRadius||""==e.WebkitBorderRadius||""==e.borderRadius,this.cssRounded?this._$elements.css({backgroundColor:"#eee",border:"1px solid #999",opacity:.8}):(e=bt.versionPath+"i/0.4/editor/edgeMarker.png",this._$elements.append(wt("<i style='position:absolute;top:-10px;left:0;width:10px;height:20px;'></i>").css(Pt.msie&&6==Pt.version?{filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+e+",sizingMethod=scale)"}:{background:"url("+e+")"})))}function q(t,e){bt.ABaseLayout.call(this,t,e),this._mouseOver=0,this._menuOpen=0,this._$elements=wt("<div class='YMaps-gEditor-vertexPoint' style='background-color: #fff; border: 1px solid #777; position: absolute; top: 0; left: 0; font-size: 0px; z-index:1'></div>")}function K(t,e){q.call(this,t,e),this._$elements.removeClass("YMaps-gEditor-vertexPoint"),this._$elements.addClass("YMaps-gEditor-lockedVertexPoint"),this._$elements.css({backgroundColor:"#eee",borderColor:"#777",opacity:.8})}function Q(t){var e,i,n=new yt.Placemark(t.coordSystem.getCoordPoint(0,0),{style:{iconStyle:{template:new yt.LayoutTemplate(tt)}},cursor:yt.Cursor.ARROW,interactive:yt.Interactivity.STATIC,zIndex:yt.ZIndex.EDITOR_VERTEX_MARKER+1}),o=[];function s(){e&&(t.removeOverlay(n),e.setOptions({zIndex:yt.ZIndex.EDITOR_VERTEX_MARKER}),Dt.notify(e,"MenuHide"),clearTimeout(i),Ot(o,"cleanup"),o=[])}function a(t,e){e.preventMapEvent()}n.metaDataProperty.owner=e,this.isVisible=function(){return n.getMap()},this.setOwner=function(t){t!=e&&(s(),n.metaDataProperty.owner=e=t)},this.getOwner=function(){return e},this.setContent=function(t){n.setIconContent(t)},this.show=function(){e&&(n.setCoordPoint(e.getCoordPoint()),t.addOverlay(n),e.setOptions({zIndex:yt.ZIndex.EDITOR_VERTEX_MARKER+2}),Dt.notify(e,"MenuShow"),o=Dt.observe(t,[t.Events.MoveStart,t.Events.BoundsChange],s).concat(Dt.observe(e,[e.Events.DragStart,e.Events.DblClick],s),Dt.observe(n,[n.Events.DblClick,n.Events.Click,n.Events.MouseEnter,n.Events.MouseLeave,n.Events.MouseMove],a)),i=setTimeout(function(){o.push(Dt.observe(t,t.Events.BeforeClick,s))},0))},this.hide=function(){s()}}(Mt=Et($,U))._createDraggableObject=function(){return this._glassPane.getMap()?new lt(this._graphicsObject,this._glassPane):new ut(this._graphicsObject)},Mt._dragGraphicsObject=function(t){for(var e=[this._graphicsObject.getCoordPath()].concat(this._graphicsObject.getOptions().interiors),i=0,n=e.length;i<n;i++)this._shiftCoordPath(e[i],t)},(Mt=G.prototype).getModel=function(){return this._coordPathModel},Mt._onOptionsChange=function(t,e){("lockedPoints"in e||"maxPoints"in e||"vertexLockedLayout"in e||"vertexLayout"in e||"edgeLayout"in e)&&this.update()},Mt.update=function(){var n=this._map.getBounds(1),o=this._vertexPool.getDragged(),t=this._coordPathModel.getVertexModels(),e=wt.map(t,function(t){if(n.contains(t.getPoint()))return t;for(var e=0,i=o.length;e<i;e++)if(o[e].metaDataProperty.rec==t)return t}),i=[];this._model.getPointsNum()<this._editor.getOptions().maxPoints&&(i=wt.map(this._coordPathModel.getEdgeModels(),function(t){if(n.contains(t.getPoint()))return t}));t=10<this._model.getPointsNum();this._vertexPool.setupMarkers(e,t),this._edgePool.setupMarkers(i,t)},Mt.destruct=function(){this._optionsChangeListener.cleanup(),this._edgePool.destruct(),this._vertexPool.destruct()},(Mt=V.prototype).update=function(){for(var t=this._model.getCoordPathModels(),e=[],i=0,n=t.length;i<n;i++){for(var o=null,s=0,a=this._coordPathViews.length;s<a;s++)if(this._coordPathViews[s].getModel()==t[i]){o=this._coordPathViews.splice(s,1)[0];break}o?o.update():o=new G(t[i],this._model,this._controller,this._graphicsObject.getMap(),this._editor),e.push(o)}Ot(this._coordPathViews,"destruct"),this._coordPathViews=e},Mt.destruct=function(){Ot(this._updateListeners,"cleanup"),Ot(this._coordPathViews,"destruct"),this._controller.destruct()},(Mt=X.prototype).update=function(){this._coordPathView.update()},Mt.destruct=function(){Ot(this._updateListeners,"cleanup"),this._coordPathView.destruct(),this._controller.destruct()},(Mt=Et(W,bt.ABaseLayout)).onAddToParent=function(t){bt.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},Mt.update=function(){var t;this.cssRounded&&((t=this._$elements[0].style).width=t.height=this._getSize()+"px",t.MozBorderRadius=t.WebkitBorderRadius=t.borderRadius=this._getSize()/2+1+"px"),this._mouseListeners=[Dt.observe(this._context,this._context.Events.MouseEnter,this._onMouseOver,this),Dt.observe(this._context,this._context.Events.MouseLeave,this._onMouseOut,this)]},Mt.onRemoveFromParent=function(){bt.ABaseLayout.prototype.onRemoveFromParent.call(this),Ot(this._mouseListeners,"cleanup")},Mt._onMouseOver=function(){(this.cssRounded?this._$elements:this._$elements.children()).css(this.cssRounded?{backgroundColor:"#fdff38",opacity:1}:{top:"0"})},Mt._onMouseOut=function(){(this.cssRounded?this._$elements:this._$elements.children()).css(this.cssRounded?{backgroundColor:"#eee",opacity:.8}:{top:"-10px"})},Mt.getOffset=function(){var t=-this._getSize()/2-(!1!==wt.boxModel&&1);return new kt(t,t)},Mt._getSize=function(){return 8+(!1===wt.boxModel&&2)},(Mt=Et(q,bt.ABaseLayout)).onAddToParent=function(t){bt.ABaseLayout.prototype.onAddToParent.call(this,t),this.update(),this._listeners=[Dt.observe(this._context,this._context.Events.MouseEnter,this._onMouseOver,this),Dt.observe(this._context,this._context.Events.MouseLeave,this._onMouseOut,this),Dt.observe(this._context,"MenuShow",this._onMenuShow,this),Dt.observe(this._context,"MenuHide",this._onMenuHide,this)]},Mt.onRemoveFromParent=function(){bt.ABaseLayout.prototype.onRemoveFromParent.call(this),Ot(this._listeners,"cleanup")},Mt._onMouseOver=function(){this._mouseOver=1,this.lightUp()},Mt._onMouseOut=function(){this._mouseOver=0,this.lightDown()},Mt._onMenuShow=function(){this._menuOpen=1,this.lightUp()},Mt._onMenuHide=function(){this._menuOpen=0,this.lightDown()},Mt.lightUp=function(){(this._mouseOver||this._menuOpen)&&this._$elements.css("backgroundColor","#fdff38")},Mt.lightDown=function(){this._mouseOver||this._menuOpen||this._$elements.css("backgroundColor","#fff")},Mt.update=function(){var t=this._$elements[0].style,e=this.getSize();t.width=e.getX()+"px",t.height=e.getY()+"px"},Mt.getSize=function(){var t=10+(!1===wt.boxModel&&2);return new kt(t,t)},Mt.getOffset=function(){return new kt(-this.getSize().getX()/2-(!1!==wt.boxModel&&1),-this.getSize().getY()/2-(!1!==wt.boxModel&&1))},(Mt=Et(K,q)).lightDown=function(){this._mouseOver||this._menuOpen||this._$elements.css("backgroundColor","#eee")};var J=new function(){var n=[],o=[];this.get=function(t){var e,i=wt.inArray(t,n);return-1!=i?e=o[i]:(e=new Q(t),o.push(e),n.push(t)),e}},tt=function(t,e){bt.ABaseLayout.call(this,t,e),this._$elements=wt("<div class='YMaps-gEditor-menu' style='color: #1a3dc1; font-size: 11px; position: absolute; top: 0; left: 0;padding: 2px 3px; background-color: #fff; border: 1px solid #777;' />")};function et(e,i,n){var o=null,s=[];function a(){for(var t=0;t<i;t++){if(!s.length)return clearInterval(o),void(o=null);n(s.shift())}}this.push=function(t){s.push(t),o=o||setInterval(a,e)},this.clear=function(){o&&(clearInterval(o),o=null),s.length=0}}function it(e,t,i){this._editor=i,this._map=e,this._handlers=t,this._pool={},this._fadePool={},this._dragged=[],this._chunker=new et(20,10,function(t){t.getMap()||e.addOverlay(t)})}(Mt=Et(tt,bt.ABaseLayout)).onAddToParent=function(t){bt.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},Mt.setContent=function(t){this._setContent(t,this._$elements)},Mt.getOffset=function(){return this._context.metaDataProperty.owner._icon.getOffset().moveBy(new kt(-3,-3))},Mt.update=function(){var t=this._context.metaDataProperty.owner._icon.getSize().getX()+7;this._$elements.css("paddingLeft",t+"px")};var nt=function(){var e=wt("<div>"),i=[];this.addItem=function(t){i.push(t),e.append(t)},this.getContainer=function(){return e[0]},this.destruct=function(){for(var t;t=i.pop();)t.data("eventListener").removeAll();e.remove()}};it.createMarkerStyle=function(t){return{hasBalloon:0,hasHint:0,iconStyle:{template:new yt.LayoutTemplate(t)}}},(Mt=it.prototype).getDragged=function(){return this._dragged},Mt.setupMarkers=function(t,e){var i=0,n=t.length,o={};for(this._chunker.clear();i<n;i++){var s=t[i],a=this.getMarkerOptions(s),r=null,h=this.getHashKey(s);if(r=this._findMarkerInCell(this._pool,h,s)||this._findMarkerInCell(this._fadePool,h,s)){var l,c=0,u={},d=r.getOptions();for(l in a)a.hasOwnProperty(l)&&a[l]!=d[l]&&(c=1,u[l]=a[l]);c&&r.setOptions(u),r.getCoordPoint().equals(s.getPoint())||r.metaDataProperty.dragged||r.setCoordPoint(s.getPoint())}else{r=new yt.Placemark(s.getPoint(),a);var p,_=[],f=this._handlers;for(p in _.push(Dt.observe(r,r.Events.DragStart,this._onDragStart,this),Dt.observe(r,r.Events.DragEnd,this._onDragEnd,this)),f)f.hasOwnProperty(p)&&_.push(Dt.observe(r,r.Events[p],f[p]));wt.extend(r.metaDataProperty,{listeners:_,rec:s})}r.getMap()||(e?this._chunker.push(r):this._map.addOverlay(r)),(o[h]||(o[h]=[])).push(r)}for(h in this._pool)if(this._pool.hasOwnProperty(h)){for(var m=this._pool[h],i=0,n=m.length;i<n;i++)(r=m[i]).getMap()&&this._map.removeOverlay(r);this._fadePool[h]=(this._fadePool[h]||[]).concat(m)}this._pool=o},Mt._findMarkerInCell=function(t,e,i){var n=t[e];if(n)for(var o=0,s=n.length;o<s;o++)if(n[o].metaDataProperty.rec==i){var a=n.splice(o,1)[0];return n.length||delete t[e],a}},Mt._onDragStart=function(t){t.metaDataProperty.dragged=1,this._dragged.push(t)},Mt._onDragEnd=function(t){t.metaDataProperty.dragged=0;t=wt.inArray(t,this._dragged);-1!=t&&this._dragged.splice(t,1)},Mt.destruct=function(){this._chunker.clear(),this._cleanupPool(this._pool),this._cleanupPool(this._fadePool)},Mt._cleanupPool=function(t){var e,i,n,o,s=J.get(this._map);for(e in t)if(t.hasOwnProperty(e))for(i=0,n=t[e].length;i<n;i++)o=t[e][i],Ot(o.metaDataProperty.listeners,"cleanup"),o.getMap()&&(this._map.removeOverlay(o),s.getOwner()==o&&s.hide())};var ot=function(t,e,i){it.call(this,t,e,i)};(Mt=Et(ot,it)).getMarkerOptions=function(t){var e=yt.ZIndex.EDITOR_VERTEX_MARKER,i=this._editor.getOptions(),t=-1!=wt.inArray(t.originalPoint,i.lockedPoints);return{draggable:t?0:1,style:it.createMarkerStyle(t?i.vertexLockedLayout:i.vertexLayout),interactive:yt.Interactivity.INTERACTIVE,zIndex:e,zIndexHover:e+2,zIndexDrag:e+2,zIndexActive:e+2}},Mt.getHashKey=function(t){t=t.originalPoint;return t.getX()+","+t.getY()};var st=function(t,e,i){it.call(this,t,e,i)};function at(t,e){this._map=t.getMap(),this._graphicsObject=t,this._hotspotField=new S(e),this._updateListener=Dt.observe(t,"Update",this._update,this),this._update()}(Mt=Et(st,it)).getMarkerOptions=function(){var t=yt.ZIndex.EDITOR_EDGE_MARKER;return{draggable:1,style:it.createMarkerStyle(this._editor.getOptions().edgeLayout),interactive:yt.Interactivity.INTERACTIVE,zIndex:t,zIndexHover:t+1,zIndexDrag:t+1,zIndexActive:t+1}},Mt.getHashKey=function(t){t=t.nextOriginalPoint;return t.getX()+","+t.getY()};var rt=function(r,t){var h,l,c=[],u=t,d=r.converter,e=Dt.observe(r,r.Events.Update,function(){h&&i()});function i(){for(var t=[],e=0,i=l.length;e<i;e++){var n=l[e],o=d.coordinatesToLocalPixels(n),s=o.diff(h),a=s.length();a&&(s.scale(Math.max(a-(1.7*Number(u.lineStyle.strokeWidth)+7),0)/a),o=d.localPixelsToCoordinates(o.moveBy(s),1),(s=c.shift())?s.splicePoints(0,2,o,n):(s=new yt.PaintPolyline([o,n],{style:u}),r.addOverlay(s)),t.push(s))}for(;c.length;)r.removeOverlay(c.shift());c=t}this.setStyle=function(t){Ot(c,"setStyle",u=t)},this.setCoords=function(t,e){h=d.coordinatesToLocalPixels(t),l=e,i()},this.hide=function(){for(h=null;c.length;)r.removeOverlay(c.shift())},this.destruct=function(){this.hide(),e.cleanup()}};(Mt=at.prototype)._update=function(){this._graphicsObject.getComputedStyle();var t=this._getCoordsArray();this._hotspot?this._hotspot.setCoords(t):(this._hotspot=new P(t,0),this._hotspotField.add(this._hotspot),this._hotspotListeners=[Dt.observe(this._hotspot,"MouseMove",this._onHotspotMouseMove,this),Dt.observe(this._hotspot,"MouseLeave",this._onHotspotMouseLeave,this)])},Mt._getCoordsArray=Mt._getPixelPoints=xt.NULL,Mt._onHotspotMouseMove=function(t,e){Dt.notify(this,"MouseMove",this,e)},Mt._onHotspotMouseLeave=function(t,e){Dt.notify(this,"MouseLeave",this,e)},Mt.setCursor=function(t){this._hotspot.setCursor(t)},Mt.destruct=function(){this._hotspot.destruct(),this._hotspotField.destruct(),Ot(this._hotspotListeners,"cleanup"),this._updateListener.cleanup()};var ht=function(t,e){at.call(this,t,e)};(Mt=Et(ht,at))._getCoordsArray=function(){var t=this._graphicsObject.getComputedStyle();return[{coords:[a(this._getPixelPoints(),t.lineStyle.strokeWidth)],nonzero:1}]},Mt._getPixelPoints=function(){var e=this._map;return wt.map(this._graphicsObject.getPixelPoints(),function(t){return e.tileCoordinates.scale(t,e.coordSystem.getMaxZoom(),e.getZoom())})};var lt=function(t,e){at.call(this,t,e)};(Mt=Et(lt,at))._getCoordsArray=function(){for(var t=this._graphicsObject.getComputedStyle(),e=this._getPixelPoints(),i=[],n=0,o=e.length;n<o;n++){var s=e[n];i[n]=a(s,t.polygonStyle.strokeWidth)}return[{coords:e,nonzero:0},{coords:i,nonzero:1}]},Mt._getPixelPoints=function(){for(var e=this._map,t=this._graphicsObject.getPixelPoints(),i=0,n=t.length;i<n;i++){var o=t[i];(o=wt.map(o,function(t){return e.tileCoordinates.scale(t,e.coordSystem.getMaxZoom(),e.getZoom())}))[0]&&o.push(o[0]),t[i]=o}return t};var ct=function(e,i,n,o){var s,t,a,r,h;function l(){t=new y(e,{dragStart:u,dragMove:d,dragStop:_}),i&&e.setCursor(i)}function c(){t.destruct()}function u(t){a=new x(n),r=Dt.observe(n,n.Events.Move,p),s=new yt.MouseEvent(t,n).getLocalPixels()}function d(t){t=new yt.MouseEvent(t,n).getLocalPixels();h||(e.setCursor(yt.Cursor.GRABBING),h=1),o(s.diff(t)),s=t}function p(t,e){o(e)}function _(t){a.destruct(),r.cleanup(),h&&(e.setCursor(i),h=0)}l(),this.setDraggableObject=function(t){c(),e=t,l()},this.setCursor=function(t){e.setCursor(i=t)},this.destruct=function(){c()}},ut=function(e){var i,t,n=e.getShape();for(t in n.Events)n.Events.hasOwnProperty(t)&&Dt.observe(n,n.Events[t],function(i){return function(t,e){Dt.notify(this,i,this,e)}}(n.Events[t]),this);this.setCursor=function(t){typeof i==Tt&&(i=e.getOptions().cursor),e.setOptions({cursor:t})},this.destruct=function(){e.setOptions({cursor:i})}},dt=function(e,i,n,o,s,t){var a,r,h,l,c;function u(t){t&&n.addCursor(t)}function d(t){t&&n.removeCursor(t)}function p(){t(),M()}function _(){r=[Dt.observe(e,e.Events.Click,g),Dt.observe(e,e.Events.MouseLeave,v),Dt.observe(e,e.Events.MouseMove,m)],a=r.concat([Dt.observe(n,n.Events.MoveStart,y),Dt.observe(n,n.Events.MoveEnd,b)])}function f(){Ot(a,"cleanup")}function m(t,e){e.isMapEventPrevented()?p():(e.preventMapEvent(),Pt.msie?(c=e,l=l||setInterval(C,50)):s(e))}function g(t,e){o(e),e.preventMapEvent()}function v(t,e){p(),e.preventMapEvent()}function y(){Ot(r,"disable"),p()}function b(){Ot(r,"enable")}function C(){c?(s(c),c=null):M()}function M(){l&&(clearInterval(l),l=null)}u(i),_(),h=new x(n),this.destruct=function(){h.destruct(),f(),d(i),p()},this.setGlassPane=function(t){f(),e=t,_()},this.setCursor=function(t){d(i),u(i=t)}},pt=function(){var e,i,n,o;this.getMap=function(){return o},this.onMapUpdate=xt.NULL,this.onAddToMap=function(t){(e=It((o=t).__layerManager.getContainer()).events.eventListener()).add("mouseleave",function(t){Dt.notify(this,this.Events.MouseLeave,this,new yt.MouseEvent(t,o)),n=!1},this),i=[Dt.observe(o,o.Events.BeforeClick,function(t,e){e.isMapEventPrevented()||Dt.notify(this,this.Events.Click,this,e)},this),Dt.observe(o,o.Events.BeforeDblClick,function(t,e){e.isMapEventPrevented()||Dt.notify(this,this.Events.DblClick,this,e)},this),Dt.observe(o,o.Events.BeforeMouseMove,function(t,e){e.isMapEventPrevented()?n&&(Dt.notify(this,this.Events.MouseLeave,this,e),n=!1):(n||(Dt.notify(this,this.Events.MouseEnter,this,e),n=!0),Dt.notify(this,this.Events.MouseMove,this,e))},this)]},this.onRemoveFromMap=function(){o=null,e.removeAll(),Ot(i,"cleanup")}};function _t(t,e){this._graphicsObject=t,this._options=wt.extend({},this._getDefaultOptions(),e),this._model=this._createModel(),this._view=this._createView(),Dt.notify(this._graphicsObject,this._graphicsObject.Events.StartEditing,this._graphicsObject)}(Mt=pt.prototype).Events={Update:"Update",Click:"Click",DblClick:"DblClick",MouseMove:"MouseMove",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave"},(Mt=_t.prototype).Events={OptionsChange:"OptionsChange"},Mt._getDefaultOptions=function(){return{drawing:0,drawingCursor:yt.Cursor.ARROW,drawOver:0,visibilityZoomForNewPoints:0,stopDrawingByDblClick:1,dragging:0,draggingCursor:yt.Cursor.MOVE,maxPoints:1/0,menuManager:0,onDblClick:null,lockedPoints:[],onPointDragging:0,onPointDrawing:0,vertexLockedLayout:K,vertexLayout:q,edgeLayout:W}},Mt._createModel=xt.NULL,Mt._createView=xt.NULL,Mt.setOptions=function(t){t=t||{};var e,i=this._getDefaultOptions(),n={};for(e in i)i.hasOwnProperty(e)&&typeof t[e]!=Tt&&t[e]!=this._options[e]&&(this._options[e]=n[e]=t[e]);Dt.notify(this,this.Events.OptionsChange,this,n)},Mt.getOptions=function(){return this._options},Mt.stopEditing=function(){this._view.destruct(),this._model.destruct(),Dt.notify(this._graphicsObject,this._graphicsObject.Events.StopEditing,this._graphicsObject),this._graphicsObject=this._view=this._model=null};var ft=function(t,e){_t.call(this,t,e)};(Mt=Et(ft,_t))._getDefaultOptions=function(){return wt.extend({},_t.prototype._getDefaultOptions.call(this),{fromStart:0})},Mt._createModel=function(){return new B(this._graphicsObject,this)},Mt._createView=function(){return new X(this._model,this._graphicsObject,this)};var mt=function(t,e){_t.call(this,t,e)};(Mt=Et(mt,_t))._getDefaultOptions=function(){return wt.extend({},_t.prototype._getDefaultOptions.call(this),{drawingCoordPath:this._graphicsObject.getCoordPath(),drawNewInteriors:0,fromIndex:-1})},Mt.setOptions=function(t){_t.prototype.setOptions.call(this,t),this._options.fromIndex=-1},Mt._createModel=function(){return new k(this._graphicsObject,this)},Mt._createView=function(){return new V(this._model,this._graphicsObject,this)};var gt=new function(){this.getIntersection=function(t,e,i){var n=t.x,o=e.x,s=t.y,a=e.y,r=0,h=0,l=i[0],c=i[1];n<l.x&&(r|=1),n>c.x&&(r|=2),s<l.y&&(r|=4),s>c.y&&(r|=8),o<l.x&&(h|=1),o>c.x&&(h|=2),a<l.y&&(h|=4),a>c.y&&(h|=8);for(var u,d=0==(r|h),p=0!=(r&h),i=!(d||p),_=!1;!d&&!p;)0==r&&(_=!_,u=n,n=o,o=u,u=s,s=a,a=u,u=r,r=h,h=u),0!=(1&r)?(s+=Math.floor((a-s)*(l.x-n)/(o-n)),n=l.x):0!=(2&r)?(s+=Math.floor((a-s)*(c.x-n)/(o-n)),n=c.x):0!=(4&r)?(n+=Math.floor((o-n)*(l.y-s)/(a-s)),s=l.y):0!=(8&r)&&(n+=Math.floor((o-n)*(c.y-s)/(a-s)),s=c.y),r=0,n<l.x&&(r|=1),n>c.x&&(r|=2),s<l.y&&(r|=4),s>c.y&&(r|=8),d=0==(r|h),p=0!=(r&h);return{intersection:d,clipping:i,outs:p,to:new kt(_?n:o,_?s:a),from:new kt(_?o:n,_?a:s)}}},vt=new function(){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",o="A".charCodeAt(0);this.encode4bytes=function(t){for(var e=[],i=0;i<4;i++)e[i]=255&t,t>>=8;return e},this.encode=function(t){var e="string"==typeof t;if(typeof btoa!=Tt)return e||(t=String.fromCharCode.apply(String,t)),btoa(t).replace(/\//g,"_").replace(/\+/g,"-");for(var i,n,o,s,a,r,h,l=[],c=0,u=t.length;c<u;)o=e?(i=t.charCodeAt(c++),n=t.charCodeAt(c++),t.charCodeAt(c++)):(i=t[c++],n=t[c++],t[c++]),s=i>>2,a=(3&i)<<4|n>>4,r=(15&n)<<2|o>>6,h=63&o,isNaN(n)?r=h=64:isNaN(o)&&(h=64),l.push(d.charAt(s),d.charAt(a),d.charAt(r),d.charAt(h));return l.join("")},this.decode=function(t){if(typeof atob!=Tt)return atob(t.replace(/_/g,"/").replace(/-/g,"+"));for(var e,i,n,o,s,a=[],r=0,h=(t=t.replace(/[^A-Za-z0-9\-_\=]/g,"")).length;r<h;)e=d.indexOf(t.charAt(r++))<<2|(n=d.indexOf(t.charAt(r++)))>>4,i=(15&n)<<4|(o=d.indexOf(t.charAt(r++)))>>2,n=(3&o)<<6|(s=d.indexOf(t.charAt(r++))),a.push(String.fromCharCode(e)),64!=o&&a.push(String.fromCharCode(i)),64!=s&&a.push(String.fromCharCode(n));return a.join("")},this.codingCoefficient=1e6,this.decodePoints=function(t,e){for(var i=this.decode(t),n=i.length,o=0,s=e.getCoordPoint(0,0),a=[];o<n;){for(var r=0,h=0,l=0,c=i.substr(o,8);l<4;)r|=c.charCodeAt(l)<<8*l,h|=c.charCodeAt(l+4)<<8*l,l++;var u=e.getCoordPoint(r/1e6,h/1e6),u=e.getCoordPoint(u.getX()+s.getX(),u.getY()+s.getY()),s=u;a.push(u),o+=8}return a},this.decodeLevels=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(t.charCodeAt(i)-o);return e}}}(),function(){Ct=yt.ConnectedPlacemarks=function(t){yt.GeoObjectCollection.call(this,t),this._showLines=1,this._lines=new yt.GeoObjectCollection,this._lines.onAddToGroup(this),this.__placemarkListeners=[]},(Mt=Et(Ct,yt.GeoObjectCollection))._onAddObject=function(e,t){yt.GeoObjectCollection.prototype._onAddObject.call(this,e,t),t&&(t==this.length()-1?this._lines.add(new h([this.get(-2).getGeoPoint(),e.getGeoPoint()])):this._lines.get(t-1).splicePoints(1,1,e.getGeoPoint())),t!=this.length()-1&&this._lines.splice(t,0,new h([e.getGeoPoint(),this.get(t+1).getGeoPoint()]));var i,n,o,s,a=[],r=e.Events;a.push(Dt.observe(e,r.Drag,this._onPlacemarkPositionChange,this),Dt.observe(e,r.PositionChange,function(t,e){this._onPlacemarkPositionChange(t)},this)),bt.Graphics.SSG&&a.push(Dt.observe(e,r.DragStart,function(){var t=this.indexOf(e);i=0!=t?this._lines.get(t-1):null,n=this._lines.get(t),i&&(o=new l([i.getPoint(0),i.getPoint(1)]),this._lines.splice(t-1,1,o)),n&&(s=new l([n.getPoint(0),n.getPoint(1)]),this._lines.splice(t,1,s))},this),Dt.observe(e,r.DragEnd,function(){var t=this.indexOf(e);o&&(i.splicePoints(0,2,o.getPoint(0),o.getPoint(1)),this._lines.splice(t-1,1,i)),s&&(n.splicePoints(0,2,s.getPoint(0),s.getPoint(1)),this._lines.splice(t,1,n)),i=n=o=s=null},this)),this.__placemarkListeners.splice(t,0,a)},Mt._onRemoveObject=function(t,e){var i;yt.GeoObjectCollection.prototype._onRemoveObject.call(this,t,e),Ot(this.__placemarkListeners.splice(e,1)[0],"cleanup"),0!=e&&(i=this._lines.get(e-1),(t=this.get(e))?i.splicePoints(1,1,t.getGeoPoint()):this._lines.remove(i)),e!=this.length()&&this._lines.remove(this._lines.get(e))},Mt._onPlacemarkPositionChange=function(t){var e,i=this.indexOf(t);-1!=i&&(e=null,t=this.get(i).getGeoPoint(),0!=i&&(e=this._lines.get(i-1))&&e.splicePoints(0,2,this.get(i-1).getGeoPoint(),t),(e=this._lines.get(i))&&e.splicePoints(0,2,t,this.get(i+1).getGeoPoint()))},Mt.update=function(){yt.GeoObjectCollection.prototype.update.call(this),this._lines.update()},Mt.onAddToMap=function(t,e){yt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._showLines&&this._lines.onAddToMap(t,e)},Mt.onRemoveFromMap=function(){yt.GeoObjectCollection.prototype.onRemoveFromMap.call(this),this._showLines&&this._lines.onRemoveFromMap()},Mt.setLineVisible=function(t){this._showLines!=t&&(this._showLines=t,this.getMap()&&(t?this._lines.onAddToMap(this.getMap(),this.getParentContainer()):this._lines.onRemoveFromMap()))},Mt.getLineVisible=function(){return this._showLines},Mt.onMapUpdate=function(){yt.GeoObjectCollection.prototype.onMapUpdate.call(this),this._showLines&&this._lines.onMapUpdate()};var h=function(t){yt.Polyline.call(this,t,{interactive:yt.Interactivity.NONE}),this._getDrawPixels=e};Mt=Et(h,yt.Polyline);var l=function(t){yt.PaintPolyline.call(this,t),this._getDrawPixels=e};Mt=Et(l,yt.PaintPolyline);var e=function(t,e,i){return wt.map(t,function(t){return i.coordSystem.fromCoordPoint(t,i.getCenter(1))})}}(),Ct=bt.AItemContainer=function(t){yt.Group.call(this),this.__$itemContainers=new yt.Group,yt.Events.observe(this,this.Events.Add,this.__onAddItem,this),yt.Events.observe(this,this.Events.Remove,this.__onRemoveItem,this),t!=Tt&&this.add(t)},(Mt=Et(Ct,yt.Group)).makeContainer=xt.NULL,Mt.makeItemContainer=xt.NULL,Mt.getContentNode=xt.NULL,Mt.getItemContentNode=xt.NULL,Mt.getToolBar=function(){return this},Mt.getElement=function(){return this.__$element},Mt.getItemElement=function(t){return this.__$itemContainers.get(t)},Mt.__onAddItem=function(t,e,i){this.__$itemContainers.add(this.makeItemContainer(),i),this.__parentContainer&&this.__buildItem(i)},Mt.__buildItem=function(t){var e=this.getContentNode(),i=this.getItemElement(t),n=this.getItemContentNode(t);t>=wt(e).children().length?i.appendTo(e):i.insertBefore(this.getItemElement(t+1)),this.get(t).onAddToToolBar(this.getToolBar(),n,this)},Mt.__onRemoveItem=function(t,e,i){this.__parentContainer&&this.__unbuildItem(e,i),this.__$itemContainers.splice(i,1)},Mt.__unbuildItem=function(t,e){t.onRemoveFromToolBar(),this.getItemElement(e).remove()},Mt.onAdd=function(t){this.__parentContainer=t,this.__$element=this.makeContainer().appendTo(t);for(var e=0,i=this.length();e<i;e++)this.__buildItem(e)},Mt.onRemove=function(){for(var t=0,e=this.length();t<e;t++)this.__unbuildItem(this.get(t),t);this.__$element.remove(),this.__parentContainer=null},Ct=yt.ToolBarSeparator=function(t){this._width=parseInt(t,10),isNaN(this._width)&&(this._width=20)},(Mt=Ct.prototype).onAddToToolBar=function(t,e){this._toolBar=t,this._parentContainer=e,wt(e).css("width",this._width).addClass("YMaps-tool-bar-separator")},Mt.onRemoveFromToolBar=function(){this._toolBar=this._parentContainer=null},Ct=yt.ToolBarButton=function(t,e){this._content=wt.extend({hint:null,caption:null,icon:null,width:null},t),this._options=wt.extend({selected:0,enabled:1,shown:1},e),this._options.selected&&!this._options.enabled&&(this._options.enabled=1),this._listeners=[],this._toolBar=null},(Mt=Ct.prototype).hoverCSSClassName="YMaps-button_hover",Mt.activeCssClassName="YMaps-button_active",Mt.disabledCssClassName="YMaps-button_disable",Mt.Events={Click:"Click"},Mt.getContent=function(){return this._content},Mt.setContent=function(t){this._content=t||{},this._toolBar&&this._applyTemplate()},Mt._applyTemplate=function(){var t,e=wt(this._parentContainer),i=this._content,n=i.hint||"",o='alt="'+n+'" title="'+n+'"',s=i.icon||null,a=i.caption||(s?"":"&#160;"),r='<i class="YMaps-button-c YMaps-button-l"><i></i></i><i class="YMaps-button-m"><i></i>';n&&e.attr("title",n),s&&(Pt.msie&&Pt.version<7?r+='<b class="YMaps-button-opacity"></b><img class="YMaps-icon" src="'+At.images.transparentImage+'" '+o+' style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+s+');"/>':r+='<img class="YMaps-icon"'+o+' src="'+s+'"/>'),a&&(r+='<span class="YMaps-button-caption">'+a+"</span>"),r+='</i><i class="YMaps-button-c YMaps-button-r"><i></i></i>',e.addClass("YMaps-button").html(r),i.width&&!isNaN(t=parseInt(i.width,10))&&e.find(".YMaps-button-m").css("width",t),this._applyState()},Mt._applyState=function(){this._toolBar&&(wt(this._parentContainer)[this._options.shown?"removeClass":"addClass"]("YMaps-display-none")[this._options.selected?"addClass":"removeClass"](this.activeCssClassName)[this._options.enabled?"removeClass":"addClass"](this.disabledCssClassName),this._applyCursor())},Mt._applyCursor=function(){this._toolBar&&wt(this._parentContainer).find(".YMaps-button-m")[this._options.enabled?"addClass":"removeClass"]("YMaps-cursor-pointer")},Mt.onAddToToolBar=function(t,e){this._toolBar=t,this._parentContainer=e,this._applyTemplate();var i=wt(e),n=this.hoverCSSClassName;this.__domListener=It(e).events.eventListener().add("click",function(t){this._options.enabled&&Dt.notify(this,this.Events.Click,this)},this).add("mouseenter",function(){i.addClass(n)}).add("mouseleave",function(){i.removeClass(n)})},Mt.onRemoveFromToolBar=function(){this._toolBar&&(Ot(this._listeners,"cleanup"),this._listeners=[],this.__domListener.removeAll(),wt(this._parentContainer).empty(),this._toolBar=this._parentContainer=null)},Mt.getToolBar=function(){return this._toolBar},Mt.show=function(){this._options.shown||(this._options.shown=1,this._applyState())},Mt.hide=function(){this._options.shown&&(this._options.shown=0,this._applyState())},Mt.isShown=function(){return this._options.shown},Mt.select=function(){!this._options.selected&&this._options.enabled&&(this._options.selected=1,this._applyState())},Mt.deselect=function(){this._options.selected&&(this._options.selected=0,this._applyState())},Mt.isSelected=function(){return this._options.selected},Mt.enable=function(){this._options.enabled||(this._options.enabled=1,this._applyState())},Mt.disable=function(){this._options.enabled&&!this._options.selected&&(this._options.enabled=0,this._applyState())},Mt.isEnabled=function(){return this._options.enabled},Ct=yt.ToolBarToggleButton=function(t,e){yt.ToolBarButton.call(this,t,e)},(Mt=Et(Ct,yt.ToolBarButton)).Events.Select="Select",Mt.Events.Deselect="Deselect",Mt.onAddToToolBar=function(t,e){yt.ToolBarButton.prototype.onAddToToolBar.call(this,t,e),this._listeners.push(Dt.observe(this,this.Events.Click,this._onClick))},Mt._onClick=function(){this[this.isSelected()?"deselect":"select"]()},Mt.select=function(){!this.isSelected()&&this.isEnabled()&&(yt.ToolBarButton.prototype.select.call(this),Dt.notify(this,this.Events.Select,this))},Mt.deselect=function(){this.isSelected()&&(yt.ToolBarButton.prototype.deselect.call(this),Dt.notify(this,this.Events.Deselect,this))},Ct=yt.ToolBarRadioButton=function(t,e,i){this._groupId=t,yt.ToolBarToggleButton.call(this,e,i)},(Mt=Et(Ct,yt.ToolBarToggleButton)).getGroupId=function(){return this._groupId},Mt._onClick=function(){this.isSelected()||this.select()},Mt.select=function(){var t,e;!this.isSelected()&&this.isEnabled()&&(t=null,this._toolBar&&(e=this,wt.each(e._toolBar.getByGroupId(e.getGroupId()),function(){this!=e&&this.isSelected()&&(this.deselect(),t=this)})),this._options.selected=1,this._applyState(),Dt.notify(this,this.Events.Select,this,t))},Mt._applyCursor=function(){this._toolBar&&wt(this._parentContainer).find(".YMaps-button-m")[this._options.enabled&&!this._options.selected?"addClass":"removeClass"]("YMaps-cursor-pointer")},Ct=yt.ListBoxItem=function(t){this._caption=t||""},(Mt=Ct.prototype).hoverCSSClassName="YMaps-btn-list-item_hover",Mt.Events={Click:"Click"},Mt._applyTemplate=function(){wt('<a href="javascript:void(0)">'+this._caption+"</a>").appendTo(this._$parentContainer)},Mt.onAddToToolBar=function(t,e,i){this._toolBar=t,this._listBox=i,this._$parentContainer=wt(e),this.__listener=It(e).events.eventListener().add("mouseenter",function(){this._$parentContainer.addClass(this.hoverCSSClassName)},this).add("mouseleave",function(){this._$parentContainer.removeClass(this.hoverCSSClassName)},this).add("click",function(t){Dt.notify(this,this.Events.Click,this),t.preventDefault()},this),this._applyTemplate()},Mt.onRemoveFromToolBar=function(){this.__listener.removeAll(),this._$parentContainer.empty(),this._$parentContainer=this._toolBar=this._listBox=null},Mt.getListBox=function(){return this._listBox},Mt.setCaption=function(t){this._caption=t,this._toolBar&&this._$parentContainer.html(t)},Mt.getCaption=function(){return this._caption},Ct=yt.ListBoxToggleItem=function(t,e){var i;yt.ListBoxItem.call(this,t),this.__selected=!!e,Pt.msie&&((i=this).__ieChangeListener=function(){window.setTimeout(function(){i.__applyState()},0)})},(Mt=Et(Ct,yt.ListBoxItem)).Events.Select="Select",Mt.Events.Deselect="Deselect",Mt._applyTemplate=function(){this._$parentContainer.addClass("YMaps-cursor-pointer").html('<input type="checkbox"'+(this.__selected?'checked="checked" ':"")+"/><span>"+this._caption+"</span>"),this.__applyState()},Mt.__applyState=function(){this._toolBar&&this._$parentContainer.find("input").attr("checked",this.__selected?"checked":null)},Mt.onAddToToolBar=function(t,e,i){yt.ListBoxItem.prototype.onAddToToolBar.call(this,t,e,i);i=this._$parentContainer.find("input");this.__checkboxListener=It(i[0]).events.eventListener().add("click",function(t){Dt.notify(this,this.Events.Click,this),t.stopPropagation()},this),Pt.opera&&Pt.version<9.5?this.__checkboxListener.add("change",this.__applyState,this):Pt.msie&&(i[0].onpropertychange=this.__ieChangeListener),this.__clickListener=yt.Events.observe(this,this.Events.Click,function(){this[this.isSelected()?"deselect":"select"]()},this)},Mt.onRemoveFromToolBar=function(){this.__clickListener.cleanup(),this.__checkboxListener.removeAll(),Pt.msie&&(this._$parentContainer.find("input").onpropertychange=null),yt.ListBoxItem.prototype.onRemoveFromToolBar.call(this)},Mt.setCaption=function(t){this._caption=t,this._toolBar&&this._$parentContainer.find("span").html(t)},Mt.select=function(){this.__selected||(this.__selected=1,this.__applyState(),Dt.notify(this,this.Events.Select,this))},Mt.deselect=function(){this.__selected&&(this.__selected=0,this.__applyState(),Dt.notify(this,this.Events.Deselect,this))},Mt.isSelected=function(){return this.__selected},Ct=yt.ToolBar=function(t){this.__map=null,t=t||[new yt.ToolBar.MoveButton,new yt.ToolBar.MagnifierButton,new yt.ToolBar.RulerButton],bt.AItemContainer.call(this,t)},Mt=Et(Ct,bt.AItemContainer),Ct.DEFAULT_GROUP="default",Ct.MoveButton=ot("move",0,1),Ct.MagnifierButton=ot("magnifier",1,0),Ct.RulerButton=ot("ruler",1,0),Mt.makeContainer=function(){return wt('<div class="YMaps-buttons"></div>').css("z-index",yt.ZIndex.CONTROL-1)},Mt.makeItemContainer=function(){return wt('<div class="YMaps-button"></div>')},Mt.getContentNode=function(){return this.getElement()[0]},Mt.getItemContentNode=function(t){return this.getItemElement(t)[0]},Mt.onAddToMap=function(t,e){this.__map=t,bt.AItemContainer.prototype.onAdd.call(this,t.getContainer()),(e||new yt.ControlPosition(yt.ControlPosition.TOP_LEFT,new yt.Point(5,5))).apply(this.__$element[0])},Mt.onRemoveFromMap=function(){bt.AItemContainer.prototype.onRemove.call(this)},Mt.getMap=function(){return this.__map},Mt.getByGroupId=function(e){return this.filter(function(t){return t.getGroupId&&t.getGroupId()==e})},Ct=yt.ListBox=function(t){this.__options=wt.extend({width:140,caption:""},t),this.__state={color:this.__options.color,expanded:0,enabled:1},this.__captionListeners=[],this.__groupListeners=[],bt.AItemContainer.call(this)},(Mt=Et(Ct,bt.AItemContainer)).__baseCSSClass="YMaps-btn",Mt.__collapseTimeout=3e3,Mt.makeContainer=function(){var t=this.__options.caption||"&#160",e="green"==this.__state.color?"YMaps-btn-name_green":"YMaps-btn-name_layers";return wt('<div class="'+this.__baseCSSClass+this.__getCSSClass()+(this.__state.enabled?" YMaps-cursor-pointer":"")+'"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i" style="width:'+this.__options.width+'px;"><i class="YMaps-btn__disabler"></i><div class="YMaps-btn-reduce"><a class="YMaps-btn-name '+e+'" href="javascript:void(0)"><span class="YMaps-btn-caption">'+t+'</span><i class="YMaps-arr"><i></i></i></a></div><div class="YMaps-btn-expand"><a class="YMaps-btn-name YMaps-btn-name_layers" href="javascript:void(0)"><span class="YMaps-btn-caption">'+t+'</span><i class="YMaps-arr"><i></i></i></a><ul class="YMaps-btn-list YMaps-btn-list_hover"></ul></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>')},Mt.__getCSSClass=function(){var t=this.__state.color,e=[];this.__state.enabled||e.push("disabled"),this.__state.color&&this.__state.expanded?e.push(t,"expanded",t+"-expanded"):(this.__state.color&&e.push(t),this.__state.expanded&&e.push("expanded"));var i=this.__baseCSSClass;return(e=wt.map(e,function(t){return i+"_"+t})).length?" "+e.join(" "):""},Mt.makeItemContainer=function(){return wt('<li class="YMaps-btn-list-item"></li>')},Mt.getContentNode=function(){return this.getElement().find(".YMaps-btn-list")[0]},Mt.getItemContentNode=function(t){return this.getItemElement(t)[0]},Mt.onAddToToolBar=function(t,e){this.__toolBar=t,bt.AItemContainer.prototype.onAdd.call(this,e);var i=this.getElement();this.__updateDisablerHeight(),this.__groupListeners=yt.Events.observe(this,[this.Events.Add,this.Events.Remove],this.__updateDisablerHeight,this),this.__leaveListener=It(i[0]).events.eventListener(),this.__state.expanded&&this.__beginMapListening();for(var n=i.find(".YMaps-btn-name"),o=0,s=n.length;o<s;o++){var a,r=It(n[o]).events.eventListener().add("click",function(t){this[this.__state.expanded?"collapse":"expand"](),t.preventDefault()},this);Pt.msie&&(Pt.version<8||document.documentMode<8)&&(a=i.find(".YMaps-arr"),r.add("mouseenter",function(){a.addClass("YMaps-arr_hover")}).add("mouseleave",function(){a.removeClass("YMaps-arr_hover")})),this.__captionListeners.push(r)}t=t.getMap();this.__destructListener=Dt.observe(t,t.Events.Destruct,this.onRemoveFromToolBar,this)},Mt.onRemoveFromToolBar=function(){this.__state.expanded&&this.__stopMapListening(),Ot(this.__captionListeners,"removeAll"),Ot(this.__groupListeners,"cleanup"),this.__captionListeners=[],this.__destructListener.cleanup(),bt.AItemContainer.prototype.onRemove.call(this),this.__toolBar=null,this.getElement().empty()},Mt.__updateDisablerHeight=function(){var t=this.getElement();t.find(".YMaps-btn__disabler").height(t.find(".YMaps-btn-i").height()+3)},Mt.getToolBar=function(){return this.__toolBar},Mt.getCaption=function(){return this.__options.caption},Mt.setCaption=function(t){this.__options.caption=t,this.__toolBar&&this.getElement().find(".YMaps-btn-caption").html(t)},Mt.expand=function(){this.__state.expanded||this.setState({expanded:1})},Mt.collapse=function(){this.__state.expanded&&this.setState({expanded:0})},Mt.isExpanded=function(){return this.__state.expanded},Mt.enable=function(){this.__state.enabled||this.setState({enabled:1})},Mt.disable=function(){this.__state.enabled&&this.setState({enabled:0})},Mt.isEnabled=function(){return this.__state.enabled},Mt.setState=function(t){var e;this.__toolBar&&typeof t.expanded!=Tt&&t.expanded!=this.__state.expanded&&(t.expanded?this.__beginMapListening():this.__stopMapListening()),this.__toolBar&&typeof t.enabled!=Tt&&t.enabled!=this.__state.enabled&&(t.enabled?this.getElement().addClass("YMaps-cursor-pointer"):this.getElement().removeClass("YMaps-cursor-pointer")),this.__toolBar&&(e=this.__getCSSClass()),wt.extend(this.__state,t),this.__toolBar&&this.getElement().removeClass(e).addClass(this.__getCSSClass())},Mt.__beginMapListening=function(){var t=this.__toolBar.getMap();this.__leaveListener.add("mouseenter",this.__onMouseEnter,this).add("mouseleave",this.__onMouseLeave,this),this.__mapClickListener=Dt.observe(t,t.Events.Click,function(){this.collapse()},this)},Mt.__onMouseEnter=function(){this.__cancelCollapse()},Mt.__onMouseLeave=function(){this.__planCollapse()},Mt.__planCollapse=function(){var t=this;this.__state.expanded&&(this.__cancelCollapse(),this.__collapseHandler=window.setTimeout(function(){t.collapse()},this.__collapseTimeout))},Mt.__cancelCollapse=function(){this.__collapseHandler&&(window.clearTimeout(this.__collapseHandler),this.__collapseHandler=null)},Mt.__stopMapListening=function(){this.__cancelCollapse(),this.__leaveListener.removeAll(),this.__mapClickListener.cleanup()},bt.SmoothZoomer=function(o){var s,e,i,n,a,r=null,h=null,l=1,t=Pt.opera&&Pt.version<9.5,c=t?300:25,u=t?1:4,d=null,p=0,_=0;function f(t,e){return o.tileCoordinates.scale(o.coordSystem.fromCoordPoint(t),o.coordSystem.getMaxZoom(),e)}function m(){var t=function(){if(i)p&&_!=p&&(r+=_,i=Math.abs(i-e),_=p);else{if((r+=_)==h)return null;i=e=Math.pow(2,r+(0<p?0:-1)-o.getZoom()),n=e/u,_=p}return i-=n,{saveThisPosition:s,scaleCoefficient:l+=_*n}}();t?o.animator.scale(t):this.stop()}this.zoomTo=function(t,e,i){var n;h=t,null===r&&(r=o.getZoom()),p=xt.sign(h-(r+_)),s=(e||o.getCenter()).copy(),i&&(n=o.animator.getState().scaleCoefficient,t=h-(o.getZoom()+Math.log(n)/Math.log(2)),i=(e=f(o.coordSystem.toCoordPoint(o._state.centerInTiles),o.getZoom()).scale(n)).copy().diff(f(s,o.getZoom()).scale(n)),t=Math.pow(2,-t),t=new yt.Point(i.getX()/(1-t),i.getY()/(1-t)),t=e.copy().moveBy(t).scale(1/n),n=o.getZoom(),s=o.coordSystem.toCoordPoint(o.tileCoordinates.scale(t,n,o.coordSystem.getMaxZoom()))),d||(p?(o.animator.start(),d=setInterval(Lt(m,this),c),a=Dt.observe(o,o.Events.Destruct,function(){this.stop()},this)):this.stop())},this.stop=function(){d&&(clearInterval(d),d=null,o.animator.stop(h),a.cleanup()),null!==r&&Dt.notify(this,"ZoomEnd",this,r==h),r=h=e=i=n=null,p=_=0,l=1},this.getTargetZoom=function(){return h},this.getCurrentZoom=function(){return r}},bt.Zoomer=function(s){var a,r=null;function h(t,e){a=null,l(e?yt.State.SUCCESS:yt.State.FAILURE)}function l(t){var e;r&&r.callback&&(e=r.callback,r.callback=null,e(t))}this.zoomTo=function(t,e){var i,n,o;l(yt.State.FAILURE),o=e,r=wt.extend({position:null,centering:0,callback:null,smooth:0},o),s._inited?(i=s.getCenter(),r.position&&(i=r.centering?r.position:function(t,e){t=s._state.centerInTiles.diff(s.coordSystem.fromCoordPoint(t,s.getCenter()));e<0?(t.scale(Math.pow(2,Math.abs(e))-1),t=t.neg()):t.scale((Math.pow(2,e)-1)/Math.pow(2,e));return s._restrictCenter(s.coordSystem.toCoordPoint(t.moveBy(s._state.centerInTiles),1))}(r.position,t-s.getZoom())),n=t,e=i,o=new yt.Point(-1e-10),o=s.coordSystem.getCoordBounds(e.copy().moveBy(o),e.copy().moveBy(o.neg())),o=xt.boundaryRestrict(n,s.getMinZoom(o),s.getMaxZoom(o)),r.smooth&&Math.abs(t-o)<3?!a&&t==s.getZoom()&&r.position&&r.centering?s.panTo(r.position,r):(a||(a=new bt.SmoothZoomer(s),Dt.observe(a,"ZoomEnd",h,this)),a.zoomTo(o,r.position,r.centering)):(s.setCenter(i,o),l(yt.State.SUCCESS))):(r.position&&r.centering?s.setCenter(r.position,t):s._state.zoom=t,l(yt.State.SUCCESS))},this.zoomBy=function(t,e){this.zoomTo((a?a.getTargetZoom():s.getZoom())+t,e)},this.stop=function(){a&&a.stop()}},bt.SmoothMoving=function(t){this._map=t,Dt.observe(t,t.Events.Destruct,this._destruct,this),this._actionHandler=Lt(this._actionHandler,this)},(Mt=bt.SmoothMoving.prototype).isActive=function(){return!!this._tickIntervalID},Mt.start=function(t,e){this._tickIntervalID&&this._stop(1);e=this._options=wt.extend({speedUpTime:120,startSpeed:5,speed:37,timeout:20,nonstop:0},e);this._startZoom=this._map.getZoom(),this._currentPosition=this._map._state.centerInTiles.copy(),this._pixelOffset=t,this._tickIntervalID||(this._currentSpeed=e.startSpeed,this._setTickInterval(),this._map._moveStart()),this._speedIncrement=(e.speed-this._currentSpeed)/(e.speedUpTime/e.timeout)},Mt.stop=function(t){this._tickIntervalID&&(clearInterval(this._tickIntervalID),this._tickIntervalID=null,this._stop(t),this._map._moveEnd())},Mt._stop=function(t){this.callback(t?yt.State.FAILURE:yt.State.SUCCESS)},Mt.callback=function(t){var e;this._options.callback&&(e=this._options.callback,this._options.callback=null,e(t))},Mt._setTickInterval=function(){this._tickIntervalID=setInterval(this._actionHandler,this._options.timeout)},Mt._actionHandler=function(){var t=this._action();1!=t&&this.stop(-1==t)},Mt._action=function(){var t,e,i=this._map._state.centerInTiles,n=this._pixelOffset,o=-1;return this._currentPosition.equals(i)&&this._startZoom==this._map.getZoom()&&(t=this._options,e=Math.sqrt(n.x*n.x+n.y*n.y),e=n.copy().scale(e?1/e:1),this._currentSpeed!=t.speed&&(this._currentSpeed+=this._speedIncrement,this._currentSpeed=Math[0<this._speedIncrement?"min":"max"](t.speed,this._currentSpeed)),e=e.scale(this._currentSpeed),t.nonstop?o=1:(e.apply(Math.round),(o=this._pixelOffset.distance(new kt)>e.distance(new kt))||(e=this._pixelOffset),this._pixelOffset=e.diff(this._pixelOffset)),this._options.moveCallback&&this._options.moveCallback(),this._map._move(e),o&&(this._currentPosition=i.copy())),o},Mt._destruct=function(){this.stop(1),this._map=this._pixelOffset=this._currentPosition=this._tickIntervalID=this._speedIncrement=this._currentSpeed=this._vector=this._startZoom=null},(Ct=yt.ControlPosition=function(t,e){this.anchor=this._normalizeAnchor(t),this.offsets=this._normalizeOffsets(e||new yt.Point)}).TOP_LEFT=0,Ct.TOP_RIGHT=1,Ct.BOTTOM_LEFT=2,Ct.BOTTOM_RIGHT=3,Ct.prototype={_normalizeAnchor:function(t){return isNaN(Number(t))?0:t%4},_normalizeOffsets:function(t){return[this._normalizeCoordinate(t.x),this._normalizeCoordinate(t.y)]},_normalizeCoordinate:function(t){var e=Number(t||0);return isNaN(e)?t:e+"px"},apply:function(t){wt(t).css(1&this.anchor?"right":"left",this.offsets[0]).css(2&this.anchor?"bottom":"top",this.offsets[1])}},bt.DraggingControl=function(t){var i,n,o,e,s,a,r=t;function h(){this._beginListening(),i.addCursor("grab")}function l(t){i._state.cache=!0,o=0;t=new kt(t.clientX,t.clientY);n=i.converter.clientPixelsToLocalPixels(t),i.addCursor("grabbing")}function c(t){var e=i.converter.clientPixelsToLocalPixels(new kt(t.clientX,t.clientY)),t=e.diff(n);o||(o=1,i._dragStart(),i._moveStart()),i._move(t),i._drag(t),n=e}function u(){i._state.cache=!1,i.removeCursor("grabbing"),n=null,o&&(i._moveEnd(),i._dragEnd())}this.onAddToMap=function(t){i=t,a=[],s=new xt.DragAndDrop.MouseMove(r,0,At.tremor.draggingControl,i),(this.onAddToMap=h).call(this)},this._beginListening=function(){s.beginListening(),a.push(Dt.observe(s,"start",l),Dt.observe(s,"move",c),Dt.observe(s,"stop",u)),e=Dt.observe(i,i.Events.Destruct,this._destruct,this)},this.onRemoveFromMap=function(){this._stopListening(),i.removeCursor("grab")},this._stopListening=function(){s.stopListening(),Ot(a,"cleanup"),a=[],e.cleanup(),n&&u()},this._destruct=function(){i&&(this.onRemoveFromMap(),i=n=null)}},bt.TouchZoomControl=function(){var s,a,r,h,i,e,l=.001,n=!1;function o(t,e){n||(n=!0,i.move.enable(),i.end.enable(),s.animator.start()),r=p(e),h=_(e),e.preventMapEvent(),e.getEvent().preventDefault()}function c(t,e){var i=p(e),n=i/r,o=_(e);s.animator.move(o.diff(h)),Math.abs(1-n)>l&&(s.animator.scale({saveThisPosition:s._restrictCenter(a.localPixelsToCoordinates(o)),scaleCoefficient:s.animator.getState().scaleCoefficient*n}),r=i),h=o,e.preventMapEvent(),e.getEvent().preventDefault()}function u(t,e){d(),e.preventMapEvent(),e.getEvent().preventDefault()}function d(){i.move.disable(),i.end.disable(),s.animator.stop(),n=!1}function p(t){t=t.touches[0].getLocalPixels().distance(t.touches[1].getLocalPixels());return Math.max(t,1)}function _(t){return t.touches[0].getLocalPixels().copy().moveBy(t.touches[1].getLocalPixels()).scale(.5)}this.onAddToMap=function(t){a=(s=t).converter,function(){e=Dt.observe(s,s.Events.Destruct,this.onRemoveFromMap,this),i={start:Dt.observe(s,s.Events.MultiTouchStart,o,this),move:Dt.observe(s,s.Events.BeforeMultiTouchMove,c,this,!1),end:Dt.observe(s,s.Events.BeforeMultiTouchEnd,u,this,!1)}}()},this.onRemoveFromMap=function(){s&&(n&&d(),e.cleanup(),i.start.cleanup(),i.move.cleanup(),i.end.cleanup(),s=null)}},bt.ScrollZoomControl=function(){var o,n,s,a,r,h,l,c={smooth:!0},u=0,d=0;function p(t,i){var e=i.getEvent(),n=xt.sign(e.deltaY);n&&(r=n,a=new Date,h=h||setTimeout(function(){l=setInterval(function(){var t,e;d<a?(d=new Date,u+=r,Math.abs(u)<=3&&(t=r,e=i.getCoordPoint(1),o.zoomBy(t,{smooth:c.smooth,position:e,callback:function(t){t==yt.State.SUCCESS&&(u=0)}}))):(clearInterval(l),l=h=0)},100)},100)),e.preventDefault()}function _(){this.onRemoveFromMap(),o=null}this.onAddToMap=function(t,e,i){o=t,n=Dt.observe(o,o.Events.DOMMouseScroll,p,this),s=Dt.observe(o,o.Events.Destruct,_,this),i&&(c=wt.extend({},c,i))},this.onRemoveFromMap=function(){s.cleanup(),n.cleanup(),u=0}},bt.DblClickZoomControl=function(){var n,i,o,s=[];function a(t,e){h(e.getEvent()),t.zoomBy(1,{smooth:o.smooth,position:e.getGeoPoint(),centering:1})}function r(t){var e=new Date;i&&e-i<500&&(t=n.converter.clientPixelsToCoordinates(new kt(t.clientX,t.clientY)),n.zoomBy(-1,{smooth:o.smooth,position:t,centering:1}),e=null),i=e}function h(t){t.preventDefault()}function l(t,e){r(e.getEvent()),h(e.getEvent())}this.onAddToMap=function(t,e,i){n=t,"mac"==wt.os.name&&Pt.mozilla&&1.8<Pt.version&&(l=function(t,e){h(e.getEvent())},s.push(Dt.observe(n,n.Events.MouseUp,function(t,e){3==(e=e.getEvent()).which&&r(e)}))),s.push(Dt.observe(n,n.Events.DblClick,a,this),Dt.observe(n,n.Events.ContextMenu,l,this)),(this.onAddToMap=function(t,e,i){Ot(s,"enable"),o=wt.extend({smooth:1},i)})(t,e,i)},this.onRemoveFromMap=function(){i=null,Ot(s,"disable")}},bt.MagnifierControl=function(n,o){var s,a,r,h,l,c,u,d,p={smooth:0};function _(t,e,i){o||(s.addCursor("zoom"),d=Dt.observe(s,s.Events.Click,b)),wt(document).bind("keydown","esc",v),c.beginListening(),u=[Dt.observe(c,"start",f),Dt.observe(c,"move",m),Dt.observe(c,"stop",g)],l=Dt.observe(s,s.Events.Destruct,this._destruct,this),i&&(p=wt.extend({},p,i))}function f(t){r=s.converter.clientPixelsToLocalPixels(new kt(t.clientX,t.clientY))}function m(t){h=s.converter.clientPixelsToLocalPixels(new kt(t.clientX,t.clientY));var e=r.copy(),t=e.diff(h);t.x&&t.y?(t.x<0&&(e.moveByX(t.x),t.scaleX(-1)),t.y<0&&(e.moveByY(t.y),t.scaleY(-1)),xt.position(a,e),xt.size(a,t),wt(a).css("display","")):wt(a).css("display","none")}function g(t){var e,i,n;h=s.converter.clientPixelsToLocalPixels(new kt(t.clientX,t.clientY)),(e=h).equals(r)||(n=new yt.CollectionBounds([r,e]),i=s.converter.localPixelsToCoordinates(n.getCenter()),t=s.getContainerSize(),e=n.getSpan(),n=t.x/e.x,e=t.y/e.y,e=Math.floor(Math.log(Math.min(n,e))/Math.LN2),e=s.getZoom()+(0<e?e:0),s.setZoom(e,{smooth:p.smooth,position:i,centering:1})),y()}function v(t){r&&(c.abort(),y(),t.preventDefault())}function y(){wt(a).css("display","none"),r=null}function b(t,e){t.setCenter(e.getCoordPoint(),t.getZoom()+1)}this.onAddToMap=function(t,e,i){s=t,a=wt("<div />").addClass("YMaps-select-frame").css({display:"none","z-index":yt.ZIndex.CONTROL-1})[0],s.getContainer().appendChild(a),c=new xt.DragAndDrop.MouseMove(n,o,null,s),(this.onAddToMap=_).call(this,t,e,i)},this.onRemoveFromMap=function(){l.cleanup(),r&&y(),o||(s.removeCursor("zoom"),d.cleanup()),wt(document).unbind("keydown","esc",v),c.stopListening(),Ot(u,"cleanup")},this._destruct=function(){s&&this.onRemoveFromMap(),r=u=a=s=null}},bt.RightButtonMagnifierControl=function(t){return new bt.MagnifierControl(t,1)},bt.HotKeysControl=function(t){var o,s,e,i,a=[],r=0,h=0,l=0,n=0,c=0,u={zoomTimeout:300,startSpeed:1,speed:15,speedUpTime:1100,smooth:0,moveCallback:function(){n&&o._drag()},callback:function(){n&&!c&&(b(),o._dragEnd()),c=0}},d={63234:37,63232:38,63235:39,63233:40},p={};function _(t){u=wt.extend({},u,t)}function f(t,e,i){s.appendTo(o.getContainer()),s.bind("blur",b),wt(window).bind("blur",b);var n=Pt.opera?"keypress":"keydown";wt.each(["up","right","down","left","shift+up","shift+right","shift+down","shift+left"],function(){var t=this.toString();s.bind(n,t,m).bind("keyup",t,g)}),wt.each(["+","="],function(){s.bind(n,this.toString(),C)}),s.bind(n,{key:"+",shift:!0},C),wt.each(["-","_"],function(){s.bind(n,this.toString(),M)}),s.bind(n,{key:"-",shift:!0},M),Ot(a,"enable"),i&&_(i)}function m(t){var e,i,n,o,s=v(t);p[s]&&(clearTimeout(p[s]),delete p[s]),e=s,i=t.shiftKey,n=h,o=r,s=l,1&e?h=2&e?1:-1:r=2&e?-1:1,(l=i)==s&&n==h&&o==r||y(),t.preventDefault()}function g(e){var i=v(e);p[i]=setTimeout(function(){var t;delete p[i],t=e.shiftKey,l=t,1&i?h=0:r=0,(h||r?y:b)()},50),e.preventDefault()}function v(t){t=t.charCode||t.keyCode;return Pt.webkit&&Pt.version<=523.15?d[t]:t}function y(){var t;n?c=1:(o._dragStart(),n=1),l&&!Pt.opera?((t=wt.extend({},u)).startSpeed=t.speed,o.startMove(new kt(h,r),t)):o.startMove(new kt(h,r),u)}function b(){for(var t in h=r=0,n&&(o.stopMove(),n=0),p)p.hasOwnProperty(t)&&clearTimeout(p[t]);p={}}function C(){x(1)}function M(){x(-1)}function x(t){t=(i||o.getZoom())+t;t<o.getCurrentMinZoom()||t>o.getCurrentMaxZoom()||t==o.getZoom()||(i=t,e&&clearTimeout(e),e=setTimeout(w,u.zoomTimeout))}function w(){e=null,o.setZoom(i,{smooth:u.smooth}),i=null}_(t),this.onAddToMap=function(t,e,i){o=t,s=wt("<button />").addClass("YMaps-hot-keys-focus-holder");var n=o.Events;(a=Dt.observe(o,[n.DragEnd,n.Click],function(){s[0].focus()})).push(Dt.observe(o,n.Update,b),Dt.observe(o,n.Destruct,this._destruct,this)),(this.onAddToMap=f).call(this,t,e,i)},this.onRemoveFromMap=function(){b(),s.remove(),Ot(a,"disable")},this._destruct=function(){this.onRemoveFromMap(),Ot(a,"cleanup"),wt(window).unbind("blur",b),o=s=a=null}},bt.CopyrightsControl=function(){var s,a,e,i,r,n,o,h,l,c=[];function u(t,e,i,n,o){var s=" !important;",a="",o=["background-color: transparent","border: none","float: none","z-index: "+(yt.ZIndex.CONTROL+1),"position: "+t,"overflow: "+o||"hidden","padding: 0"];return e&&(o.push("display: "+e),"inline"==e&&o.push("font-family: Arial,sans-serif","font-size: 10px","text-indent: 0","text-align: left","white-space: nowrap","line-height: normal","text-decoration: "+i,"-webkit-text-size-adjust: none")),o.push(""),a=o.join(s),n=n||{},wt.each(["margin-top","margin-right","margin-bottom","margin-left","height","width"],function(t,e){a+=e+": "+(n[e]?n[e]+"px":t<4?"0":"auto")+s}),a}function d(){var t,e,i,n,o=s.getType();a.find("*").andSelf().css("color",o.getTextColor()),t=o.getTextColor(),e=t.replace("#",""),i=e.length/3,n=1==i?15:255,o=parseInt(e.slice(0,i),16)/n,t=parseInt(e.slice(i,2*i),16)/n,n=parseInt(e.slice(2*i,3*i),16)/n,.5<(Math.max(o,Math.max(t,n))+Math.min(o,Math.min(t,n)))/2?r.attr("class","YMaps-logo YMaps-logo-white"):r.attr("class","YMaps-logo"),p()}function p(){var t=c.concat(s._getLayerCopyrights());e.html(0<t.length?t.join(", ")+"&nbsp;&ndash;&nbsp;":""),n.attr("href",function(){var t=o;h&&(t+=(-1==t.indexOf("?")?"?":"&")+"origin=jsapi"+(l?"&ll="+s.getCenter().getX()+","+s.getCenter().getY()+"&z="+s.getZoom()+"&l=map":""));return t}())}this.onAddToMap=function(t){l=(s=t).coordSystem==Bt;t=s.getContainer();r=wt('<div style="'+u("absolute","block","none",{height:20,width:51})+'"><a href="javascript:void(0)" target="_blank" class="YMaps-logo-link" style="'+u("absolute","block","none",{height:20,width:51})+'"><i style="'+u("absolute",null,"none",{height:106,width:56})+'"></i></a></div>').appendTo(t),n=r.find(".YMaps-logo-link"),o=At.copyrights.logoLink,h=At.copyrights.addStateToLogoLink,Pt.msie&&yt.dom(n[0]).events.add("mouseenter",function(){n.addClass("YMaps-logo-link_hover")}).add("mouseleave",function(){n.removeClass("YMaps-logo-link_hover")}),a=wt('<div class="YMaps-copyrights" style="'+u("absolute","block","none",{},"visible")+'"><span style="'+u("static","inline","none")+'"></span><a href="'+At.copyrights.agreementLink+'" target="_blank" style="'+u("static","inline","underline")+'">'+At.copyrights.agreement+"</a></div>").appendTo(t),e=a.find("span"),i=a.find("a"),d();t=s.Events;Dt.observe(s,t.TypeChange,d),Dt.observe(s,[t.BoundsChange,t.AddLayer,t.RemoveLayer],p)},this.addCopyright=function(t){t&&(c.push(t),s&&p())},this.removeCopyright=function(t){t=c.indexOf(t);-1!=t&&(c.splice(t,1),s&&p())},this.checkVisibility=function(){"blocked"==bt.checkVisibility(n[0])&&bt.statCount({pid:443,cid:72959,path:"logoHidden.1_1"}),"blocked"==bt.checkVisibility(i[0])&&bt.statCount({pid:443,cid:72959,path:"copyrightsHidden.1_1"})},this.onRemoveFromMap=xt.NULL,this.update=p},Ct=yt.TypeControl=function(t,e,i){this.__types=[],this.__buttons=[],this.__buttonListeners=[],this.__changeTypeListener=null,this.__enabled=1,this.__options=wt.extend({width:100,caption:At.hints.typeControl.more},i||{}),this.__toolBar=new yt.ToolBar([]),this.__listBox=new bt.TypeListBox(this.__buttonGroup,this.__options),e=e||[];for(var n=0,o=(t=t||[yt.MapType.MAP,yt.MapType.SATELLITE,yt.MapType.HYBRID]).length;n<o;n++)this.addType(t[n],-1!=wt.inArray(n,e))},(Mt=Ct.prototype).__buttonGroup="default#types",Mt.__isListItem=function(t){t=wt.inArray(t,this.__types);return-1==t?0:-1!=this.__listBox.indexOf(this.__buttons[t])},Mt.__getTypeButton=function(t){t=wt.inArray(t,this.__types);return-1==t?null:this.__buttons[t]},Mt.onAddToMap=function(t,e){this.__map=t,this.__toolBar.onAddToMap(t,e||new yt.ControlPosition(yt.ControlPosition.TOP_RIGHT,new yt.Point(5,5))),this.__changeTypeListener=Dt.observe(t,t.Events.TypeChange,this.update,this),this.update()},Mt.update=function(){var t,e;this.__map&&(t=this.__map.getType(),e=wt.inArray(t,this.__types),this.__applySelection(this.__currentType,0),-1==e?this.__currentType=null:(this.__applySelection(t,1),this.__currentType=t))},Mt.enable=function(){this.__enabled||(this.__toolBar.forEach(function(t){t.enable()}),this.__listBox.enable(),this.__enabled=1)},Mt.disable=function(){this.__enabled&&(this.__toolBar.forEach(function(t){t.disable()}),this.__listBox.disable(),this.__enabled=0)},Mt.isEnabled=function(){return this.__enabled},Mt.__applySelection=function(t,e){t&&(this.__isListItem(t)?this.__listBox[e?"select":"deselect"](t):this.__getTypeButton(t)[e?"select":"deselect"]())},Mt.addType=function(t,e){var i;t&&-1==wt.inArray(t,this.__types)&&(i=e?new yt.ListBoxItem(t.getName()):new yt.ToolBarRadioButton(this.__buttonGroup,{caption:t.getName()}),e||this.__enabled||i.disable(),this.__types.push(t),this.__buttons.push(i),e?(this.__listBox.add(i),1==this.__listBox.length()&&this.__toolBar.add(this.__listBox)):this.__listBox.length()?this.__toolBar.splice(-1,0,i):this.__toolBar.add(i),this.__buttonListeners.push(Dt.observe(i,i.Events.Click,function(){this.__map.setType(t),this.__isListItem(t)&&this.__listBox.collapse()},this))),this.update()},Mt.removeType=function(t){var e=t?wt.inArray(t,this.__types):-1;-1!=e&&(this.__buttonListeners[e].cleanup(),this.__buttonListeners.splice(e,1),this.__currentType==t&&(this.__applySelection(t,0),this.__currentType=null),(this.__isListItem(t)?this.__listBox:this.__toolBar).remove(this.__buttons[e]),this.__types.splice(e,1),this.__buttons.splice(e,1),this.__listBox.length()||this.__toolBar.remove(this.__listBox)),this.update()},Mt.getTypes=function(){return this.__types.slice()},Mt.onRemoveFromMap=function(){this.__map&&(this.__changeTypeListener.cleanup(),this.__changeTypeListener=null,this.__toolBar.onRemoveFromMap(),this.__map=null)},Ct=bt.TypeListBox=function(t,e){yt.ListBox.call(this,e),this.__inactiveCaption=e.caption,this.__groupId=t,this.__selected=0},(Mt=Et(Ct,yt.ListBox)).isSelected=function(){return this.__selected},Mt.getGroupId=function(){return this.__groupId},Mt.select=function(t){var e;this.__selected||(this.__selected=1,this.getToolBar&&(e=this,wt.each(this.getToolBar().getByGroupId(this.__groupId),function(){this!=e&&this.isSelected()&&this.deselect()}),this.setState({color:"green"}),this.getElement().find(".YMaps-btn-name").removeClass("YMaps-btn-name_layers").addClass("YMaps-btn-name_green"))),this.setCaption(t.getName())},Mt.deselect=function(){this.__selected=0,this.setCaption(this.__inactiveCaption),this.setState({color:""}),this.getElement().find(".YMaps-btn-name").removeClass("YMaps-btn-name_green").addClass("YMaps-btn-name_layers")},function(){function g(t,e,i){t&&0<=e.currentIndex&&(e=e.get(e.currentIndex),i.noCentering||(e.getBounds()?t.setBounds(e.getBounds()):t.setCenter(e.getCoordPoint())),i.noPlacemark||(t.addOverlay(e),e.openBalloon(null,{mapAutoPan:!i.noCentering})))}function v(t,e,i){t&&0<=e.currentIndex&&!i.noPlacemark&&t.removeOverlay(e.get(e.currentIndex))}yt.SearchControl=function(t){var n,s,o,a,i,r=this,h=wt.extend({resultsPerPage:3,width:240,noCentering:0,noPlacemark:0,useMapBounds:1},t),l={action:yt.State.EMPTY,expanded:1,enabled:1},c="";function u(t,e,i){for(var n=0,o=t.length;n<o;n++)s.listeners.push(yt.dom(t[n]).events.eventListener().add(e,i))}function d(t){var e=a.get(t),i=a.page*h.resultsPerPage;yt.Events.notify(r,r.Events.Select,r,e),v(n,a,h),-1!=a.currentIndex&&s.$list.find("dd").eq(a.currentIndex-i).removeClass("YMaps-btn-list-item_current"),-1!=(a.currentIndex=t)&&s.$list.find("dd").eq(t-i).addClass("YMaps-btn-list-item_current"),g(n,a,h)}function p(){var t,e=P(s);e&&(t=+new Date,c&&e==c&&t-i<At.dblClickTimeout||(c=e,i=t,l.action=yt.State.LOADING,f(),C(l,a,s),a.search(e,_)))}function _(t){l.action=t,n&&(M(a,s,h,d),C(l,a,s),a.length()&&-1==a.currentIndex&&d(0))}function f(){n&&(s.$list.empty(),v(n,a,h)),a.currentIndex=-1,a.page=0,a.removeAll()}function m(t){a.page=t,a.length()>t*h.resultsPerPage?M(a,s,h,d):(l.action=b,C(l,a,s),a.getMore(_))}h.resultsPerPage=Math.round(xt.boundaryRestrict(h.resultsPerPage,1,20)),h.width=Math.max(h.width,200),a=new e(this,h),this.getMap=function(){return n},this.Events={Select:"Select"},this.onAddToMap=function(t,e){var i,e=e||new yt.ControlPosition(yt.ControlPosition.TOP_RIGHT,new yt.Point(200,5));n=t,s=new y(h),o=s.$element,e.apply(o),w(s,c),C(l,a,s),l.action==yt.State.SUCCESS&&M(a,s,h,d),o.appendTo(n.getContainer()),x(o),u(s.$submit,"click",function(){p()}),u(s.$switcher,"click",function(){l.expanded=!l.expanded,C(l,a,s)}),u(s.$cleaner,"click",function(){l.action=yt.State.EMPTY,c="",f(),n&&(C(l,a,s),w(s,""),0<=a.currentIndex&&!h.noPlacemark&&n.removeOverlay(a.get(a.currentIndex)))}),u(s.$hint,"click",function(){s.$input[0].focus()}),u(s.$input,"focus",function(){T(s)}),u(s.$input,"blur",function(){P(s)||S(s)}),u(s.$input,"keyup",function(t){13==t.which&&p()}),u(s.$prev,"click",function(){m(a.page-1)}),u(s.$next,"click",function(){m(a.page+1)}),Pt.msie&&(Pt.version<8||document.documentMode<8)&&(i=o.find(".YMaps-arr"),u(e=o.find(".YMaps-btn-name_result"),"mouseenter",function(){i.addClass("YMaps-arr_hover")}),u(e,"mouseleave",function(){i.removeClass("YMaps-arr_hover")})),u(o.find(".YMaps-pseudo-link"),"click",function(t){t.preventDefault()}),g(n,a,h)},this.onRemoveFromMap=function(){n&&(v(n,a,h),Ot(s.listeners,"removeAll"),Ot(s.itemListeners,"removeAll"),s.listeners=[],s.itemListeners=[],o.empty().remove(),o=s=n=null)},this.expand=function(){l.expanded||(l.expanded=1,n&&C(l,a,s))},this.collapse=function(){l.expanded&&(l.expanded=0,n&&C(l,a,s))},this.isExpanded=function(){return l.expanded},this.enable=function(){l.enabled||(l.enabled=1,n&&C(l,a,s))},this.disable=function(){l.enabled&&(l.enabled=0,n&&C(l,a,s))},this.isEnabled=function(){return l.enabled},this.parseGeocoderResult=function(t){var e,i;return t.name||t.description||(t.text?(e=t.text.split(", "),i=t.kind&&"house"==t.kind?-2:-1,t.name=e.slice(i).join(", "),t.description=e.slice(0,i).join(", ")):t.getCoordPoint?t.name=t.getCoordPoint().toString():t.name=At.hints.searchControl.noname),t}};var y=function(t){var e=At.hints.searchControl,e=wt('<div class="YMaps-btn YMaps-cursor-default"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i" style="width: '+t.width+'px"><i class="YMaps-btn__disabler"></i><div class="YMaps-h-search"><table class="YMaps-l-search"><tbody><tr><td class="YMaps-l-search-l"><div class="YMaps-b-search-wrap"><label class="YMaps-b-hint-input">'+e.mapSearch+'</label><input type="text" name="text" class="YMaps-search-control-text" value=""/></div></td><td class="YMaps-l-search-r"><div class="YMaps-search-control-submit"><i>'+e.find+'</i></div></tr></tbody></table></div><table class="YMaps-l-search YMaps-b-result YMaps-b-result_hide"><tbody><tr><td class="YMaps-l-search-l"><a href="javascript:void(0)" class="YMaps-btn-name YMaps-btn-name_result YMaps-search-control-foundblock"><i class="YMaps-pseudo-link"><span class="YMaps-search-control-found YMaps-search-control-switch"></span></i><i class="YMaps-arr YMaps-search-control-switch"><i></i></i></a><p class="YMaps-search-control-wait">'+e.wait+'</p><p class="YMaps-notice YMaps-search-control-notfound">'+e.notFound+'</p><p class="YMaps-notice YMaps-search-control-failure"></p></td><td class="YMaps-l-search-r"><a href="javascript:void(0)" class="YMaps-pseudo-link"><span class="YMaps-search-control-clean">'+e.clear+'</span></a></td></tr><tr class="YMaps-b-result-list"><td colspan="2"><dl class="YMaps-btn-list YMaps-btn-list_search"><dt class="YMaps-btn-list-query">'+e.correction+' <b class="YMaps-search-control-suggest"></b></dt></dl><dl class="YMaps-btn-list YMaps-btn-list_search YMaps-search-control-list"></dl><dl class="YMaps-btn-list YMaps-btn-list_search"><dd class="YMaps-btn-list-item YMaps-btn-list-item_more"><a class="YMaps-pseudo-link YMaps-prev" href="javascript:void(0)"><span>'+(1<t.resultsPerPage?e.previous[1]+" "+t.resultsPerPage:e.previous[0])+'</span></a><a class="YMaps-pseudo-link YMaps-next" href="javascript:void(0)"><span></span></a></dd></dl></td></tr></tbody></table></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>').css({zIndex:yt.ZIndex.CONTROL,position:"absolute"});return{$element:e,listeners:[],itemListeners:[],$submit:e.find(".YMaps-search-control-submit"),$switcher:e.find(".YMaps-search-control-switch"),$wait:e.find(".YMaps-search-control-wait"),$foundblock:e.find(".YMaps-search-control-foundblock"),$found:e.find(".YMaps-search-control-found"),$notfound:e.find(".YMaps-search-control-notfound"),$failure:e.find(".YMaps-search-control-failure"),$result:e.find(".YMaps-b-result"),$input:e.find(".YMaps-search-control-text"),$hint:e.find(".YMaps-b-hint-input"),$cleaner:e.find(".YMaps-search-control-clean"),$list:e.find(".YMaps-search-control-list"),$correction:e.find(".YMaps-btn-list-query"),$suggest:e.find(".YMaps-search-control-suggest"),$prev:e.find(".YMaps-prev"),$next:e.find(".YMaps-next")}},b="InUpdate",s=["$foundblock","$notfound","$wait","$failure","$result","$element"],l="YMaps-display-none",a="YMaps-btn_disabled",r={cssClass:l,show:"remove",hide:"add"},h={$element:{cssClass:"YMaps-btn_expanded",show:"add",hide:"remove"},$result:{cssClass:"YMaps-b-result_hide",show:"remove",hide:"add"}};function C(t,e,n){var i,o=function(t,e,i){var n=[];switch(e.action){case yt.State.LOADING:n.push("$wait","$element");break;case b:n.push("$foundblock","$wait","$element");break;case yt.State.SUCCESS:n.push("$element"),i?(n.push("$foundblock"),e.expanded&&n.push("$result")):n.push("$notfound");break;case yt.State.FAILURE:n.push("$failure","$element");break;case yt.State.EMPTY:}P(t)||n.push("$hint");return n}(n,t,e.getFound());wt.each(s,function(t,e){var i=h[e]||r;n[e][i[-1!=wt.inArray(e,o)?"show":"hide"]+"Class"](i.cssClass)}),n.$element[(t.enabled?"remove":"add")+"Class"](a),n.$failure.html(e.getErrorMessage()),n.$found.html((i=e.getFound(),t=At.hints.searchControl.quantity,i%10==(e=0)||4<i%10||1==Math.floor(i/10)?e=1:i%10==1&&(e=2),t[e].found+" "+i.toString()+" "+t[e].objects)),x(n.$element)}function M(t,e,i,n){var o=i.resultsPerPage,s=t.page,a=e.$list.empty(),i=Math.min(o,t.getFound()-(s+1)*o);Ot(e.itemListeners,"removeAll"),e.itemListeners=[],t.getSuggest()?(e.$suggest.html("«"+t.getSuggest().replace(/<fix>/gi,"<i>").replace(/<\/fix>/gi,"</i>")+"»"),e.$correction.removeClass(l)):e.$correction.addClass(l);for(var r=s*o,h=Math.min((s+1)*o,t.getFound());r<h;r++)(function(t,e,i,n){var o=t.get(e),t=wt('<dd class="YMaps-btn-list-item'+(e==t.currentIndex?" YMaps-btn-list-item_current":"")+'">'+(o.name?'<a class="YMaps-pseudo-link" href="javascript:void(0)"><span>'+o.name+"</span></a>":"")+(o.description?'<p class="YMaps-note">'+o.description+"</p>":"")+"</dd>");n.push(yt.dom(t[0]).events.eventListener().add("click",function(){i(e)})),o.name&&n.push(yt.dom(t.find(".YMaps-pseudo-link")[0]).events.eventListener().add("click",function(t){t.preventDefault()}));return t})(t,r,n,e.itemListeners).appendTo(a);0<s?e.$prev.removeClass(l):e.$prev.addClass(l),0<i?e.$next.html("<span>"+(1<i?At.hints.searchControl.next[1]+" "+i:At.hints.searchControl.next[0])+"</span>").removeClass(l):e.$next.addClass(l),x(e.$element)}function x(t){t.find(".YMaps-btn__disabler").height(t.find(".YMaps-btn-i").height()+3)}function w(t,e){var i=t.$input;typeof e!==Tt?(i.attr("value",""),S(t)):(i.attr("value",e),T(t))}function P(t){return t.$input.attr("value")}function S(t){t.$hint.removeClass(l)}function T(t){t.$hint.addClass(l)}var e=function(n,o){yt.GeoObjectCollection.call(this);var s,a=this,e=[],r=0,h="",l="",c="",u=null,d="";function i(t){var i,t={results:3*o.resultsPerPage,skip:t,prefLang:o.prefLang};c&&(t.boundedBy=c),o.geocodeOptions&&(t=wt.extend({},o.geocodeOptions,t)),e.length&&p(),s=new yt.Geocoder(l,t),i=s,e=[yt.Events.observe(i,i.Events.Load,function(){var t;(t=i)==s&&(function(){for(var t=0,e=s.length();t<e;t++)a.add(n.parseGeocoderResult(s.get(t)));r=s.found,h=s.suggest}(),p(),u(yt.State.SUCCESS)),t.removeAll()}),yt.Events.observe(i,i.Events.Fault,function(t,e){e=e,i==s&&(p(),d=e,r=0,h="",u(yt.State.FAILURE))})]}function p(){Ot(e,"cleanup"),e=[]}this.getFound=function(){return r},this.getSuggest=function(){return h},this.getErrorMessage=function(){return d},this.page=0,this.currentIndex=-1,this.search=function(t,e){l=t,u=e,c=o.useMapBounds&&n.getMap()?n.getMap().getBounds():null,i(0)},this.getMore=function(t){u=t,i(this.length())}};Et(e,yt.GeoObjectCollection)}(),bt.ZoomButton=function(i,n){var o,e,s=wt('<a class="YMaps-slider-'+(1==i?"plus":"minus")+'" href="javascript:void(0)"><i class="YMaps-slider-btn"><i></i></i></a>'),a=[];function r(){1==i?o.getZoom()>=o.getCurrentMaxZoom()?s.addClass("YMaps-slider-plus_disable"):s.removeClass("YMaps-slider-plus_disable"):o.getZoom()<=o.getCurrentMinZoom()?s.addClass("YMaps-slider-minus_disable"):s.removeClass("YMaps-slider-minus_disable")}this.getElement=function(){return s},this.beginListening=function(t){return this.stopListening(),o=t,e=It(s[0]).events.eventListener().add("click",function(t){var e=o.getZoom()+i;(1==i?e<=o.getCurrentMaxZoom():e>=o.getCurrentMinZoom())&&o.zoomBy(i,{smooth:n}),t.preventDefault()}),a=yt.Events.observe(o,[o.Events.BoundsChange,o.Events.ZoomRangeChange],r),r(),this},this.stopListening=function(){return o&&(e.removeAll(),Ot(a,"cleanup"),a=[],o=null),this}},function(){yt.Zoom=function(s){var a,r,h,l,c,i,n,o=[];function u(){var t;if(c||(e=(c=new d(s)).getContainer(),t=wt(e).find(".YMaps-slider-scale"),(l=new bt.ZoomButton(-1,s.smooth)).getElement().insertBefore(t),(h=new bt.ZoomButton(1,s.smooth)).getElement().insertAfter(t),a.getContainer().appendChild(e),r.apply(e)),!c.isDragging()){for(var e=a.getZoom(),i=Math.max(e,a.getCurrentMaxZoom()),n=Math.min(e,a.getCurrentMinZoom()),o=[];n<=i;i--)o.push(i);c.update({value:a.getZoom(),values:o,isRight:r.anchor%2})}}s=wt.extend({noTips:0,customTips:At.hints.zoom,smooth:1},s||{}),this.onAddToMap=function(t,e){a=t,r=e||new yt.ControlPosition(yt.ControlPosition.TOP_LEFT,new yt.Point(5,75)),u(),o.push(Dt.observe(a,a.Events.Update,function(){c.setValue(a.getZoom()),u()}),Dt.observe(a,a.Events.ZoomRangeChange,u,this),Dt.observe(c.getContainer(),"sliderchange",function(t){n&&window.clearTimeout(n),n=window.setTimeout(function(){a.setZoom(t),c.setFocus()},300)},this)),l.beginListening(a),h.beginListening(a),i=Dt.observe(a,a.Events.Destruct,this._destruct,this)},this._destruct=function(){i.cleanup(),n&&window.clearTimeout(n),a&&(Ot([l,h],"stopListening"),a.getContainer().removeChild(c.getContainer()),c._destruct(),Ot(o,"cleanup"),a=r=c=l=h=null)},this.onRemoveFromMap=this._destruct};var d=function(e){var i,n,o,s,a,t,r,h,l,c,u,d,p,_,f,m,g=[],v=2e3;function y(e){return function(t){e(t),t.preventDefault()}}function b(){f=f||setTimeout(function(){f=void 0,_.hide()},v)}function C(){f&&(clearTimeout(f),f=void 0)}function M(){c=!0,p=i}function x(t){w(Math.round((u-t.clientY-wt(window).scrollTop()-3+r.offset().top)/d))}function w(t){t=Math.max(0,Math.min(n,t));a.css("margin-top",Math.round(u-(t+1)*d-1)+"px"),i=t}function P(){p!=i&&(Dt.notify(s[0],"sliderchange",O()),p=null),c=!1}function S(t){x(t),P()}function T(){L(i-1)}function E(){L(i+1)}function L(t){M(),w(t),P()}function O(t){return o[isNaN(t=parseInt(t))?i:t]}s=wt('<div class="YMaps-slider"><div class="YMaps-slider-content"><div class="YMaps-slider-scale"><i class="YMaps-slider-grab" type="button"><i></i><input type="button"/></i><i class="YMaps-slider-marks"><i></i></i></div></div></div>').css("z-index",yt.ZIndex.CONTROL),a=s.find(".YMaps-slider-grab"),t=a.find("input"),h=s.find(".YMaps-slider-marks"),r=s.find(".YMaps-slider-scale"),e.noTips||(_=new I(r,this,e.customTips)),l=new xt.DragAndDrop.MouseMove(t[0]),Dt.observe(l,"start",M),Dt.observe(l,"move",x),Dt.observe(l,"stop",P),l.beginListening(),g.push(It(h[0]).events.eventListener().add("click",S)),g.push(It(a[0]).events.eventListener().add("mouseenter",function(){wt(a).addClass("YMaps-slider-grab_h")}).add("mouseleave",function(){wt(a).removeClass("YMaps-slider-grab_h")})),e.noTips||g.push(It(s[0]).events.eventListener().add("mouseenter",function(){_.show(),C()}).add("mouseleave",b)),m=Pt.opera?"keypress":"keydown",t.bind(m,"down",y(T)).bind(m,"+",y(T)).bind(m,"up",y(E)).bind(m,"-",y(E)).bind(m,"end",y(function(){L(0)})).bind(m,"home",y(function(){L(n)})),this.update=function(t){o=t.values,n=o.length-1,d=7,u=Math.round((1+n)*d),r.css({height:u+"px","padding-bottom":"0"}),h.css({height:u+"px"}),s.css({height:(u+50).toString()+"px"}),t.isRight?s.addClass("YMaps-slider_left"):s.removeClass("YMaps-slider_left"),e.noTips||_.update(u,d,t.isRight),this.setValue(t.value)},this._destruct=function(){e.noTips||C(),e.noTips||_._destruct(),Ot(g,"removeAll"),g=[],l.stopListening(),s.empty(),s=t=a=r=h=_=l=null},this.isDragging=function(){return c},this.setValue=function(t){"number"!=typeof t||-1!=(t=wt.inArray(t,o))&&w(t)},this.getValue=O,this.setFocus=function(){t[0].focus()},this.getContainer=function(){return s[0]},this.getIndex=function(t){return wt.inArray(t,o)}},I=function(t,e,i){this._slider=e,this._$element=wt('<div class="YMaps-slider-tips" style="visibility: hidden;"></div>').appendTo(t),this._tips=[],this.listeners=[],this._visible=!1;var n=this;wt.each(i,function(e,t){n._tips[e]={index:t.index,$element:wt('<a href="javascript:void(0)" class="YMaps-button-tip YMaps-cursor-pointer"><i class="YMaps-button-tip-l"><i></i></i><i class="YMaps-button-tip-r"><i></i></i><b class="YMaps-button-tip-container"><i class="YMaps-button-tip-text">'+t.value+'</i><i class="YMaps-button-tip-m"></i></b></a>').appendTo(n._$element)},n.listeners.push(It(n._tips[e].$element[0]).events.eventListener().add("click",function(t){Dt.notify(n._slider.getContainer(),"sliderchange",n._tips[e].index),t.preventDefault()}))})};(Mt=I.prototype).update=function(t,e,i){var n,o;for(a=0,r=this._tips.length;a<r;a++)n=this._tips[a],-1==(o=this._slider.getIndex(n.index))?n.$element.addClass("YMaps-display-none"):n.$element.removeClass("YMaps-display-none"),n.$element.css({top:Math.round(t-(o+1)*e-6)+"px"});if(this._$element.css({height:t+"px"}),i?this._$element.addClass("YMaps-slider-tips_left"):this._$element.removeClass("YMaps-slider-tips_left"),Pt.msie&&7<=Pt.version&&Pt.version<8&&"BackCompat"==document.compatMode)for(var s=this._$element.find(".YMaps-button-tip-r"),a=0,r=s.length;a<r;a++){var h=s.eq(a);h.parent().eq(0).width()%2?h.css("right",i?"-10px":"-7px"):h.css("right",i?"-9px":"-6px"),i&&h.css("left","auto")}},Mt.show=function(){this._visible||(this._$element.css({visibility:"visible"}),this._visible=!0)},Mt.getContainer=function(){return this._$element[0]},Mt.hide=function(){this._visible&&(this._$element.css({visibility:"hidden"}),this._visible=!1)},Mt._destruct=function(){Ot(this.listeners,"removeAll"),this.listeners=[]}}(),yt.SmallZoom=function(i){var n,o,s,a;(i=i||{}).smooth=void 0===i.smooth?1:i.smooth,this.onAddToMap=function(t,e){n=t,e=e||new yt.ControlPosition(yt.ControlPosition.TOP_LEFT,new yt.Point(5,75)),o=wt('<div class="YMaps-slider"></div>').css("z-index",yt.ZIndex.CONTROL).appendTo(n.getContainer()),e.apply(o[0]),s&&a||(a=new bt.ZoomButton(-1,i.smooth),s=new bt.ZoomButton(1,i.smooth)),a.beginListening(n).getElement().appendTo(o),s.beginListening(n).getElement().appendTo(o)},this.onRemoveFromMap=function(){n&&(o.removeFromDom(),a.stopListening(),s.stopListening(),n=o=a=s=null)}},(Ct=bt.RulerPointLayout=function(t){var e=wt('<div class="YMaps-placemark-wrap"><i class="YMaps-ruler-point YMaps-cursor-move"><i></i></i><b class="YMaps-button-tip YMaps-ruler-tip YMaps-cursor-default"><i class="YMaps-button-tip-l"><i></i></i><i class="YMaps-button-tip-r"><i></i></i><b class="YMaps-button-tip-container"><i class="YMaps-button-tip-text"><span class="YMaps-number"></span>&nbsp;<span class="YMaps-ruler-text-dist"></span></i><i class="YMaps-button-tip-m"></i></b></b></div>');this.__$nodes={element:e,point:e.find(".YMaps-ruler-point"),hint:e.find(".YMaps-button-tip"),num:e.find(".YMaps-number"),text:e.find(".YMaps-ruler-text-dist"),tipR:e.find(".YMaps-button-tip-r"),button:null},this.setType(t.getType())}).prototype={__typeModifiers:{start:{element:"YMaps-popup-none",point:"YMaps-start-point"},via:{element:"YMaps-popup-hover",point:"YMaps-via-point",hint:"YMaps-ruler-tip-via"},end:{element:"YMaps-popup-visible",point:"YMaps-end-point"}},setType:function(t,e){var i,n=this.__typeModifiers,o=n[this.__type]||{},s=n[t]||{},a=this.__$nodes;wt.each(["element","point","hint"],function(t,e){var i=a[e];o[e]&&i.removeClass(o[e]),s[e]&&i.addClass(s[e])}),"end"==this.__type&&"end"!=t&&(this.__buttonListener.removeAll(),a.button.remove(),a.button=null),"end"!=this.__type&&"end"==t&&(i=wt('<a class="YMaps-ruler-tip-delete YMaps-cursor-pointer" title="'+At.hints.ruler.close+'"></a>').appendTo(a.element.find(".YMaps-button-tip-text")),this.__buttonListener=It(i[0]).events.eventListener().add("click",e),Pt.msie&&(Pt.version<7||Pt.quirksMode)&&this.__buttonListener.add("mouseenter",function(){i.addClass("YMaps-ruler-tip-delete_hover")}).add("mouseleave",function(){i.removeClass("YMaps-ruler-tip-delete_hover")}),a.button=i),a.element.width(),this.__type=t},setData:function(t){var e=this.__$nodes;e.num.html(t.number+")&nbsp;").width(),e.text.html(yt.humanDistance(t.distance)).width(),Pt.msie&&7<=Pt.version&&Pt.version<8&&"BackCompat"==document.compatMode&&e.tipR.css("right",e.tipR.parent().eq(0).width()%2?"-7px":"-6px"),Pt.opera&&Pt.version<9.5&&e.hint.css("width","auto")},onAddToParent:function(t){this.__$nodes.element.appendTo(t)},onRemoveFromParent:function(){this.__$nodes.element.remove(),"end"==this.__type&&this.__buttonListener.removeAll()},getOffset:function(){return new yt.Point(0,0)},setContent:xt.NULL,update:xt.NULL},yt.Templates.add("ruler#icon",new yt.LayoutTemplate(Ct)),Ct=bt.RulerPoint=function(t){yt.Placemark.call(this,t,{draggable:1}),this.__type=bt.RulerPoint.START_POINT,this.__data={},this.__listeners=[]},(Mt=Et(Ct,yt.Placemark)).getIconLayout=function(){return this._icon},Ct.START_POINT="start",Ct.VIA_POINT="via",Ct.END_POINT="end",Mt.setData=function(t){this.__data=t||{};t=this.getIconLayout();t&&t.setData(this.__data)},Mt.getData=function(){return this.__data},Mt.setType=function(t,e){this.__type=t;var i=this.getIconLayout();i&&i.setType(t,e)},Mt.getType=function(){return this.__type},Mt.onAddToGroup=function(t){yt.Placemark.prototype.onAddToGroup.call(this,t),this.__listeners=[yt.Events.observe(this,this.Events.DblClick,function(){t.remove(this)},this),yt.Events.observe(this,this.Events.Drag,function(){t.updatePoints(this)},this)]},Mt.onRemoveFromGroup=function(){Ot(this.__listeners,"cleanup"),yt.Placemark.prototype.onRemoveFromGroup.call(this)},Ct=bt.RulerContainer=function(t){yt.ConnectedPlacemarks.call(this,t);var e=this,i=[Dt.observe(this,this.Events.Add,function(t,e,i){var n=this.length(),o=0;{var s;1<n&&(s=this.get(i-1),1<i&&s.setType(bt.RulerPoint.VIA_POINT),o=s.getData().distance+this.getMap().coordSystem.rulerDistance(e.getCoordPoint(),s.getCoordPoint()),e.setType(bt.RulerPoint.END_POINT,a))}e.setData({number:n,distance:o})},this),Dt.observe(this,this.Events.Remove,function(t,e,i){var n=this.length();n&&(0==i?this.get(0).setType(bt.RulerPoint.START_POINT):i==n&&1<n&&this.get(-1).setType(bt.RulerPoint.END_POINT,a));i!=n&&this.updatePoints(0<i?this.get(i):null)},this)];function a(t){(e.length()<3||confirm(At.hints.ruler.sure))&&e.removeAll(),bt.preventMapEvent(t),t.preventDefault()}this.updatePoints=function(t){for(var e=t?this.indexOf(t):0,i=0<e?this.get(e-1).getData().distance:0,n=this.length();e<n;e++){var o=this.get(e);i+=0<e?this.getMap().coordSystem.rulerDistance(o.getCoordPoint(),this.get(e-1).getCoordPoint()):0,o.setData({number:e+1,distance:i})}},this.removeAll=function(){Ot(i,"disable"),yt.ConnectedPlacemarks.prototype.removeAll.call(this),Ot(i,"enable")}},Et(Ct,yt.ConnectedPlacemarks),bt.RulerControl=function(){var s,a,e,r=new bt.RulerContainer("ruler#style");this.onAddToMap=function(t){s||(s=t).addOverlay(r,1),e=Dt.observe(s,s.Events.Click,function(t,e){r.add(new bt.RulerPoint(e.getGeoPoint(1)))},this),a&&(this.setStateString(a),a=null),s.addCursor(yt.Cursor.ARROW)},this.onRemoveFromMap=function(){s.removeCursor(yt.Cursor.ARROW),e.cleanup()},this.setStateString=function(t){if(s){if(r.removeAll(),t)for(var e=t.split("~"),i=s.coordSystem.getCoordPoint(0,0,1),n=0,o=e.length;n<o;n++)r.add(new bt.RulerPoint(i.moveBy(yt.Point.fromString(e[n]))))}else a=t},this.getStateString=function(){if(r.length()){for(var t,e=r.get(0).getCoordPoint(),i=[s.coordSystem.getCoordPoint(0,0).moveTo(e).toString(8)],n=1,o=r.length();n<o;n++)t=r.get(n).getCoordPoint(),i.push(e.diff(t).toString(8)),e=t;return i.join("~")}return""}},(X=new yt.Style(null)).iconStyle={template:"ruler#icon",offset:new kt(0,0)},X.lineStyle={strokeColor:"d61d00",strokeWidth:2},X.hasBalloon=0,yt.Styles.add("ruler#style",X),yt.Executor=function(t){this.resources=t||[]},(Mt=yt.Executor.prototype).execCommand=function(t,e){if(t instanceof Array||(e=t,t=null),e)for(var i=[e].concat(Array.prototype.slice.call(arguments,t?2:1)),n=0,o=this.resources.length;n<o;n++)t&&-1!=wt.inArray(this.resources[n],t)||this.resources[n].execCommand.apply(this.resources[n],i)},Mt.destroy=function(){Ot(this.resources,"destroy"),this.resources=null},yt.Resource=function(t){this.data=t,this.commands={}},(Mt=yt.Resource.prototype).execCommand=function(t){var e=this.commands[t];e&&e.apply(this,[this].concat(Array.prototype.slice.call(arguments,1)))},Mt.destroy=function(){this.data=this.commands=null},yt.Connect=function(t){yt.Resource.call(this,t),this.events={},this.listeners={},this.eventsByCommand={},wt.extend(this.commands,{connect:function(t){t.connect()},disconnect:function(t){t.disconnect()}})},(Mt=Et(yt.Connect,yt.Resource)).execCommand=function(t){var e,i,n,o=this.eventsByCommand[t];if(o&&this.isConnected())for(i=0,n=o.length;i<n;i++)(e=this.listeners[o[i]])&&e.disable();if(yt.Resource.prototype.execCommand.apply(this,arguments),o&&this.isConnected())for(i=0;i<n;i++)(e=this.listeners[o[i]])&&e.enable()},Mt.connect=function(){for(var t in this.listeners={},this.events)this.events.hasOwnProperty(t)&&function(t,e,i){i.listeners[t]=Dt.observe(i.data,i.data.Events[t],function(){e.apply(t,[i].concat(Array.prototype.slice.call(arguments)))})}(t,this.events[t],this)},Mt.disconnect=function(){for(var t in this.listeners)this.listeners.hasOwnProperty(t)&&this.listeners[t].cleanup();this.listeners=null},Mt.isConnected=function(){return!!this.listeners},Mt.destroy=function(){this.isConnected()&&this.disconnect(),this.events=this.listeners=this.eventsByCommand=null,yt.Resource.prototype.destroy.call(this)},yt.MapConnect=function(t,n){yt.Connect.call(this,t),wt.extend(this.commands,{setCenter:function(t,e,i,n){t.data.setCenter(e,i,n)},setType:function(t,e){t.data.setType(e)},moveStart:function(t){t.data._moveStart()},move:function(t,e,i){var n=t.data.getZoom()-i;t.data._move(e.apply(function(t){return t*Math.pow(2,n)}))},moveEnd:function(t){t.data._moveEnd()}}),wt.extend(this.eventsByCommand,{setCenter:["Update","TypeChange"],setType:["TypeChange"],moveStart:["MoveStart"],move:["Update","Move"],moveEnd:["MoveEnd"]}),wt.extend(this.events,{Update:function(t,e){n.execCommand([t],"setCenter",e.getCenter(),e.getZoom())},TypeChange:function(t,e){n.execCommand([t],"setType",e.getType())},MoveStart:function(t){n.execCommand([t],"moveStart")},Move:function(t,e,i){n.execCommand([t],"move",i.copy(),e.getZoom())},MoveEnd:function(t){n.execCommand([t],"moveEnd")}})},Et(yt.MapConnect,yt.Connect),yt.MiniMap=function(t){this.Events={VisibilityChange:"visibilitychange"};var i,n,o,s,a,r,h,l={zoomOffset:typeof t==Tt?5:t,mapType:new yt.MapType(["map"],"",{minZoom:0}),visible:!0};function c(n){var t=new bt.ALayer;return t.onAddToMap=function(t,e){bt.ALayer.prototype.onAddToMap.call(this,t,e),wt(this.getContainer()).addClass("YMaps-mini-map-frame").css({left:"50%",top:"50%"}),this.onMapUpdate()},t.onMapUpdate=function(){var t=n.getContainerSize().scale(1/Math.pow(2,n.getZoom()-this.getMap().getZoom())),e=t.copy().scale(-.5),i=this.getContainer();xt.size(i,t),wt(i).css("margin",e.y+"px 0 0 "+e.x+"px")},t.onMove=xt.NULL,t}function u(t,e){this._options=e,this._construct(t)}function d(){var t=l.visible;i.toggleClass("YMaps-mini-map-invisible",!t),n.attr("title",At.hints.miniMap[t?"hide":"show"]),i.css("zIndex",yt.ZIndex.CONTROL+(t?0:2)),t?(r.execCommand("connect"),r.resources[0].execCommand("setCenter",s.getCenter(),s.getZoom(),l.mapType)):r.execCommand("disconnect")}this.onAddToMap=function(t,e){s=t,e=e||new yt.ControlPosition(yt.ControlPosition.BOTTOM_LEFT,new yt.Point(5,5)),i=wt("<div />").addClass("YMaps-mini-map"),n=wt("<a />").addClass("YMaps-button-mini-map-hide").css("z-index",yt.ZIndex.CONTROL).attr("title",At.hints.miniMap.hide).appendTo(i),o=wt("<div />").addClass("YMaps-mini-map-map"),i.append(o),It(n[0]).events.add("click",function(){this.setVisible(!this.getVisible())},this),i.appendTo(s.getContainer()),e.apply(i),h=Dt.observe(s,s.Events.Destruct,this.onRemoveFromMap,this),function t(){if(Pt.webkit&&(0==o[0].offsetWidth||0==o[0].offsetHeight))return void window.setTimeout(function(){t()},100);a=new u(o,{coordSystem:s.coordSystem});a.enableDragging();a.addLayer(new c(s));r=new yt.Executor;var e=new yt.MapConnect(a,r),i=new yt.MapConnect(s,r);r.resources.push(e,i);delete i.events.TypeChange;delete e.events.TypeChange;e.commands.setCenter=function(t,e,i,n){t.data.setCenter(e,i-l.zoomOffset,n)};e.commands.redraw=function(t){t.data.redraw()};e.eventsByCommand.redraw=["Update"];i.events.Redraw=function(t){r.execCommand([t],"redraw")};e.events.Click=function(t,e,i){s.panTo(i.getCoordPoint())};d()}()},Et(u,yt.Map),u.prototype._restrictCenter=function(t){return t},this.onRemoveFromMap=function(){s&&(h.cleanup(),It(n[0]).events.removeAll(),i.remove(),r.destroy(),h=s=a=r=i=n=o=null)},this.setType=function(t){l.mapType=t,l.visible&&a&&a.setType(t)},this.getType=function(){return l.mapType},this.setVisible=function(t){l.visible!=t&&(l.visible=t,a&&d(),Dt.notify(this,this.Events.VisibilityChange,this))},this.getVisible=function(){return l.visible}},yt.ScaleLine=function(){var n,i,o,s,a;function r(){var t=n.getType();a.css("color",t.getTextColor())}function h(){var t,e,i,e=(t=75,i=n.converter.coordinatesToLocalPixels(n.getCenter()),e=n.converter.localPixelsToCoordinates(new kt(i.getX()-t/2,i.getY())),i=n.converter.localPixelsToCoordinates(new kt(i.getX()+t/2,i.getY())),n.coordSystem.distance(e,i)),i=function(t){t=Math.round(t).toString();return(Number(t.charAt(0))+1)*Math.pow(10,t.length-1)}(e);s.css("width",parseInt(75*i/e)+"px"),i=1e3<i?i/1e3+" "+At.metric.kilometre:i+" "+At.metric.metre,a.html(i)}this.onAddToMap=function(t,e){n=t,i=e||new yt.ControlPosition(yt.ControlPosition.BOTTOM_RIGHT,new yt.Point(5,37)),s=wt('<div class="YMaps-scale-line"><span>0</span></div>').css({height:(wt.boxModel?3:5)+"px","z-index":yt.ZIndex.CONTROL-2}).appendTo(n.getContainer()),a=s.find("span"),i.apply(s[0]),r(),h();t=Dt.observe,e=n.Events;o=[t(n,e.BoundsChange,h),t(n,e.TypeChange,r)]},this.onRemoveFromMap=function(){n&&(s.remove(),Ot(o,"cleanup"),n=i=s=a=o=null)}},yt.RouteProviders=new xt.ObjectStorage,yt.RouteProviders.add("yandex#router",{route:function(t,e,i,n){i&&!wt.isFunction(i)&&(n=i,i=xt.UNDEF);var o={wayPoints:t.wayPoints,viaPoints:t.viaPoints||[],options:wt.extend({origin:"jsRouter"},t.options)},s={wayPoints:[],routes:[]},a=[st,at,lt,ct(e,n)],r=!1;return function t(e){r||(e?ct(i,n)(o,s):a.shift()(o,s,t))}(),{abort:function(){r=!0}}}}),yt.Router=function(e,t,i){yt.GeoObjectCollection.call(this),this.setStyle("router#route"),this._isLoaded=0,this._request={wayPoints:e,viaPoints:wt.grep(t||[],function(t){return 0<t&&t<e.length-1}),options:i||{}},yt.RouteProviders.get("yandex#router").route(this._request,this._onLoad,this._onLoad,this)},(Mt=Et(yt.Router,yt.GeoObjectCollection))._onLoad=function(t){this._isLoaded=1,(t=mt(t)).error?Dt.notifyPermanent(this,this.Events.Fault,this,t.error.message):(this._duration=t.duration,this._distance=t.distance,this.add(this._routes=t.routes),this.add(this._wayPoints=t.wayPoints),this._boundedBy=t.boundedBy,Dt.notifyPermanent(this,this.Events.Load,this),this.update(),this._map&&this._request.options.viewAutoApply&&this.applyView(),this._wayPoints.length<this._request.wayPoints.length-this._request.viaPoints.length?Dt.notifyPermanent(this,this.Events.GeocodeError,this,this._wayPoints.length):this._routes.length<this._request.wayPoints.length-this._request.viaPoints.length-1?Dt.notifyPermanent(this,this.Events.RouteError,this,this._routes.length+1):Dt.notifyPermanent(this,this.Events.Success,this))},Mt.Events.Load="Load",Mt.Events.Fault="Fault",Mt.Events.Success="Success",Mt.Events.GeocodeError="GeocodeError",Mt.Events.RouteError="RouteError",Mt.getDistance=function(){return this._distance},Mt.getDuration=function(){return this._duration},Mt.getNumWayPoints=function(){return this._wayPoints.length},Mt.getWayPoint=function(t){t=this._wayPoints[t];return t||null},Mt.getNumRoutes=function(){return this._routes.length},Mt.getRoute=function(t){t=this._routes[t];return t||null},Mt.onAddToMap=function(t,e){yt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._isLoaded&&this._request.options.viewAutoApply&&this.applyView()},Mt.applyView=function(){this._boundedBy&&this._map&&this._map.setBounds(this._boundedBy)},yt.Styles.add("router#route",{balloonContentStyle:{template:new yt.Template("<div>$[text]</div>")},lineStyle:{strokeColor:"6C00FF99",strokeWidth:5}}),yt.Route=function(t,e,i,n,o,s,a){e=yt.Polyline.fromEncodedPoints(t,e);wt.extend(this,e),this.setOptions({interactive:0,hasBalloon:0}),this._boundedBy=i,this._routeSegments=n,this._distance=o,this._duration=s,this._viaPoints=a},(Mt=Et(yt.Route,yt.Polyline)).getDistance=function(){return this._distance},Mt.getDuration=function(){return this._duration},Mt.getNumRouteSegments=function(){return this._routeSegments.length},Mt.getRouteSegment=function(t){return this._routeSegments[t]},Mt.getNumViaPoints=function(){return this._viaPoints.length},Mt.getViaPoint=function(t){return this._viaPoints[t]},yt.RouteSegment=function(t,e,i,n,o,s){this._indexInPolyline=t,this._distance=e,this._duration=i,this._action=n,this._angle=o,this._street=s},(Mt=yt.RouteSegment.prototype).getDistance=function(){return this._distance},Mt.getDuration=function(){return this._duration},Mt.getAction=function(){return this._action},Mt.getStreet=function(){return this._street},Mt.getAngle=function(){return this._angle},Mt.getPolylineIndex=function(){return this._indexInPolyline},yt.ViaPoint=function(t){this._indexInPolyline=t},(Mt=yt.ViaPoint.prototype).getPolylineIndex=function(){return this._indexInPolyline},yt.WayPoint=function(t,e){yt.GeocoderResult.call(this,t,e)},Mt=Et(yt.WayPoint,yt.GeocoderResult),function(t){function a(t,e){return 0<t.x*e.y-t.y*e.x}var l,c,n=200,r=yt.Hotspots={},h=t.Hotspots={},o={maps:[],managers:[]};function u(t,e){l[t]?l[t].push(e):l[t]=[e]}o.get=function(t,e){var i=wt.inArray(t,o.maps);if(-1!=i)return o.managers[i];e=new h.Manager(t,e);return o.maps.push(t),o.managers.push(e),e},l={},c={},r.Loader={load:function(t,e){var i,n,o,s,a,r;if(e.key&&wt.isArray(e.key)){a=e.key;for(var h=0,l=e.key.length;h<l;h++)u(e.key[h],{callback:e.callback[h],context:e.context[h]});r=e.key.join("_").replace(/\W/g,"_")}else u(a=e.key||e.id||Math.random(),e),r=a.replace(/\W/g,"_");i=a,n=r,o=window[n],window[n]=function(t){yt.Hotspots.Loader.onLoad(i,t),window[n]=o},s=a,a=r,r=e,a=t+(/\?/.test(t)?"&":"?")+"callback="+a+(r.format?"&format="+r.format:""),tag=wt.ajax({type:"GET",url:a,cache:r.cache,dataType:"script"}),function(t){for(var e=[].concat(s),i=0,n=e.length;i<n;i++)c[e[i]]?c[e[i]].push(t):c[e[i]]=[t]}(tag)},onLoad:function(n,t){for(var e=[].concat(n),i=0,o=e.length;i<o;i++){var s=e[i],a=l[s];if(a){for(var r=0,h=a.length;r<h;r++)a[r].callback&&a[r].callback.call(a[r].context||window,t);delete l[s]}}!function(){for(var t=[].concat(n),e=0,i=t.length;e<i;e++)c[t[e]]&&function(t){setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}(c[t[e]])}()},cancel:function(t){var e="string"==typeof t?t:t.key,i=l[e];if(i)if(t.callback){for(var n=t.callback,o=t.context,s=[],a=0,r=i.length;a<r;a++)i[a].callback==n&&i[a].context==o||s.push(i[a]);s.length?l[e]=s:delete l[e]}else delete l[e]}},h.Loader=r.Loader,(Ct=h.AHotspotShape=function(t){var e,i,n,o,s=yt.Point,a=n=t[0],r=o=t[1];this._points=[new s(a,r)];for(var h=2;h<t.length-1;h+=2)e=t[h],i=t[h+1],a=Math.min(e,a),r=Math.min(i,r),n=Math.max(e,n),o=Math.max(i,o),this._points.push(new s(e,i));this._minX=a,this._minY=r,this._maxX=n,this._maxY=o}).prototype={setOwner:function(t){this._object=t},getOwner:function(){return this._object},getMinX:function(){return this._minX},getMinY:function(){return this._minY},getMaxX:function(){return this._maxX},getMaxY:function(){return this._maxY},contains:xt.NULL,getNumPoints:function(){return this._points.length},getPoint:function(t){return this._points[t].copy()}},Ct=r.RectShape=function(t){this._minX=Math.min(t[0],t[2]),this._minY=Math.min(t[1],t[3]),this._maxX=Math.max(t[0],t[2]),this._maxY=Math.max(t[1],t[3])},(Mt=Et(Ct,h.AHotspotShape)).contains=function(t){return t.x>=this._minX&&t.y>=this._minY&&t.x<=this._maxX&&t.y<=this._maxY},Mt.getNumPoints=Mt.getPoint=xt.NULL,Ct=r.CPolyShape=function(t){h.AHotspotShape.call(this,t)},(Mt=Et(Ct,h.AHotspotShape)).contains=function(t){for(var e=this._points,i=e[this._points.length-1].diff(t),n=e[0].diff(t),o=a(i,n),s=1;s<e.length;s++)if(i=n,n=e[s].diff(t),a(i,n)!=o)return 0;return 1},Ct=r.NPolyShape=function(t){h.AHotspotShape.call(this,t)},(Mt=Et(Ct,h.AHotspotShape)).contains=function(t){for(var e,i,n,o,s,a=this._points.length,r=this._points[a-1],h=0,l=0;l<a;l++)e=this._points[l],i=t,o=e,s=void 0,s=(n=r).diff(o),(Math.abs(s.y)<1e-8?0:(o=(i.y-n.y)/s.y,-1e-8<n.x-i.x+o*s.x&&-1e-8<o&&o<1?1:0))&&(h=!h),r=e;return h},Ct=h.ShapeContainer=function(t){this.__sortFunction=t,this.__shapes=[],this.__maxWidth=0},(Mt=Ct.prototype).add=function(t){for(var e=[],i=0,n=t.length;i<n;i++)for(var o=t[i],s=0,a=o.getNumShapes();s<a;s++){var r=o.getShape(s),h=r.getMaxX()-r.getMinX();e.push(r),h>this.__maxWidth&&(this.__maxWidth=h)}e.sort(function(t,e){return t.getMinX()-e.getMinX()}),this.__shapes=this.__merge(this.__shapes,e)},Mt.remove=function(t){for(var e=[],i=0,n=this.__shapes.length;i<n;i++)-1==wt.inArray(this.__shapes[i].getOwner(),t)&&e.push(this.__shapes[i]);this.__shapes=e},Mt.__merge=function(t,e){for(var i=[],n=0,o=0,s=t.length,a=e.length;n<s&&o<a;)t[n].getMinX()<e[o].getMinX()?(i.push(t[n]),n++):(i.push(e[o]),o++);for(;n<s;n++)i.push(t[n]);for(;o<a;o++)i.push(e[o]);return i},Mt.clear=function(){this.__shapes=[],this.__maxWidth=0},Mt.getShapeInPosition=function(t){if(!this.__shapes.length)return null;for(var e=this.getPosition(t.getX()-this.__maxWidth),i=this.getPosition(t.getX()+1),n=t.x,o=t.y,s=[],a=e;a<i;a++){var r=this.__shapes[a];r.getMinX()<=n&&r.getMaxX()>=n&&r.getMinY()<=o&&r.getMaxY()>=o&&r.contains(t)&&s.push(this.__shapes[a])}return s.length?(s.sort(this.__sortFunction),s[0]):null},Mt.getPosition=function(t){return this.__getPosition(0,this.__shapes.length-1,t)},Mt.__getPosition=function(t,e,i){var n=this.__shapes[t].getMinX(),o=this.__shapes[e].getMinX();return i<=n?t:o<i?e+1:e-t==1?e:((n=t+Math.round((e-t)*(i-n)/(o-n)))==t?n++:n==e&&n--,this.__shapes[n].getMinX()<i?this.__getPosition(n,e,i):this.__getPosition(t,n,i))},Ct=r.Object=function(t,e,i,n){this.__layer=t,this.__data=i||{},"number"!=typeof n&&"string"!=typeof n||(n={priority:parseFloat(n)}),this.__options=wt.extend({priority:0,style:yt.Styles.DefaultStyleKey},n),this.__shapes=e,Ot(this.__shapes,"setOwner",this)},(Mt=Ct.prototype).getLayer=function(){return this.__layer},Mt.getNumShapes=function(){return this.__shapes.length},Mt.getShape=function(t){return this.__shapes[t]},Mt.getData=function(){return this.__data},Mt.getPriority=function(){return this.__options.priority},Mt.__getComputedStyle=function(){if(!this.__computedStyle){for(var t=yt.Styles,e=yt.Style.copy(t.get(this.__options.style)||t.get(t.DefaultStyleKey)),i=e.parentStyle;i;)(i=t.get(i))&&(yt.Style.extendStyle(e,i,0),i=i.parentStyle);yt.Style.extendStyle(e,yt.AGeoObject.fullStyle),this.__computedStyle=e}return this.__computedStyle},Mt.requestHintData=function(t){t(yt.Templates.get(this.__getComputedStyle().hintContentStyle.template).build(this.__data))},Mt.requestBalloonData=function(t,e){t(yt.Templates.get(this.__getComputedStyle().balloonContentStyle.template).build(this.__data),e.getCoordPoint(1))},Ct=h.Manager=function(t,e){this.__map=t,this.__mapLayerContainer=e,this.__layers=[],this.__layerObjects=[],this.__containers=[],this.__overlays=[],this.__overlayShapeContainer=new h.ShapeContainer(function(t,e){return e.getOwner().getOptions().priority-t.getOwner().getOptions().priority}),this.__listeners=[],this.__activeTile={tile:null,zoom:null};var i=t.coordSystem,n=i.getWorldSize(),o=new yt.Point(n.getX()/2,n.getY()/2),s=i.toCoordPoint(o),e=i.toCoordPoint(o.copy().moveBy(n),1),o=i.fromCoordPoint(s,e).diff(o);this.__xCycled=!!o.getX(),this.__yCycled=!!o.getY(),this.__worldSizeInPixels=n.scale(Math.pow(2,t.getZoom()-i.getMaxZoom()))},(Mt=Ct.prototype).__getShapeContainer=function(t){var e=t.getOptions().priority,t=this.__containers[e]||new h.ShapeContainer(function(t,e){return e.getOwner().getPriority()-t.getOwner().getPriority()});return this.__containers[e]||(this.__containers[e]=t),t},Mt.addLayer=function(t){var e,i;-1==wt.inArray(t,this.__layers)&&(this.__layers.length||this.__overlays.length||this.__beginListening(),this.__layers.push(t),this.__layerObjects.push([]),e=this.__activeTile.tile,i=this.__activeTile.zoom,e&&i&&t.getObjectSource().requestObjects(this.__getLoadListener(t,e,i,1),t,e,i))},Mt.removeLayer=function(t){var e=wt.inArray(t,this.__layers);-1!=e&&(this.__removeObjects(t),this.__layers.splice(e,1),this.__layerObjects.splice(e,1),this.__layers.length||this.__overlays.length||this.__stopListening())},Mt.addOverlay=function(t){-1==wt.inArray(t,this.__overlays)&&(this.__layers.length||this.__overlays.length||this.__beginListening(),this.__overlays.push(t),this.__overlayShapeContainer.add([t]))},Mt.removeOverlay=function(t){var e=wt.inArray(t,this.__overlays);-1!=e&&(this.__activeShape&&this.__activeShape.getOwner()==t&&this.__leave(),this.__overlays.splice(e,1),this.__overlayShapeContainer.remove([t]),this.__layers.length||this.__overlays.length||this.__stopListening())},Mt.__beginListening=function(){var t=this.__map,e=t.Events,i=this;this.__updateMapPixelOffset(),this.__listeners=yt.Events.observe(t,[e.BeforeMouseDown,e.BeforeMouseUp,e.BeforeClick,e.BeforeDblClick],this.__onMouseEvent,this),this.__listeners.push(yt.Events.observe(t,e.BeforeMouseMove,this.__onMoveEvent,this)),wt.merge(this.__listeners,yt.Events.observe(t,[e.MoveStart,e.SmoothZoomStart,e.Destruct],this.__abortCurrentAction,this)),this.__listeners.push(yt.Events.observe(t,t.Events.BoundsChange,this.__onUpdate,this)),wt(this.__mapLayerContainer).bind("mouseleave.hs",function(){i.__abortCurrentAction()})},Mt.__stopListening=function(){wt(this.__mapLayerContainer).unbind("mouseleave.hs"),Ot(this.__listeners,"cleanup"),this.__listeners=[],this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null),this.__lastMoveEvent=null,this.__lastMissedEvent=null},Mt.__onMouseEvent=function(t,e){e.isMapEventPrevented()?this.__abortCurrentAction(e):(this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null,this.__processMouseEvent(this.__lastMoveEvent)),this.__processMouseEvent(e)),this.__lastMissedEvent=this.__activeShape||e.isMapEventPrevented()?null:e},Mt.__onMoveEvent=function(t,e){var i=this;(this.__lastMoveEvent=e).isMapEventPrevented()?this.__abortCurrentAction(e):(this.__activeShape&&this.__activeShape.contains(this.__getPixelPosition(e))&&this.__notify("mousemove",this.__activeShape,e),this.__moveTickTimeout||(this.__moveTickTimeout=window.setTimeout(function(){i.__processMouseEvent(i.__lastMoveEvent),i.__moveTickTimeout=null},n)))},Mt.__onUpdate=function(){this.__updateMapPixelOffset(),this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null),this.__lastMissedEvent=null,this.__lastMoveEvent=null},Mt.__updateMapPixelOffset=function(){var t=this.__map,e=t.coordSystem,i=t.getZoom(),n=t.getContainerSize().scale(.5),o=e.fromCoordPoint(t.getCenter()),o=t.tileCoordinates.scale(o,e.getMaxZoom(),i);this.__mapPixelOffset=n.diff(o),this.__worldSizeInPixels=e.getWorldSize().scale(Math.pow(2,i-e.getMaxZoom()))},Mt.__getPixelPosition=function(t){t=t.getLocalPixels().copy().moveBy(this.__mapPixelOffset);return new yt.Point(this.__xCycled?xt.cycleRestrict(t.getX(),0,this.__worldSizeInPixels.getX()-1e-10):t.getX(),this.__yCycled?xt.cycleRestrict(t.getY(),0,this.__worldSizeInPixels.getY()-1e-10):t.getY())},Mt.__processMouseEvent=function(t){var e,i;t.isMapEventPrevented()||(e=this.__getPixelPosition(t),i=(i=this.__map.tileCoordinates).fromPixels(i.scale(e),this.__map.getZoom()).number,this.__updateActiveTile(i),this.__updateActiveObject(t,e),this.__activeShape&&"mousemove"!=t.getEvent().type&&this.__notify(t.getEvent().type,this.__activeShape,t))},Mt.__updateActiveObject=function(t,e){var i=this.__getActiveShape(e||t.getLocalPixels().copy().moveBy(this.__mapPixelOffset)),e=i?i.getOwner():null;e!=(this.__activeShape?this.__activeShape.getOwner():null)&&(this.__leave(t),e&&(this.__notify("mouseenter",i,t),this.__notify("mousemove",i,t))),this.__activeShape=i},Mt.__notify=function(t,e,i){var n=e.getOwner();n.getLayer?yt.Events.notify(n.getLayer(),t,n.getLayer(),n,i,e):yt.Events.notify(n,t,n,i,e)},Mt.__getActiveShape=function(t){for(var e=this.__overlayShapeContainer.getShapeInPosition(t),i=e?e.getOwner().getOptions().priority:0,n=this.__containers.length-1;i<=n;n--)if(this.__containers[n]){var o=this.__containers[n].getShapeInPosition(t);if(o){e=o;break}}return e},Mt.__updateActiveTile=function(t){var e=this.__map.getZoom(),i=this.__activeTile.zoom!=e;this.__tileEquals(t,this.__activeTile.tile)&&!i||(this.__activeTile={tile:t,zoom:e},this.__updateLayers(),i&&this.__updateOverlays())},Mt.__updateLayers=function(){var t,e,i=this.__activeTile.tile,n=this.__activeTile.zoom;for(this.__activeShape&&this.__activeShape.getOwner().getLayer&&this.__leave(),t=0,e=this.__containers.length;t<e;t++)this.__containers[t]&&this.__containers[t].clear();if(i)for(t=0,e=this.__layers.length;t<e;t++)this.__layers[t].getObjectSource().requestObjects(this.__getLoadListener(this.__layers[t],i,n),this.__layers[t],i,n)},Mt.__updateOverlays=function(){this.__overlays.length&&(this.__activeShape&&-1!=wt.inArray(this.__activeShape.getOwner(),this.__overlays)&&this.__leave(),this.__overlayShapeContainer.clear(),this.__overlayShapeContainer.add(this.__overlays))},Mt.__getLoadListener=function(e,i,n,o){var s=this;return function(t){-1!=wt.inArray(e,s.__layers)&&s.__activeTile.tile.equals(i)&&s.__activeTile.zoom==n&&s.__addObjects(e,t,o)}},Mt.__abortCurrentAction=function(t){this.__leave(t),this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null),this.__lastMoveEvent=null},Mt.__leave=function(t){this.__activeShape&&(this.__notify("mouseleave",this.__activeShape,t||this.__lastMoveEvent),this.__activeShape=null)},Mt.__addObjects=function(t,e,i){var n=wt.inArray(t,this.__layers);-1!=n&&(this.__layerObjects[n]=e,this.__getShapeContainer(t).add(e),(e=this.__lastMissedEvent)&&!i&&(this.__updateActiveObject(e),this.__activeShape&&(this.__notify(e.getEvent().type,this.__activeShape,e),this.__lastMissedEvent=null)),this.__lastMoveEvent&&!this.__lastMoveEvent.isMapEventPrevented()&&this.__updateActiveObject(this.__lastMoveEvent))},Mt.__removeObjects=function(t){var e=wt.inArray(t,this.__layers),i=this.__activeShape;-1!=e&&this.__layerObjects[e].length&&(this.__containers[t.getOptions().priority].remove(this.__layerObjects[e]),i&&i.getOwner().getLayer&&i.getOwner().getLayer()==t&&this.__leave()),this.__layerObjects[e]=[]},Mt.__tileEquals=function(t,e){return t&&e?t.equals(e):t==e},Ct=r.ObjectSource=function(t,e,i){this.__tileUrlTemplate=t,this.__keyTemplate=e,this.__options=wt.extend({useBrowserCache:1,useProgramCache:0,programCacheEntries:100,bounds:null,minZoom:0,maxZoom:23},i),this.__options.useProgramCache&&this._enableCache(this.__options.programCacheEntries)},(Mt=Ct.prototype).__gStrings=["","G","Ga","Gag","Gaga","Gagar","Gagari","Gagarin"],Mt.getOptions=function(){return this.__options},Mt.getTileUrl=function(t,e){return this.__tileUrlTemplate.replace("%d",2*(1&t.x)+(1&t.y)+1).replace("%c","x="+t.x+"&y="+t.y+"&z="+e).replace("%g","g="+this.__gStrings[(3*t.x+t.y)%8])},Mt.getKey=function(t,e){return this.__keyTemplate.replace("%c","x="+t.x+"&y="+t.y+"&z="+e)},Mt.getTileUrlTemplate=function(){return this.__tileUrlTemplate},Mt.setTileUrlTemplate=function(t){this.__tileUrlTemplate=t},Mt.getKeyTemplate=function(){return this.__keyTemplate},Mt.setKeyTemplate=function(t){this.__keyTemplate=t},Mt.requestObjects=function(e,i,t,n){var o,s;this.isRestricted(i,t,n)?e([]):(o=this.getKey(t,n),s=null,(s=this.__options.useProgramCache?this.getCachedData(o):s)?e(s):r.Loader.load(this.getTileUrl(t,n),{key:o,cache:this.__options.useBrowserCache,callback:function(t){t=this.parseResponse(i,t);this.__options.useProgramCache&&this.cacheData(o,t),e(t)},context:this}))},Mt.isRestricted=function(t,e,i){var n=this.__options;if(i>n.maxZoom)return 1;if(i<n.minZoom)return 1;if(null!==n.bounds){e=e.copy().moveBy(new yt.Point(.5,.5)).scale(yt.TILE_SIZE),t=t.getMap();if(!t)return 0;e=t.coordSystem.toCoordPoint(t.tileCoordinates.scale(e));if(!n.bounds.contains(e))return 1}return 0},Mt.parseResponse=function(n,t){var o=this,s=n.getMap();return s?wt.map(t.objects,function(t){var e=t.base||t.center,i=s.tileCoordinates.scale(s.coordSystem.fromCoordPoint(e),s.coordSystem.getMaxZoom(),s.getZoom()),e=wt.map(t.geometry,function(t){return o.__makeShape(i,t)});return o.createObject(n,e,t.data,{priority:t.priority,style:t.style})}):[]},Mt.createObject=function(t,e,i,n){return new r.Object(t,e,i,n)},Mt.__shapes={rect:r.RectShape,npoly:r.NPolyShape,cpoly:r.CPolyShape},Mt.__makeShape=function(t,e){for(var i=e.shape?e.coords:e,n=t.getX(),o=t.getY(),s=0;s<i.length-1;s+=2)i[s]+=n,i[s+1]+=o;return new(e.shape?this.__shapes[e.shape]:r.RectShape)(i)},(Mt=r.ObjectSource.prototype)._enableCache=function(t){this.__cacheCapacity=t,this.clearCache()},Mt._disableCache=function(){this.clearCache()},Mt.cacheData=function(t,e){this.__cacheEntries[this.__getFreeCachePosition()]=t,this.__cache[t]=e},Mt.__getUsedSize=function(){var t=this.__cacheEnd-this.__cacheStart;return 0<=t?t:t+this.__cacheCapacity},Mt.__getFreeCachePosition=function(){if(this.__getUsedSize()<this.__cacheCapacity){var t=this.__cacheEnd;return this.__cacheEnd=(this.__cacheEnd+1)%this.__cacheCapacity,t}t=this.__cacheStart;return delete this.__cache[this.__cacheEntries[t]],this.__cacheEntries[t]=null,this.__cacheStart=(this.__cacheStart+1)%this.__cacheCapacity,this.__cacheEnd=(this.__cacheEnd+1)%this.__cacheCapacity,t},Mt.getCachedData=function(t){return typeof this.__cache[t]!=Tt?this.__cacheHits++:this.__cacheMisses++,this.__cache[t]},Mt.clearCache=function(){this.__cache={},this.__cacheEntries=[],this.__cacheSize=this.__cacheStart=this.__cacheEnd=0,this.__cacheHits=this.__cacheMisses=0},Ct=r.Overlay=function(t,e){this._geometry=t||[],this._options=wt.extend({},s,e),this.__listeners=[],yt.AInteractiveGeoObject.call(this,this._options),this._hintContent=null,this._hintCustomContent=null,this._hintCustomContentLayout=null,this._balloonContent=null,this._balloonCustomContent=null,this._balloonCustomContentLayout=null},Mt=Et(Ct,yt.AInteractiveGeoObject);var s={interactive:yt.Interactivity.INTERACTIVE,cursor:yt.Cursor.POINTER,priority:0};Mt.Events={MouseEnter:"mouseenter",MouseMove:"mousemove",MouseLeave:"mouseleave",MouseDown:"mousedown",MouseUp:"mouseup",Click:"click",DblClick:"dblclick",BalloonOpen:"balloonopen",BalloonClose:"balloonclose"},Mt.__shapes={rect:r.RectShape,cpoly:r.CPolyShape,npoly:r.NPolyShape},Mt.getGeometry=function(){return this._geometry},Mt.setGeometry=function(t){this._geometry=t,this.update()},Mt.onAddToMap=function(t){this.__map=t,this.__beginListening(),o.get(t).addOverlay(this)},Mt.getMap=function(){return this.__map},Mt.__beginListening=function(){var t=this._options.interactive==yt.Interactivity.INTERACTIVE;this.__listeners=[],t&&this.getOptions().hasBalloon&&this.__listeners.push(yt.Events.observe(this,this.Events.Click,this.__onClick)),(t&&this.getOptions().hasHint||this._options.cursor!=yt.Cursor.INHERIT)&&(this.__listeners.push(yt.Events.observe(this,this.Events.MouseEnter,this.__onMouseEnter),yt.Events.observe(this,this.Events.MouseLeave,this.__onMouseLeave)),this.getOptions().hasHint&&t&&this.__listeners.push(yt.Events.observe(this,this.Events.MouseMove,this.__onMouseMove)))},Mt.__stopListening=function(){Ot(this.__listeners,"cleanup"),this.__listeners=[]},Mt.getOptions=function(){return wt.extend(yt.AInteractiveGeoObject.prototype.getOptions.call(this),{priority:this._options.priority,cursor:this._options.cursor,interactive:this._options.interactive})},Mt.setOptions=function(t,e){var i=0,n=e?wt.extend({},s,t):t;typeof n.cursor!=Tt&&n.cursor!=this._options.cursor&&(t=this.__map&&this.__cursorAdded,this.__removeCursor(),this._options.cursor=n.cursor,t&&this.__addCursor(),i=1),typeof n.interactive!=Tt&&(this._options.interactive=n.interactive,this.__map&&(i=1)),1==i&&(this.__stopListening(),this.__beginListening()),yt.AInteractiveGeoObject.prototype.setOptions.call(this,n,e),typeof n.priority!=Tt&&n.priority!=this._options.priority&&(this._options.priority=n.priority,this.update())},Mt.update=function(){var t=this.__map;yt.AInteractiveGeoObject.prototype.update.call(this),t&&(this.onRemoveFromMap(),this.onAddToMap(t))},Mt.onRemoveFromMap=function(){this.closeBalloon(),this.__hideHint(0),this.__removeCursor(),o.get(this.__map).removeOverlay(this),Ot(this.__listeners,"cleanup"),this.__map=null},Mt.getNumShapes=function(){return this.__map?this._geometry.length:0},Mt.getShape=function(t){for(var e=this._geometry[t],i=e.shape?e.coords:e,t=this.__map,n=t.coordSystem,o=t.getZoom(),s=n.getMaxZoom(),a=t.tileCoordinates,r=[],h=0,l=i.length;h<l;h++){var c=a.scale(n.fromCoordPoint(i[h]),s,o);r.push(c.x,c.y)}e=new this.__shapes[e.shape||"rect"](r);return e.setOwner(this),e},Mt.onMapUpdate=xt.NULL,Mt.__onClick=function(t,e,i){var n=this;e.preventMapEvent(),this.__map.openBalloon(e.getCoordPoint(),this._getBalloonContentLayout(),wt.extend({},this.getBalloonOptions(),{onClose:function(){n.__onBalloonClose()}})),this.__balloonOpened=1,this.__hintShown&&this.__map.hint.hide(),yt.Events.notify(this,this.Events.BalloonOpen,this)},Mt.__onBalloonClose=function(){this.__balloonOpened=0,yt.Events.notify(this,this.Events.BalloonClose,this)},Mt.__onMouseEnter=function(t,e){this.getOptions().hasHint&&this._options.interactive==yt.Interactivity.INTERACTIVE&&this.__showHint(e.getLocalPixels()),this.__addCursor()},Mt.__showHint=function(t){var e=this;this.__map.hint.show(t,this._getHintContentLayout(),wt.extend({},this.getHintOptions(),{onHide:function(){e.__onHintHide()}})),this.__hintShown=1},Mt.__addCursor=function(){var t=this._options.cursor;t&&t!=yt.Cursor.INHERIT&&!this.__cursorAdded&&(this.__map.addCursor(t),this.__cursorAdded=1)},Mt.__onHintHide=function(){this.__hintShown=0},Mt.__onMouseLeave=function(){this.__hideHint(),this.__removeCursor()},Mt.__hideHint=function(t){this.__hintShown&&this.__map.hint.hide(t)},Mt.__removeCursor=function(){this.__cursorAdded&&(this.__map.removeCursor(this._options.cursor),this.__cursorAdded=0)},Mt.__onMouseMove=function(t,e){this.__hintShown?this.__map.hint.moveTo(e.getLocalPixels()):this.__showHint(e.getLocalPixels())},Mt.openBalloon=function(t,e,i){var n;this.__map&&(this.closeBalloon(),yt.AInteractiveGeoObject.prototype.openBalloon.call(this,t,e),(n=this).__map.openBalloon(i||this.__getBalloonPoint(),this._getBalloonContentLayout(),wt.extend({},this.getBalloonOptions(),{onClose:function(){e&&e.onClose&&e.onClose(),n.__onBalloonClose()}})),this.__balloonOpened=1,yt.Events.notify(this,this.Events.BalloonOpen,this))},Mt.closeBalloon=function(){this.__balloonOpened&&this.__map.closeBalloon()},Mt.__getBalloonPoint=function(){var t=this.__map.coordSystem;if(!this._geometry.length)return t.getCoordPoint(0,0);for(var e=this._geometry[0].coords||this._geometry[0],i=0,n=0,o=e.length,s=0;s<o;s++)i+=e[s].getX(),n+=e[s].getY();return t.getCoordPoint(i/o,n/o)},Mt.getBalloon=function(){return this.__map&&this.__balloonOpened?this.__map.getBalloon():null},Mt.setBalloonOptions=function(t){yt.AInteractiveGeoObject.prototype.setBalloonOptions.call(this,t),this.__balloonOpened&&this.__map.getBalloon().setOptions(this._getComputedBalloonOptions(),1)},Mt.setHintOptions=function(t,e){yt.AInteractiveGeoObject.prototype.setHintOptions.call(this,t,e),this.__hintShown&&this.__map.hint.setOptions(this._getComputedHintOptions(),e)},Mt.setHintContent=function(t){this._hintCustomContent=t,this._hintCustomContentLayout=xt.normalizeContent(t),this._hintContent=null},Mt.getHintContent=function(){return this._hintCustomContent},Mt._getHintContentLayout=function(){return this._hintContent||(this._hintCustomContentLayout?this._hintContent=this._hintCustomContentLayout:this._hintContent=yt.Templates.get(this.getComputedStyle().hintContentStyle.template).build(this)),this._hintContent},Mt.setBalloonContent=function(t){this._balloonCustomContent=t,this._balloonCustomContentLayout=xt.normalizeContent(t),this._balloonContent=null},Mt.getBalloonContent=function(){return this._balloonCustomContent},Mt._getBalloonContentLayout=function(){return this._balloonContent||(this._balloonContent=this._balloonCustomContentLayout||yt.Templates.get(this.getComputedStyle().balloonContentStyle.template).build(this)),this._balloonContent},Ct=r.Layer=function(t,e){this._options=wt.extend({},i,e),this._objectSource=t,this.__cursorAdded=0},Mt=Ct.prototype;var i={interactive:yt.Interactivity.INTERACTIVE,cursor:yt.Cursor.POINTER,priority:0,hasHint:1,hintOptions:{},hasBalloon:1,balloonOptions:{}};Mt.Events={MouseEnter:"mouseenter",MouseMove:"mousemove",MouseLeave:"mouseleave",MouseDown:"mousedown",MouseUp:"mouseup",Click:"click",DblClick:"dblclick",BalloonOpen:"balloonopen",BalloonClose:"balloonclose"},Mt.getObjectSource=function(){return this._objectSource},Mt.getOptions=function(){return this._options},Mt.setOptions=function(t,e){e=e?wt.extend({},i,t):t,t=typeof e.interactive!=Tt&&this._options.interactive!=e.interactive;t&&this._options.interactive==yt.Interactivity.INTERACTIVE&&(this._options.hasHint&&this._disableHint(),this._options.hasBalloon&&this._disableBalloon()),this._setHintOptions(e),this._setBalloonOptions(e),t&&(this._options.interactive=e.interactive),t&&this._options.interactive==yt.Interactivity.INTERACTIVE&&(this._options.hasHint&&this._enableHint(),this._options.hasBalloon&&this._enableBalloon()),this._setCursorOptions(e),typeof e.priority!=Tt&&e.priority!=this._options.priority&&((t=this.getMap())&&t.removeLayer(this),this._options.priority=e.priority,t&&t.addLayer(this))},Mt.update=function(){var t=this.__map;t&&(t.removeLayer(this),t.addLayer(this))},Mt.getMap=function(){return this.__map},Mt.onAddToMap=function(t,e){this.__map=t,this._layerManager=o.get(t,e),this._layerManager.addLayer(this),this._options.hasHint&&this._options.interactive==yt.Interactivity.INTERACTIVE&&this._enableHint(),this._options.hasBalloon&&this._options.interactive==yt.Interactivity.INTERACTIVE&&this._enableBalloon(),this._enableCursor()},Mt.onRemoveFromMap=function(){this._layerManager.removeLayer(this),this._options.hasHint&&this._options.interactive==yt.Interactivity.INTERACTIVE&&this._disableHint(),this._options.hasBalloon&&this._options.interactive==yt.Interactivity.INTERACTIVE&&this._disableBalloon(),this._disableCursor(),this.__map=null},Mt.onMapUpdate=Mt.onSmoothZoomStart=Mt.onSmoothZoomTick=Mt.onMove=Mt.onSmoothZoomEnd=Mt.getCopyright=Mt.getZoomRange=xt.NULL,(Mt=r.Layer.prototype)._enableHint=function(){this.__mouseEventListeners=[yt.Events.observe(this,this.Events.MouseEnter,this.__onMouseEnter),yt.Events.observe(this,this.Events.MouseMove,this.__onMouseMove),yt.Events.observe(this,this.Events.MouseLeave,this.__onMouseLeave)],this.__hintDataIsReady=0,this.__hintPosition=null,this.__hintObject=null},Mt._disableHint=function(){this.__hintObject&&this._hideHint(),Ot(this.__mouseEventListeners,"cleanup"),this.__mouseEventListeners=[]},Mt._setHintOptions=function(t){var e=this,i=this.__hintObject,n=this.getMap();typeof t.hintOptions!=Tt&&(this._options.hintOptions=t.hintOptions,n&&this.__hintObject&&this.__hintDataIsReady&&n.hint.setOptions(wt.extend({},this._options.hintOptions,{onHide:function(){e.__onHideHint(i)}}))),typeof t.hasHint!=Tt&&t.hasHint!=this._options.hasHint&&(n&&this._options.hasHint&&this._disableHint(),this._options.hasHint=t.hasHint,n&&t.hasHint&&this._enableHint())},Mt.__onMouseEnter=function(t,e,i,n){var o=this;this.__hintObject=e,this.__hintPosition=i.getLocalPixels(),this.__hintDataIsReady=0,e.requestHintData(function(t){e!=o.__hintObject||o.__hintDataIsReady||o.__onLoadHintData(t)},i,n)},Mt.__onMouseMove=function(t,e,i){this.__hintPosition=i.getLocalPixels(),this.__hintObject==e&&this.__hintDataIsReady&&this._moveHint(this.__hintPosition)},Mt.__onMouseLeave=function(t,e){this.__hintObject==e&&this._hideHintIfVisible()},Mt.__onLoadHintData=function(t){this.__hintDataIsReady=1;var e=this,i=this.__hintObject;this._showHint(t,function(){e.__onHideHint(i)}),this.__hintObject=i},Mt.__onHideHint=function(t){this.__hintObject==t&&(this.__hintObject=null)},Mt._showHint=function(t,e){this.getMap().hint.show(this.__hintPosition,t,wt.extend({},this._hintOptions,{onHide:e}))},Mt._moveHint=function(t){this.getMap().hint.moveTo(t)},Mt._hideHint=function(){this.getMap().hint.hide()},Mt._hideHintIfVisible=function(){this.__hintObject&&this.__hintDataIsReady&&this._hideHint(),this.__hintObject=null},(Mt=r.Layer.prototype)._enableBalloon=function(){var t=this.getMap();this.__balloonListeners=[yt.Events.observe(this,this.Events.Click,this.__onClick),yt.Events.observe(t,t.Events.BalloonOpen,this.__onBalloonOpen,this),yt.Events.observe(this,this.Events.MouseDown,this.__onMouseDown)],this.__dragListeners=[yt.Events.observe(t,t.Events.BeforeMouseMove,function(){yt.Events.notify(t,t.Events.MouseDown,t,this.__lastMouseDown),Ot(this.__dragListeners,"disable"),this.__lastMouseDown=null},this,0),yt.Events.observe(t,t.Events.BeforeMouseUp,function(t,e){e.preventMapEvent(),Ot(this.__dragListeners,"disable"),this.__lastMouseDown=null},this,0)],this.__balloonInitEvent={object:null,dataIsReady:0,shape:null,event:null,canceled:0},this.__balloonOpened=0},Mt._disableBalloon=function(){var t;Ot(this.__balloonListeners,"cleanup"),Ot(this.__dragListeners,"cleanup"),this.__lastMouseDown&&(t=this.getMap(),yt.Events.notify(t,t.Events.MouseDown,t,this.__lastMouseDown),this.__lastMouseDown=null),this.__balloonListeners=[],this._closeBalloon()},Mt._setBalloonOptions=function(t){var e=this.getMap();typeof t.balloonOptions!=Tt&&(this._options.balloonOptions=t.balloonOptions,e&&this.__balloonOpened&&e.getBalloon().setOptions(wt.extend(this._options.balloonOptions,{onClose:this.__getBalloonCloseListener(this.__balloonInitEvent)}))),typeof t.hasBalloon!=Tt&&t.hasBalloon!=this._options.hasBalloon&&(e&&this._options.hasBalloon&&this._disableBalloon(),this._options.hasBalloon=t.hasBalloon,e&&t.hasBalloon&&this._enableBalloon())},Mt.__getBalloonCloseListener=function(t){var e=this;return function(){yt.Events.notify(e,e.Events.BalloonClose,e,t.object),t.object=null,e.__balloonOpened=0}},Mt.__onClick=function(t,i,n,e){var o=this,s=i.getData();n.preventMapEvent(),this.__balloonInitEvent.object!=i&&"string"==typeof s.id&&"u"===s.id[0]&&(this.__balloonInitEvent={object:i,dataIsReady:0,event:n,shape:e,canceled:0},i.requestBalloonData(function(t,e){o.__balloonInitEvent.object!=i||o.__balloonInitEvent.canceled||o.__onLoadBalloonData(t,e||n.getCoordPoint(1))},n,e))},Mt.__onMouseDown=function(t,e,i){(this.__lastMouseDown=i).preventMapEvent(),Ot(this.__dragListeners,"enable")},Mt.__onLoadBalloonData=function(t,e){this.__balloonInitEvent.dataIsReady=1,this._openBalloon(t,e,this.__getBalloonCloseListener(this.__balloonInitEvent))},Mt._openBalloon=function(t,e,i){this._options.hasHint&&this._hideHintIfVisible(),this.getMap().openBalloon(e,t,wt.extend({},this._options.balloonOptions,{onClose:i})),this.__balloonOpened=1;i=this.__balloonInitEvent;yt.Events.notify(this,this.Events.BalloonOpen,this,i.object,i.event,i.shape)},Mt._closeBalloon=function(){this.__balloonOpened&&this.getMap().closeBalloon(),this.__balloonInitEvent.canceled=1},Mt.__onBalloonOpen=function(){this.__balloonInitEvent.canceled=1},(Mt=r.Layer.prototype)._enableCursor=function(){this.__cursorAdded=0,this.__cursorListeners=[yt.Events.observe(this,this.Events.MouseEnter,this.__addCursor),yt.Events.observe(this,this.Events.MouseLeave,this.__removeCursor)]},Mt._disableCursor=function(){this.__removeCursor()},Mt._setCursorOptions=function(t){var e;typeof t.cursor!=Tt&&((e=this.__cursorAdded)&&this.__removeCursor(),this._options.cursor=t.cursor,e&&this.__addCursor())},Mt.__addCursor=function(){var t=this._options.cursor;this.getMap()&&!this.__cursorAdded&&(t!=yt.Cursor.INHERIT&&this.getMap().addCursor(t),this.__cursorAdded=1)},Mt.__removeCursor=function(){var t=this._options.cursor,e=this.getMap();e&&this.__cursorAdded&&(t!=yt.Cursor.INHERIT&&window.setTimeout(function(){e.removeCursor(t)},0),this.__cursorAdded=0)}}(bt),q=yt.Metro={},W=new yt.Template("<div>$[text]</div>"),yt.Templates.add("metro#stationBalloonTemplate",W),(W=new yt.Style).balloonContentStyle={template:"metro#stationBalloonTemplate"},yt.Styles.add("metro#station",W),Ct=q.Closest=function(t,e){yt.GeoObjectCollection.call(this,"metro#station"),e=e||{},this.request=t,this.found=0,this.prefLang=e.prefLang||null;var i=new yt.Size(e.span?Math.min(e.span.getX(),1):.1,e.span?Math.min(e.span.getY(),1):.1);yt.GeocodeProviders.get("yandex#map").geocode(t,{boundedBy:yt.GeoBounds.fromCenterAndSpan(t,i),kind:"metro",origin:"jsClosestMetro",prefLang:e.prefLang,results:e.results,skip:e.skip},yt.Utils.bindContext(this.__successCallback,this),yt.Utils.bindContext(this.__failureCallback,this))},(Mt=yt.Utils.extend(Ct,yt.GeoObjectCollection)).Events.Load="Load",Mt.Events.Fault="Fault",Mt.__successCallback=function(t){this.found=t.found,this.add(wt.map(t.results,this.__createStation)),yt.Events.notifyPermanent(this,this.Events.Load,this)},Mt.__failureCallback=function(t){yt.Events.notifyPermanent(this,this.Events.Fault,this,t)},Mt.__createStation=function(t){var e=new yt.Metro.Station(t.getGeoPoint());return e.AddressDetails=t.AddressDetails,e.setBounds(t.getBounds()),e.text=t.text,e},Ct=q.Station=function(t,e){yt.Placemark.call(this,t,e),this.text="",this.AddressDetails=null},yt.Utils.extend(Ct,yt.Placemark),function(){var c=wt.browser,a=yt.Point,r=yt.Events;function h(t,e,i){yt.dom(t).events.add(e,i)}function i(t,e,i){yt.dom(t).events.remove(e,i)}var t={DEFAULT_MAX_WIDTH:520,DEFAULT_MAX_HEIGHT:100,DEFAULT_MIN_WIDTH:56,DEFAULT_MIN_HEIGHT:15,CLOSE_BUTTON_WIDTH:20,SIDE_BORDER_WIDTH:12,TAIL_HEIGHT:14},e=bt.versionPath+"i/0.4/plainstyle",n={balloon:{close:"Закрыть"}},l=Ct=function(t,e){this._context=t,this._map=e,this._parentNode=null};(u=Ct.prototype)._setContent=function(t,e){this._contentLayout&&this._contentLayout.onRemoveFromParent(),t&&t.onAddToParent(e),this._contentLayout=t},u.getRootNodes=function(){return this._$elements},u.onAddToParent=function(t){this._parentNode=t,wt(t).append(this._$elements)},u.onRemoveFromParent=function(){this._parentNode=null,this._$elements.removeFromDom()},function(){function t(t,i){function e(t,e){l.call(this,t,e),e='<ymaps:balloon class="YMaps-balloon-small YMaps-balloon-small_'+i+'">                    <ymaps:balloon-content></ymaps:balloon-content>                    <ymaps:balloon-tail class="YMaps-border"></ymaps:balloon-tail>                    <ymaps:balloon-tail></ymaps:balloon-tail>                </ymaps:balloon>',e=this._$elements=wt(e),this._nodes={visContainer:e,content:e.find("ymaps\\:balloon-content"),tail:e.find("ymaps\\:balloon-tail")}}(u=Et(e,l)).onAddToParent=function(t){l.prototype.onAddToParent.call(this,t),this.update()},u.update=function(){var t=this._nodes.visContainer;t.css({visibility:"hidden",width:790}),c.opera&&t.css("overflow","hidden"),this._nodes.content.css({overflow:"",width:"auto",height:"auto",float:"left"});var e=xt.size(this._nodes.content);"mac"==wt.os.name&&wt.browser.mozilla&&e.x++,e.x=Math.min(790,Math.max(o,e.x))+3,e.y=Math.max(17,e.y),xt.size(this._nodes.content[0],e),this._nodes.content.css({overflow:"hidden",float:""}),c.opera&&t.css("overflow",""),t.css({left:-(e.x+4)/2+1,visibility:"",width:""})},u.setContent=function(t){this._setContent(t,this._nodes.content);var e=this;xt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()})},u.getOffset=function(){return new a(0,0)};var n=function(t,e){this._context=t,this._map=e,this._content=null,this._parentNode=null};return(u=n.prototype).onAddToParent=function(t){this._parentNode=t,this._getLayout().onAddToParent(t)},u.onRemoveFromParent=function(){this._parentNode=null,this._getLayout().onRemoveFromParent()},u.update=function(){this._getLayout().update()},u.getRootNodes=function(){return this._getLayout().getRootNodes()},u.setContent=function(t){var e;this._content!=t&&(e=this._parentNode,!this._content!=!(this._content=t)?(e&&this._getLayout().onRemoveFromParent(),this._currentLayout=null,this._getLayout(),t&&this._currentLayout.setContent(t),e&&this._currentLayout.onAddToParent(this._parentNode)):this._currentLayout.setContent(t))},u._getLayout=function(){return this._currentLayout||(this._content?this._currentLayout=new e(this._context,this._map):this._currentLayout=new s(this._context,this._map)),this._currentLayout},u.getOffset=function(){return this._currentLayout.getOffset()},n=new yt.LayoutTemplate(n),yt.Templates.add("plain#"+t+"PointIcon",n),n}var o=c.msie&&c.quirksMode?26:13;t("black","black"),t("blue","blue"),t("lightblue","blue-l"),t("darkblue","blue-d"),t("brown","brown"),t("green","green"),t("darkgreen","green-d"),t("grey","grey"),t("night","night"),t("orange","orange"),t("darkorange","orange-d"),t("pink","pink"),t("violet","violet"),t("white","white"),t("red","red"),t("yellow","yellow");var s=function(t,e){l.call(this,t,e);this.__getStyleData();this._$elements=wt(c.msie&&c.version<7?"<div />":"<img />")};(u=Et(s,l)).__getStyleData=function(){return this._context.getComputedStyle().iconStyle},u.onAddToParent=function(t){l.prototype.onAddToParent.call(this,t),this.update()},u.update=function(){var t=this.__getStyleData();c.msie&&c.version<7?this._$elements.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+(t&&t.href)+"', sizingMethod='scale')","line-height":"0px"}):this._$elements[0].src=t&&t.href,t.size&&xt.size(this._$elements[0],t.size)},u.setContent=xt.NULL,u.getOffset=function(){return this.__getStyleData().offset||new a(0,0)}}();var o=new a(12,12),s=function(t,e){l.call(this,t,e);e=this._$elements=wt('<ymaps:balloon class="YMaps-balloon-full YMaps-balloon-full_hint">            <ymaps:balloon-inner>                <ymaps:balloon-content></ymaps:balloon-content>            </ymaps:balloon-inner>        </ymaps:balloon>');this._nodes={visContainer:e,inner:e.find("ymaps\\:balloon-inner"),content:e.find("ymaps\\:balloon-content")},this._topNode=e[0],this._size=null,this._hasContent=!1};(u=Et(s,l)).DEFAULT_MIN_WIDTH=42,u.update=function(){var t,e,i,n;this._parentNode&&this._hasContent&&(t=this._nodes.content,e=this._maxSize,(i=this._nodes.visContainer).css("width","10000px"),t.css({width:"",height:"",overflow:"",float:"left"}),this._nodes.inner.css("width","auto"),n=t.width(),"mac"==wt.os.name&&wt.browser.mozilla&&n++,n=n+o.getX(),e[0]&&n>e[0]?n=e[0]:n<this.DEFAULT_MIN_WIDTH&&(n=this.DEFAULT_MIN_WIDTH),n=Math.max(0,n-o.getX()),t.css("width",n),this._nodes.inner.css("width",n+"px"),n=t.height()+o.getY(),e[1]&&n>e[1]&&(n=e[1]),n=Math.max(0,n-o.getY()),t.css({height:n,overflow:"hidden",float:""}),i.css("width","").addClass("YMaps-fake").removeClass("YMaps-fake"))},u.setMaxSize=function(t,e){this._maxSize=[t,e]},u.setContent=function(t){var e;this._setContent(t,this._nodes.content[0]),t?(this._$elements.css("display",""),e=this,xt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()}),this._hasContent=!0):(this._$elements.css("display","none"),this._hasContent=!1),this._size=null},u.getSize=function(){return this._size||(this._size=xt.size(this._nodes.visContainer[0])),this._size},yt.Templates.add("plain#hint",new yt.LayoutTemplate(s));var u=Et(s=function(t,e,i){l.call(this,t,e);e=this._$elements=wt('<ymaps:balloon class="YMaps-balloon-full YMaps-balloon-full_close">                <ymaps:balloon-inner>                    <ymaps:balloon-content></ymaps:balloon-content>                </ymaps:balloon-inner>                <ymaps:balloon-tail class="YMaps-border"></ymaps:balloon-tail>                <ymaps:balloon-tail></ymaps:balloon-tail>                <ymaps:balloon-close></ymaps:balloon-close>            </ymaps:balloon>');this.__balloon=i,this._nodes={topNode:e[0],visContainer:e[0],contentParent:e.find("ymaps\\:balloon-inner"),content:e.find("ymaps\\:balloon-content")[0],$close:e.find("ymaps\\:balloon-close"),$eventBlockNode:e.find("ymaps\\:balloon-tail").add(e.find("ymaps\\:balloon-inner"))},this._nodes.$eventBlockNode=this._nodes.$eventBlockNode.add(this._nodes.$close),this._nodes.$close[0].title=n.balloon.close},l),d="YMaps-balloon-content-overflow-hidden";u.onAddToParent=function(t){var e;wt(t).append(this._$elements),c.mozilla&&(this._ffObservers=[],this._ffObservers.push(r.observe(this._map,this._map.Events.MoveStart,function(){e||(e=1,wt(this._nodes.content).addClass(d))},this)),this._ffObservers.push(r.observe(this._map,this._map.Events.MoveEnd,function(){e&&(wt(this._nodes.content).removeClass(d),e=0)},this)));var n=this,o=this._nodes.$close[0],s=o.childNodes[0];this.__contextMenuHandler=function(t){new yt.MouseEvent(t,n._map).preventMapEvent()},h(this._nodes.content,"contextmenu",this.__contextMenuHandler),this.__mouseEventHandler=function(t){var e=t.target,i=new yt.MouseEvent(t,n._map);"click"!=t.type||!n._closeCallback||e!=o&&e!=s||n._closeCallback(t),"contextmenu"!=t.type||i.isMapEventPrevented()||t.preventDefault(),i.preventMapEvent()};for(var i=0,a=this._nodes.$eventBlockNode.length;i<a;i++)h(this._nodes.$eventBlockNode[i],["click","dblclick","mouseup","mousedown","mousemove","wheel"],this.__mouseEventHandler);this.update()},u.onRemoveFromParent=function(){this._updateTimeout&&(window.clearTimeout(this._updateTimeout),this._updateTimeout=null),this._ffObservers&&(Ot(this._ffObservers,"cleanup"),this._ffObservers=null),wt(this._nodes.content).removeClass(d),i(this._nodes.content,"contextmenu",this.__contextMenuHandler);for(var t=0,e=this._nodes.$eventBlockNode.length;t<e;t++)i(this._nodes.$eventBlockNode[t],["click","dblclick","mouseup","mousedown","mousemove","wheel"],this.__mouseEventHandler);this._$elements.removeFromDom()},u.DEFAULT_MAX_WIDTH=t.DEFAULT_MAX_WIDTH,u.DEFAULT_MAX_HEIGHT=t.DEFAULT_MAX_HEIGHT,u.DEFAULT_MIN_WIDTH=t.DEFAULT_MIN_WIDTH,u.DEFAULT_MIN_HEIGHT=t.DEFAULT_MIN_HEIGHT,u.CLOSE_BUTTON_WIDTH=t.CLOSE_BUTTON_WIDTH,u.TAIL_HEIGHT=t.TAIL_HEIGHT,u.update=function(){var t,e,i,n,o,s,a,r,h,l;this.__balloon&&this.__balloon._map&&this.__balloon._map._state&&(t=this._nodes.visContainer,l=this._nodes.content,e=wt(l),a=this._maxSize[0],r=this._maxSize[1],n=e.hasClass(d),o=this._nodes.contentParent,e.css("float","left"),n&&e.removeClass(d),xt.size(t,1e4),o.css("width",""),wt(t).css("visibility","hidden"),e.css({overflow:"auto",width:"auto",height:"auto"}),c.opera&&wt(t).css("overflow","hidden"),a&&r||(s=this._map.getContainerSize(),a=a||Math.max(this.DEFAULT_MAX_WIDTH,s.x-60),r=r||(250<s.y?s.y-100:this.DEFAULT_MAX_HEIGHT)),e.css("maxWidth",a),s=Math.max(l.scrollWidth,l.offsetWidth)>a,null!=r&&(c.opera&&e.css("overflow","hidden"),e.css("maxHeight",r),i=Math.max(l.scrollHeight,l.offsetHeight)>r),s&&c.opera&&e.css("overflow","auto"),c.safari&&this._$elements[0].offsetParent==document.body?(h=this)._updateTimeout=window.setTimeout(function(){h._updateTimeout=null,h.update()},100):(l=xt.size(l),"mac"==wt.os.name&&wt.browser.mozilla&&(l.x=Math.min(a,l.x+1)),l.y=Math.max(l.y,this.DEFAULT_MIN_HEIGHT),l.x=Math.max(l.x,this.DEFAULT_MIN_WIDTH),e.css({width:l.x,height:l.y,overflow:s||i?"auto":"hidden",float:""}),n&&e.addClass(d),c.opera&&wt(t).css("overflow",""),wt(t).css({width:"",height:"",visibility:""}).css("left",-this.getSize().x/2+1+"px")))},u.moveTo=function(t){xt.position(this._nodes.topNode,t)},u.setMaxSize=function(t,e){this._maxSize=[t,e]},u.getOffset=function(){var t=this.getSize();return new a(-(t.x-(this._closeCallback?this.CLOSE_BUTTON_WIDTH:0))/2,1-t.y)},u.getSize=function(){return xt.size(this._nodes.visContainer).moveBy(new a(2,this.TAIL_HEIGHT+2))},u.enableClose=function(t){this._closeCallback=t,wt(this._nodes.visContainer).addClass("YMaps-balloon-full_close")},u.disableClose=function(){this._closeCallback&&(this._closeCallback=null),wt(this._nodes.visContainer).removeClass("YMaps-balloon-full_close")},u.setContent=function(t){this._setContent(t,this._nodes.content);var e=this;xt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update(),e.__balloon&&"function"==typeof e.__balloon.mapAutoPan&&e.__balloon.getOptions().mapAutoPan&&e.__balloon.mapAutoPan()})},yt.Templates.add("plain#balloon",new yt.LayoutTemplate(s));for(var p,_,f=["black","blue","brown","darkblue","darkgreen","darkorange","green","grey","lightblue","night","orange","pink","red","violet","white","yellow"],m=0,g=f.length;m<g;m++)p=f[m],_=void 0,(_=new yt.Style(null)).iconStyle={offset:new a(-11,-25),href:e+"placemarks/"+p+".png",size:new a(27,26),shadow:null,template:"plain#"+p+"PointIcon"},_.balloonStyle={template:"plain#balloon"},_.hintStyle={template:"plain#hint"},yt.Styles.add("plain#"+p+"Point",_);(s=new yt.Style("plain#whitePoint")).iconStyle={href:e+"placemarks/nashlos.png"},yt.Styles.add("plain#nashlos",s)}(),yt.MapType.PMAP=yt.MapType.MAP,yt.MapType.PHYBRID=yt.MapType.HYBRID,yt.GeocodeProviders.add("yandex#pmap",{geocode:function(t,e,i,n){n("http://clubs.ya.ru/mapsapi/58473")}}),function(){var l=yt.Regions={},s=bt.PolygonPoints;l.RegionHotspot=function(t,e){yt.Hotspots.Overlay.call(this,t,e),this._highlightRegion=e&&void 0!==e.highlightRegion?e.highlightRegion:1,this._listeners=[yt.Events.observe(this,this.Events.MouseEnter,this._addPolygons,this),yt.Events.observe(this,this.Events.MouseLeave,this._removePolygons,this)]},(e=Et(l.RegionHotspot,yt.Hotspots.Overlay)).getGeometry=function(){var t=yt.Hotspots.Overlay.prototype.getGeometry.call(this);return t.length||(t=this._decodeGeometry(),this.setGeometry(t)),t},e._decodeGeometry=function(){var t=[];this.metaDataProperty.polygonPoints=[];for(var e=0,i=this.metaDataProperty.encodedShapes.length;e<i;e++){var n=this.metaDataProperty.encodedShapes[e],o=new s;o.setEncodedPoints(n.coords,n.levels,new yt.GeoCoordSystem),t.push({shape:"npoly",coords:o.getPoints()}),this.metaDataProperty.polygonPoints.push(o)}return t},e.onAddToMap=function(t){this.getGeometry(),yt.Hotspots.Overlay.prototype.onAddToMap.call(this,t)},e._addPolygons=function(){if(this._highlightRegion){if(n=this.metaDataProperty.polygons)n.setStyle(this.getComputedStyle());else{for(var t=this.metaDataProperty.polygonPoints,e=0,i=t.length,n=new yt.GeoObjectCollection(this.getComputedStyle());e<i;e++)n.add(new yt.Polygon(t[e],{interactive:yt.Interactivity.NONE}));this.metaDataProperty.polygons=n}this.getMap().addOverlay(n)}},e._removePolygons=function(){var t=this.metaDataProperty.polygons;t&&this.getMap().removeOverlay(t)},e.setOptions=function(t,e){t&&void 0!==t.highlightRegion?this._highlightRegion=t.highlightRegion:e&&(this._highlightRegion=1),yt.Hotspots.Overlay.prototype.setOptions.call(this,t,e)},e.getOptions=function(){var t=yt.Hotspots.Overlay.prototype.getOptions.call(this);return t.highlightRegion=this._highlightRegion,t};var t=l.RegionCollection=function(t){yt.GeoObjectCollection.call(this,t),this._hotspotListeners=[],yt.Events.observe(this,this.Events.Add,this._onHotspotAdd,this),yt.Events.observe(this,this.Events.Remove,this._onHotspotRemove,this)},e=Et(t,yt.GeoObjectCollection);yt.jQuery.extend(e.Events,{MouseEnter:"mouseenter",MouseMove:"mousemove",MouseLeave:"mouseleave",MouseDown:"mousedown",MouseUp:"mouseup",Click:"click",DblClick:"dblclick",BalloonOpen:"balloonopen",BalloonClose:"balloonclose"}),e._onHotspotAdd=function(n,o,t){var e,i=[];for(e in this.Events)o.Events.hasOwnProperty(e)&&i.push(function(i){return yt.Events.observe(o,i,function(t,e){yt.Events.notify(n,i,n,o,e)})}(o.Events[e]));this._hotspotListeners[t]=i},e._onHotspotRemove=function(t,e,i){xt.callMethod(this._hotspotListeners.splice(i,1)[0],"cleanup")},l.load=function(t,r){var e=t.toUpperCase(),t=bt.versionPath+"xml/regions/getRegion.xml?region="+t+"&v="+bt.fullVersion,h=new yt.Style;h.polygonStyle=new yt.PolygonStyle,h.polygonStyle.fillColor={BY:"918f7180",KZ:"a2a68180",RU:"b2a2a180",UA:"b2a17b80"}[e],h.polygonStyle.outline=!1,h.hasHint=!0,h.hasBalloon=!1,l.Loader.load(t,{key:e+"regions",cache:!0,callback:function(t){var e=t.regionCode&&t.regions;if(e){var i=new l.RegionCollection(h);i.name=t.regionCode;for(var n=0,o=t.regions.length;n<o;n++){var s=t.regions[n],a=new yt.Regions.RegionHotspot([]);a.name=s.name,a.metaDataProperty.encodedShapes=s.shapes,i.add(a)}}r(e?yt.State.SUCCESS:yt.State.FAILURE,i||t)}})},l.Loader=yt.Hotspots.Loader}(),function(){function t(t){this._context=t,this._element=wt('<div><div style="text-align: center; padding-top: 2px; font-size: 14px"></div></div>'),this.update()}var a=yt.RouterEditor={},s=yt.Events;function i(t){t=t||{},this._map=null,this._activeRoute=null,this._routes=[],this._pmCursor=new yt.Placemark(new yt.GeoPoint(0,0),{draggable:!0,style:t.cursorStyle||"router#viaPoint",hasHint:!!t.cursorHintContent,zIndexHover:yt.ZIndex.OVERLAY-1,hasBalloon:!1}),this._visible=!1,t.cursorHintContent&&this._pmCursor.setHintContent(t.cursorHintContent),this._observers={routeMouseEnter:[],routeMouseMove:[],routeMouseLeave:[],pmCursorMouseMove:[],pmCursorMouseLeave:[],pmDragStart:[],pmDragEnd:[]}}t.prototype={onAddToParent:function(t){this._element.appendTo(t)},onRemoveFromParent:function(){this._element.remove()},setContent:function(t){this._content&&this._content.onRemoveFromParent(),t&&t.onAddToParent(this._element.children()[0]),this._content=t},update:function(){var t=this._context.getComputedStyle(),e=t.iconContentStyle,i=t.iconStyle,t=wt.browser.msie&&wt.browser.version<7?{filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+i.href+'",sizingMethod="scale")'}:{backgroundImage:"url("+i.href+")"};t.width=i.size.x+"px",t.height=i.size.y+"px",this._element.css(t).children().css({color:e.color,width:e.width+"px"})}},yt.Templates.add("router#icon",new yt.LayoutTemplate(t)),yt.Styles.add("router#viaPoint",{iconStyle:{href:bt.versionPath+"i/0.4/router-editor/via.png",size:new yt.Point(18,19),offset:new yt.Point(-9.5,-10)}}),yt.Styles.add("router#wayPoint",{hasBalloon:!0,iconContentStyle:{color:"white",width:21},iconStyle:{template:"router#icon",size:new yt.Point(27,26),href:bt.versionPath+"i/0.4/plainstyle/placemarks/red.png"}}),a.RouteProviders=new xt.ObjectStorage,a.RouteProviders.add("yandex#router",{route:function(t,e,i,n){return t.options=wt.extend(t.options,{origin:"jsRouterEditor",minWayPoints:1}),yt.RouteProviders.get("yandex#router").route(t,e,i,n)}}),a.RouterResultHelper=function(t){this._cachedRoutes=[],this._routerResult=t,this._routerRequest=t.request,this._routerResponse=t.response},a.RouterResultHelper.prototype={getDistance:function(){return this._routerResponse.distance},getDuration:function(){return this._routerResponse.duration},getBounds:function(){var t=this._routerResponse.boundedBy;return t?new yt.GeoBounds(new yt.GeoPoint(t[0][0],t[0][1]),new yt.GeoPoint(t[1][0],t[1][1])):null},getNumWayPoints:function(){var t=this._routerResponse.wayPoints;return t?t.length:0},getWayPoint:function(t){var e=this._routerResponse.wayPoints;return e&&e[t]},getRouterRequest:function(){return this._routerRequest},getRouterResponse:function(){return this._routerResponse},getRouterResult:function(){return this._routerResult},getNumRoutes:function(){var t=this._routerResponse.routes;return t?t.length:0},getRoute:function(t){var e,i,n,o=this._cachedRoutes,s=this._routerResponse.routes;return o[t]||((e=s&&s[t])?(i=wt.map(e.routeSegments,function(t){return new yt.RouteSegment(t.indexInPolyline,t.distance,t.duration,t.action,t.angle,t.street)}),n=new yt.GeoBounds(new yt.GeoPoint(e.boundedBy[0][0],e.boundedBy[0][1]),new yt.GeoPoint(e.boundedBy[1][0],e.boundedBy[1][1])),s=wt.map(e.viaPoints,function(t){return new yt.ViaPoint(t.indexInPolyline)}),o[t]=new yt.Route(e.encodedPoints,e.levels,n,i,e.distance,e.duration,s)):void 0)},hasAllRoutes:function(){return this.getNumWayPoints()-this.getNumRoutes()==1}},i.prototype={Events:{DragStart:"DragStart",DragEnd:"DragEnd"},enable:function(){var n=this._pmCursor,e=this._observers,o=this;wt.each(this.getRoutes(),function(t,i){i.setOptions({interactive:1}),e.routeMouseEnter.push(s.observe(i,i.Events.MouseEnter,function(t,e){this._hideCursorTimeout&&(clearTimeout(this._hideCursorTimeout),delete this._hideCursorTimeout),this._showAt(i,e.getGeoPoint())},o)),e.routeMouseMove.push(s.observe(i,i.Events.MouseMove,function(t,e){this._hideCursorTimeout&&(clearTimeout(this._hideCursorTimeout),delete this._hideCursorTimeout),this._showAt(i,e.getGeoPoint())},o)),e.routeMouseLeave.push(s.observe(i,i.Events.MouseLeave,function(){this._hideCursorTimeout=setTimeout(function(){n.metaDataProperty.mouseOverCursor||o.hide()},100)},o))}),e.pmCursorMouseMove.push(s.observe(n,n.Events.MouseMove,function(t,e){n.metaDataProperty.mouseOverCursor=!0,this._showAt(this._activeRoute,this._activeRoute.getClosestPoint(e.getGeoPoint()).point)},this)),e.pmCursorMouseLeave.push(s.observe(n,n.Events.MouseLeave,function(){delete n.metaDataProperty.mouseOverCursor,this.hide()},this)),e.pmDragStart.push(s.observe(n,n.Events.DragStart,function(t){this._doWithObservers(["routeMouseEnter","routeMouseMove","routeMouseLeave","pmCursorMouseMove","pmCursorMouseLeave"],"disable"),s.notify(this,this.Events.DragStart,t,this,this._activeRoute)},this)),e.pmDragEnd.push(s.observe(n,n.Events.DragEnd,function(t){s.notify(this,this.Events.DragEnd,t,this,this._activeRoute)},this))},_doWithObservers:function(t,i){var n=this._observers;wt.each(t,function(t,e){xt.callMethod(n[e],i),"cleanup"==i&&(n[e]=[])})},disable:function(){this._doWithObservers(["routeMouseEnter","routeMouseMove","routeMouseLeave","pmCursorMouseMove","pmCursorMouseLeave","pmDragStart","pmDragEnd"],"cleanup")},show:function(){this._setVisible(!0)},hide:function(){this._setVisible(!1)},setMap:function(t){this._map=t},getMap:function(){return this._map},setRoutes:function(t){this._routes=t},getRoutes:function(){return this._routes},_setVisible:function(t){var e=this._pmCursor,i=this._map;this._visible!=t&&((this._visible=t)?i.addOverlay(e):i.removeOverlay(e))},_showAt:function(t,e){this.show(),this._pmCursor.setGeoPoint(e),this._activeRoute=t}},a.DragAndDropEditor=function(t,e){this._model=t,this._options=e||{},this._options.maxPoints=void 0===this._options.maxPoints?2:+this._options.maxPoints,this._map=null,this._isDrawing=!1,this._editorPoints=[],this._routerResultHelper=null,this._routerResultVisible=!1,this._routeProviderHandler=null,this._cursor=new i({cursorStyle:this._options.cursorStyle,cursorHintContent:this._options.cursorHintContent}),s.observe(this._cursor,this._cursor.Events.DragStart,this._onCursorDragStart,this),s.observe(this._cursor,this._cursor.Events.DragEnd,this._onCursorDragEnd,this),s.observe(this._model,this._model.Events.RouterResultChange,this._onRouterResultChange,this);e=this._model.getRouterResult();e&&this._setRouterResult(e)},a.DragAndDropEditor.prototype={_onRouterResultChange:function(t){this._destroyRouterResult(),this._setRouterResult(t)},_destroyRouterResult:function(){this._cursor.hide(),this._cursor.disable(),this._setRouterResultVisible(!1),this._destroyPoints(),this._abortRouteProviderHandler(),this._routerResultHelper=null},_setRouterResult:function(t){this._routerResultHelper=new a.RouterResultHelper(t),this._createPoints(),this._setRouterResultVisible(!0),this._cursor.setRoutes(this._getRoutes()),this._cursor.enable()},_abortRouteProviderHandler:function(){this._routeProviderHandler&&(this._routeProviderHandler.abort(),this._routeProviderHandler=null)},_setRouterResultVisible:function(i){var n=this._map;n&&this._routerResultVisible!=i&&(wt.each(this._editorPoints,function(t,e){i?e.show(n):e.hide(n)}),wt.each(this._getRoutes(),function(t,e){i?n.addOverlay(e):n.removeOverlay(e)}),this._routerResultVisible=i)},_destroyPoints:function(){xt.callMethod(this._editorPoints,"cleanup"),this._editorPoints=[]},_getPointIndex:function(t){for(var e=this._editorPoints,i=e.length;i--;)if(e[i]==t)return i;return-1},_onCursorDragStart:function(t,e,i){this._abortRouteProviderHandler(),this._viaPointIndex=this._calculateViaPointIndex(t.getGeoPoint(),i)},_onCursorDragEnd:function(t,e,i){this._update("addPoint",t.getGeoPoint(),!0,this._viaPointIndex)},_calculateViaPointIndex:function(t,i){var n=i.getClosestPoint(t).index,o=0;return wt.each(this._editorPoints,function(t,e){e.getRoute()==i&&i.getClosestPoint(e.getGeoPoint()).index<n&&(o=t)}),o+1},_onPointDragStart:function(t,e){this._abortRouteProviderHandler()},_onPointDragEnd:function(t,e){this._update("editPoint",e.getGeoPoint(),t.isVia(),this._getPointIndex(t))},_onPointDblClick:function(t,e){t.isVia()&&this._update("deletePoint",e.getGeoPoint(),!0,this._getPointIndex(t))},_addObserversToPoint:function(t){return t.addObserver(t.Events.DragStart,this._onPointDragStart,this),t.addObserver(t.Events.DragEnd,this._onPointDragEnd,this),t.addObserver(t.Events.DblClick,this._onPointDblClick,this),t},_createPoints:function(){for(var t,e,i,n=[],o=this._routerResultHelper,s=o.hasAllRoutes(),a=0,r=o.getNumWayPoints();a<r;a++)if(e=o.getRoute(a==r-1?a-1:a),(i=(t=c.fromRouterResultWayPoint(o.getWayPoint(a))).getLabel())&&(this._options.onWayPointUpdate?this._options.onWayPointUpdate(a,i):i.setIconContent(63<a?a-63:String.fromCharCode(1040+a)),t.setRoute(e),this._addObserversToPoint(t)),n.push(t),a<r-1&&s)for(var h=0,l=e.getNumViaPoints();h<l;h++)t=new c({geoPoint:e.getPoint(e.getViaPoint(h).getPolylineIndex()),via:!0,viaPointHintContent:this._options.viaPointHintContent,route:e}),n.push(this._addObserversToPoint(t));this._editorPoints=n},_replaceRouterResult:function(t){this._model.setRouterResult(t)},_getRoutes:function(){var t,e=this._routerResultHelper,i=[];if(!e)return i;for(var n=0,o=e.getNumRoutes();n<o;n++)(t=e.getRoute(n)).setStyle("router#route"),i.push(t);return i},onAddToMap:function(t,e){this._map=t,this._cursor.setMap(t),this._setRouterResultVisible(!0)},onRemoveFromMap:function(){this._setRouterResultVisible(!1),this._map=null},_update:function(t,e,i,n){var o=this._convertToRouteProviderFormat(t,e,i,n),s=function(t){this._replaceRouterResult(t)},e=function(t){};this._cursor.disable(),"addPoint"==t&&i?(s=function(t){new a.RouterResultHelper(t).hasAllRoutes()?this._replaceRouterResult(t):(this._cursor.enable(),this._cursor.hide())},e=function(t){this._cursor.enable(),this._cursor.hide()}):"editPoint"==t&&i&&(s=function(t){var e=new a.RouterResultHelper(t).hasAllRoutes(),i=this._editorPoints[n];e?this._replaceRouterResult(t):i.getLabel().setGeoPoint(i.getGeoPoint())},e=function(t){var e=this._editorPoints[n];e.getLabel().setGeoPoint(e.getGeoPoint())}),this._abortRouteProviderHandler(),this._routeProviderHandler=this._model.getRouteProvider().route(o,s,e,this)},_convertToRouteProviderFormat:function(t,e,i,n){if("clear"==t)return{wayPoints:[],viaPoints:[],options:this._routerResultHelper&&this._routerResultHelper.getRouterRequest().options};var o=this._editorPoints.slice(),s=[],a=[],i="deletePoint"==t?[n,1]:[n,"addPoint"==t?0:1,new c({geoPoint:e,via:i})];return Array.prototype.splice.apply(o,i),wt.each(o,function(t,e){s.push(e.toRouteProviderPoint()),e.isVia()&&a.push(t)}),{wayPoints:s,viaPoints:a,options:this._routerResultHelper&&this._routerResultHelper.getRouterRequest().options}},clear:function(){this._update("clear")},startDrawing:function(){var t=this._map;t&&!this._isDrawing&&this._options.maxPoints&&(this._isDrawing=!0,t.addCursor(yt.Cursor.ARROW),this._mapClickObserver?this._mapClickObserver.enable():this._mapClickObserver=s.observe(t,t.Events.Click,function(t,e){var i=0;wt.each(this._editorPoints,function(t,e){e.isVia()||i++}),i<this._options.maxPoints&&this._update("addPoint",e.getGeoPoint(),!1,this._editorPoints.length),i+1>=this._options.maxPoints&&this.stopDrawing()},this))},stopDrawing:function(){this._isDrawing&&(this._isDrawing=!1,this._mapClickObserver.disable(),this._map.removeCursor(yt.Cursor.ARROW))}},a.RouterModel=function(t){t=t||{},this._routeProvider=a.RouteProviders.get(t.routeProvider||"yandex#router"),this._routerResult=null},a.RouterModel.prototype={Events:{RouterResultChange:"RouterResultChange"},setRouterResult:function(t){this._routerResult=t,s.notify(this,this.Events.RouterResultChange,t)},getRouterResult:function(){return this._routerResult},getRouteProvider:function(){return this._routeProvider}};var c=function(t){this._geocoderText=t.geocoderText,this._request=t.request,this._geoPoint=t.geoPoint,this._via=!!t.via,this._viaPointHintContent=t.viaPointHintContent,this._route=t.route,this._labelObservers=[],this._observers=[],this._visible=!1,this._createLabel()};c.prototype={Events:{DragStart:"DragStart",DragEnd:"DragEnd",DblClick:"DblClick"},isVia:function(){return this._via},getGeoPoint:function(){return this._geoPoint},setGeoPoint:function(t){this._geocoderText=null,this._request=null,this._geoPoint=t},setRoute:function(t){this._route=t},getRoute:function(){return this._route},show:function(t){t&&!this._visible&&this._label&&(this._visible=!0,t.addOverlay(this._label))},hide:function(t){t&&this._visible&&this._label&&(this._visible=!1,t.removeOverlay(this._label))},getLabel:function(){return this._label},addObserver:function(t,e,i){this._observers.push(s.observe(this,t,e,i))},cleanup:function(){xt.callMethod(this._labelObservers,"cleanup"),xt.callMethod(this._observers,"cleanup")},_createLabel:function(){var t,e,i,n;this._geoPoint&&(t=this._via,e=this._viaPointHintContent,i=new yt.Placemark(this._geoPoint,{draggable:!0,style:t?"router#viaPoint":"router#wayPoint",hasBalloon:!t,hasHint:t&&!!e}),n=this._labelObservers,t?(e&&i.setHintContent(e),n.push(s.observe(i,i.Events.DragStart,function(t){s.notify(this,this.Events.DragStart,this,t)},this),s.observe(i,i.Events.DragEnd,function(t){s.notify(this,this.Events.DragEnd,this,t)},this),s.observe(i,i.Events.DblClick,function(t){s.notify(this,this.Events.DblClick,this,t)},this))):(i.name=this._geocoderText||this._geoPoint.toString(),n.push(s.observe(i,i.Events.DragEnd,function(t){s.notify(this,this.Events.DragEnd,this,t)},this))),this._label=i)},toRouteProviderPoint:function(){return this._geoPoint&&!this._geocoderText?this._geoPoint:this._request}},c.fromRouterResultWayPoint=function(t){var e={request:t.request};return"ok"==t.status&&(e.geoPoint=new yt.GeoPoint(t.data.point[0],t.data.point[1]),"geocoder"==t.data.type&&(e.geocoderText=t.data.text)),new c(e)}}(),A=bt,j=xt.browser,z=A.Traffic={},H=yt.Hotspots.Loader,Z="YMaps-display-none",U=yt.Traffic={},F={Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6},$=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],G=yt.dom?(k=function(t,e,i){yt.dom(t).events.add(e,i)},function(t,e,i){yt.dom(t).events.remove(e,i)}):(k=function(t,e,i){wt(t).bind("string"==typeof e?e:e.join(" "),i)},function(t,e,i){wt(t).bind("string"==typeof e?e:e.join(" "),i)}),V=A.trafficHost,X=A.trafficArchiveHost,W=A.trafficService+"v1/",q=A.versionPath+"i/0.4/"+"traffic/semaphores/",K={coverageUrl:W+"coverage.js",regionsStatUrl:W+"stat.js",archiveVersionUrl:W+"version.js",archiveCounterUrl:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=70774/rnd=%u/*https://maps.yandex.ru/",archiveStatUrl:W+"stat.js?%v&%t",coverageServiceUrl:A.coverageService+"v2/",updateTimeout:12e4,compactForm:!1,hotspotsCacheSize:100,regionContentTemplate:"traffic#regionContent",semaphoreStyles:{red:"traffic#red",yellow:"traffic#yellow",green:"traffic#green",nodata:"traffic#nodata",nolevel:"traffic#nolevel"},layers:{baseUrl:V+"1.1/tiles?%l&%c&%t",key:"%c&%l&%t",jams:{png:"trf",js:"trj",layerOptions:{hintOptions:{hideTimeout:1e3,maxWidth:150},balloonOptions:{hasCloseButton:0},cursor:"pointer",priority:0,hasHint:1,hasBalloon:1,interactive:yt.Interactivity.INTERACTIVE}},info:{png:"trfe",js:"trje",layerOptions:{cursor:"pointer",priority:1,hasHint:1,hasBalloon:1,interactive:yt.Interactivity.INTERACTIVE,balloonOptions:{maxWidth:350}}},archive:{baseUrl:X+"tiles?%l&%c&%t",key:"%c&%l&%t",png:"trf",js:"trj",tz:"trfa",layerOptions:{hintOptions:{hideTimeout:1e3,maxWidth:150},balloonOptions:{hasCloseButton:0},cursor:"pointer",priority:0,hasHint:1,hasBalloon:0,interactive:yt.Interactivity.INTERACTIVE}},image:{layerOptions:{zIndex:5}}},providers:{traffic:{urlTemplate:W+"description?%l&%t&id=%j&lang=ru_RU",keyTemplate:"jamInfo-%j",hintContentTemplate:"traffic#jamsHintContent",balloonContentTemplate:"traffic#jamsBalloonContent",counters:{show:"https://clck.yandex.ru/jclck/dtype=stred/pid=443/cid=70634/path=show/rnd=%u/*https://maps.yandex.ru/",click:"https://clck.yandex.ru/jclck/dtype=stred/pid=443/cid=70634/path=click/rnd=%u/*https://mobile.yandex.ru/maps?api=web",infoLayer:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=71334/path=turn_%s/rnd=%u/*https://maps.yandex.ru/"}},"traffic-events":{urlTemplate:W+"description?%l&%t&id=%j&lang=ru_RU",keyTemplate:"traffic-events-%j",hintContentTemplate:"traffic#infoHintContent",balloonContentTemplate:"traffic#infoBalloonContent",counters:{load:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=70596/path=%p/rnd=%u/*https://maps.yandex.ru/",links:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=70603/path=%p/rnd=%u/*https://maps.yandex.ru/"},regionsEnabled:["2","10174"]}},strings:{toCity:"увеличьте масштаб",instruction:", чтобы увидеть пробки",noRegionData:"Данные о&#160;пробках недоступны",jams:"Пробки",points:["балл","балла","баллов"],length:"Длина",kmh:"км/ч",blocked:"движение перекрыто",infoLayer:"Дорожные события",time:"Дата",times:"Сроки",address:"Адрес",description:"Описание",source:"Источник",providers:{"traffic#actual":"Сейчас","traffic#archive":"Обычно"},archiveDataText:"На основе статистики Яндекс.Пробок",daysOfWeek:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],noTimeZone:"Данные о пробках отсутствуют"},globalTraffic:{icons:{red:{href:q+"styles/red.png",iconOffset:new yt.Point(-13,-39),iconSize:new yt.Point(25,39)},yellow:{href:q+"styles/yellow.png",iconOffset:new yt.Point(-13,-39),iconSize:new yt.Point(25,39)},green:{href:q+"/styles/green.png",iconOffset:new yt.Point(-13,-39),iconSize:new yt.Point(25,39)},nodata:{href:q+"/styles/nodata.png",iconOffset:new yt.Point(-13,-39),iconSize:new yt.Point(25,39)},nolevel:{href:q+"/styles/nolevel.png",iconSize:new yt.Point(8,20),iconOffset:new yt.Point(-4,-20)}}},timeScale:{markers:[0,4,8,12,16,20,24],step:12,sliderSize:6,dragUpdateTimeout:500},localTrafficMinZoom:8,showRegionZoom:10,trafficTypes:[{color:"brown",tag:"Движение перекрыто"},{color:"red",tag:"Пробка"},{color:"yellow",tag:"Движение затруднено"},{color:"green",tag:"Свободно"}],trafficButton:{icons:{beta:{on:{href:q+"3lights-on.png",size:new yt.Point(11,19)},off:{href:q+"3lights-off.png",size:new yt.Point(11,19)}},full:{red:{href:q+"small-lights/red.png",size:new yt.Point(22,18)},yellow:{href:q+"small-lights/yellow.png",size:new yt.Point(22,18)},green:{href:q+"small-lights/green.png",size:new yt.Point(22,18)},nodata:{href:q+"small-lights/grey.png",size:new yt.Point(22,18)},off:{href:q+"small-lights/grey.png",size:new yt.Point(22,18)}}}}},z.AutoUpdater=function(t,e){var i,n,o,s=0;function a(){i=window.setTimeout(function(){i=null,n=yt.Events.observe(o,o.Events.MouseMove,r)},t)}function r(){n.cleanup(),n=null,e(),a()}this.enable=function(t){s||(s=1,o=t,a())},this.disable=function(){s&&(s=0,o=null,i&&(window.clearTimeout(i),i=null),n&&(n.cleanup(),n=null))}},yt.TrafficLoader={onLoad:yt.Hotspots.Loader.onLoad},B=[],z.coverage={regions:[],state:yt.State.EMPTY,load:function(t){this.state==yt.State.SUCCESS?t():(B.push(t),this.state==yt.State.EMPTY&&(this.state=yt.State.LOADING,H.load(K.coverageUrl,{key:"coverage",callback:zt,cache:0})))},getRegionById:function(t){for(var e=0,i=this.regions.length;e<i;e++)if(this.regions[e].regionId==t)return this.regions[e];return null},getRegionsByBounds:function(t){for(var e,i=[],n=0,o=this.regions.length;n<o;n++)(function(t,e){if(t.getTop()>e.getBottom()&&t.getBottom()<e.getTop()){var i,n,o,t=t.getLeft()>e.getLeft()?(i=t.getLeft(),n=e.getLeft(),o=t.getRight(),e.getRight()):(i=e.getLeft(),n=t.getLeft(),o=e.getRight(),t.getRight());if(o<i&&(o+=360),t<n&&(t+=360),n<=i&&i<=t)return 1;if(n+360<=o&&o<=t+360)return 1}return 0})((e=this.regions[n]).boundedBy,t)&&i.push(e);return i}},z.TimeZone={get:function(t,r,h){const l=K.layers.archive;t=wt.param({l:[l.png,l.tz].join(","),ll:t.toString(8),lang:"ru_RU"});wt.ajax({url:K.coverageServiceUrl+"?"+t,dataType:"jsonp",jsonpCallback:decodeURIComponent(t).replace(/\W/g,"_"),scriptCharset:"utf-8",cache:1,success:function(t){if(t&&"success"===t.status){var e=!1,i=z.TimeZone.UNKNOWN,t=wt.grep(t.data,function(t){return t.id===l.tz})[0];if(t&&t.LayerMetaData)for(var n=t.LayerMetaData,o=!1,s=0,a=n.length;s<a&&!o;s++)i=n[s].offset/3600,e=n[s].dst,i!=z.TimeZone.UNKNOWN&&0!=e&&(o=!0);r&&r.call(h||window,i,e)}},error:function(){r&&r.call(h||window,z.TimeZone.UNKNOWN,!1)}})},UNKNOWN:"unknown"},Ct=z.ABaseLayout=function(t,e){this._context=t,this.__map=e,this._parentNode=null},(Mt=Ct.prototype)._setContent=function(t,e){this._contentLayout&&this._contentLayout.onRemoveFromParent(),t&&t.onAddToParent(e),this._contentLayout=t},Mt.getRootNodes=function(){return this._$elements},Mt.onAddToParent=function(t){this._parentNode=t,wt(t).append(this._$elements)},Mt.onRemoveFromParent=function(){this._parentNode=null,this._$elements.removeFromDom()},function(){for(var t,e,i,a=z.ABaseLayout,n=K.globalTraffic,o=["red","yellow","green","nodata","nolevel"],s=0;s<o.length;s++)t=o[s],i=e=void 0,e=n.icons[t],(i=new yt.Style).iconStyle=new yt.IconStyle,i.iconStyle.offset=e.iconOffset,i.iconStyle.size=e.iconSize,i.iconStyle.href=e.href,i.balloonContentStyle=new yt.BalloonContentStyle(K.regionContentTemplate),yt.Styles.add("traffic#"+t,i);function r(t){var e=t.stat,i=typeof e.level!=Tt;this.__master=t,this._$elements=wt(e?'<div class="YMaps-b-traffic-balloon'+(i?" YMaps-b-traffic-balloon_level":"")+'"><h3>'+t.name+'</h3><div class="YMaps-inner">'+(i?'<i class="YMaps-traffic YMaps-traffic_'+e.style+'"></i><h4>'+K.strings.jams+" "+Rt(e.level)+"</h4><p>"+e.localTime+" "+e.hint+"</p>":"")+'<p class="YMaps-zoom"><a class="YMaps-b-pseudo-link" href="javascript:void(0)"><span>'+K.strings.toCity+"</span></a>"+K.strings.instruction+"</p></div></div>":'<div class="YMaps-b-traffic-balloon"><div class="YMaps-inner"<i class="YMaps-traffic"></i><h4>'+t.name+'</h4><p class="YMaps-access">'+K.strings.noRegionData+"</p></div></div>")}(Mt=Et(r,a)).onAddToParent=function(t){a.prototype.onAddToParent.call(this,t);var e=this.__master.getMap(),i=this.__master.getCoordPoint();this.__clickListener=function(t){e.setCenter(i,K.showRegionZoom),t.stopPropagation(),t.preventDefault(),e.closeBalloon()};for(var n=this._$elements.find("a"),o=0,s=n.length;o<s;o++)k(n[o],"click",this.__clickListener)},Mt.onRemoveFromParent=function(){for(var t=this._$elements.find("a"),e=0,i=t.length;e<i;e++)G(t[e],"click",this.__clickListener);a.prototype.onRemoveFromParent.call(this)},yt.Templates.add("traffic#regionContent",new yt.LayoutTemplate(r))}(),function(){var n=z.ABaseLayout,t=function(t){t=(this._data=t).content;this._$elements=wt("<span>"+(t&&"0"!=t?t:K.strings.blocked)+"</span>")};(Mt=Et(t,n)).onAddToParent=function(t){n.prototype.onAddToParent.call(this,t);var e=this._data,i=e.object.getLayer(),t=i.getOptions();t.hasBalloon&&t.interactive==yt.Interactivity.INTERACTIVE&&this._$elements.addClass("YMaps-cursor-pointer").bind("click",function(){yt.Events.notify(i,i.Events.Click,i,e.object,e.event,e.shape)})},Mt.onRemoveFromParent=function(){n.prototype.onRemoveFromParent.call(this),this._$elements.unbind("click")},yt.Templates.add("traffic#jamsHintContent",new yt.LayoutTemplate(t));var s=["brown","red","yellow","green"];Et(t=function(t,e){var i=parseInt(t.type),n=t.from?t.from+(t.to?"&nbsp;→ "+t.to:"")+"<br/>":"",o=t.region?'<div class="YMaps-b-traffic-tip__location">'+t.region+"</div>":"";this._$elements=wt('<div class="YMaps-b-traffic-tip YMaps-b-traffic-tip_'+s[i]+'" style="width: 250px"><div class="YMaps-b-traffic-tip__round"><i class="YMaps-b-round YMaps-b-round_4"><i class="YMaps-l YMaps-t"><i></i></i><i class="YMaps-r YMaps-t"><i></i></i></i><div class="YMaps-b-traffic-tip__round-i"><h3 class="YMaps-b-traffic-tip__title">'+(t.speed?t.speed+" "+K.strings.kmh:K.strings.blocked)+'</h3><i class="YMaps-b-traffic-tip__close YMaps-cursor-pointer"></i></div><i class="YMaps-b-round YMaps-b-round_4"><i class="YMaps-l YMaps-b"><i></i></i><i class="YMaps-r YMaps-b"><i></i></i></i></div>'+o+'<div class="YMaps-b-traffic-tip__distance">'+n+K.strings.length+": "+yt.humanDistance(t.length)+"</div></div>"),this._$elements.find(".YMaps-b-traffic-tip__close").bind("click",function(t){e.closeBalloon(),new yt.MouseEvent(t,e).preventMapEvent()})},n),yt.Templates.add("traffic#jamsBalloonContent",new yt.LayoutTemplate(t))}(),D=K.strings,R=z.ABaseLayout,Y=["Дорожные работы","ДТП","Развод моста","Перекрытие движения","Камера","Прочее"],(Mt=Et(q=function(t){this._data=t,this._$elements=wt("<span>"+t.content+"</span>")},R)).onAddToParent=function(t){R.prototype.onAddToParent.call(this,t);var e=this._data,i=e.object.getLayer(),t=i.getOptions();t.hasBalloon&&t.interactive==yt.Interactivity.INTERACTIVE&&this._$elements.addClass("YMaps-cursor-pointer").bind("click",function(){yt.Events.notify(i,i.Events.Click,i,e.object,e.event,e.shape)})},Mt.onRemoveFromParent=function(){R.prototype.onRemoveFromParent.call(this),this._$elements.unbind("click")},yt.Templates.add("traffic#infoHintContent",new yt.LayoutTemplate(q)),(Mt=Et(q=function(t){var e='<div class="YMaps-b-traffic-info-balloon YMaps-b-traffic-info-balloon_'+t.type+'"><h3 class="YMaps-b-traffic-info-balloon__title">'+Y[t.type]+'</h3><p class="YMaps-b-traffic-info-balloon__parameter">'+(t.startTime&&t.endTime?"<strong>"+D.times+":</strong> "+t.startTime+" - "+t.endTime:"<strong>"+D.time+":</strong> "+t.startTime)+"</p>"+(t.district?'<p class="YMaps-b-traffic-info-balloon__parameter"><strong>'+D.address+": </strong>"+t.district+"</p>":"")+(t.description?'<p class="YMaps-b-traffic-info-balloon__parameter"><strong>'+D.description+":</strong> "+t.description+"</p>":"")+(t.href?'<i class="YMaps-b-traffic-info-balloon__separator"></i><p class="YMaps-b-traffic-info-balloon__copyright YMaps-b-traffic-info-balloon__parameter">'+D.source+': <a href="'+t.href+'" target="_blank">'+(t.localizedSource||t.href)+"</a></p>":t.localizedSource?'<i class="YMaps-b-traffic-info-balloon__separator"></i><p class="YMaps-b-traffic-info-balloon__copyright YMaps-b-traffic-info-balloon__parameter">'+D.source+": "+t.localizedSource+"</p>":"");this._$elements=wt(e);var i=K.providers["traffic-events"].counters.links.replace("%p",t.source).replace("%u",+new Date);this._$elements.find("a").bind("click",function(){wt.ajax({url:i,cache:!0,dataType:"script"})})},R)).onRemoveFromParent=function(){R.prototype.onRemoveFromParent.call(this),this._$elements.find("a").unbind("click")},yt.Templates.add("traffic#infoBalloonContent",new yt.LayoutTemplate(q)),Ct=z.TrafficObject=function(){yt.Hotspots.Object.apply(this,arguments)},(Mt=Et(Ct,yt.Hotspots.Object)).requestHintData=function(t,e,i){t(yt.Templates.get(K.providers[this.getData().provider].hintContentTemplate).build({content:this.getData().description,event:e,object:this,shape:i}))},Mt.requestBalloonData=function(e){var i=this.getLayer().getMap(),n=K.providers[this.getData().provider].balloonContentTemplate,o=this.getData().point;this.getLayer().getObjectSource().requestObjectData(this,function(t){t=yt.Templates.get(n).build(t,i);e(t,o)})},Ct=z.MultiObjectSource=function(t,e,i){yt.Hotspots.ObjectSource.call(this,t,e,i),this.__layers=[],this.__layerIds=[]},(Mt=Et(Ct,yt.Hotspots.ObjectSource)).addLayer=function(t,e){-1==wt.inArray(e,this.__layers)&&(this.__layers.push(e),this.__layerIds.push(t))},Mt.removeLayer=function(t){var e=wt.inArray(t,this.__layerIds);-1!=e&&(this.__layers.splice(e,1),this.__layerIds.splice(e,1),this.__request&&this.__request.layers[t]&&delete this.__request.layers[t])},Mt.getLayersAbbr=function(){return"l="+this.__layerIds.join(",")},Mt.requestObjects=function(t,e,i,n){var o,s=this.__request,a=wt.inArray(e,this.__layers),r=!0;-1!=a&&(s&&s.tile.equals(i)&&s.zoom==n||(r=!1,s=this.__request=null),this.isRestricted(e,i,n)?t([]):(o=this.getOptions().useProgramCache?this.getCachedData(this.getKey(i,n,e)):o)?t(o):(a=this.__layerIds[a],r?s.layers[a]&&s.layers[a].data?t(s.layers[a].data):s.layers[a]={callback:t}:(this.__request={tile:i.copy(),zoom:n,layers:{}},this.__request.layers[a]={callback:t},this.__load())))},Mt.parseResponse=function(t,e,i,n){if(!e||e.error)return[];if(!t.getMap())return[];var o=this.__getLayerData(t,e.data);if(!o)return[];for(var s=[],a=this.__layerIds[wt.inArray(t,this.__layers)],r=new yt.Point(256*i.getX(),256*i.getY()),h=0,l=o.features.length;h<l;h++){var c=o.features[h],u=c.properties.HotspotMetaData||{},d=u.zIndex,p=this.__makeShapes(r,u.RenderedGeometry),d=this.createObject(t,p,{id:u.id,provider:"trj"==a?"traffic":"traffic-events",description:c.properties.hintContent},{priority:d});s.push(d)}return s},Mt.__getLayerData=function(t,e){var i=wt.inArray(t,this.__layers);if(-1==i)return null;var n=this.__layerIds[i],i=e.properties.HotspotSearchMetaData.HotspotSearchResponse.layer;if(wt.isArray(i)&&-1!=wt.inArray(n,i)){for(var o=0,s=e.features.length;o<s;o++){var a=this.__getLayerData(t,e.features[o]);if(a)return a}return null}return i==n?e:null},Mt.__load=function(){for(var t=this.__request,e=t.tile,i=t.zoom,t=this.getTileUrl(e,i),n={key:[],callback:[],context:[],cache:this.getOptions().useBrowserCache,format:"json"},o=0,s=this.__layers.length;o<s;o++)n.key.push(this.getKey(e,i,this.__layers[o])),n.callback.push(this.__getCallback(e,i,this.__layers[o])),n.context.push(this);H.load(t,n)},Mt.__getCallback=function(n,o,s){return function(t){var e,i=wt.inArray(s,this.__layers);-1!=i&&(e=this.parseResponse(s,t,n,o),this.getOptions().useProgramCache&&this.cacheData(this.getKey(n,o,s),e),t=this.__request,i=this.__layerIds[i],t&&t.tile.equals(n)&&t.zoom==o&&((i=t.layers[i]||(t.layers[i]={})).data=e,i.callback&&i.callback(e)))}},Mt.__makeShapes=function(t,e){e.coordinates;var t=[t.getX(),t.getY()],i=this.__makeCoordinates(e.coordinates,t);switch(e.type){case"Rectangle":return[new this.__shapes.rect(this.__makePlainCoordinates(i))];case"Polygon":return[new this.__shapes.npoly(this.__makePlainCoordinates(i[0]))];case"MultiPolygon":for(var n=[],o=0,s=i.length;o<s;o++)n.push(new this.__shapes.npoly(this.__makePlainCoordinates(i[o][0])));return n;case"ConvexPolygon":return[new this.__shapes.cpoly(this.__makePlainCoordinates(i[0]))];case"MultiConvexPolygon":for(n=[],o=0,s=i.length;o<s;o++)n.push(new this.__shapes.cpoly(this.__makePlainCoordinates(i[o][0])));return n}},Mt.__makeCoordinates=function(t,e){var i=[];if(t[0].length)for(var n=0,o=t.length;n<o;n++)i[n]=this.__makeCoordinates(t[n],e);else i=[t[0]+e[0],t[1]+e[1]];return i},Mt.__makePlainCoordinates=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(t[i][0]),e.push(t[i][1]);return e},Mt.clearCache=function(){this.__request=null,yt.Hotspots.ObjectSource.prototype.clearCache.call(this)},Mt.getTileUrl=function(t,e){return yt.Hotspots.ObjectSource.prototype.getTileUrl.call(this,t,e).replace("%l",this.getLayersAbbr())},Mt.getKey=function(t,e,i){e=yt.Hotspots.ObjectSource.prototype.getKey.call(this,t,e);return!i||-1!=(i=wt.inArray(i,this.__layers))&&(e=e.replace("%l","l="+this.__layerIds[i])),e},Ct=z.TrafficMultiSource=function(t,e,i,n){this.__timestamp=i,z.MultiObjectSource.call(this,t,e,n)},(Mt=Et(Ct,z.MultiObjectSource)).setTimestamp=function(t){this.__timestamp=t},Mt.applyTimestamp=function(t){return t.replace("%t","tm="+this.__timestamp).replace("%s",this.__timestamp)},Mt.getTileUrl=function(t,e){return this.applyTimestamp(z.MultiObjectSource.prototype.getTileUrl.call(this,t,e))},Mt.getKey=function(t,e,i){return this.applyTimestamp(z.MultiObjectSource.prototype.getKey.call(this,t,e,i))},Mt.applyLayer=function(t,e){e=("traffic"==e?K.layers.jams:K.layers.info).js;return this.applyTimestamp(t.replace("%l","l="+e))},Mt.applyObjectId=function(t,e){e=e.getData();return this.applyLayer(t.replace("%j",e.id),e.provider)},Mt.requestObjectData=function(t,i){var e=t.getData(),n=e.id,o=K.providers[e.provider];this.__lastObjectDataKey=this.applyObjectId(o.keyTemplate,t),H.load(this.applyObjectId(o.urlTemplate,t),{key:this.__lastObjectDataKey,callback:function(t){var e;o.counters&&o.counters.load&&(e=o.counters.load.replace("%p",n+"."+t.type).replace("%u",+new Date),wt.ajax({url:e,cache:!0,dataType:"script"})),i(t)},cache:this.getOptions().useBrowserCache})},Mt.cancelObjectDataRequest=function(){this.__lastObjectDataKey&&H.cancel(this.__lastObjectDataKey)},Mt.createObject=function(t,e,i,n){return new z.TrafficObject(t,e,i,n)},Ct=z.AView=function(t){this.__provider=t,this.__listeners=[],this.__addedLayers=[],this.__addedOverlays=[]},(Mt=Ct.prototype).onAdd=function(t){this.__control=t,this.__provider.isInited()?(this.__updateLayers(),this.__updateOverlays(),this.beginListening()):this.__initListener=yt.Events.observe(this.__provider,this.__provider.Events.Init,this.__onProviderInit,this)},Mt.onRemove=function(){this.__control&&(this.__provider.isInited()?(this.stopListening(),this.__removeLayers(this.__addedLayers),this.__removeOverlays(this.__addedOverlays),this.__addedLayers=this.__addedOverlays=[],this.__control=null):this.__initListener.cleanup())},Mt.getProvider=function(){return this.__provider},Mt.getControl=function(){return this.__control},Mt.__onProviderInit=function(){this.__initListener.cleanup(),this.__updateLayers(),this.__updateOverlays(),this.beginListening()},Mt.beginListening=function(){var t=this.__control,e=this.__provider,i=t.getMap();this.__listeners=[yt.Events.observe(t,t.Events.StateChange,this.__onUpdate,this),yt.Events.observe(e,e.Events.StateChange,this.__onUpdate,this),yt.Events.observe(i,i.Events.Update,this.__onUpdate,this)]},Mt.stopListening=function(){Ot(this.__listeners,"cleanup")},Mt.getVisibleLayers=function(){return[]},Mt.getVisibleOverlays=function(){return[]},Mt.__onUpdate=function(){this.__updateLayers(),this.__updateOverlays()},Mt.__updateLayers=function(){var t=this.getVisibleLayers(),e=gt(this.__addedLayers,t);e.equals||(this.__removeLayers(e.removed),this.__addLayers(e.added)),this.__addedLayers=t},Mt.__updateOverlays=function(){var t=this.getVisibleOverlays(),e=gt(this.__addedOverlays,t);e.equals||(this.__removeOverlays(e.removed),this.__addOverlays(e.added)),this.__addedOverlays=t},Mt.__addLayers=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.addLayer(t[i])},Mt.__removeLayers=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.removeLayer(t[i])},Mt.__addOverlays=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.addOverlay(t[i])},Mt.__removeOverlays=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.removeOverlay(t[i])},Ct=z.ActualView=function(t){z.AView.call(this,t),this.__trafficLayerListeners=[]},(Mt=Et(Ct,z.AView)).getVisibleLayers=function(){var t,e,i=[];return!this.__isLocalZoom()||(t=this.getControl().getState()).shown&&(e=this.getProvider().getLayers(),i.push(e.png,e.jams),t.infoLayerShown&&i.push(e.info)),i},Mt.getVisibleOverlays=function(){var t=[];return!this.__isLocalZoom()&&this.getControl().getState().shown&&t.push(this.getProvider().getRegionCollection()),t},Mt.__isLocalZoom=function(){return Yt(this.getControl().getMap().getZoom())},Mt.onAdd=function(t){z.AView.prototype.onAdd.call(this,t);var e,i=t.getMap(),n=i.getZoom(),t=this.getProvider().getLayers().jams;this.__trafficLayerListeners=[yt.Events.observe(t,t.Events.BalloonOpen,function(){e=1}),yt.Events.observe(t,t.Events.BalloonClose,function(){e=0}),yt.Events.observe(i,i.Events.Update,function(){n!=i.getZoom()&&(n=i.getZoom(),e&&i.closeBalloon())})]},Mt.onRemove=function(){Ot(this.__trafficLayerListeners,"cleanup"),z.AView.prototype.onRemove.call(this)},Ct=z.ArchiveView=function(t){z.AView.call(this,t)},(Mt=Et(Ct,z.AView)).getVisibleLayers=function(){var t,e=[];return this.__isLocalZoom()&&this.getControl().getState().shown&&this.getProvider().getState().timeZone!=z.TimeZone.UNKNOWN&&(t=this.getProvider().getLayers(),e.push(t.png,t.js)),e},Mt.getVisibleOverlays=function(){var t=[];return!this.__isLocalZoom()&&this.getControl().getState().shown&&this.getProvider().getState().action==yt.State.SUCCESS&&t.push(this.getProvider().getRegionCollection()),t},Mt.__isLocalZoom=function(){return Yt(this.getControl().getMap().getZoom())},z.InfoLayerSwitcher=function(e){var i,n,o,t;function s(){i&&n.attr("checked",e.getState().infoLayerShown?"checked":null)}function a(){e.setState({infoLayerShown:!e.getState().infoLayerShown})}function r(t){a(),t.stopPropagation()}function h(){t=window.setTimeout(function(){t=null,s()},0)}this.onAddToParent=function(t){i=wt(t),wt('<input type="checkbox" class="YMaps-traffic-button-layers__control"'+(e.getState().infoLayerShown?' checked="checked"':"")+'><label class="YMaps-traffic-button-layers__description">'+K.strings.infoLayer+"</label>").appendTo(i),n=i.find("input"),k(i[0],"click",a),k(n[0],"click",r),j.opera&&j.version<9.5?k(n[0],"change",s):j.msie&&(n[0].onpropertychange=h),o=yt.Events.observe(e,e.Events.StateChange,s)},this.onRemoveFromParent=function(){o.cleanup(),j.opera&&j.version<9.5?G(n[0],"change",s):j.msie&&(n[0].onpropertychange=null,t&&(window.clearTimeout(t),t=null)),G(n[0],"click",r),G(i[0],"click",a),i.empty(),i=null}},z.ProviderSwitcher=function(s,a,t){var r,h={},l={},c=t;this.onAddToParent=function(t){var e=document&&8<=document.documentMode;r=wt(t);for(var i=0,n=a.length;i<n;i++){var o=a[i];h[o]=wt('<span class="YMaps-traffic-provider-switcher"><input type="radio" class="YMaps-traffic-switcher-control'+(e?" YMaps-traffic-switcher-control__ie8":"")+'"'+(c==o?' checked="checked"':"")+'/><label class="YMaps-traffic-switcher-description">'+K.strings.providers[o]+"</label></span>").appendTo(r),l[o]=function(e){return function(t){"input"==t.target.tagName&&t.stopPropagation(),s.setState({provider:e})}}(o),k(h[o][0],"click",l[o])}},this.onRemoveFromParent=function(){if(r){for(var t=0,e=a.length;t<e;t++){var i=a[t];G(h[i][0],"click",l[i]),h[i].remove()}h=l=[],r=null}}},Ct=z.TimeSlider=function(t){this.__master=t,this.__listeners=[],this.__dom={},this.__domListeners={}},(Mt=z.TimeSlider.prototype).onAddToParent=function(t,e){this.__$parentContainer=t;var i=this,n=this.__master.getProvider().getState(),o=e?" YMaps-cursor-pointer":"";wt('<i class="YMaps-traffic-button-time__minus'+o+'"></i><i class="YMaps-traffic-button-time__plus'+o+'"></i><div class="YMaps-traffic-button-time__scale-line'+o+'"></div>'+this.__getTimeMarkersHTML()+'<div style="left: '+this.__getSliderOffset(n)+'px;"class="YMaps-traffic-button-time__slider YMaps-cursor-pointer'+(e?"":" "+Z)+'"><i class="YMaps-traffic-button-time__slider-i"></i></div>').appendTo(t),this.__dom={$minus:t.find(".YMaps-traffic-button-time__minus"),$plus:t.find(".YMaps-traffic-button-time__plus"),$scale:t.find(".YMaps-traffic-button-time__scale-line"),$slider:t.find(".YMaps-traffic-button-time__slider")},this.__domListeners.minusClick=function(){i.__moveBy({hours:0,minutes:-15})},this.__domListeners.plusClick=function(){i.__moveBy({hours:0,minutes:15})},this.__dragAndDrop=new yt.Utils.DragAndDrop.MouseMove(t[0]),e&&this.enable()},Mt.onRemoveFromParent=function(){this.__$parentContainer&&(this.__enabled&&this.disable(),this.__$parentContainer.empty(),this.__$parentContainer=null,this.__dom={})},Mt.enable=function(){this.__$parentContainer&&!this.__enabled&&(k(this.__dom.$minus[0],"click",this.__domListeners.minusClick),k(this.__dom.$plus[0],"click",this.__domListeners.plusClick),this.__listeners=[yt.Events.observe(this.__dragAndDrop,"start",this.__onDragStart,this),yt.Events.observe(this.__dragAndDrop,"move",this.__onDrag,this),yt.Events.observe(this.__dragAndDrop,"stop",this.__onDragEnd,this)],this.__dragAndDrop.beginListening(),this.__dom.$slider.removeClass(Z),this.__dom.$scale.addClass("YMaps-cursor-pointer"),this.__dom.$plus.addClass("YMaps-cursor-pointer"),this.__dom.$minus.addClass("YMaps-cursor-pointer"),this.__enabled=1)},Mt.disable=function(){this.__$parentContainer&&this.__enabled&&(this.__isDragged&&this.abort(),G(this.__dom.$minus[0],"click",this.__domListeners.minusClick),G(this.__dom.$plus[0],"click",this.__domListeners.plusClick),Ot(this.__listeners,"cleanup"),this.__dragAndDrop.stopListening(),this.__dom.$slider.addClass(Z),this.__dom.$scale.removeClass("YMaps-cursor-pointer"),this.__dom.$plus.removeClass("YMaps-cursor-pointer"),this.__dom.$minus.removeClass("YMaps-cursor-pointer"),this.__enabled=0)},Mt.update=function(t){this.__applyTime(t)},Mt.abort=function(){this.__dragAndDrop.abort(),this.__cancelDragUpdate()},Mt.__getTimeMarkersHTML=function(){for(var t=this.__master.getOptions().timeScale,e=t.markers,i=t.step,n="",o=0,s=e.length;o<s;o++)n+='<i style="left: '+(i*e[o]).toString()+'px;" class="YMaps-traffic-button-time__scale__marker"><i class="YMaps-traffic-button-time__scale__marker-time">'+Nt(Math.floor(e[o]),60*(e[o]-Math.floor(e[o])))+"</i></i>";return n},Mt.__getSliderOffset=function(t){var e=this.__master.getOptions().timeScale,i=t.timeZone==z.TimeZone.UNKNOWN?0:t.timeZone;return xt.cycleRestrict(i+t.hours+t.minutes/60,0,24)*e.step-e.sliderSize/2},Mt.__moveSlider=function(t){t=this.__getSliderOffset(t);this.__dom.$slider.css("left")!=t&&this.__dom.$slider.css("left",t)},Mt.__moveBy=function(t){var e=this.__master.getProvider().getState(),i=e.hours+t.hours,t=e.minutes+t.minutes;this.__master.getProvider().setState(this.__getAdjustedState({hours:i,minutes:t}))},Mt.__applyTime=function(t){var e=t.timeZone==z.TimeZone.UNKNOWN?0:t.timeZone;this.__moveSlider(t),this.__master.setDisplayTime(Nt(xt.cycleRestrict(t.hours+e,0,24),t.minutes))},Mt.__onDragStart=function(t){this.__initialDragX=t.clientX;var e=this.__$parentContainer.offset().left,i=e+24*this.__master.getOptions().timeScale.step,n=t.clientX,o=this.__master.getOptions().timeScale.sliderSize/2+1;e-o<=n&&n<=i+o?(n=xt.boundaryRestrict(n,e-o,i+o),n={hours:-(n=(n=this.__master.getProvider().getState()).timeZone==z.TimeZone.UNKNOWN?0:n.timeZone),minutes:0,timeZone:n},n=this.__getStateByOffset(t.clientX-e,n),this.__initialState=n,this.__applyTime(n),this.__setDragUpdate(n)):this.__dragAndDrop.abort()},Mt.__onDrag=function(t){t=this.__getStateByOffset(t.clientX-this.__initialDragX,this.__initialState);this.__moveSlider(t),this.__applyTime(t),this.__setDragUpdate(t)},Mt.__onDragEnd=function(t){this.__cancelDragUpdate(),this.__updateProviderState(this.__getStateByOffset(t.clientX-this.__initialDragX,this.__initialState))},Mt.__getStateByOffset=function(t,e){var i=e.timeZone,e=e.hours+e.minutes/60,t=xt.boundaryRestrict(e+t/this.__master.getOptions().timeScale.step,-i,24-i-.25);return{hours:Math.floor(t),minutes:15*Math.floor(4*(t-Math.floor(t))),timeZone:i}},Mt.__setDragUpdate=function(t){this.__dragUpdateTimeout&&window.clearTimeout(this.__dragUpdateTimeout);var e=this;this.__dragUpdateTimeout=window.setTimeout(function(){e.__updateProviderState(t),e.__dragUpdateTimeout=null},this.__master.getOptions().timeScale.dragUpdateTimeout)},Mt.__updateProviderState=function(t){this.__master.getProvider().setState(this.__getAdjustedState(t))},Mt.__getAdjustedState=function(t){var e=this.__master.getProvider().getState(),i=F[e.dayOfWeek],n=xt.cycleRestrict(t.hours+Math.floor(t.minutes/60),0,24),o=xt.cycleRestrict(t.minutes,0,60),s=e.timeZone,t=24-s;return t<=n&&e.hours<t?i=xt.cycleRestrict(i-1,0,7):n<t&&e.hours>=t&&(i=xt.cycleRestrict(i+1,0,7)),{hours:n,minutes:o,dayOfWeek:$[i],timeZone:s}},Mt.__cancelDragUpdate=function(){this.__dragUpdateTimeout&&(window.clearTimeout(this.__dragUpdateTimeout),this.__dragUpdateTimeout=null)},Ct=z.AButtonLayout=function(t,e,i){this.__options=wt.extend({compactForm:K.compactForm,providerKey:z.ActualProvider.key},e||{}),this.__state=wt.extend({currentRegion:null},i||{}),this.__provider=t,this.__captionListeners=[],this.__controlListeners=[],this.__needWidthUpdate=j.msie&&j.version<8||document.documentMode&&document.documentMode<8},(Mt=Ct.prototype).onAddToParent=function(t){this.__$parentContainer=wt(t);var e=this.__provider.getControl(),i=e.getOptions(),t=this.__$element=wt(this.getHTML()).appendTo(this.__$parentContainer),n=t.find(".YMaps-traffic-expander");this.__captionListeners=[];for(var o,s=0,a=n.length;s<a;s++)this.__captionListeners.push(function(){e.setState({shown:!e.getState().shown})}),k(n[s],"click",this.__captionListeners[s]);this.__options.compactForm||this.__setClickCounter(),i.showProviderSwitcher&&(this.__providerSwitcher=new z.ProviderSwitcher(e,[z.ActualProvider.key,z.ArchiveProvider.key],this.__options.providerKey),this.__providerSwitcher.onAddToParent(t.find(".YMaps-traffic-provider-switcher"))),this.__controlListeners=[yt.Events.observe(e,e.Events.StateChange,this.__onControlStateChange,this),yt.Events.observe(e,e.Events.OptionsChange,this.__onControlOptionsChange,this)],this.__needWidthUpdate&&((o=this).__updateWidthTimeout=window.setTimeout(function(){o.__updateWidth(),o.__updateWidthTimeout=null},0))},Mt.onRemoveFromParent=function(){if(this.__$parentContainer){this.__updateWidthTimeout&&(window.clearTimeout(this.__updateWidthTimeout),this.__updateWidthTimeout=null),Ot(this.__controlListeners,"cleanup"),this.__provider.getControl().getOptions().showProviderSwitcher&&(this.__providerSwitcher.onRemoveFromParent(),this.__providerSwitcher=null);for(var t=this.__$element.find(".YMaps-traffic-expander"),e=0,i=t.length;e<i;e++)G(t[e],"click",this.__captionListeners[e]);this.__options.compactForm||this.__unsetClickCounter(),this.__$element.remove(),this.__$parentContainer=this.__$element=null}},Mt.startRegionChangeListening=function(){var t=this.__provider,e=t.getControl().getMap();t.isInited()?(this.setState({activeRegion:this.getActiveRegion()}),this.__regionChangeListener=yt.Events.observe(e,e.Events.BoundsChange,this.__onMapBoundsChange,this)):this.__regionChangeListener=yt.Events.observe(t,t.Events.Init,function(){this.setState({activeRegion:this.getActiveRegion()}),this.__regionChangeListener.cleanup(),this.__regionChangeListener=yt.Events.observe(e,e.Events.BoundsChange,this.__onMapBoundsChange,this)},this)},Mt.stopRegionChangeListening=function(){this.setState({activeRegion:null}),this.__regionChangeListener.cleanup()},Mt.getHTML=function(){return this.getCollapsedHTML()+this.getExpandedHTML()},Mt.getCollapsedHTML=function(){return'<div class="YMaps-btn YMaps-btn-traffic YMaps-cursor-default YMaps-traffic-collapsed'+(this.getProvider().getControl().getState().shown?" YMaps-display-none":"")+'"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i"><div class="YMaps-btn-reduce"><div class="YMaps-traffic-caption__layout">'+this.getIconHTML(K.trafficButton.icons.beta.off,"YMaps-traffic-icon")+'<span class="YMaps-btn-caption YMaps-cursor-pointer YMaps-traffic-expander">'+K.strings.jams+'</span></div></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>'},Mt.getExpandedHTML=function(){return""},Mt.getRootNodes=function(){return this.__$element},Mt.getProvider=function(){return this.__provider},Mt.getOptions=function(){return this.__options},Mt.getState=function(){return this.__state},Mt.setState=function(t){wt.extend(this.__state,t),this.__updateWidth()},Mt.applyIcon=function(t,e){e?(j.msie&&j.ieDocumentMode<10?t.css({width:e.size.getX(),height:e.size.getY(),filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+e.href+")"}):t.html('<img src="'+e.href+'" style="width: '+e.size.getX()+"px;height:"+e.size.getY()+'px;"/>'),t.removeClass(Z)):(t.addClass(Z),j.msie&&t.css("filter",null))},Mt.getIconHTML=function(t,e){if(t){var i="width:"+t.size.getX()+"px;height:"+t.size.getY()+"px;";return j.msie?'<span class="'+e+'" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+t.href+");"+i+'"></span>':'<span class="'+e+'"><img src="'+t.href+'" style="'+i+'"/></span>'}return'<span class="'+e+" "+Z+'"></span>'},Mt.__onControlStateChange=function(){var t=this.__$parentContainer;this.__provider.getControl().getState().shown?(t.find(".YMaps-traffic-collapsed").addClass(Z),t.find(".YMaps-traffic-expanded").removeClass(Z)):(t.find(".YMaps-traffic-collapsed").removeClass(Z),t.find(".YMaps-traffic-expanded").addClass(Z)),this.__updateWidth()},Mt.__onControlOptionsChange=function(){var t=this.getProvider().getControl(),e=t.getOptions();e.showProviderSwitcher&&!this.__providerSwitcher?(this.__providerSwitcher=new z.ProviderSwitcher(t,[z.ActualProvider.key,z.ArchiveProvider.key],this.__options.providerKey),t=this.__$element.find(".YMaps-traffic-provider-switcher"),this.__providerSwitcher.onAddToParent(t)):!e.showProviderSwitcher&&this.__providerSwitcher&&(this.__providerSwitcher.onRemoveFromParent(),this.__providerSwitcher=null),this.__updateWidth()},Mt.__onMapBoundsChange=function(){this.getProvider().isInited()&&this.setState({activeRegion:this.getActiveRegion()})},Mt.getActiveRegion=function(){return this.getProvider().isInited()&&z.coverage.getRegionsByBounds(this.getProvider().getControl().getMap().getBounds())[0]||null},Mt.getActiveRegionStat=function(){var t=this.getProvider().getState().stat,e=this.getState().activeRegion;if(e&&t)for(var i=0,n=t.length;i<n;i++)if(t[i].regionId==e.regionId)return t[i];return null},Mt.__setClickCounter=function(){for(var t=this.__$element.find(".YMaps-traffic-addtext a"),e=0,i=t.length;e<i;e++)this.__clickCounter=function(){var t=K.providers.traffic.counters.click.replace("%u",+new Date);wt.ajax({url:t,cache:!0,dataType:"script"})},k(t[e],"click",this.__clickCounter)},Mt.__unsetClickCounter=function(){for(var t=this.__$element.find(".YMaps-traffic-addtext a"),e=0,i=t.length;e<i;e++)G(t[e],"click",this.__clickCounter)},Mt.__updateWidth=function(){var t,e;this.__needWidthUpdate&&(e=this.__provider.getControl().getState().shown,(e=(t=this.__$parentContainer.find((e?".YMaps-traffic-expanded":".YMaps-traffic-collapsed")+" .YMaps-btn-i")).width())%2&&t.width(e+1))},Ct=z.ActualButtonLayout=function(t,e,i){z.AButtonLayout.call(this,t,e,i),this.__actualButtonListeners=[],this.__cachedZoom=0},(Mt=Et(Ct,z.AButtonLayout)).onAddToParent=function(t){z.AButtonLayout.prototype.onAddToParent.call(this,t);var e=this.getRootNodes().parent().find(".YMaps-traffic-expanded"),i=e.find(".YMaps-btn-i"),n=this.getProvider(),o=n.getControl(),t=o.getMap();this.__dom={$top:e,$content:i,$switcher:i.find(".YMaps-traffic-info-switcher"),$switcherContainer:i.find(".YMaps-traffic-button-layers"),$level:i.find(".YMaps-traffic-button-content__traffic-level"),$full:i.find(".YMaps-traffic-button-content__traffic-hint"),$time:i.find(".YMaps-traffic-button-content__traffic-time"),$hint:i.find(".YMaps-traffic-button-content__level-hint"),$nodata:this.getRootNodes().find(".YMaps-traffic-nodata"),$smallIcon:i.find(".YMaps-btn-reduce .YMaps-traffic-button-content__img"),$fullIcon:i.find(".YMaps-btn-expand .YMaps-traffic-button-content__img")},this.__cachedZoom=this.__isLocalZoom(),this.__updateInfoSwitcher(),this.__updateProviderSwitcher(),this.__updateRegionData(),this.__actualButtonListeners=[yt.Events.observe(o,o.Events.OptionsChange,this.__onActualControlOptionsChange,this),yt.Events.observe(n,n.Events.Update,this.__onActualProviderUpdate,this),yt.Events.observe(t,t.Events.BoundsChange,this.__onActualMapBoundsChange,this)],this.startRegionChangeListening()},Mt.onRemoveFromParent=function(){this.stopRegionChangeListening(),Ot(this.__actualButtonListeners,"cleanup"),this.__infoLayerSwitcher&&(this.__infoLayerSwitcher.onRemoveFromParent(),this.__infoLayerSwitcher=null),z.AButtonLayout.prototype.onRemoveFromParent.call(this)},Mt.getExpandedHTML=function(){var t=this.getProvider().getControl(),e=t.getState(),i=this.__isFull;return'<div class="YMaps-btn YMaps-btn-traffic YMaps-cursor-default YMaps-btn_expanded YMaps-traffic-expanded'+(e.shown?"":" YMaps-display-none")+(i&&!t.getOptions().showProviderSwitcher?" YMaps-btn-traffic_with-providers":"")+'"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i"><div class="YMaps-btn-reduce"><div class="YMaps-traffic-caption__layout"><span class="YMaps-traffic-provider-switcher YMaps-traffic-switchers"></span>'+this.getIconHTML(this.__getSmallIcon(),"YMaps-traffic-button-content__img")+'<span class="YMaps-btn-caption YMaps-cursor-pointer YMaps-traffic-expander">'+K.strings.jams+'</span></div></div><div class="YMaps-traffic-button YMaps-btn-expand"><div class="YMaps-traffic-button-content YMaps-traffic-button-content_now">'+this.getIconHTML(this.__getFullIcon(),"YMaps-traffic-button-content__img")+'<p class="YMaps-traffic-button-content__traffic-level"></p><p class="YMaps-traffic-button-content__traffic-hint'+(i?"":" YMaps-display-none")+'"><span class="YMaps-traffic-button-content__traffic-time"></span><span class="YMaps-traffic-button-content__level-hint"></span></p></div><div class="YMaps-traffic-button-layers"><div class="YMaps-traffic-button-layers__item YMaps-traffic-info-switcher"></div></div><div class="YMaps-traffic-nodata YMaps-display-none"></div></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>'},Mt.__getFullIcon=function(){return this.__isFull()?K.trafficButton.icons.full[this.getActiveRegionStat().style]:null},Mt.__getSmallIcon=function(){var t=this.__isFull(),e=this.getProvider().getControl().getOptions().showProviderSwitcher;return t||e?null:K.trafficButton.icons.beta.on},Mt.__updateInfoSwitcher=function(){var t=this.getProvider(),e=t.getControl(),t=this.__isLocalZoom()&&t.isInited()&&e.getOptions().showInfoSwitcher;t&&!this.__infoLayerSwitcher&&(this.__infoLayerSwitcher=new z.InfoLayerSwitcher(e),this.__infoLayerSwitcher.onAddToParent(this.__dom.$switcher)),!t&&this.__infoLayerSwitcher&&(this.__infoLayerSwitcher.onRemoveFromParent(),this.__infoLayerSwitcher=null)},Mt.__updateRegionData=function(){var t=this.getActiveRegionStat(),e=this.__isFull(),i=this.__dom;e?(i.$level.html(Rt(t.level)).removeClass(Z),i.$time.html(t.localTime),i.$hint.html(t.hint).removeClass(Z),i.$full.removeClass(Z)):(i.$level.addClass(Z),i.$full.addClass(Z),i.$hint.addClass(Z)),t&&t.nodata?i.$nodata.html(K.strings.noRegionData).removeClass(Z):i.$nodata.html("").addClass(Z)},Mt.__updateProviderSwitcher=function(){this.__isFull()&&!this.getProvider().getControl().getOptions().showProviderSwitcher?this.__dom.$top.addClass("YMaps-btn-traffic_with-providers"):this.__dom.$top.removeClass("YMaps-btn-traffic_with-providers")},Mt.__onActualControlOptionsChange=function(){this.__updateInfoSwitcher(),this.__updateProviderSwitcher(),this.__updateIcons()},Mt.__onActualMapBoundsChange=function(){var t=this.__isLocalZoom();t!=this.__cachedZoom&&(this.__cachedZoom=t,this.__updateViewState(),this.__updateIcons(),this.__updateRegionData(),this.__updateProviderSwitcher(),this.__updateInfoSwitcher())},Mt.__updateViewState=function(){this.__isLocalZoom()?this.__dom.$switcherContainer.removeClass(Z):this.__dom.$switcherContainer.addClass(Z)},Mt.setState=function(t){var e=wt.extend({},this.getState());z.AButtonLayout.prototype.setState.call(this,t),typeof t.activeRegion!=Tt&&t.activeRegion!=e.activeRegion&&(this.__updateIcons(),this.__updateRegionData(),this.__updateProviderSwitcher(),this.__updateInfoSwitcher())},Mt.__updateIcons=function(){this.applyIcon(this.__dom.$smallIcon,this.__getSmallIcon()),this.applyIcon(this.__dom.$fullIcon,this.__getFullIcon())},Mt.__onActualProviderUpdate=function(){this.__updateIcons(),this.__updateRegionData(),this.__updateProviderSwitcher()},Mt.__isLocalZoom=function(){return Yt(this.getProvider().getControl().getMap().getZoom())},Mt.__isFull=function(){var t=this.getActiveRegionStat();return this.__isLocalZoom()&&t&&typeof t.level!=Tt},Ct=z.ArchiveButtonLayout=function(t,e,i){z.AButtonLayout.call(this,t,vt({providerKey:z.ArchiveProvider.key,timeScale:K.timeScale},e||{}),i),this.__archiveProviderListeners=[]},(Mt=Et(Ct,z.AButtonLayout)).onAddToParent=function(t){var i=this.getProvider(),e=i.getControl().getMap();this.__localZoom=this.__isLocalZoom(),this.__hasTimeZone=i.getState().timeZone!=z.TimeZone.UNKNOWN,z.AButtonLayout.prototype.onAddToParent.call(this,t);t=this.getRootNodes().parent().find(".YMaps-traffic-expanded");this.__dom={$scale:t.find(".YMaps-traffic-button-time__scale"),$select:t.find(".YMaps-traffic-day-of-week"),$disabler:t.find(".YMaps-traffic-button-time"),$time:t.find(".YMaps-traffic-button-time__header__time"),$icon:t.find(".YMaps-btn-reduce .YMaps-traffic-icon"),$level:t.find(".YMaps-traffic-button-time__header__forecast"),$scaleText:t.find(".YMaps-traffic-button-content__scale-text"),$noDataText:t.find(".YMaps-traffic-nodata")},this.__timeSlider=new z.TimeSlider(this),this.__timeSlider.onAddToParent(this.__dom.$scale,this.__localZoom&&this.__hasTimeZone);t=i.getControl();this.__archiveButtonListeners=[yt.Events.observe(i,i.Events.StateChange,this.__onProviderStateChange,this),yt.Events.observe(t,t.Events.OptionsChange,this.__onArchiveControlOptionsChange,this),yt.Events.observe(t,t.Events.StateChange,this.__onArchiveControlStateChange,this)],this.__archiveMapListener=yt.Events.observe(e,e.Events.BoundsChange,this.__onMapUpdate,this);var n=this.__dom.$select;this.__dayChangeListener=function(){var t=Number(n.attr("value")),e=i.getState();24<=e.hours+e.timeZone?t=xt.cycleRestrict(t-1,0,7):e.hours+e.timeZone<0&&(t=xt.cycleRestrict(t+1,0,7)),i.setState({dayOfWeek:$[t]}),j.msie&&wt("body").focus()},k(this.__dom.$select[0],"change",this.__dayChangeListener),this.startRegionChangeListening();var o=this;this.__updateBottomTimeout=window.setTimeout(function(){o.__bottomAnchor=o.getRootNodes().parent()[0].style.bottom,null!==o.__bottomAnchor&&"auto"!=o.__bottomAnchor&&""!==o.__bottomAnchor&&(o.__needBottomUpdate=1,o.__updateBottom()),o.__updateBottomTimeout=null},0)},Mt.onRemoveFromParent=function(){this.__updateBottomTimeout&&window.clearTimeout(this.__updateBottomTimeout),this.stopRegionChangeListening(),this.__timeSlider.onRemoveFromParent(),Ot(this.__archiveButtonListeners,"cleanup"),this.__archiveMapListener.cleanup(),G(this.__dom.$select[0],"change",this.__dayChangeListener),this.__needBottomUpdate&&(this.getRootNodes().parent().css("bottom",this.__bottomAnchor),this.__needBottomUpdate=0),z.AButtonLayout.prototype.onRemoveFromParent.call(this)},Mt.getExpandedHTML=function(){var t=this.getProvider().getLocalTime(),e=this.__hasTimeZone&&this.__localZoom;return'<div class="YMaps-btn YMaps-btn-traffic YMaps-cursor-default YMaps-btn_expanded YMaps-btn_expanded-usually YMaps-traffic-expanded"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i"><div style="display: block;" class="YMaps-btn-reduce"><div class="YMaps-traffic-caption__layout"><span class="YMaps-traffic-provider-switcher YMaps-traffic-switchers"></span>'+this.getIconHTML(this.__getIcon(),"YMaps-traffic-icon")+'<span class="YMaps-btn-caption YMaps-cursor-pointer YMaps-traffic-expander">'+K.strings.jams+'</span></div></div><i class="YMaps-btn-reduce__inner-corner"><i class="YMaps-btn-reduce__inner-corner-i"></i></i><div class="YMaps-btn-expand"><div class="YMaps-traffic-button-content"><div class="YMaps-traffic-button-content_usually"><i class="YMaps-btn-round YMaps-btn-round_half"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-traffic-button-content_usually-i"><div class="YMaps-traffic-button-content_usually-i2"><div class="YMaps-traffic-button-time'+(e?"":" YMaps-traffic-button-content__disabled")+'"><div class="YMaps-traffic-button-time__header"><select class="YMaps-traffic-day-of-week"'+(e?"":' disabled="disabled"')+">"+this.__getDayOfWeeksHTML(t.dayOfWeek)+'</select><i class="YMaps-traffic-button-time__header__time">'+Nt(t.hours,t.minutes)+'</i><div class="YMaps-traffic-button-time__header__forecast">'+this.__getLevelHTML()+'</div></div><div class="YMaps-traffic-button-time__scale"></div><p class="YMaps-traffic-button-content__scale-text'+(this.__localZoom&&!this.__hasTimeZone?" "+Z:"")+'">'+K.strings.archiveDataText+'</p><div class="YMaps-traffic-nodata'+(this.__localZoom&&!this.__hasTimeZone?"":" "+Z)+'">'+K.strings.noTimeZone+'</div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div></div></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>'},Mt.__getIcon=function(){var t=this.__isFull(),e=this.getProvider().getControl().getOptions().showProviderSwitcher;return t||e?null:K.trafficButton.icons.beta.on},Mt.__getLevelHTML=function(){var t=this.getActiveRegionStat();return this.__isFull()?this.getIconHTML(K.trafficButton.icons.full[t.style],"YMaps-traffic-button-content__img")+'<p class="YMaps-traffic-button-content__traffic-level">'+Rt(t.level)+"</p>":""},Mt.__getDayOfWeeksHTML=function(t){for(var e="",i=0;i<7;i++)e+='<option value="'+i+'"'+(i==F[t]?' selected="selected"':"")+">"+K.strings.daysOfWeek[i]+"</option>";return e},Mt.setState=function(t){var e=wt.extend({},this.getState());z.AButtonLayout.prototype.setState.call(this,t),typeof t.activeRegion!=Tt&&t.activeRegion!=e.activeRegion&&(this.__updateIcon(),this.__updateLevelData(),this.__applyEnableState())},Mt.setDisplayTime=function(t){this.getRootNodes()&&this.__dom.$time.html(t)},Mt.__onMapUpdate=function(){this.__updateIcon(),this.__updateLevelData(),this.__applyEnableState()},Mt.__onArchiveControlOptionsChange=function(){this.__updateIcon()},Mt.__onArchiveControlStateChange=function(){this.__updateBottom()},Mt.__onProviderStateChange=function(){this.__selectDay(this.getProvider().getLocalTime().dayOfWeek),this.__applyEnableState(),this.getProvider().getState().action==yt.State.SUCCESS&&(this.__updateIcon(),this.__updateLevelData())},Mt.__applyEnableState=function(){var t=this.__dom,e=this.getProvider().getState(),i=this.__isLocalZoom(),n=e.timeZone!=z.TimeZone.UNKNOWN,o=this.__localZoom&&this.__hasTimeZone,s=i&&n,e=(this.getRootNodes(),i!=this.__localZoom||n!=this.__hasTimeZone);this.__timeSlider.update(this.getProvider().getState()),e&&(o!=s&&(s?(this.__timeSlider.enable(),t.$select.attr("disabled",null),t.$disabler.removeClass("YMaps-traffic-button-content__disabled")):(this.__timeSlider.disable(),t.$select.attr("disabled","disabled"),t.$disabler.addClass("YMaps-traffic-button-content__disabled"))),i&&!n?(t.$scaleText.addClass(Z),t.$noDataText.removeClass(Z)):(t.$scaleText.removeClass(Z),t.$noDataText.addClass(Z)),this.__hasTimeZone=n,this.__localZoom=i),this.__updateBottom()},Mt.__updateIcon=function(){this.applyIcon(this.__dom.$icon,this.__getIcon())},Mt.__updateLevelData=function(){this.__dom.$level.html(this.__getLevelHTML())},Mt.__selectDay=function(t){var e=F[t],t=this.__dom.$select;t.attr("selectedIndex")!=e&&t.attr({selectedIndex:e})},Mt.__isLocalZoom=function(){return Yt(this.getProvider().getControl().getMap().getZoom())},Mt.__isFull=function(){var t=this.getActiveRegionStat();return this.__isLocalZoom()&&t&&typeof t.level!=Tt},Mt.__updateBottom=function(){this.__needBottomUpdate&&this.getRootNodes().parent().css("bottom",parseInt(this.__bottomAnchor)+this.getRootNodes().find(".YMaps-traffic-button-content_usually").height()+"px")},N={},z.Providers={get:function(t){if(N[t])return new N[t]},add:function(t,e){N[t]=e}},U.Providers=z.Providers,function(){(Ct=z.ActualProvider=function(t,e){this.__options=vt(wt.extend(!0,{},n),t||{}),this.__state=vt(wt.extend(!0,{},o),e||{}),this.__buttonLayout=new z.ActualButtonLayout(this),this.__view=new z.ActualView(this),this.__controlListeners=[];var i=this;z.coverage.load(function(){i.__onCoverageReady()}),this.__autoUpdater=new z.AutoUpdater(this.__options.updateTimeout,function(){i.update()}),this.__isInited=z.coverage.state==yt.State.SUCCESS&&this.__state.timestamp,this.__sources={png:new yt.TileDataSource(this.__getPngTemplate(),!0,!1),js:new z.TrafficMultiSource(this.__options.urlTemplate,this.__options.keyTemplate,this.__state.timestamp,this.__options.objectSourceOptions)},this.__layers={png:new yt.Layer(this.__sources.png,this.__options.imageLayerOptions),jams:new yt.Hotspots.Layer(this.__sources.js,this.__options.layerOptions),info:new yt.Hotspots.Layer(this.__sources.js,this.__options.infoLayerOptions)},this.__sources.js.addLayer(this.__options.layerAliases.jams.js,this.__layers.jams)}).key="traffic#actual",(Mt=Ct.prototype).Events={StateChange:"statechange",Update:"update",Init:"init"},Mt.onAdd=function(t){this.__control=t,this.__options.autoUpdate&&(this.__autoUpdater.enable(t.getMap()),this.update()),this.__currentControlState=t.getState(),this.__sources.png.setTileUrlTemplate(this.__getPngTemplate()),this.__layers.png.update(),this.__applyLayerOptions(),this.__controlListeners=[yt.Events.observe(t,t.Events.StateChange,this.__onControlStateChange,this),yt.Events.observe(t,t.Events.OptionsChange,this.__onControlOptionsChange,this)]},Mt.onRemove=function(){this.__control&&(Ot(this.__controlListeners,"cleanup"),this.__options.autoUpdate&&this.__autoUpdater.disable(),this.__control=null)},Mt.isInited=function(){return this.__isInited},Mt.getControl=function(){return this.__control},Mt.getButtonLayout=function(){return this.__buttonLayout},Mt.getView=function(){return this.__view},Mt.__getPngTemplate=function(){var t=this.__options.layerAliases,e=this.__control&&this.__control.getState(),t=e?[t.jams.png]:[];return this.__options.urlTemplate.replace("%l","l="+t.join("%2C")).replace("%t","tm="+this.__state.timestamp)},Mt.getLayers=function(){return this.__layers},Mt.getRegionCollection=function(){return this.__regionCollection},Mt.__onCoverageReady=function(){this.__state.timestamp&&!this.__isInited&&(this.__isInited=1,this.__regionCollection=this.__buildRegionCollection(this.__state.stat),yt.Events.notify(this,this.Events.Init,this))},Mt.setState=function(t){var e;typeof t.timestamp!=Tt&&t.timestamp!=this.__state.timestamp&&(this.__state.timestamp=t.timestamp,this.__updateLayers(),e=1),typeof t.stat!=Tt&&t.stat!=this.__state.stat&&(this.__state.stat=t.stat,z.coverage.state==yt.State.SUCCESS&&(this.__regionCollection=this.__buildRegionCollection(this.__state.stat)),e=1),e&&(yt.Events.notify(this,this.Events.StateChange,this),yt.Events.notify(this,this.Events.Update,this)),!this.__isInited&&t.timestamp&&z.coverage.state==yt.State.SUCCESS&&(this.__isInited=1,yt.Events.notify(this,this.Events.Init,this))},Mt.getState=function(){return this.__state},Mt.__updateLayers=function(){for(var t in this.__sources.png.setTileUrlTemplate(this.__getPngTemplate()),this.__sources.js.setTimestamp(this.__state.timestamp),this.__layers)this.__layers.hasOwnProperty(t)&&this.__layers[t].update()},Mt.__onControlStateChange=function(){var t=this.__control.getState();this.__currentControlState=t},Mt.__onControlOptionsChange=function(){this.__applyLayerOptions()},Mt.__applyLayerOptions=function(){var t=this.__control.getOptions();this.__layers.jams.setOptions(t.layerOptions||{}),this.__layers.info.setOptions(t.infoLayerOptions||{})},Mt.update=function(){H.load(this.__options.updateUrl,{key:"stat",callback:this.__onUpdateComplete,context:this})},Mt.__onUpdateComplete=function(t){this.setState({timestamp:t.timestamp,stat:t.regions})},Mt.__buildRegionCollection=function(){return jt(this.__state.stat,this.__options.regionIconStyles)};var n={updateTimeout:K.updateTimeout,updateUrl:K.regionsStatUrl,urlTemplate:K.layers.baseUrl,keyTemplate:K.layers.key,layerOptions:K.layers.jams.layerOptions,infoLayerOptions:K.layers.info.layerOptions,imageLayerOptions:K.layers.image.layerOptions,layerAliases:{jams:{png:K.layers.jams.png,js:K.layers.jams.js},info:{png:K.layers.info.png,js:K.layers.info.js}},objectSourceOptions:{useBrowserCache:1,useProgramCache:1,programCacheEntries:K.hotspotsCacheSize},regionContentTemplate:K.regionContentTemplate,regionIconStyles:K.semaphoreStyles,autoUpdate:1},o={timestamp:null,stat:null};z.Providers.add(Ct.key,function(){return new z.ActualProvider})}(),function(){(Ct=z.ArchiveProvider=function(t,e){this.__buttonLayout=new z.ArchiveButtonLayout(this),this.__view=new z.ArchiveView(this),this.__options=wt.extend(!0,{},n,t||{}),this.__state=wt.extend(!0,{},o,e||{}),this.__sources={png:new yt.TileDataSource(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.png),!0,!1),js:new z.MultiObjectSource(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.js),this.__processTemplate(this.__options.keyTemplate,this.__options.layerAliases.js))};var i=this;this.__sources.js.requestObjectData=function(t,e){t=t.getData().id;H.load(i.__getObjectUrl(t),{key:i.__getObjectKey(t),callback:e,cache:this.getOptions().useBrowserCache})},this.__sources.js.createObject=function(t,e,i,n){return new z.TrafficObject(t,e,i,n)},this.__layers={png:new yt.Layer(this.__sources.png,this.__options.imageLayerOptions),js:new yt.Hotspots.Layer(this.__sources.js,this.__options.layerOptions)},this.__sources.js.addLayer(this.__options.layerAliases.js,this.__layers.js),this.__state.version||H.load(this.__options.versionUrl,{key:"version",callback:this.__onVersionLoad,context:this}),z.coverage.load(function(){i.__onCoverageLoad()}),this.__isInited=this.__state.version&&z.coverage.state==yt.State.SUCCESS,this.__isInited&&this.__loadStat()}).key="traffic#archive",(Mt=Ct.prototype).Events={StateChange:"statechange",Update:"update",Init:"init"},Mt.getButtonLayout=function(){return this.__buttonLayout},Mt.getView=function(){return this.__view},Mt.getControl=function(){return this.__control},Mt.isInited=function(){return this.__isInited},Mt.onAdd=function(t){this.__control=t,this.__layers.js.setOptions(t.getOptions().layerOptions||{}),this.__controlOptionsChangeListener=yt.Events.observe(t,t.Events.OptionsChange,function(){this.__layers.js.setOptions(t.getOptions().layerOptions||{})},this);var e=t.getMap();this.__options.autoTimeZoneUpdate&&(this.__boundsChangeListener=yt.Events.observe(e,e.Events.BoundsChange,this.__onMapBoundsChange,this),this.updateTimeZone(t.getMap().getCenter()))},Mt.onRemove=function(){this.__control&&(this.__options.autoTimeZoneUpdate&&this.__boundsChangeListener.cleanup(),this.__controlOptionsChangeListener.cleanup(),this.__control=null)},Mt.update=function(){},Mt.setState=function(e){var t,i,n=wt.extend({},this.__state);function o(t){return typeof e[t]!=Tt&&e[t]!=n[t]}o("dayOfWeek")&&(this.__state.dayOfWeek=e.dayOfWeek,i=t=1),o("hours")&&(this.__state.hours=e.hours,i=t=1),o("minutes")&&(this.__state.minutes=e.minutes,i=t=1),o("timeZone")&&(this.__state.timeZone=e.timeZone,t=1),o("dst")&&(this.__state.dst=e.dst,t=1),o("version")&&(this.__state.version=e.version,i=t=1),o("action")&&(this.__state.action=e.action,t=1),o("stat")&&(this.__state.stat=e.stat,this.__regionCollection=jt(this.__state.stat,this.__options.regionIconStyles),t=1),i&&(this.__sources.png.setTileUrlTemplate(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.png)),this.__sources.js.setTileUrlTemplate(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.js)),this.__sources.js.setKeyTemplate(this.__processTemplate(this.__options.keyTemplate,this.__options.layerAliases.js)),this.__layers.png.update(),this.__layers.js.update(),this.__isInited&&this.__loadStat()),t&&yt.Events.notify(this,this.Events.StateChange,this),e.version&&z.coverage.state==yt.State.SUCCESS&&!this.__isInited&&(this.__isInited=1,yt.Events.notify(this,this.Events.Init,this),this.__loadStat())},Mt.getState=function(){return this.__state},Mt.getLayers=function(){return this.__layers},Mt.getRegionCollection=function(){return this.__regionCollection},Mt.__onVersionLoad=function(t){this.setState({version:t.version})},Mt.__processTemplate=function(t,e){return t.replace("%r",this.__state.version).replace("%s",this.__getTimestamp()).replace("%v","v="+this.__state.version).replace("%l","l="+(e||"")).replace("%t","tm="+this.__getTimestamp())},Mt.__getTimestamp=function(){var t=F[this.__state.dayOfWeek],e=this.__state.dst?this.__state.hours+1:this.__state.hours;return 24<=e&&(t=xt.cycleRestrict(t+1,0,7),e-=24),xt.cycleRestrict(86400*t+3600*e+60*this.__state.minutes,0,604800)},Mt.__getObjectUrl=function(t){return this.__processTemplate(this.__options.objectUrlTemplate).replace("%j",t)},Mt.__getObjectKey=function(t){return this.__options.objectKeyTemplate.replace("%j",t)},Mt.updateTimeZone=function(t){z.TimeZone.get(t,this.__onTimeZoneLoad,this)},Mt.__onTimeZoneLoad=function(t,e){this.setState({timeZone:t,dst:e})},Mt.__onMapBoundsChange=function(){this.updateTimeZone(this.__control.getMap().getCenter())},Mt.getLocalTime=function(){var t=this.__state.minutes,e=Number(this.__state.timeZone!=z.TimeZone.UNKNOWN?this.__state.timeZone:0),i=Number(this.__state.hours)+e,e=F[this.__state.dayOfWeek];return 24<=i?(i-=24,e=xt.cycleRestrict(e+1,0,7)):i<0&&(i+=24,e=xt.cycleRestrict(e-1,0,7)),{hours:i,minutes:t,dayOfWeek:$[e]}},Mt.__onCoverageLoad=function(){this.__regionCollection=this.__buildRegionCollection(),this.__state.version&&!this.__isInited&&(this.__isInited=1,yt.Events.notify(this,this.Events.Init,this),this.__loadStat())},Mt.__buildRegionCollection=function(){return jt(this.__state.stat,this.__options.regionIconStyles)},Mt.__loadStat=function(){this.__state.stat=null,this.__state.action=yt.State.LOADING,H.load(this.__processTemplate(this.__options.statUrlTemplate),{key:"archive-stat",callback:function(t){Number(t.timestamp)==this.__getTimestamp()&&this.setState({action:yt.State.SUCCESS,stat:t.regions})},context:this})},z.Providers.add(Ct.key,function(){return new z.ArchiveProvider});var n={versionUrl:K.archiveVersionUrl,urlTemplate:K.layers.archive.baseUrl,keyTemplate:K.layers.archive.key,statUrlTemplate:K.archiveStatUrl,objectUrlTemplate:K.layers.archive.objectUrlTemplate,objectKeyTemplate:K.layers.archive.objectKeyTemplate,layerOptions:K.layers.archive.layerOptions,imageLayerOptions:K.layers.archive.layerOptions,regionIconStyles:K.semaphoreStyles,autoTimeZoneUpdate:1,layerAliases:{png:K.layers.archive.png,js:K.layers.archive.js}},o={version:null,timeZone:z.TimeZone.UNKNOWN,dst:!1,dayOfWeek:"Mon",hours:12,minutes:0,action:yt.State.EMPTY,stat:{}}}(),function(){U.Control=function(t,e){var n,i,o,s,a,r=wt.extend(!0,{},v,t||{}),h=wt.extend({},{shown:0,infoLayerShown:0,provider:"traffic#actual"},e||{}),l={},c=!K.compactForm,u=!1,d=this;function p(){var t=K.providers.traffic.counters.show.replace("%u",+new Date);wt.ajax({url:t,cache:!0,dataType:"script"}),c=0}function _(t){return t.shown&&t.infoLayerShown}function f(t){t=K.providers.traffic.counters.infoLayer.replace("%u",+new Date).replace("%s",t);wt.ajax({url:t,cache:!0,dataType:"script"})}function m(){var t=d.getProvider();t.onAdd(d),(i=t.getButtonLayout()).onAddToParent(o),(s=t.getView()).onAdd(d),a=yt.Events.observe(t,t.Events.Update,function(){yt.Events.notify(this,this.Events.Update,this)},d),h.provider==z.ArchiveProvider.key&&wt.ajax({url:K.archiveCounterUrl.replace("%u",+new Date),cache:!0,dataType:"script"})}function g(){a.cleanup(),s.onRemove(),i.onRemoveFromParent(),d.getProvider().onRemove()}this.Events={Show:"show",Hide:"hide",Update:"update",InfoLayerShow:"infolayershow",InfoLayerHide:"infolayerhide",StateChange:"statechange",OptionsChange:"optionschange"},this.onAddToMap=function(t,e){n=t,o=wt('<div class="YMaps-buttons" style="z-index: '+(yt.ZIndex.CONTROL||"1000")+';"></div>')[0],(e||new yt.ControlPosition(yt.ControlPosition.TOP_RIGHT,new yt.Size(5,40))).apply(o),m(),n.getContainer().appendChild(o),c&&h.shown&&p(),u!=_(h)&&f((u=_(h))?"on":"off")},this.onRemoveFromMap=function(){n&&(wt(o).remove(),g(),n=i=s=null,u=!1)},this.show=function(){this.setState({shown:1})},this.hide=function(){this.setState({shown:0})},this.isShown=function(){return this.getState().shown},this.getMap=function(){return n},this.setOptions=function(t,e){r=e?wt.extend(!0,{},v,t):wt.extend(!0,{},r,t),yt.Events.notify(this,this.Events.OptionsChange,this)},this.getOptions=function(){return wt.extend(!0,{},r)},this.setState=function(t,e){var i=e?wt.extend({},{shown:0,infoLayerShown:0,provider:z.ActualProvider.key},t):wt.extend({},h,t),e=wt.extend({},h),t=typeof i.provider!=Tt&&i.provider!=h.provider;n&&t&&g(),h=i,n&&t&&m(),e.shown!=i.shown&&yt.Events.notify(this,i.shown?this.Events.Show:this.Events.Hide,this),e.infoLayerShown!=i.infoLayerShown&&yt.Events.notify(this,i.infoLayerShown?this.Events.InfoLayerShow:this.Events.InfoLayerHide,this),u!=_(i)&&f((u=_(h))?"on":"off"),yt.Events.notify(this,this.Events.StateChange,this),n&&h.shown&&c&&p()},this.getState=function(){return wt.extend({},h)},this.update=function(){this.getProvider().update()},this.getProvider=function(){var t=h.provider;return"string"==typeof t?(l[t]||(l[t]=z.Providers.get(t)),l[t]):h.provider}};var v={layerOptions:{hasHint:1,hasBalloon:1,cursor:yt.Cursor.POINTER},infoLayerOptions:{hasHint:1,hasBalloon:1,cursor:yt.Cursor.POINTER},showInfoSwitcher:0,showProviderSwitcher:0}}()});